var XAdES=function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function r(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?t(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function n(e,t,r,a,n,i,s){try{var u=e[i](s),o=u.value}catch(e){return void r(e)}u.done?t(o):Promise.resolve(o).then(a,n)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var s=e.apply(t,r);function u(e){n(s,a,i,u,o,"next",e)}function o(e){n(s,a,i,u,o,"throw",e)}u(void 0)}))}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,t,r){return v=m()?Reflect.construct:function(e,t,r){var a=[null];a.push.apply(a,t);var n=new(Function.bind.apply(e,a));return r&&f(n,r.prototype),n},v.apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return v(e,arguments,h(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),f(a,e)},d(e)}function g(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function y(e){var t=m();return function(){var r,a=h(e);if(t){var n=h(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return p(this,r)}}function k(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var a=k(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},w.apply(this,arguments)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var a,n,i=[],s=!0,u=!1;try{for(r=r.call(e);!(s=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){u=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(u)throw n}}return i}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function C(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=N(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}var x=["name","optional","primitiveSchema"],E=["value"],I=["isHexOnly"],B=["value","isIndefiniteForm"],V=["value"],R=["isConstructed"],D=["idBlock","lenBlock"],O=["unusedBits","isConstructed"],P=["idBlock","lenBlock"],U=["value"],T=["valueDec","isFirstSid"],L=["value"],M=["valueDec"],H=["value"],_=["value","valueDate"],K=["value"],j=["value","local"],J=["name","optional","primitiveSchema"],F=["value"],G=["isHexOnly"],q=["value","isIndefiniteForm"],X=["value"],W=["isConstructed"],z=["idBlock","lenBlock"],Q=["unusedBits","isConstructed"],Y=["idBlock","lenBlock"],Z=["value"],$=["valueDec","isFirstSid"],ee=["value"],te=["valueDec"],re=["value"],ae=["value","valueDate"];function ne(e,t,r,n){var i,s=arguments.length,u=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":a(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(u=(s<3?i(u):s>3?i(t,r,u):i(t,r))||u);return s>3&&u&&Object.defineProperty(t,r,u),u}var ie="element",se="attribute",ue="content",oe=1e9;function le(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function ce(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=le({},r.items)),r.target=t}}function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var a=t.constructor,n=r;a.items||(a.items={}),a.target!==a&&(a.items=le({},a.items)),a.target=t,e.parser?a.items[n]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||oe,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:a.items[n]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter,noRoot:e.noRoot||!1},e.localName=e.localName||e.parser&&e.parser.localName||n,a.items[n].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,a.items[n].prefix=e.prefix||e.parser&&e.parser.prefix||null,a.items[n].localName=e.localName,a.items[n].type=ie,ve(t,n,e)}}function fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var a=t.constructor,n=r;e.localName||(e.localName=r),a.items||(a.items={}),a.target!==a&&(a.items=le({},a.items)),a.target=t,a.items[r]=e,a.items[r].type=se,ve(t,n,e)}}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1};return function(t,r){var a=t.constructor,n=r;a.items||(a.items={}),a.target!==a&&(a.items=le({},a.items)),a.target=t,a.items[r]=e,a.items[r].type=ue,ve(t,n,e)}}function ve(e,t,r){var a="_".concat(t),n={set:function(e){this[a]!==e&&(this.element=null,this[a]=e)},get:function(){if(void 0===this[a]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[a]=e}return this[a]}};Object.defineProperty(e,a,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,n)}var de=function(){function e(t){s(this,e),this.items=new Array,t&&(this.items=t)}return o(e,[{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e}))}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}}]),e}();function ge(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=e,i=/[^%](%\d+)/g,s=null,u=[];s=i.exec(n);)u.push({arg:s[1],index:s.index});for(var o=u.length-1;o>=0;o--){var l=u[o],c=l.arg.substring(1),h=l.index+1;n=n.substring(0,h)+arguments[+c]+n.substring(h+1+c.length)}return n=n.replace("%%","%")}function pe(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var ye,ke=o((function e(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];s(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=we[t];var i=ge.apply(this,arguments);this.message="".concat(this.prefix).concat(pe(t,4),": ").concat(i),this.stack=new Error(this.message).stack}));!function(e){e[e.NONE=0]="NONE",e[e.NULL_REFERENCE=1]="NULL_REFERENCE",e[e.NULL_PARAM=2]="NULL_PARAM",e[e.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",e[e.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",e[e.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",e[e.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",e[e.PARAM_REQUIRED=7]="PARAM_REQUIRED",e[e.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",e[e.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",e[e.ELEMENT_MISSING=10]="ELEMENT_MISSING",e[e.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",e[e.CONTENT_MISSING=12]="CONTENT_MISSING",e[e.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",e[e.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",e[e.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",e[e.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",e[e.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",e[e.XML_EXCEPTION=18]="XML_EXCEPTION"}(ye||(ye={}));var we={};we[ye.NONE]="No description",we[ye.NULL_REFERENCE]="Null reference",we[ye.NULL_PARAM]="'%1' has empty '%2' object",we[ye.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",we[ye.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",we[ye.METHOD_NOT_IMPLEMENTED]="Method is not implemented",we[ye.METHOD_NOT_SUPPORTED]="Method is not supported",we[ye.PARAM_REQUIRED]="Required parameter is missing '%1'",we[ye.CONVERTER_UNSUPPORTED]="Converter is not supported",we[ye.ELEMENT_MALFORMED]="Malformed element '%1'",we[ye.ELEMENT_MISSING]="Element '%1' is missing in '%2'",we[ye.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",we[ye.CONTENT_MISSING]="Content is missing in '%1'",we[ye.CRYPTOGRAPHIC]="Cryptographic error: %1",we[ye.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",we[ye.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",we[ye.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",we[ye.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",we[ye.XML_EXCEPTION]="XML exception: %1";var be,Se=function(){function e(){s(this,e)}return o(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new ke(ye.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new ke(ye.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");throw new ke(ye.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Uint8Array(Buffer.from(e,"base64"));throw new ke(ye.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r].toString(16);t.push(1===a.length?"0"+a:a)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var a=e.slice(r,r+2);t[r/2]=parseInt(a,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),Ne="application/xml";!function(e){e[e.None=0]="None",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation",e[e.Whitespace=13]="Whitespace",e[e.SignificantWhitespace=14]="SignificantWhitespace",e[e.EndElement=15]="EndElement",e[e.EndEntity=16]="EndEntity",e[e.XmlDeclaration=17]="XmlDeclaration"}(be||(be={}));var Ae,Ce=function(e,t){throw new Error("Not implemented")};if("undefined"==typeof self){Ae=global;var xe=require("@xmldom/xmldom");Ce=require("xpath.js"),Ae.XMLSerializer=xe.XMLSerializer,Ae.DOMParser=xe.DOMParser,Ae.DOMImplementation=xe.DOMImplementation,Ae.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else Ae=self;var Ee="undefined"!=typeof self?function(e,t){for(var r,a=null==e.ownerDocument?e:e.ownerDocument,n=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),i=a.evaluate(t,e,n,XPathResult.ANY_TYPE,null),s=[];r=i.iterateNext();)s.push(r);return s}:Ce;function Ie(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,Ne)}function Be(e,t){var r=Ee(e,t);return r&&r.length>0?r[0]:null}function Ve(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function Re(e,t){return e&&e.nodeType===t}function De(e){return Re(e,be.Element)}function Oe(e){return Re(e,be.Document)}var Pe={get:function(e){if(e)return Se.ToBase64(e)},set:function(e){return Se.FromBase64(e)}},Ue={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},Te="xml_root",Le=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI,t)for(var r=0,a=Object.entries(t);r<a.length;r++){var n=b(a[r],2),i=n[0],u=n[1];void 0!==u&&(this[i]=u)}}return o(e,[{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}},{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],a=this[t];if(r.parser&&a&&a.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(t){if(!t&&!this.HasChanged())return this.element||null;var r=this.CreateDocument(),a=this.CreateElement(),n=this.GetStatic(),i=this.localName;if(n.items)for(var s in n.items)if(n.items.hasOwnProperty(s)){var u=this[s],o=n.items[s];switch(o.type){case ue:var l=o,c=l.converter?l.converter.get(u):u;if(l.required&&null==c)throw new ke(ye.CONTENT_MISSING,i);(l.defaultValue!==u||l.required)&&(a.textContent=c);break;case se:var h=o,f=h.converter?h.converter.get(u):u;if(h.required&&null==f)throw new ke(ye.ATTRIBUTE_MISSING,h.localName,i);(h.defaultValue!==u||h.required)&&(h.namespaceURI?a.setAttributeNS(h.namespaceURI,h.localName,f):a.setAttribute(h.localName,f));break;case ie:var m=o,v=null;if(m.parser){if(m.required&&!u||m.minOccurs&&!u.Count)throw new ke(ye.ELEMENT_MISSING,u.localName,i);u&&(v=u.GetXml(void 0===u.element&&(m.required||u.Count)))}else{var d=m.converter?m.converter.get(u):u;if(m.required&&void 0===d)throw new ke(ye.ELEMENT_MISSING,m.localName,i);if(u!==m.defaultValue||m.required)if(v=m.namespaceURI?r.createElementNS(m.namespaceURI,"".concat(m.prefix?m.prefix+":":"").concat(m.localName)):r.createElement("".concat(m.prefix?m.prefix+":":"").concat(m.localName)),Array.isArray(d)){var g,p=C(d);try{for(p.s();!(g=p.n()).done;){var y=g.value,k=y instanceof e?y.GetXml(!0):y;null!==k&&v.appendChild(k)}}catch(e){p.e(e)}finally{p.f()}}else d instanceof e?v.appendChild(d.GetXml(!0)):v.textContent=d}if(v)if(m.noRoot){for(var w=[],b=0;b<v.childNodes.length;b++){var S=v.childNodes.item(b);De(S)&&w.push(S)}if(w.length<m.minOccurs||w.length>m.maxOccurs)throw new ke(ye.COLLECTION_LIMIT,u.localName,n.localName);w.forEach((function(e){return a.appendChild(e.cloneNode(!0))}))}else{if(v.childNodes.length<m.minOccurs||v.childNodes.length>m.maxOccurs)throw new ke(ye.COLLECTION_LIMIT,u.localName,n.localName);a.appendChild(v)}}}return this.OnGetXml(a),this.element=a,a}},{key:"LoadXml",value:function(e){var t,r=this;"string"==typeof e?t=Ie(e).documentElement:t=e;if(!t)throw new ke(ye.PARAM_REQUIRED,"element");var a=this.GetStatic(),n=this.localName;if(t.localName!==n||t.namespaceURI!=this.NamespaceURI)throw new ke(ye.ELEMENT_MALFORMED,n);if(a.items)for(var i in a.items)if(a.items.hasOwnProperty(i)){var s=a.items[i];switch(s.type){case ue:var u=s;if(u.required&&!t.textContent)throw new ke(ye.CONTENT_MISSING,n);if(t.textContent){var o=u.converter?u.converter.set(t.textContent):t.textContent;r[i]=o}else r[i]=u.defaultValue;break;case se:var l=s,c=void 0,h=void 0;if(!l.localName)throw new ke(ye.PARAM_REQUIRED,"localName");if(l.namespaceURI?(c=t.hasAttributeNS.bind(t,l.namespaceURI,l.localName),h=t.getAttributeNS.bind(t,l.namespaceURI,l.localName)):(c=t.hasAttribute.bind(t,l.localName),h=t.getAttribute.bind(t,l.localName)),l.required&&!c())throw new ke(ye.ATTRIBUTE_MISSING,l.localName,n);if(c()){var f=l.converter?l.converter.set(h()):h();r[i]=f}else r[i]=l.defaultValue;break;case ie:var m=s;if(m.noRoot){if(!m.parser)throw new ke(ye.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser'"));var v=new m.parser;if(!(v instanceof Me))throw new ke(ye.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser' like instance of XmlCollection"));if(v.OnLoadXml(t),delete v.element,v.Count<m.minOccurs||v.Count>m.maxOccurs)throw new ke(ye.COLLECTION_LIMIT,m.parser.localName,n);r[i]=v;continue}for(var d=null,g=0;g<t.childNodes.length;g++){var p=t.childNodes.item(g);if(De(p)){var y=p;if(y.localName===m.localName&&y.namespaceURI==m.namespaceURI){d=y;break}}}if(m.required&&!d)throw new ke(ye.ELEMENT_MISSING,m.parser?m.parser.localName:m.localName,n);if(m.parser){if(d){var k=new m.parser;k.localName=m.localName,k.namespaceURI=m.namespaceURI,r[i]=k,k.LoadXml(d)}}else if(d){var w=m.converter?m.converter.set(d.textContent):d.textContent;r[i]=w}else r[i]=m.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ke(ye.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new ke(ye.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ke(ye.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new ke(ye.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new ke(ye.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,a)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI;var n=((a=a||this.prefix)?"".concat(a,":"):"")+t,i=r?e.createElementNS(r,n):e.createElement(n);return e.importNode(i,!0),i}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getElementsByTagName(t);if(r&&0===a.length)throw new ke(ye.ELEMENT_MISSING,t,e.localName);return a[0]||null}},{key:"GetAttribute",value:function(e,t,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(a)throw new ke(ye.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return Oe(e)&&(r=e.getElementById(t)),null==r&&null==(r=Be(e,"//*[@Id='".concat(t,"']")))&&null==(r=Be(e,"//*[@ID='".concat(t,"']")))&&(r=Be(e,"//*[@id='".concat(t,"']"))),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Te,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a="",n="",i="";r&&(a=r+":",n=":"+r),t&&(i=" xmlns".concat(n,'="').concat(t,'"'));var s="".concat(a).concat(e),u=(new DOMParser).parseFromString("<".concat(s).concat(i,"></").concat(s,">"),Ne);return u}},{key:"GetChildren",value:function(e,t,r){e=Oe(e)?e.documentElement:e;for(var a=[],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];!De(i)||i.localName!==t||i.namespaceURI!==r&&r||a.push(i)}return a}},{key:"GetFirstChild",value:function(e,t,r){e=Oe(e)?e.documentElement:e;for(var a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(De(n)&&n.localName===t&&(n.namespaceURI===r||!r))return n}return null}},{key:"GetChild",value:function(e,t,r){for(var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(De(i)&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(a)throw new ke(ye.ELEMENT_MISSING,t,e.localName);return null}}]),e}(),Me=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).MaxOccurs=Number.MAX_VALUE,e.MinOccurs=0,e.items=[],e}return o(r,[{key:"HasChanged",value:function(){var e=w(h(r.prototype),"HasChanged",this).call(this),t=this.Some((function(e){return e.HasChanged()}));return e||t}},{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e})),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new de(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new de(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new de(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t,r=C(this.GetIterator());try{for(r.s();!(t=r.n()).done;){var a=t.value.GetXml();a&&e.appendChild(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new ke(ye.XML_EXCEPTION,"".concat(t.localName," doesn't have required 'parser' in @XmlElement"));for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);if(De(a)&&a.localName===t.parser.localName&&a.namespaceURI==t.namespaceURI){var n=a,i=new t.parser;i.LoadXml(n),this.Add(i)}}}}]),r}(Le),He={DefaultPrefix:"xades",NamespaceURI:"http://uri.etsi.org/01903/v1.3.2#",SignedPropertiesType:"http://uri.etsi.org/01903/v1.3.2#SignedProperties",ElementNames:{Any:"Any",ByName:"ByName",ByKey:"ByKey",AttrAuthoritiesCertValues:"AttrAuthoritiesCertValues",AttributeRevocationValues:"AttributeRevocationValues",AttributeCertificateRefs:"AttributeCertificateRefs",AttributeRevocationRefs:"AttributeRevocationRefs",QualifyingProperties:"QualifyingProperties",QualifyingPropertiesReference:"QualifyingPropertiesReference",SignedProperties:"SignedProperties",SignedSignatureProperties:"SignedSignatureProperties",SignedDataObjectProperties:"SignedDataObjectProperties",UnsignedProperties:"UnsignedProperties",UnsignedSignatureProperties:"UnsignedSignatureProperties",UnsignedDataObjectProperties:"UnsignedDataObjectProperties",UnsignedDataObjectProperty:"UnsignedDataObjectProperty",SigningTime:"SigningTime",SigningCertificate:"SigningCertificate",SigningCertificateV2:"SigningCertificateV2",SignaturePolicyIdentifier:"SignaturePolicyIdentifier",SignatureProductionPlace:"SignatureProductionPlace",SignerRole:"SignerRole",Cert:"Cert",CertDigest:"CertDigest",IssuerSerial:"IssuerSerial",IssuerSerialV2:"IssuerSerialV2",DataObjectFormat:"DataObjectFormat",CommitmentTypeIndication:"CommitmentTypeIndication",AllDataObjectsTimeStamp:"AllDataObjectsTimeStamp",IndividualDataObjectsTimeStamp:"IndividualDataObjectsTimeStamp",HashDataInfo:"HashDataInfo",EncapsulatedTimeStamp:"EncapsulatedTimeStamp",XMLTimeStamp:"XMLTimeStamp",XAdESTimeStamp:"XAdESTimeStamp",OtherTimeStamp:"OtherTimeStamp",Description:"Description",ObjectIdentifier:"ObjectIdentifier",MimeType:"MimeType",Encoding:"Encoding",Identifier:"Identifier",DocumentationReferences:"DocumentationReferences",DocumentationReference:"DocumentationReference",CommitmentTypeId:"CommitmentTypeId",ObjectReference:"ObjectReference",CommitmentTypeQualifiers:"CommitmentTypeQualifiers",AllSignedDataObjects:"AllSignedDataObjects",CommitmentTypeQualifier:"CommitmentTypeQualifier",SignaturePolicyId:"SignaturePolicyId",SignaturePolicyImplied:"SignaturePolicyImplied",SigPolicyId:"SigPolicyId",SigPolicyHash:"SigPolicyHash",SigPolicyQualifier:"SigPolicyQualifier",SigPolicyQualifiers:"SigPolicyQualifiers",SPURI:"SPURI",SPUserNotice:"SPUserNotice",NoticeRef:"NoticeRef",ExplicitText:"ExplicitText",ClaimedRoles:"ClaimedRoles",ClaimedRole:"ClaimedRole",CertifiedRoles:"CertifiedRoles",CertifiedRole:"CertifiedRole",Organization:"Organization",NoticeNumbers:"NoticeNumbers",Int:"int",City:"City",PostalCode:"PostalCode",StateOrProvince:"StateOrProvince",CountryName:"CountryName",CounterSignature:"CounterSignature",SignatureTimeStamp:"SignatureTimeStamp",CompleteCertificateRefs:"CompleteCertificateRefs",CompleteRevocationRefs:"CompleteRevocationRefs",SigAndRefsTimeStamp:"SigAndRefsTimeStamp",RefsOnlyTimeStamp:"RefsOnlyTimeStamp",CertificateValues:"CertificateValues",RevocationValues:"RevocationValues",ArchiveTimeStamp:"ArchiveTimeStamp",CertRefs:"CertRefs",CRLRefs:"CRLRefs",CRLRef:"CRLRef",OCSPRefs:"OCSPRefs",OtherRefs:"OtherRefs",OtherRef:"OtherRef",DigestAlgAndValue:"DigestAlgAndValue",CRLIdentifier:"CRLIdentifier",Issuer:"Issuer",IssueTime:"IssueTime",Number:"Number",OCSPRef:"OCSPRef",OCSPIdentifier:"OCSPIdentifier",ResponderID:"ResponderID",ProducedAt:"ProducedAt",EncapsulatedX509Certificate:"EncapsulatedX509Certificate",OtherCertificate:"OtherCertificate",CRLValues:"CRLValues",OCSPValues:"OCSPValues",OtherValues:"OtherValues",OtherValue:"OtherValue",EncapsulatedCRLValue:"EncapsulatedCRLValue",EncapsulatedOCSPValue:"EncapsulatedOCSPValue",ReferenceInfo:"ReferenceInfo",Include:"Include"},AttributeNames:{Id:"Id",Encoding:"Encoding",Target:"Target",ObjectReference:"ObjectReference",Qualifier:"Qualifier",Uri:"uri",URI:"URI",ReferencedData:"referencedData"}},_e=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Le);_e=ne([ce({localName:"xades",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],_e);var Ke=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Me);Ke=ne([ce({localName:"xades_collection",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],Ke);var je=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([me()],je.prototype,"Value",void 0),je=ne([ce({localName:He.ElementNames.Any})],je);var Je=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);Je=ne([ce({localName:He.ElementNames.Any})],Je);var Fe=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],Fe.prototype,"Id",void 0),ne([fe({localName:He.AttributeNames.Encoding,defaultValue:null,converter:{get:function(e){switch(e){case"der":case"ber":case"cer":case"per":case"xer":return"http://uri.etsi.org/01903/v1.2.2#".concat(e.toUpperCase())}},set:function(e){var t=/#(\w+)$/.exec(e);return t?t[1].toLowerCase():null}}})],Fe.prototype,"Encoding",void 0),ne([me({required:!0,converter:Pe})],Fe.prototype,"Value",void 0),Fe=ne([ce({localName:"EncapsulatedPKIData"})],Fe);var Ge=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);Ge=ne([ce({localName:He.ElementNames.OtherCertificate})],Ge);var qe=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);qe=ne([ce({localName:"OtherCertificateCollection",parser:Ge})],qe);var Xe=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);Xe=ne([ce({localName:He.ElementNames.EncapsulatedX509Certificate})],Xe);var We=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);We=ne([ce({localName:"EncapsulatedX509CertificateCollection",parser:Xe})],We);var ze=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],ze.prototype,"Id",void 0),ne([he({parser:We,noRoot:!0})],ze.prototype,"EncapsulatedX509Certificates",void 0),ne([he({parser:qe,noRoot:!0})],ze.prototype,"OtherCertificates",void 0),ze=ne([ce({localName:He.ElementNames.CertificateValues})],ze);var Qe=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Qualifier})],Qe.prototype,"Qualifier",void 0),ne([me({defaultValue:"",required:!0})],Qe.prototype,"Value",void 0),Qe=ne([ce({localName:He.ElementNames.Identifier})],Qe);var Ye=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){e.textContent&&(this.Uri=e.textContent)}},{key:"OnGetXml",value:function(e){this.Uri&&(e.textContent=this.Uri)}}]),r}(_e);ne([me({defaultValue:"",required:!0})],Ye.prototype,"Uri",void 0),Ye=ne([ce({localName:He.ElementNames.DocumentationReference})],Ye);var Ze=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);Ze=ne([ce({localName:He.ElementNames.DocumentationReferences,parser:Ye})],Ze);var $e=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:Qe,required:!0})],$e.prototype,"Identifier",void 0),ne([he({localName:He.ElementNames.Description,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,defaultValue:""})],$e.prototype,"Description",void 0),ne([he({parser:Ze})],$e.prototype,"DocumentationReferences",void 0),$e=ne([ce({localName:He.ElementNames.ObjectIdentifier})],$e);var et=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);et=ne([ce({localName:He.ElementNames.CommitmentTypeQualifier})],et);var tt=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);tt=ne([ce({localName:He.ElementNames.CommitmentTypeQualifiers,parser:et})],tt);var rt=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([me({required:!0})],rt.prototype,"Value",void 0),rt=ne([ce({localName:He.ElementNames.ObjectReference})],rt);var at=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);at=ne([ce({localName:"ObjectReferences",parser:rt})],at);var nt=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.CommitmentTypeId,required:!0,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,parser:$e})],nt.prototype,"CommitmentTypeId",void 0),ne([he({parser:at,noRoot:!0})],nt.prototype,"ObjectReference",void 0),ne([he({localName:He.ElementNames.AllSignedDataObjects,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,converter:{set:function(e){return!0},get:function(e){}},defaultValue:!1})],nt.prototype,"AllSignedDataObjects",void 0),ne([he({localName:He.ElementNames.CommitmentTypeQualifiers,parser:et})],nt.prototype,"CommitmentTypeQualifiers",void 0),nt=ne([ce({localName:He.ElementNames.CommitmentTypeIndication})],nt);var it="element",st="attribute",ut="content",ot=1e9;function lt(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function ct(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=lt({},r.items)),r.target=t}}function ht(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var a=t.constructor,n=r;a.items||(a.items={}),a.target!==a&&(a.items=lt({},a.items)),a.target=t,e.parser?a.items[n]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||ot,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:a.items[n]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter,noRoot:e.noRoot||!1},e.localName=e.localName||e.parser&&e.parser.localName||n,a.items[n].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,a.items[n].prefix=e.prefix||e.parser&&e.parser.prefix||null,a.items[n].localName=e.localName,a.items[n].type=it,mt(t,n,e)}}function ft(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var a=t.constructor,n=r;e.localName||(e.localName=r),a.items||(a.items={}),a.target!==a&&(a.items=lt({},a.items)),a.target=t,a.items[r]=e,a.items[r].type=st,mt(t,n,e)}}function mt(e,t,r){var a="_".concat(t),n={set:function(e){this[a]!==e&&(this.element=null,this[a]=e)},get:function(){if(void 0===this[a]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[a]=e}return this[a]}};Object.defineProperty(e,a,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,n)}var vt=function(){function e(t){s(this,e),this.items=new Array,t&&(this.items=t)}return o(e,[{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e}))}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}}]),e}();function dt(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=e,i=/[^%](%\d+)/g,s=null,u=[];s=i.exec(n);)u.push({arg:s[1],index:s.index});for(var o=u.length-1;o>=0;o--){var l=u[o],c=l.arg.substring(1),h=l.index+1;n=n.substring(0,h)+arguments[+c]+n.substring(h+1+c.length)}return n=n.replace("%%","%")}function gt(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var pt,yt=o((function e(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];s(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=kt[t];var i=dt.apply(this,arguments);this.message="".concat(this.prefix).concat(gt(t,4),": ").concat(i),this.stack=new Error(this.message).stack}));!function(e){e[e.NONE=0]="NONE",e[e.NULL_REFERENCE=1]="NULL_REFERENCE",e[e.NULL_PARAM=2]="NULL_PARAM",e[e.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",e[e.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",e[e.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",e[e.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",e[e.PARAM_REQUIRED=7]="PARAM_REQUIRED",e[e.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",e[e.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",e[e.ELEMENT_MISSING=10]="ELEMENT_MISSING",e[e.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",e[e.CONTENT_MISSING=12]="CONTENT_MISSING",e[e.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",e[e.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",e[e.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",e[e.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",e[e.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",e[e.XML_EXCEPTION=18]="XML_EXCEPTION"}(pt||(pt={}));var kt={};kt[pt.NONE]="No description",kt[pt.NULL_REFERENCE]="Null reference",kt[pt.NULL_PARAM]="'%1' has empty '%2' object",kt[pt.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",kt[pt.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",kt[pt.METHOD_NOT_IMPLEMENTED]="Method is not implemented",kt[pt.METHOD_NOT_SUPPORTED]="Method is not supported",kt[pt.PARAM_REQUIRED]="Required parameter is missing '%1'",kt[pt.CONVERTER_UNSUPPORTED]="Converter is not supported",kt[pt.ELEMENT_MALFORMED]="Malformed element '%1'",kt[pt.ELEMENT_MISSING]="Element '%1' is missing in '%2'",kt[pt.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",kt[pt.CONTENT_MISSING]="Content is missing in '%1'",kt[pt.CRYPTOGRAPHIC]="Cryptographic error: %1",kt[pt.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",kt[pt.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",kt[pt.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",kt[pt.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",kt[pt.XML_EXCEPTION]="XML exception: %1";var wt,bt=function(){function e(){s(this,e)}return o(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new yt(pt.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new yt(pt.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");throw new yt(pt.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Uint8Array(Buffer.from(e,"base64"));throw new yt(pt.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r].toString(16);t.push(1===a.length?"0"+a:a)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var a=e.slice(r,r+2);t[r/2]=parseInt(a,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),St="application/xml";!function(e){e[e.None=0]="None",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation",e[e.Whitespace=13]="Whitespace",e[e.SignificantWhitespace=14]="SignificantWhitespace",e[e.EndElement=15]="EndElement",e[e.EndEntity=16]="EndEntity",e[e.XmlDeclaration=17]="XmlDeclaration"}(wt||(wt={}));var Nt,At=function(e,t){throw new Error("Not implemented")};if("undefined"==typeof self){Nt=global;var Ct=require("@xmldom/xmldom");At=require("xpath.js"),Nt.XMLSerializer=Ct.XMLSerializer,Nt.DOMParser=Ct.DOMParser,Nt.DOMImplementation=Ct.DOMImplementation,Nt.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else Nt=self;var xt="undefined"!=typeof self?function(e,t){for(var r,a=null==e.ownerDocument?e:e.ownerDocument,n=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),i=a.evaluate(t,e,n,XPathResult.ANY_TYPE,null),s=[];r=i.iterateNext();)s.push(r);return s}:At;function Et(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,St)}function It(e,t){var r=xt(e,t);return r&&r.length>0?r[0]:null}function Bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ot(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&!t[e.prefix||""]&&(t[e.prefix?e.prefix:""]=e.namespaceURI);for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);a&&a.nodeType===wt.Element&&Bt(a,t)}}}function Vt(e){var t={};return Bt(e,t),t}function Rt(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function Dt(e,t){return e&&e.nodeType===t}function Ot(e){return Dt(e,wt.Element)}function Pt(e){return Dt(e,wt.Document)}var Ut={get:function(e){if(e)return bt.ToBase64(e)},set:function(e){return bt.FromBase64(e)}},Tt={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},Lt="xml_root",Mt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI,t)for(var r=0,a=Object.entries(t);r<a.length;r++){var n=b(a[r],2),i=n[0],u=n[1];void 0!==u&&(this[i]=u)}}return o(e,[{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}},{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],a=this[t];if(r.parser&&a&&a.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(t){if(!t&&!this.HasChanged())return this.element||null;var r=this.CreateDocument(),a=this.CreateElement(),n=this.GetStatic(),i=this.localName;if(n.items)for(var s in n.items)if(n.items.hasOwnProperty(s)){var u=this[s],o=n.items[s];switch(o.type){case ut:var l=o,c=l.converter?l.converter.get(u):u;if(l.required&&null==c)throw new yt(pt.CONTENT_MISSING,i);(l.defaultValue!==u||l.required)&&(a.textContent=c);break;case st:var h=o,f=h.converter?h.converter.get(u):u;if(h.required&&null==f)throw new yt(pt.ATTRIBUTE_MISSING,h.localName,i);(h.defaultValue!==u||h.required)&&(h.namespaceURI?a.setAttributeNS(h.namespaceURI,h.localName,f):a.setAttribute(h.localName,f));break;case it:var m=o,v=null;if(m.parser){if(m.required&&!u||m.minOccurs&&!u.Count)throw new yt(pt.ELEMENT_MISSING,u.localName,i);u&&(v=u.GetXml(void 0===u.element&&(m.required||u.Count)))}else{var d=m.converter?m.converter.get(u):u;if(m.required&&void 0===d)throw new yt(pt.ELEMENT_MISSING,m.localName,i);if(u!==m.defaultValue||m.required)if(v=m.namespaceURI?r.createElementNS(m.namespaceURI,"".concat(m.prefix?m.prefix+":":"").concat(m.localName)):r.createElement("".concat(m.prefix?m.prefix+":":"").concat(m.localName)),Array.isArray(d)){var g,p=C(d);try{for(p.s();!(g=p.n()).done;){var y=g.value,k=y instanceof e?y.GetXml(!0):y;null!==k&&v.appendChild(k)}}catch(e){p.e(e)}finally{p.f()}}else d instanceof e?v.appendChild(d.GetXml(!0)):v.textContent=d}if(v)if(m.noRoot){for(var w=[],b=0;b<v.childNodes.length;b++){var S=v.childNodes.item(b);Ot(S)&&w.push(S)}if(w.length<m.minOccurs||w.length>m.maxOccurs)throw new yt(pt.COLLECTION_LIMIT,u.localName,n.localName);w.forEach((function(e){return a.appendChild(e.cloneNode(!0))}))}else{if(v.childNodes.length<m.minOccurs||v.childNodes.length>m.maxOccurs)throw new yt(pt.COLLECTION_LIMIT,u.localName,n.localName);a.appendChild(v)}}}return this.OnGetXml(a),this.element=a,a}},{key:"LoadXml",value:function(e){var t,r=this;"string"==typeof e?t=Et(e).documentElement:t=e;if(!t)throw new yt(pt.PARAM_REQUIRED,"element");var a=this.GetStatic(),n=this.localName;if(t.localName!==n||t.namespaceURI!=this.NamespaceURI)throw new yt(pt.ELEMENT_MALFORMED,n);if(a.items)for(var i in a.items)if(a.items.hasOwnProperty(i)){var s=a.items[i];switch(s.type){case ut:var u=s;if(u.required&&!t.textContent)throw new yt(pt.CONTENT_MISSING,n);if(t.textContent){var o=u.converter?u.converter.set(t.textContent):t.textContent;r[i]=o}else r[i]=u.defaultValue;break;case st:var l=s,c=void 0,h=void 0;if(!l.localName)throw new yt(pt.PARAM_REQUIRED,"localName");if(l.namespaceURI?(c=t.hasAttributeNS.bind(t,l.namespaceURI,l.localName),h=t.getAttributeNS.bind(t,l.namespaceURI,l.localName)):(c=t.hasAttribute.bind(t,l.localName),h=t.getAttribute.bind(t,l.localName)),l.required&&!c())throw new yt(pt.ATTRIBUTE_MISSING,l.localName,n);if(c()){var f=l.converter?l.converter.set(h()):h();r[i]=f}else r[i]=l.defaultValue;break;case it:var m=s;if(m.noRoot){if(!m.parser)throw new yt(pt.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser'"));var v=new m.parser;if(!(v instanceof Ht))throw new yt(pt.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser' like instance of XmlCollection"));if(v.OnLoadXml(t),delete v.element,v.Count<m.minOccurs||v.Count>m.maxOccurs)throw new yt(pt.COLLECTION_LIMIT,m.parser.localName,n);r[i]=v;continue}for(var d=null,g=0;g<t.childNodes.length;g++){var p=t.childNodes.item(g);if(Ot(p)){var y=p;if(y.localName===m.localName&&y.namespaceURI==m.namespaceURI){d=y;break}}}if(m.required&&!d)throw new yt(pt.ELEMENT_MISSING,m.parser?m.parser.localName:m.localName,n);if(m.parser){if(d){var k=new m.parser;k.localName=m.localName,k.namespaceURI=m.namespaceURI,r[i]=k,k.LoadXml(d)}}else if(d){var w=m.converter?m.converter.set(d.textContent):d.textContent;r[i]=w}else r[i]=m.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new yt(pt.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new yt(pt.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new yt(pt.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new yt(pt.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new yt(pt.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,a)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI;var n=((a=a||this.prefix)?"".concat(a,":"):"")+t,i=r?e.createElementNS(r,n):e.createElement(n);return e.importNode(i,!0),i}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getElementsByTagName(t);if(r&&0===a.length)throw new yt(pt.ELEMENT_MISSING,t,e.localName);return a[0]||null}},{key:"GetAttribute",value:function(e,t,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(a)throw new yt(pt.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return Pt(e)&&(r=e.getElementById(t)),null==r&&null==(r=It(e,"//*[@*[local-name()='Id']='".concat(t,"']")))&&null==(r=It(e,"//*[@*[local-name()='ID']='".concat(t,"']")))&&(r=It(e,"//*[@*[local-name()='id']='".concat(t,"']"))),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a="",n="",i="";r&&(a=r+":",n=":"+r),t&&(i=" xmlns".concat(n,'="').concat(t,'"'));var s="".concat(a).concat(e),u=(new DOMParser).parseFromString("<".concat(s).concat(i,"></").concat(s,">"),St);return u}},{key:"GetChildren",value:function(e,t,r){e=Pt(e)?e.documentElement:e;for(var a=[],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];!Ot(i)||i.localName!==t||i.namespaceURI!==r&&r||a.push(i)}return a}},{key:"GetFirstChild",value:function(e,t,r){e=Pt(e)?e.documentElement:e;for(var a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(Ot(n)&&n.localName===t&&(n.namespaceURI===r||!r))return n}return null}},{key:"GetChild",value:function(e,t,r){for(var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(Ot(i)&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(a)throw new yt(pt.ELEMENT_MISSING,t,e.localName);return null}}]),e}(),Ht=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).MaxOccurs=Number.MAX_VALUE,e.MinOccurs=0,e.items=[],e}return o(r,[{key:"HasChanged",value:function(){var e=w(h(r.prototype),"HasChanged",this).call(this),t=this.Some((function(e){return e.HasChanged()}));return e||t}},{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e})),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new vt(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new vt(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new vt(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t,r=C(this.GetIterator());try{for(r.s();!(t=r.n()).done;){var a=t.value.GetXml();a&&e.appendChild(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new yt(pt.XML_EXCEPTION,"".concat(t.localName," doesn't have required 'parser' in @XmlElement"));for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);if(Ot(a)&&a.localName===t.parser.localName&&a.namespaceURI==t.namespaceURI){var n=a,i=new t.parser;i.LoadXml(n),this.Add(i)}}}}]),r}(Mt),_t=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"Add",value:function(e){e.prefix=e.prefix||"",e.namespace=e.namespace||"",w(h(r.prototype),"Add",this).call(this,e)}},{key:"GetPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.prefix===e)return n}return null}},{key:"GetNamespace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.namespace===e)return n}return null}}]),r}(vt),Kt=function(){function e(){s(this,e)}return o(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var a=e.toUint8Array(t),n=e.toUint8Array(r);if(a.length!==n.byteLength)return!1;for(var i=0;i<a.length;i++)if(a[i]!==n[i])return!1;return!0}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Array.isArray(t[0])){var a,n=t[0],i=0,s=C(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;i+=u.byteLength}}catch(e){s.e(e)}finally{s.f()}var o,l=new Uint8Array(i),c=0,h=C(n);try{for(h.s();!(o=h.n()).done;){var f=o.value,m=this.toUint8Array(f);l.set(m,c),c+=m.length}}catch(e){h.e(e)}finally{h.f()}return t[1]?this.toView(l,t[1]):l.buffer}return this.concat(t)}}]),e}(),jt=function(){function e(){s(this,e)}return o(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r.buffer}},{key:"toString",value:function(e){for(var t=Kt.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return decodeURIComponent(escape(r))}}]),e}(),Jt=function(){function e(){s(this,e)}return o(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Kt.toArrayBuffer(e),a=new DataView(r),n="",i=0;i<r.byteLength;i+=2){var s=a.getUint16(i,t);n+=String.fromCharCode(s)}return n}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),a=new DataView(r),n=0;n<e.length;n++)a.setUint16(2*n,e.charCodeAt(n),t);return r}}]),e}(),Ft=function(){function e(){s(this,e)}return o(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=Kt.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Jt.toString(r,!0);case"utf16":case"utf16be":return Jt.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Jt.fromString(e,!0);case"utf16":case"utf16be":return Jt.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=Kt.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return jt.fromString(t);case"utf16":case"utf16be":return Jt.fromString(t);case"utf16le":case"usc2":return Jt.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return jt.toString(t);case"utf16":case"utf16be":return Jt.toString(t);case"utf16le":case"usc2":return Jt.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=Kt.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return r}},{key:"ToHex",value:function(e){for(var t=Kt.toUint8Array(e),r=[],a=t.length,n=0;n<a;n++){var i=t[n].toString(16).padStart(2,"0");r.push(i)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var a=new Uint8Array(r.length/2),n=0;n<r.length;n+=2){var i=r.slice(n,n+2);a[n/2]=parseInt(i,16)}return a.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function Gt(e,t,r){var a;return e instanceof Object==!1?r:null!==(a=e[t])&&void 0!==a?a:r}function qt(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",s=C(new Uint8Array(e,r,a));try{for(s.s();!(t=s.n()).done;){var u=t.value,o=u.toString(16).toUpperCase();1===o.length&&(i+="0"),i+=o,n&&(i+=" ")}}catch(e){s.e(e)}finally{s.f()}return i.trim()}function Xt(e,t){var r=0;if(1===e.length)return e[0];for(var a=e.length-1;a>=0;a--)r+=e[e.length-1-a]*Math.pow(2,t*a);return r}function Wt(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=r,n=e,i=0,s=Math.pow(2,t),u=1;u<8;u++){if(e<s){var o=void 0;if(a<0)o=new ArrayBuffer(u),i=u;else{if(a<u)return new ArrayBuffer(0);o=new ArrayBuffer(a),i=a}for(var l=new Uint8Array(o),c=u-1;c>=0;c--){var h=Math.pow(2,c*t);l[i-c-1]=Math.floor(n/h),n-=l[i-c-1]*h}return o}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function zt(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.byteLength}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(new Uint8Array(f),t),t+=f.byteLength}return o}function Qt(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.length}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(f,t),t+=f.length}return l}function Yt(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var a=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(a),i=0;i<this.valueHex.byteLength;i++)n[i]=0;n[0]=128&e[0];for(var s=Xt(n,8),u=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(u),l=0;l<this.valueHex.byteLength;l++)o[l]=e[l];return o[0]&=127,Xt(o,8)-s}function Zt(e){for(var t=e<0?-1*e:e,r=128,a=1;a<8;a++){if(t<=r){if(e<0){var n=Wt(r-t,8,a);return new Uint8Array(n)[0]|=128,n}var i=Wt(t,8,a),s=new Uint8Array(i);if(128&s[0]){var u=i.slice(0),o=new Uint8Array(u);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(var l=0;l<u.byteLength;l++)s[l+1]=o[l];s[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function $t(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),a=new Uint8Array(t),n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}function er(e,t){var r=e.toString(10);if(t<r.length)return"";for(var a=t-r.length,n=new Array(a),i=0;i<a;i++)n[i]="0";return n.join("").concat(r)}Ft.DEFAULT_UTF8_ENCODING="utf8";var tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function ar(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0,i=0,s=0,u="",o=t?rr:tr;if(a){for(var l=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){l=c;break}e=e.slice(l)}for(;n<e.length;){var h=e.charCodeAt(n++);n>=e.length&&(i=1);var f=e.charCodeAt(n++);n>=e.length&&(s=1);var m=e.charCodeAt(n++),v=h>>2,d=(3&h)<<4|f>>4,g=(15&f)<<2|m>>6,p=63&m;1===i?g=p=64:1===s&&(p=64),u+=r?64===g?"".concat(o.charAt(v)).concat(o.charAt(d)):64===p?"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p))}return u}function nr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t?rr:tr;function n(e){for(var t=0;t<64;t++)if(a.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var s=0,u="";s<e.length;){var o=n(e.charAt(s++)),l=s>=e.length?0:n(e.charAt(s++)),c=s>=e.length?0:n(e.charAt(s++)),h=s>=e.length?0:n(e.charAt(s++)),f=i(o)<<2|i(l)>>4,m=(15&i(l))<<4|i(c)>>2,v=(3&i(c))<<6|i(h);u+=String.fromCharCode(f),64!==c&&(u+=String.fromCharCode(m)),64!==h&&(u+=String.fromCharCode(v))}if(r){for(var d=u.length,g=-1,p=d-1;p>=0;p--)if(0!==u.charCodeAt(p)){g=p;break}u=-1!==g?u.slice(0,g+1):""}return u}function ir(e){var t,r="",a=C(new Uint8Array(e));try{for(a.s();!(t=a.n()).done;){var n=t.value;r+=String.fromCharCode(n)}}catch(e){a.e(e)}finally{a.f()}return r}function sr(e){for(var t=e.length,r=new ArrayBuffer(t),a=new Uint8Array(r),n=0;n<t;n++)a[n]=e.charCodeAt(n);return r}var ur=Math.log(2);function or(e,t){var r,a=C(t);try{for(a.s();!(r=a.n()).done;){delete e[r.value]}}catch(e){a.e(e)}finally{a.f()}}function lr(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function cr(e){for(var t=0,r=0,a=0;a<e.length;a++){t+=e[a].byteLength}for(var n=new Uint8Array(t),i=0;i<e.length;i++){var s=e[i];n.set(new Uint8Array(s),r),r+=s.byteLength}return n.buffer}function hr(e,t,r,a){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var fr=function(){function e(){s(this,e),this.items=[]}return o(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return cr(this.items)}}]),e}(),mr=[new Uint8Array([1])],vr="0123456789",dr="name",gr="valueHexView",pr="",yr=new ArrayBuffer(0),kr=new Uint8Array(0),wr="EndOfContent",br="OCTET STRING",Sr="BIT STRING";function Nr(e){var t;return t=function(e){c(a,e);var t=y(a);function a(){var e,r;s(this,a);for(var n=arguments.length,i=new Array(n),u=0;u<n;u++)i[u]=arguments[u];e=t.call.apply(t,[this].concat(i));var o=i[0]||{};return e.isHexOnly=null!==(r=o.isHexOnly)&&void 0!==r&&r,e.valueHexView=o.valueHex?Kt.toUint8Array(o.valueHex):kr,e}return o(a,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!hr(this,a,t,r))return-1;var n=t+r;return this.valueHexView=a.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",yr)}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isHexOnly:this.isHexOnly,valueHex:Ft.ToHex(this.valueHexView)})}}]),a}(e),t.NAME="hexBlock",t}var Ar=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,a=void 0===r?0:r,n=t.error,i=void 0===n?pr:n,u=t.warnings,o=void 0===u?[]:u,l=t.valueBeforeDecode,c=void 0===l?kr:l;s(this,e),this.blockLength=a,this.error=i,this.warnings=o,this.valueBeforeDecodeView=Kt.toUint8Array(c)}return o(e,[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ft.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]),e}();Ar.NAME="baseBlock";var Cr=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}]),r}(Ar);Cr.NAME="valueBlock";var xr=function(e){c(a,e);var t=y(a);function a(){var e,r,n,i,u,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=o.idBlock,c=void 0===l?{}:l;return s(this,a),e=t.call(this),c?(e.isHexOnly=null!==(r=c.isHexOnly)&&void 0!==r&&r,e.valueHexView=c.valueHex?Kt.toUint8Array(c.valueHex):kr,e.tagClass=null!==(n=c.tagClass)&&void 0!==n?n:-1,e.tagNumber=null!==(i=c.tagNumber)&&void 0!==i?i:-1,e.isConstructed=null!==(u=c.isConstructed)&&void 0!==u&&u):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return o(a,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",yr}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var a=this.tagNumber;t|=a&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var n=Wt(this.tagNumber,7),i=new Uint8Array(n),s=n.byteLength,u=new Uint8Array(s+1);if(u[0]=31|t,!e){for(var o=0;o<s-1;o++)u[o+1]=128|i[o];u[s]=i[s-1]}return u.buffer}var l=new Uint8Array(this.valueHexView.byteLength+1);if(l[0]=31|t,!e){for(var c=this.valueHexView,h=0;h<c.length-1;h++)l[h+1]=128|c[h];l[this.valueHexView.byteLength]=c[c.length-1]}return l.buffer}},{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!hr(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{for(var s=1,u=this.valueHexView=new Uint8Array(255),o=255;128&n[s];){if(u[s-1]=127&n[s],++s>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(s===o){o+=255;for(var l=new Uint8Array(o),c=0;c<u.length;c++)l[c]=u[c];u=this.valueHexView=new Uint8Array(o)}}this.blockLength=s+1,u[s-1]=127&n[s];for(var h=new Uint8Array(s),f=0;f<s;f++)h[f]=u[f];(u=this.valueHexView=new Uint8Array(s)).set(h),this.blockLength<=9?this.tagNumber=Xt(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}]),a}(Nr(Ar));xr.NAME="identificationBlock";var Er=function(e){c(a,e);var t=y(a);function a(){var e,r,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.lenBlock,l=void 0===o?{}:o;return s(this,a),(e=t.call(this)).isIndefiniteForm=null!==(r=l.isIndefiniteForm)&&void 0!==r&&r,e.longFormUsed=null!==(n=l.longFormUsed)&&void 0!==n&&n,e.length=null!==(i=l.length)&&void 0!==i?i:0,e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!hr(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;var s=t+1,u=a.subarray(s,s+i);return 0===u[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Xt(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var a=Wt(this.length,8);if(a.byteLength>127)return this.error="Too big length",yr;if(e=new ArrayBuffer(a.byteLength+1),r)return e;var n=new Uint8Array(a);(t=new Uint8Array(e))[0]=128|a.byteLength;for(var i=0;i<a.byteLength;i++)t[i+1]=n[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}]),a}(Ar);Er.NAME="lengthBlock";var Ir={},Br=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=r.name,u=void 0===i?pr:i,o=r.optional,l=void 0!==o&&o,c=r.primitiveSchema,h=g(r,x);return s(this,a),(e=t.call(this,h)).name=u,e.optional=l,c&&(e.primitiveSchema=c),e.idBlock=new xr(h),e.lenBlock=new Er(h),e.valueBlock=n?new n(h):new Cr(h),e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"toBER",value:function(e,t){var r=t||new fr;t||Vr(this);var a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;var i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?yr:r.final()}},{key:"toJSON",value:function(){var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii";return"ascii"===e?this.onAsciiEncoding():Ft.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(Ft.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&$t(this.toBER(),e.toBER())}}]),a}(Ar);function Vr(e){if(e instanceof Ir.Constructed){var t,r=C(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;){Vr(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}Br.NAME="BaseBlock";var Rr=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=a.value,u=void 0===i?pr:i,o=g(a,E);return s(this,r),e=t.call(this,o,n),u&&e.fromString(u),e}return o(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}]),r}(Br);Rr.NAME="BaseStringBlock";var Dr,Or=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.isHexOnly,i=void 0===n||n,u=g(a,I);return s(this,r),(e=t.call(this,u)).isHexOnly=i,e}return o(r)}(Nr(Cr));Or.NAME="PrimitiveValueBlock";var Pr=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Or)).idBlock.isConstructed=!1,e}return o(r)}(Br);function Ur(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function Tr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,a=t,n=new Br({},Cr),i=new Ar;if(!hr(i,e,t,r))return n.error=i.error,{offset:-1,result:n};var s=e.subarray(t,t+r);if(!s.length)return n.error="Zero buffer length",{offset:-1,result:n};var u=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===u)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=u,r-=n.idBlock.blockLength,u=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===u)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=u,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};var o=Br;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};o=Ir.EndOfContent;break;case 1:o=Ir.Boolean;break;case 2:o=Ir.Integer;break;case 3:o=Ir.BitString;break;case 4:o=Ir.OctetString;break;case 5:o=Ir.Null;break;case 6:o=Ir.ObjectIdentifier;break;case 10:o=Ir.Enumerated;break;case 12:o=Ir.Utf8String;break;case 13:o=Ir.RelativeObjectIdentifier;break;case 14:o=Ir.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:o=Ir.Sequence;break;case 17:o=Ir.Set;break;case 18:o=Ir.NumericString;break;case 19:o=Ir.PrintableString;break;case 20:o=Ir.TeletexString;break;case 21:o=Ir.VideotexString;break;case 22:o=Ir.IA5String;break;case 23:o=Ir.UTCTime;break;case 24:o=Ir.GeneralizedTime;break;case 25:o=Ir.GraphicString;break;case 26:o=Ir.VisibleString;break;case 27:o=Ir.GeneralString;break;case 28:o=Ir.UniversalString;break;case 29:o=Ir.CharacterString;break;case 30:o=Ir.BmpString;break;case 31:o=Ir.DATE;break;case 32:o=Ir.TimeOfDay;break;case 33:o=Ir.DateTime;break;case 34:o=Ir.Duration;break;default:var l=n.idBlock.isConstructed?new Ir.Constructed:new Ir.Primitive;l.idBlock=n.idBlock,l.lenBlock=n.lenBlock,l.warnings=n.warnings,n=l}}else o=n.idBlock.isConstructed?Ir.Constructed:Ir.Primitive;return u=(n=Ur(n,o)).fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(a,a+n.blockLength),{offset:u,result:n}}function Lr(e){if(!e.byteLength){var t=new Br({},Cr);return t.error="Input buffer has zero length",{offset:-1,result:t}}return Tr(Kt.toUint8Array(e).slice(),0,e.byteLength)}Dr=Pr,Ir.Primitive=Dr,Pr.NAME="PRIMITIVE";var Mr,Hr=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?[]:n,u=r.isIndefiniteForm,o=void 0!==u&&u,l=g(r,B);return s(this,a),(e=t.call(this,l)).value=i,e.isIndefiniteForm=o,e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!hr(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var n,i,s=t;n=this.isIndefiniteForm,i=r,(n?1:i)>0;){var u=Tr(a,s,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(s=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===wr)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===wr?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}},{key:"toBER",value:function(e,t){for(var r=t||new fr,a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?yr:r.final()}},{key:"toJSON",value:function(){var e,t=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),n=C(this.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.value.push(i.toJSON())}}catch(e){n.e(e)}finally{n.f()}return t}}]),a}(Cr);Hr.NAME="ConstructedValueBlock";var _r=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Hr)).idBlock.isConstructed=!0,e}return o(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=C(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var n=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(n," :\n").concat(t.join("\n")):"".concat(n," :")}}]),r}(Br);Mr=_r,Ir.Constructed=Mr,_r.NAME="CONSTRUCTED";var Kr,jr=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return yr}}]),r}(Cr);jr.override="EndOfContentValueBlock";var Jr,Fr=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,jr)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return o(r)}(Br);Kr=Fr,Ir.EndOfContent=Kr,Fr.NAME=wr;var Gr=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Cr)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return o(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}]),r}(Br);Jr=Gr,Ir.Null=Jr,Gr.NAME="NULL";var qr,Xr=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=g(r,V);return s(this,a),e=t.call(this,i),i.valueHex?e.valueHexView=Kt.toUint8Array(i.valueHex):e.valueHexView=new Uint8Array(1),n&&(e.value=n),e}return o(a,[{key:"value",get:function(){var e,t=C(this.valueHexView);try{for(t.s();!(e=t.n()).done;){if(e.value>0)return!0}}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);return hr(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Yt.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(Nr(Cr));Xr.NAME="BooleanValueBlock";var Wr=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Xr)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return o(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}]),r}(Br);qr=Wr,Ir.Boolean=qr,Wr.NAME="BOOLEAN";var zr,Qr=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.isConstructed,i=void 0!==n&&n,u=g(r,R);return s(this,a),(e=t.call(this,u)).isConstructed=i,e}return o(a,[{key:"fromBER",value:function(e,t,r){var n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=Hr.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.NAME;if(s===wr){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==br)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=w(h(a.prototype),"fromBER",this).call(this,e,t,r),this.blockLength=r;return n}},{key:"toBER",value:function(e,t){return this.isConstructed?Hr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isConstructed:this.isConstructed})}}]),a}(Nr(Hr));Qr.NAME="OctetStringValueBlock";var Yr=function(e){c(a,e);var t=y(a);function a(){var e,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.idBlock,l=void 0===o?{}:o,c=u.lenBlock,h=void 0===c?{}:c,f=g(u,D);return s(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),Qr)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){var i=Tr(n,0,n.byteLength);-1!==i.offset&&i.offset===r&&(this.valueBlock.value=[i.result])}}catch(e){}}return w(h(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?_r.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(Ft.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,t=[],r=C(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;n instanceof a&&t.push(n.valueBlock.valueHexView)}}catch(e){r.e(e)}finally{r.f()}return Kt.concat(t)}}]),a}(Br);zr=Yr,Ir.OctetString=zr,Yr.NAME=br;var Zr,$r=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.unusedBits,i=void 0===n?0:n,u=r.isConstructed,o=void 0!==u&&u,l=g(r,O);return s(this,a),(e=t.call(this,l)).unusedBits=i,e.isConstructed=o,e.blockLength=e.valueHexView.byteLength,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=-1;if(this.isConstructed){if(-1===(a=Hr.prototype.fromBER.call(this,e,t,r)))return a;var n,i=C(this.value);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=s.constructor.NAME;if(u===wr){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==Sr)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var o=s.valueBlock;if(this.unusedBits>0&&o.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=o.unusedBits}}catch(e){i.e(e)}finally{i.f()}return a}var l=Kt.toUint8Array(e);if(!hr(this,l,t,r))return-1;var c=l.subarray(t,t+r);if(this.unusedBits=c[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var h=c.subarray(1);try{if(h.byteLength){var f=Tr(h,0,h.byteLength);-1!==f.offset&&f.offset===r-1&&(this.value=[f.result])}}catch(e){}}return this.valueHexView=c.subarray(1),this.blockLength=c.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return Hr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return yr;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}]),a}(Nr(Hr));$r.NAME="BitStringValueBlock";var ea,ta=function(e){c(a,e);var t=y(a);function a(){var e,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.idBlock,l=void 0===o?{}:o,c=u.lenBlock,h=void 0===c?{}:c,f=g(u,P);return s(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),$r)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return o(a,[{key:"fromBER",value:function(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,w(h(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return _r.prototype.onAsciiEncoding.call(this);var e,t=[],r=C(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var n=t.join("");return"".concat(this.constructor.NAME," : ").concat(n.substring(0,n.length-this.valueBlock.unusedBits))}}]),a}(Br);function ra(e,t){for(var r=new Uint8Array([0]),a=new Uint8Array(e),n=new Uint8Array(t),i=a.slice(0),s=i.length-1,u=n.slice(0),o=u.length-1,l=0,c=0,h=o<s?s:o;h>=0;h--,c++){if(!0==c<u.length)l=i[s-c]+u[o-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=Qt(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=Qt(r,i)),i}function aa(e){if(e>=mr.length)for(var t=mr.length;t<=e;t++){for(var r=new Uint8Array([0]),a=mr[t-1].slice(0),n=a.length-1;n>=0;n--){var i=new Uint8Array([(a[n]<<1)+r[0]]);r[0]=i[0]/10,a[n]=i[0]%10}r[0]>0&&(a=Qt(r,a)),mr.push(a)}return mr[e]}function na(e,t){for(var r,a=0,n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),u=s.length-1,o=i.slice(0),l=o.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[u-c]-o[l-c]-a)<0)a=1,s[u-c]=r+10;else a=0,s[u-c]=r;if(a>0)for(var f=u-l+1;f>=0;f--,c++){if(!((r=s[u-c]-a)<0)){a=0,s[u-c]=r;break}a=1,s[u-c]=r+10}return s.slice()}Zr=ta,Ir.BitString=Zr,ta.NAME=Sr;var ia,sa=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=g(r,U);return s(this,a),(e=t.call(this,i))._valueDec=0,i.valueHex&&e.setValueHex(),void 0!==n&&(e.valueDec=n),e}return o(a,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Yt.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Zt(e))}},{key:"fromDER",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this.fromBER(e,t,r);if(-1===n)return n;var i=this.valueHexView;return 0===i[0]&&0!=(128&i[1])?this.valueHexView=i.subarray(1):0!==a&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,r){var n=w(h(a.prototype),"fromBER",this).call(this,e,t,r);return-1===n||this.setValueHex(),n}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),a=0,n=this.valueHexView,i="",s=!1,u=n.byteLength-1;u>=0;u--){e=n[u];for(var o=0;o<8;o++){if(1==(1&e))if(a===t)r=na(aa(a),r),i="-";else r=ra(r,aa(a));a++,e>>=1}}for(var l=0;l<r.length;l++)r[l]&&(s=!0),s&&(i+=vr.charAt(r[l]));return!1===s&&(i+=vr.charAt(0)),i}}]),a}(Nr(Cr));ea=sa,sa.NAME="IntegerValueBlock",Object.defineProperty(ea.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var ua,oa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,sa)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return o(r,[{key:"toBigInt",value:function(){return lr(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new r({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){lr();var t=BigInt(e),a=new fr,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(Ft.FromHex(n));if(t<0){var s=new Uint8Array(i.length+(128&i[0]?1:0));s[0]|=128;var u=BigInt("0x".concat(Ft.ToHex(s)))+t,o=Kt.toUint8Array(Ft.FromHex(u.toString(16)));o[0]|=128,a.write(o)}else 128&i[0]&&a.write(new Uint8Array([0])),a.write(i);return new r({valueHex:a.final()})}}]),r}(Br);ia=oa,Ir.Integer=ia,oa.NAME="INTEGER";var la=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return o(r)}(oa);ua=la,Ir.Enumerated=ua,la.NAME="ENUMERATED";var ca=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?-1:n,u=r.isFirstSid,o=void 0!==u&&u,l=g(r,T);return s(this,a),(e=t.call(this,l)).valueDec=i,e.isFirstSid=o,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=Kt.toUint8Array(e);if(!hr(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xt(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){lr();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),a=0;a<r.length;a++)r[a]=parseInt(t.slice(7*a,7*a+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Wt(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",yr;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=Ft.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}]),a}(Nr(Cr));ca.NAME="sidBlock";var ha,fa=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?pr:n,u=g(r,L);return s(this,a),(e=t.call(this,u)).value=[],i&&e.fromString(i),e}return o(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new ca;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;0===this.value.length&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var a=this.value[r].toBER(e);if(0===a.byteLength)return this.error=this.value[r].error,yr;t.push(a)}return cr(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="",n=!1;do{if(a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,n){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return void(this.value=[])}var u=parseInt(a,10);if(isNaN(u))return;i.valueDec=u+s,n=!1}else{var o=new ca;if(a>Number.MAX_SAFE_INTEGER){lr();var l=BigInt(a);o.valueBigInt=l}else if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,n=!0),this.value.push(o)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(a="{".concat(a,"}"),this.value[r].isFirstSid?e="2.{".concat(a," - 80}"):e+=a):e+=a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(Cr);fa.NAME="ObjectIdentifierValueBlock";var ma=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=t.call(this,r,fa)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return o(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(Br);ha=ma,Ir.ObjectIdentifier=ha,ma.NAME="OBJECT IDENTIFIER";var va=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?0:n,u=g(r,M);return s(this,a),(e=t.call(this,u)).valueDec=i,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var a=Kt.toUint8Array(e);if(!hr(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xt(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Wt(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",yr;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i.buffer}},{key:"toString",value:function(){return this.isHexOnly?Ft.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}}]),a}(Nr(Ar));va.NAME="relativeSidBlock";var da,ga=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?pr:n,u=g(r,H);return s(this,a),(e=t.call(this,u)).value=[],i&&e.fromString(i),e}return o(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new va;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e,t){for(var r=[],a=0;a<this.value.length;a++){var n=this.value[a].toBER(e);if(0===n.byteLength)return this.error=this.value[a].error,yr;r.push(n)}return cr(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="";do{a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var n=new va;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?a="{".concat(a,"}"):a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(Cr);ga.NAME="RelativeObjectIdentifierValueBlock";var pa,ya=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=t.call(this,r,ga)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return o(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(Br);da=ya,Ir.RelativeObjectIdentifier=da,ya.NAME="RelativeObjectIdentifier";var ka,wa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return o(r)}(_r);pa=wa,Ir.Sequence=pa,wa.NAME="SEQUENCE";var ba=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return o(r)}(_r);ka=ba,Ir.Set=ka,ba.NAME="SET";var Sa=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},r);return s(this,a),(e=t.call(this,n)).isHexOnly=!0,e.value=pr,e}return o(a,[{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(Nr(Cr));Sa.NAME="StringValueBlock";var Na=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Sa);Na.NAME="SimpleStringValueBlock";var Aa=function(e){c(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},e);return s(this,r),t.call(this,a,Na)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,Kt.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}]),r}(Rr);Aa.NAME="SIMPLE STRING";var Ca,xa=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=Kt.toUint8Array(e);try{this.valueBlock.value=Ft.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=Ft.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(Ft.FromUtf8String(e)),this.valueBlock.value=e}}]),r}(Aa);xa.NAME="Utf8StringValueBlock";var Ea=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return o(r)}(xa);Ca=Ea,Ir.Utf8String=Ca,Ea.NAME="UTF8String";var Ia,Ba=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=Ft.ToUtf16String(e),this.valueBlock.valueHexView=Kt.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ft.FromUtf16String(e))}}]),r}(Aa);Ba.NAME="BmpStringValueBlock";var Va=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},a);return s(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return o(r)}(Ba);Ia=Va,Ir.BmpString=Ia,Va.NAME="BMPString";var Ra,Da=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),a=0;a<t;a++){var n=Wt(e.charCodeAt(a),8),i=new Uint8Array(n);if(!(i.length>4))for(var s=4-i.length,u=i.length-1;u>=0;u--)r[4*a+u+s]=i[u]}this.valueBlock.value=e}}]),r}(Aa);Da.NAME="UniversalStringValueBlock";var Oa,Pa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},a);return s(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return o(r)}(Da);Ra=Pa,Ir.UniversalString=Ra,Pa.NAME="UniversalString";var Ua,Ta=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return o(r)}(Aa);Oa=Ta,Ir.NumericString=Oa,Ta.NAME="NumericString";var La,Ma=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return o(r)}(Aa);Ua=Ma,Ir.PrintableString=Ua,Ma.NAME="PrintableString";var Ha,_a=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return o(r)}(Aa);La=_a,Ir.TeletexString=La,_a.NAME="TeletexString";var Ka,ja=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return o(r)}(Aa);Ha=ja,Ir.VideotexString=Ha,ja.NAME="VideotexString";var Ja,Fa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return o(r)}(Aa);Ka=Fa,Ir.IA5String=Ka,Fa.NAME="IA5String";var Ga,qa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return o(r)}(Aa);Ja=qa,Ir.GraphicString=Ja,qa.NAME="GraphicString";var Xa,Wa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return o(r)}(Aa);Ga=Wa,Ir.VisibleString=Ga,Wa.NAME="VisibleString";var za,Qa=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return o(r)}(Aa);Xa=Qa,Ir.GeneralString=Xa,Qa.NAME="GeneralString";var Ya,Za=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return o(r)}(Aa);za=Za,Ir.CharacterString=za,Za.NAME="CharacterString";var $a,en=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=r.valueDate,u=g(r,_);if(s(this,a),(e=t.call(this,u)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,n){e.fromString(n),e.valueBlock.valueHexView=new Uint8Array(n.length);for(var o=0;o<n.length;o++)e.valueBlock.valueHexView[o]=n.charCodeAt(o)}return i&&(e.fromDate(i),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return o(a,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,Kt.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=new Array(7);return t[0]=er(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=er(this.month,2),t[2]=er(this.day,2),t[3]=er(this.hour,2),t[4]=er(this.minute,2),t[5]=er(this.second,2),t[6]="Z",t.join("")}return w(h(a.prototype),"toString",this).call(this,e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}]),a}(Wa);Ya=en,Ir.UTCTime=Ya,en.NAME="UTCTime";var tn,rn=function(e){c(a,e);var t=y(a);function a(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),null!==(r=(e=t.call(this,n)).millisecond)&&void 0!==r||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return o(a,[{key:"fromDate",value:function(e){w(h(a.prototype),"fromDate",this).call(this,e),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,a="",n="",i=0,s=0,u=0;if("Z"===e[e.length-1])a=e.substring(0,e.length-1),r=!0;else{var o=new Number(e[e.length-1]);if(isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");a=e}if(r){if(-1!==a.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==a.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=a.indexOf("+"),h="";if(-1===c&&(c=a.indexOf("-"),l=-1),-1!==c){if(h=a.substring(c+1),a=a.substring(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=parseInt(h.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=parseInt(h.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");u=l*f}}}var m=a.indexOf(".");if(-1===m&&(m=a.indexOf(",")),-1!==m){var v=new Number("0".concat(a.substring(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),n=a.substring(0,m)}else n=a;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for conversion")}var y=t.exec(n);if(null===y)throw new Error("Wrong input string for conversion");for(var k=1;k<y.length;k++)switch(k){case 1:this.year=parseInt(y[k],10);break;case 2:this.month=parseInt(y[k],10);break;case 3:this.day=parseInt(y[k],10);break;case 4:this.hour=parseInt(y[k],10)+s;break;case 5:this.minute=parseInt(y[k],10)+u;break;case 6:this.second=parseInt(y[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=[];return t.push(er(this.year,4)),t.push(er(this.month,2)),t.push(er(this.day,2)),t.push(er(this.hour,2)),t.push(er(this.minute,2)),t.push(er(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(er(this.millisecond,3))),t.push("Z"),t.join("")}return w(h(a.prototype),"toString",this).call(this,e)}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{millisecond:this.millisecond})}}]),a}(en);$a=rn,Ir.GeneralizedTime=$a,rn.NAME="GeneralizedTime";var an,nn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return o(r)}(Ea);tn=nn,Ir.DATE=tn,nn.NAME="DATE";var sn,un=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return o(r)}(Ea);an=un,Ir.TimeOfDay=an,un.NAME="TimeOfDay";var on,ln=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return o(r)}(Ea);sn=ln,Ir.DateTime=sn,ln.NAME="DateTime";var cn,hn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return o(r)}(Ea);on=hn,Ir.Duration=on,hn.NAME="Duration";var fn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return o(r)}(Ea);cn=fn,Ir.TIME=cn,fn.NAME="TIME";var mn=o((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,a=void 0===r?pr:r,n=t.optional,i=void 0!==n&&n;s(this,e),this.name=a,this.optional=i})),vn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.value,i=void 0===n?[]:n,u=g(a,K);return s(this,r),(e=t.call(this,u)).value=i,e}return o(r)}(mn),dn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.value,i=void 0===n?new mn:n,u=a.local,o=void 0!==u&&u,l=g(a,j);return s(this,r),(e=t.call(this,l)).value=i,e.local=o,e}return o(r)}(mn),gn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,a=void 0===r?kr:r;s(this,e),this.dataView=Kt.toUint8Array(a)}return o(e,[{key:"data",get:function(){return this.dataView.slice().buffer},set:function(e){this.dataView=Kt.toUint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=t+r;return this.dataView=Kt.toUint8Array(e).subarray(t,a),a}},{key:"toBER",value:function(e){return this.dataView.slice().buffer}}]),e}();function pn(e,t,r){if(r instanceof vn){for(var a=0;a<r.value.length;a++){if(pn(e,t,r.value[a]).verified)return{verified:!0,result:e}}var n={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(dr)&&(n.name=r.name),n}if(r instanceof mn)return r.hasOwnProperty(dr)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(gr in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=r.idBlock.valueHexView,u=t.idBlock.valueHexView;if(s.length!==u.length)return{verified:!1,result:e};for(var o=0;o<s.length;o++)if(s[o]!==u[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&(e[r.name]=t)),r instanceof Ir.Constructed){var l=0,c={verified:!1,result:{error:"Unknown error"}},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof dn&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,m=0;m<r.valueBlock.value.length;m++)f=f&&(r.valueBlock.value[m].optional||!1);return f?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-l>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var d={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&(delete e[r.name],d.name=r.name)),d}}else if(r.valueBlock.value[0]instanceof dn){if(!1===(c=pn(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&delete e[r.name]),c;l++}if(dr in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(c=pn(e,t.valueBlock.value[v-l],r.valueBlock.value[v])).verified){if(!r.valueBlock.value[v].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&delete e[r.name]),c;l++}if(!1===c.verified){var p={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&(delete e[r.name],p.name=r.name)),p}return{verified:!0,result:e}}if(r.primitiveSchema&&gr in t.valueBlock){var y=Tr(t.valueBlock.valueHexView);if(-1===y.offset){var k={verified:!1,result:y.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,pr),r.name&&(delete e[r.name],k.name=r.name)),k}return pn(e,y.result,r.primitiveSchema)}return{verified:!0,result:e}}var yn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,e),"view"in t)this.fromUint8Array(t.view);else if("buffer"in t)this.fromArrayBuffer(t.buffer);else if("string"in t)this.fromString(t.string);else if("hexstring"in t)this.fromHexString(t.hexstring);else if("length"in t&&t.length>0){if(this.length=t.length,t.stub)for(var r=0;r<this._view.length;r++)this._view[r]=t.stub}else this.length=0}return o(e,[{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"view",get:function(){return this._view},set:function(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}},{key:"length",get:function(){return this.view.byteLength},set:function(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}},{key:"clear",value:function(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}},{key:"fromArrayBuffer",value:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"fromUint8Array",value:function(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}},{key:"fromString",value:function(e){var t=e.length;this.length=t;for(var r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}},{key:"fromHexString",value:function(e){var t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);var r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);for(var a=0,n=0,i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++){var n=this.view[a].toString(16).toUpperCase();r=r+(1==n.length?"0":"")+n}return r}},{key:"copy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-t;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,t+r)});return a}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,r)});return a}},{key:"realloc",value:function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}},{key:"append",value:function(e){var t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length-t;return!(t>this.length-1)&&(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}},{key:"isEqual",value:function(e){if(this.length!=e.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}},{key:"isEqualView",value:function(e){if(e.length!=this.view.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}},{key:"findPattern",value:function(e,t,r,a){var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=e.length;if(o>s)return-1;for(var l=[],c=0;c<o;c++)l.push(e.view[c]);for(var h=0;h<=s-o;h++){for(var f=!0,m=u?i-o-h:i+h,v=0;v<o;v++)if(this.view[v+m]!=l[v]){f=!1;break}if(f)return u?i-o-h:i+o+h}return-1}},{key:"findFirstIn",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o={id:-1,position:u?0:i+s,length:0},l=0;l<e.length;l++){var c=this.findPattern(e[l],i,s,u);if(-1!=c){var h=!1,f=e[l].length;u?c-f>=o.position-o.length&&(h=!0):c-f<=o.position-o.length&&(h=!0),h&&(o.position=c,o.id=l,o.length=f)}}return o}},{key:"findAllIn",value:function(e,t,r){for(var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u={id:-1,position:n};;){var o=u.position;if(-1==(u=this.findFirstIn(e,u.position,i)).id)break;i-=u.position-o,s.push({id:u.id,position:u.position})}return s}},{key:"findAllPatternIn",value:function(e,t,r){var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u=e.length;if(u>i)return-1;for(var o=Array.from(e.view),l=0;l<=i-u;l++){for(var c=!0,h=n+l,f=0;f<u;f++)if(this.view[f+h]!=o[f]){c=!1;break}c&&(s.push(n+u+l),l+=u-1)}return s}},{key:"findFirstNotIn",value:function(t,r,a,n){for(var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l={left:{id:-1,position:s},right:{id:-1,position:0},value:new e},c=u;c>0;){if(l.right=this.findFirstIn(t,o?s-u+c:s+u-c,c,o),-1==l.right.id){u=c,o?s-=u:s=l.left.position,l.value=new e({buffer:this._buffer.slice(s,s+u)});break}if(l.right.position!=(o?l.left.position-t[l.right.id].length:l.left.position+t[l.right.id].length)){o?(s=l.right.position+t[l.right.id].length,u=l.left.position-l.right.position-t[l.right.id].length):(s=l.left.position,u=l.right.position-l.left.position-t[l.right.id].length),l.value=new e({buffer:this._buffer.slice(s,s+u)});break}l.left=l.right,c-=t[l.right.id].length}if(o){var h=l.right;l.right=l.left,l.left=h}return l}},{key:"findAllNotIn",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={left:{id:-1,position:i},right:{id:-1,position:i},value:new e};do{var l=o.right.position;s-=(o=this.findFirstNotIn(t,o.right.position,s)).right.position-l,u.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(-1!=o.right.id);return u}},{key:"findFirstSequence",value:function(t,r,a,n){var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l=this.skipNotPatterns(t,s,u,o);if(-1==l)return{position:-1,value:new e};var c=this.skipPatterns(t,l,u-(o?s-l:l-s),o);return o?(s=c,u=l-c):(s=l,u=c-l),{position:c,value:new e({buffer:this._buffer.slice(s,s+u)})}}},{key:"findAllSequences",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={position:i,value:new e};do{var l=o.position;-1!=(o=this.findFirstSequence(t,o.position,s)).position&&(s-=o.position-l,u.push({position:o.position,value:o.value}))}while(-1!=o.position);return u}},{key:"findPairedPatterns",value:function(e,t,r,a){var n=[];if(e.isEqual(t))return n;var i=this.prepareFindParameters(r,a),s=i.start,u=i.length,o=0,l=this.findAllPatternIn(e,s,u);if(!Array.isArray(l)||0==l.length)return n;var c=this.findAllPatternIn(t,s,u);if(!Array.isArray(c)||0==c.length)return n;for(;o<l.length&&0!=c.length;)if(l[0]!=c[0]){if(l[o]>c[0])break;for(;l[o]<c[0]&&!(++o>=l.length););n.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else n.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return n.sort((function(e,t){return e.left-t.left})),n}},{key:"findPairedArrays",value:function(e,t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o=0,l=this.findAllIn(e,i,s);if(0==l.length)return u;var c=this.findAllIn(t,i,s);if(0==c.length)return u;for(;o<l.length&&0!=c.length;)if(l[0].position!=c[0].position){if(l[o].position>c[0].position)break;for(;l[o].position<c[0].position&&!(++o>=l.length););u.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else u.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return u.sort((function(e,t){return e.left.position-t.left.position})),u}},{key:"replacePattern",value:function(e,t,r,a){var n,i,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=[],o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},l=this.prepareFindParameters(r,a),c=l.start,h=l.length;if(null==s){if(0==(u=this.findAllIn([e],c,h)).length)return o}else u=s;(n=o.searchPatternPositions).push.apply(n,S(Array.from(u,(function(e){return e.position}))));var f=e.length-t.length,m=new ArrayBuffer(this.view.length-u.length*f),v=new Uint8Array(m);for(v.set(new Uint8Array(this.buffer,0,c)),i=0;i<u.length;i++){var d=0==i?c:u[i-1].position;v.set(new Uint8Array(this.buffer,d,u[i].position-e.length-d),d-i*f),v.set(t.view,u[i].position-e.length-i*f),o.replacePatternPositions.push(u[i].position-e.length-i*f)}return i--,v.set(new Uint8Array(this.buffer,u[i].position,this.length-u[i].position),u[i].position-e.length+t.length-i*f),this.buffer=m,this.view=new Uint8Array(this.buffer),o.status=1,o}},{key:"skipPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=i,l=0;l<e.length;l++){for(var c=e[l].length,h=u?o-c:o,f=!0,m=0;m<c;m++)if(this.view[m+h]!=e[l].view[m]){f=!1;break}if(f)if(l=-1,u){if((o-=c)<=0)return o}else if((o+=c)>=i+s)return o}return o}},{key:"skipNotPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=-1,l=0;l<s;l++){for(var c=0;c<e.length;c++){for(var h=e[c].length,f=u?i-l-h:i+l,m=!0,v=0;v<h;v++)if(this.view[v+f]!=e[c].view[v]){m=!1;break}if(m){o=u?i-l:i+l;break}}if(-1!=o)break}return o}},{key:"prepareFindParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}]),e}(),kn=16777216,wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),this._stream=new yn,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in t?new yn({view:t.view}):"buffer"in t?new yn({buffer:t.buffer}):"string"in t?new yn({string:t.string}):"hexstring"in t?new yn({hexstring:t.hexstring}):"stream"in t?t.stream.slice():new yn,"backward"in t&&t.backward&&(this.backward=t.backward,this._start=this.stream.length),"length"in t&&t.length>0&&(this._length=t.length),"start"in t&&t.start&&t.start>0&&(this._start=t.start),"appendBlock"in t&&t.appendBlock&&t.appendBlock>0&&(this.appendBlock=t.appendBlock)}return o(e,[{key:"stream",get:function(){return this._stream},set:function(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}},{key:"length",get:function(){return this.appendBlock?this.start:this._length},set:function(e){this.prevLength=this._length,this._length=e}},{key:"start",get:function(){return this._start},set:function(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}},{key:"buffer",get:function(){return this._stream.buffer.slice(0,this._length)}},{key:"resetPosition",value:function(){this._start=this.prevStart,this._length=this.prevLength}},{key:"findPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}},{key:"findFirstIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}},{key:"findAllIn",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}},{key:"findFirstNotIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this._length)&&(t=this._length);var r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new yn}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new yn};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}},{key:"findAllNotIn",value:function(e){var t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}},{key:"findFirstSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);var a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==a.value.length)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new yn}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new yn};return this.start=a.position,a}},{key:"findAllSequences",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}},{key:"findPairedPatterns",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[];return n}},{key:"findPairedArrays",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[];return n}},{key:"replacePattern",value:function(e,t){var r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}},{key:"skipPatterns",value:function(e){var t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}},{key:"skipNotPatterns",value:function(e){var t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}},{key:"append",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendView",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendChar",value:function(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}},{key:"appendUint16",value:function(e){this.beforeAppend(2);var t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendUint24",value:function(e){this.beforeAppend(3);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}},{key:"appendUint32",value:function(e){this.beforeAppend(4);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"appendInt16",value:function(e){this.beforeAppend(2);var t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendInt32",value:function(e){this.beforeAppend(4);var t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"getBlock",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._length<=0)return new Uint8Array(0);if(this._length<e&&(e=this._length),this.backward){var a=this._stream.view.subarray(this._length-e,this._length);t=new Uint8Array(e);for(var n=0;n<e;n++)t[e-1-n]=a[n]}else t=this._stream.view.subarray(this._start,this._start+e);return r&&(this.start+=this.backward?-1*e:e),t}},{key:"getUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}},{key:"getInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}},{key:"getUint24",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}},{key:"getUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<4?0:t[0]*kn+(t[1]<<16)+(t[2]<<8)+t[3]}},{key:"getInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}},{key:"beforeAppend",value:function(t){this._start+t>this._stream.length&&(t>this.appendBlock&&(this.appendBlock=t+e.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}]),e}();wn.APPEND_BLOCK=1e3;var bn=new ArrayBuffer(0),Sn="",Nn=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).name=r.NAME,e}return o(r,null,[{key:"isType",value:function(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;if(a(e)===t)return!0}else if(e instanceof t)return!0;return!1}},{key:"assert",value:function(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];for(var s=0,u=n;s<u.length;s++){var o=u[s];if(this.isType(e,o))return}var l=n.map((function(e){return e instanceof Function&&"name"in e?e.name:"".concat(e)}));throw new r("Parameter '".concat(t,"' is not of type ").concat(l.length>1?"(".concat(l.join(" or "),")"):l[0]))}}]),r}(d(TypeError));Nn.NAME="ArgumentError";var An=function(e){c(r,e);var t=y(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return s(this,r),(a=t.call(this)).name=r.NAME,a.field=e,n&&(a.target=n),a.message=i||"Absent mandatory parameter '".concat(e,"' ").concat(n?" in '".concat(n,"'"):Sn),a}return o(r,null,[{key:"assert",value:function(){for(var e,t,a=null,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];"string"==typeof i[0]?(a=i[0],e=i[1],t=i.slice(2)):(e=i[0],t=i.slice(1)),Nn.assert(e,"parameters","object");var u,o=C(t);try{for(o.s();!(u=o.n()).done;){var l=u.value,c=e[l];if(null==c)throw new r(l,a)}}catch(e){o.e(e)}finally{o.f()}}},{key:"assertEmpty",value:function(e,t,a){if(null==e)throw new r(t,a)}}]),r}(d(TypeError));An.NAME="ParameterError";var Cn=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this,e)).name="AsnError",a}return o(r,null,[{key:"assertSchema",value:function(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}},{key:"assert",value:function(e,t){if(-1===e.offset)throw new r("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}}]),r}(d(Error)),xn=function(){function e(){s(this,e)}return o(e,[{key:"className",get:function(){return this.constructor.CLASS_NAME}},{key:"toString",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hex";try{e=this.toSchema()}catch(t){e=this.toSchema(!0)}return Ft.ToString(e.toBER(),t)}}],[{key:"blockName",value:function(){return this.CLASS_NAME}},{key:"fromBER",value:function(e){var t=Lr(e);Cn.assert(t,this.name);try{return new this({schema:t.result})}catch(e){throw new Cn("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}},{key:"defaultValues",value:function(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}},{key:"schema",value:function(){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}}]),e}();function En(e){for(var t=!1,r=Sn,a=e.trim(),n=0;n<a.length;n++)32===a.charCodeAt(n)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=a[n]);return r.toLowerCase()}xn.CLASS_NAME="PkiObject";var In="type",Bn="value",Vn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).type=Gt(a,In,r.defaultValues(In)),e.value=Gt(a,Bn,r.defaultValues(Bn)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[In,"typeValue"]);var t=pn(e,e,r.schema({names:{type:In,value:"typeValue"}}));Cn.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(e){var t=[Ea.blockName(),Va.blockName(),Pa.blockName(),Ta.blockName(),Ma.blockName(),_a.blockName(),ja.blockName(),Fa.blockName(),qa.blockName(),Wa.blockName(),Qa.blockName(),Za.blockName()];if(e instanceof ArrayBuffer)return Kt.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===r.blockName()){if(this.type!==e.type)return!1;var a,n=[!1,!1],i=this.value.constructor.blockName(),s=C(t);try{for(s.s();!(a=s.n()).done;){var u=a.value;i===u&&(n[0]=!0),e.value.constructor.blockName()===u&&(n[1]=!0)}}catch(e){s.e(e)}finally{s.f()}if(n[0]!==n[1])return!1;if(n[0]&&n[1]){var o=En(this.value.valueBlock.value),l=En(e.value.valueBlock.value);if(0!==o.localeCompare(l))return!1}else if(!Kt.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}],[{key:"defaultValues",value:function(e){switch(e){case In:return Sn;case Bn:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.type||Sn}),new mn({name:t.value||Sn})]})}}]),r}(xn);Vn.CLASS_NAME="AttributeTypeAndValue";var Rn="typesAndValues",Dn="valueBeforeDecode",On=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).typesAndValues=Gt(a,Rn,r.defaultValues(Rn)),e.valueBeforeDecode=Gt(a,Dn,r.defaultValues(Dn)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,["RDN",Rn]);var t=pn(e,e,r.schema({names:{blockName:"RDN",repeatedSet:Rn}}));Cn.assertSchema(t,this.className),Rn in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,(function(e){return new Vn({schema:e})}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}},{key:"toSchema",value:function(){if(0===this.valueBeforeDecode.byteLength)return new wa({value:[new ba({value:Array.from(this.typesAndValues,(function(e){return e.toSchema()}))})]});var e=Lr(this.valueBeforeDecode);if(Cn.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof wa))throw new Error("ASN.1 result should be SEQUENCE");return e.result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,(function(e){return e.toJSON()}))}}},{key:"isEqual",value:function(e){if(e instanceof r){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;var t,a=C(this.typesAndValues.entries());try{for(a.s();!(t=a.n()).done;){var n=b(t.value,2),i=n[0];if(!1===n[1].isEqual(e.typesAndValues[i]))return!1}}catch(e){a.e(e)}finally{a.f()}return!0}return e instanceof ArrayBuffer&&$t(this.valueBeforeDecode,e)}}],[{key:"defaultValues",value:function(e){switch(e){case Rn:return[];case Dn:return bn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Rn:return 0===t.length;case Dn:return 0===t.byteLength;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.repeatedSequence||Sn,value:new ba({value:[new dn({name:t.repeatedSet||Sn,value:Vn.schema(t.typeAndValue||{})})]})})]})}}]),r}(xn);On.CLASS_NAME="RelativeDistinguishedNames";var Pn="type",Un="value";function Tn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Gt(e,"names",{});return new wa({optional:t,value:[new _r({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||Sn,value:[new vn({value:[new Ta,new Ma]})]}),new _r({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||Sn,value:[new vn({value:[new Ta,new Ma]})]}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||Sn,isHexOnly:!0}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||Sn,isHexOnly:!0}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||Sn,value:[new vn({value:[new Ta,new Ma]})]}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||Sn,isHexOnly:!0}),new Pr({optional:!0,name:r.numeric_user_identifier||Sn,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new _r({optional:!0,name:r.personal_name||Sn,idBlock:{tagClass:3,tagNumber:5},value:[new Pr({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new _r({optional:!0,name:r.organizational_unit_names||Sn,idBlock:{tagClass:3,tagNumber:6},value:[new dn({value:new Ma})]})]})}function Ln(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new wa({optional:e,value:[new Ma,new Ma]})}function Mn(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new ba({optional:e,value:[new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new mn]})]})}var Hn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).type=Gt(a,Pn,r.defaultValues(Pn)),e.value=Gt(a,Un,r.defaultValues(Un)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);var t=pn(e,e,r.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(Cn.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:var a=t.result.blockName;a.idBlock.tagClass=1,a.idBlock.tagNumber=22;var n=Lr(a.toBER(!1));Cn.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value;break;case 4:this.value=new On({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new Yr({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:var i=t.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=Lr(i.toBER(!1));Cn.assert(s,"GeneralName registeredID"),this.value=s.result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new _r({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var e=new Fa({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e;case 4:return new _r({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var t=this.value;return t.idBlock.tagClass=3,t.idBlock.tagNumber=this.type,t;case 8:var a=new ma({value:this.value});return a.idBlock.tagClass=3,a.idBlock.tagNumber=this.type,a;default:return r.schema()}}},{key:"toJSON",value:function(){var e={type:this.type,value:Sn};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}],[{key:"defaultValues",value:function(e){switch(e){case Pn:return 9;case Un:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Pn:return t===r.defaultValues(e);case Un:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new vn({value:[new _r({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||Sn,value:[new ma,new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn]})]}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:1}}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:2}}),new _r({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||Sn,value:[Tn(t.builtInStandardAttributes||{},!1),Ln(!0),Mn(!0)]}),new _r({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||Sn,value:[On.schema(t.directoryName||{})]}),new _r({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||Sn,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new vn({value:[new _a,new Ma,new Pa,new Ea,new Va]})]}),new _r({idBlock:{tagClass:3,tagNumber:1},value:[new vn({value:[new _a,new Ma,new Pa,new Ea,new Va]})]})]}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:6}}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:7}}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:8}})]})}}]),r}(xn);Hn.CLASS_NAME="GeneralName";var _n="accessMethod",Kn="accessLocation",jn=[_n,Kn],Jn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).accessMethod=Gt(a,_n,r.defaultValues(_n)),e.accessLocation=Gt(a,Kn,r.defaultValues(Kn)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,jn);var t=pn(e,e,r.schema({names:{accessMethod:_n,accessLocation:{names:{blockName:Kn}}}}));Cn.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Hn({schema:t.result.accessLocation})}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case _n:return Sn;case Kn:return new Hn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.accessMethod||Sn}),Hn.schema(t.accessLocation||{})]})}}]),r}(xn);Jn.CLASS_NAME="AccessDescription";var Fn="seconds",Gn="millis",qn="micros",Xn=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),Fn in a&&(e.seconds=Gt(a,Fn,r.defaultValues(Fn))),Gn in a&&(e.millis=Gt(a,Gn,r.defaultValues(Gn))),qn in a&&(e.micros=Gt(a,qn,r.defaultValues(qn))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[Fn,Gn,qn]);var t=pn(e,e,r.schema({names:{seconds:Fn,millis:Gn,micros:qn}}));if(Cn.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){var a=new oa({valueHex:t.result.millis.valueBlock.valueHex});this.millis=a.valueBlock.valueDec}if("micros"in t.result){var n=new oa({valueHex:t.result.micros.valueBlock.valueHex});this.micros=n.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(void 0!==this.seconds&&e.push(new oa({value:this.seconds})),void 0!==this.millis){var t=new oa({value:this.millis});e.push(new Pr({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){var r=new oa({value:this.micros});e.push(new Pr({idBlock:{tagClass:3,tagNumber:1},valueHex:r.valueBlock.valueHexView}))}return new wa({value:e})}},{key:"toJSON",value:function(){var e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fn:case Gn:case qn:return 0;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Fn:case Gn:case qn:return t===r.defaultValues(e);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,optional:!0,value:[new oa({optional:!0,name:t.seconds||Sn}),new Pr({name:t.millis||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Pr({name:t.micros||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(xn);Xn.CLASS_NAME="Accuracy";var Wn="algorithmId",zn="algorithmParams",Qn="algorithm",Yn="params",Zn=[Qn,Yn],$n=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).algorithmId=Gt(a,Wn,r.defaultValues(Wn)),zn in a&&(e.algorithmParams=Gt(a,zn,r.defaultValues(zn))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Zn);var t=pn(e,e,r.schema({names:{algorithmIdentifier:Qn,algorithmParams:Yn}}));Cn.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Yn in t.result&&(this.algorithmParams=t.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.algorithmId})),!this.algorithmParams||this.algorithmParams instanceof mn||e.push(this.algorithmParams),new wa({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return!this.algorithmParams||this.algorithmParams instanceof mn||(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(e){return e instanceof r&&(this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams))}}],[{key:"defaultValues",value:function(e){switch(e){case Wn:return Sn;case zn:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Wn:return t===Sn;case zn:return t instanceof mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,optional:t.optional||!1,value:[new ma({name:t.algorithmIdentifier||Sn}),new mn({name:t.algorithmParams||Sn,optional:!0})]})}}]),r}(xn);$n.CLASS_NAME="AlgorithmIdentifier";var ei="altNames",ti=[ei],ri=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).altNames=Gt(a,ei,r.defaultValues(ei)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ti);var t=pn(e,e,r.schema({names:{altNames:ei}}));Cn.assertSchema(t,this.className),ei in t.result&&(this.altNames=Array.from(t.result.altNames,(function(e){return new Hn({schema:e})})))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.altNames,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ei?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.altNames||Sn,value:Hn.schema()})]})}}]),r}(xn);ri.CLASS_NAME="AltName";var ai="type",ni="values",ii=[ai,ni],si=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).type=Gt(a,ai,r.defaultValues(ai)),e.values=Gt(a,ni,r.defaultValues(ni)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ii);var t=pn(e,e,r.schema({names:{type:ai,values:ni}}));Cn.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.type}),new ba({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case ai:return Sn;case ni:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ai:return t===Sn;case ni:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.type||Sn}),new ba({name:t.setName||Sn,value:[new dn({name:t.values||Sn,value:new mn})]})]})}}]),r}(xn);si.CLASS_NAME="Attribute";var ui="notBeforeTime",oi="notAfterTime",li=[ui,oi],ci=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).notBeforeTime=Gt(a,ui,r.defaultValues(ui)),e.notAfterTime=Gt(a,oi,r.defaultValues(oi)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,li);var t=pn(e,e,r.schema({names:{notBeforeTime:ui,notAfterTime:oi}}));Cn.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}},{key:"toSchema",value:function(){return new wa({value:[new rn({valueDate:this.notBeforeTime}),new rn({valueDate:this.notAfterTime})]})}},{key:"toJSON",value:function(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}],[{key:"defaultValues",value:function(e){switch(e){case ui:case oi:return new Date(0,0,0);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new rn({name:t.notBeforeTime||Sn}),new rn({name:t.notAfterTime||Sn})]})}}]),r}(xn);ci.CLASS_NAME="AttCertValidityPeriod";var hi="names",fi="generalNames",mi=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).names=Gt(a,hi,r.defaultValues(hi)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[hi,fi]);var t=pn(e,e,r.schema({names:{blockName:hi,generalNames:fi}}));Cn.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,(function(e){return new Hn({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.names,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return"names"===e?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Gt(e,hi,{});return new wa({optional:t,name:r.blockName||Sn,value:[new dn({name:r.generalNames||Sn,value:Hn.schema()})]})}}]),r}(xn);mi.CLASS_NAME="GeneralNames";var vi="2.5.29.14",di="2.5.29.15",gi="2.5.29.17",pi="2.5.29.18",yi="2.5.29.19",ki="2.5.29.28",wi="2.5.29.29",bi="2.5.29.30",Si="2.5.29.31",Ni="2.5.29.46",Ai="2.5.29.32",Ci="2.5.29.32.0",xi="2.5.29.33",Ei="2.5.29.35",Ii="2.5.29.36",Bi="2.5.29.54",Vi="1.3.6.1.5.5.7.1.1",Ri="1.2.840.113549.1.7.1",Di="1.2.840.113549.1.7.2",Oi="1.2.840.113549.1.7.3",Pi="1.2.840.113549.1.7.6",Ui="1.2.840.113549.1.9.16.1.4",Ti="1.2.840.113549.1.9.22.1",Li="1.2.840.113549.1.9.22.3",Mi="1.2.840.113549.1.9.23.1",Hi="".concat("1.3.6.1.5.5.7",".48"),_i="".concat(Hi,".1.1"),Ki="keyIdentifier",ji="authorityCertIssuer",Ji="authorityCertSerialNumber",Fi=[Ki,ji,Ji],Gi=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),Ki in a&&(e.keyIdentifier=Gt(a,Ki,r.defaultValues(Ki))),ji in a&&(e.authorityCertIssuer=Gt(a,ji,r.defaultValues(ji))),Ji in a&&(e.authorityCertSerialNumber=Gt(a,Ji,r.defaultValues(Ji))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Fi);var t=pn(e,e,r.schema({names:{keyIdentifier:Ki,authorityCertIssuer:ji,authorityCertSerialNumber:Ji}}));Cn.assertSchema(t,this.className),Ki in t.result&&(this.keyIdentifier=new Yr({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),ji in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,(function(e){return new Hn({schema:e})}))),Ji in t.result&&(this.authorityCertSerialNumber=new oa({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}},{key:"toSchema",value:function(){var e=[];return this.keyIdentifier&&e.push(new Pr({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(function(e){return e.toSchema()}))})),this.authorityCertSerialNumber&&e.push(new Pr({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(function(e){return e.toJSON()}))),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ki:return new Yr;case ji:return[];case Ji:return new oa;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Pr({name:t.keyIdentifier||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dn({name:t.authorityCertIssuer||Sn,value:Hn.schema()})]}),new Pr({name:t.authorityCertSerialNumber||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}]),r}(xn);Gi.CLASS_NAME="AuthorityKeyIdentifier";var qi="pathLenConstraint",Xi="cA",Wi=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).cA=Gt(a,Xi,!1),qi in a&&(e.pathLenConstraint=Gt(a,qi,0)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[Xi,qi]);var t=pn(e,e,r.schema({names:{cA:Xi,pathLenConstraint:qi}}));Cn.assertSchema(t,this.className),Xi in t.result&&(this.cA=t.result.cA.valueBlock.value),qi in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.cA!==r.defaultValues(Xi)&&e.push(new Wr({value:this.cA})),qi in this&&(this.pathLenConstraint instanceof oa?e.push(this.pathLenConstraint):e.push(new oa({value:this.pathLenConstraint}))),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.cA!==r.defaultValues(Xi)&&(e.cA=this.cA),qi in this&&(this.pathLenConstraint instanceof oa?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}],[{key:"defaultValues",value:function(e){return e!==Xi&&w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Wr({optional:!0,name:t.cA||Sn}),new oa({optional:!0,name:t.pathLenConstraint||Sn})]})}}]),r}(xn);Wi.CLASS_NAME="BasicConstraints";var zi="certificateIndex",Qi="keyIndex",Yi=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).certificateIndex=Gt(a,zi,r.defaultValues(zi)),e.keyIndex=Gt(a,Qi,r.defaultValues(Qi)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){if(e.constructor.blockName()!==oa.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");var t=e.valueBlock.valueHex.slice(0),r=new Uint8Array(t);switch(!0){case t.byteLength<4:var a=new ArrayBuffer(4);new Uint8Array(a).set(r,4-t.byteLength),t=a.slice(0);break;case t.byteLength>4:var n=new ArrayBuffer(4);new Uint8Array(n).set(r.slice(0,4)),t=n.slice(0)}var i=t.slice(0,2),s=new Uint8Array(i),u=s[0];s[0]=s[1],s[1]=u;var o=new Uint16Array(i);this.keyIndex=o[0];var l=t.slice(2),c=new Uint8Array(l);u=c[0],c[0]=c[1],c[1]=u;var h=new Uint16Array(l);this.certificateIndex=h[0]}},{key:"toSchema",value:function(){var e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;var t=new Uint8Array(e),r=t[0];t[0]=t[1],t[1]=r;var a=new ArrayBuffer(2);new Uint16Array(a)[0]=this.keyIndex;var n=new Uint8Array(a);return r=n[0],n[0]=n[1],n[1]=r,new oa({valueHex:zt(a,e)})}},{key:"toJSON",value:function(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}],[{key:"defaultValues",value:function(e){switch(e){case zi:case Qi:return 0;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){return new oa}}]),r}(xn);Yi.CLASS_NAME="CAVersion";var Zi="policyQualifierId",$i="qualifier",es=[Zi,$i],ts=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).policyQualifierId=Gt(a,Zi,r.defaultValues(Zi)),e.qualifier=Gt(a,$i,r.defaultValues($i)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,es);var t=pn(e,e,r.schema({names:{policyQualifierId:Zi,qualifier:$i}}));Cn.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Zi:return Sn;case $i:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.policyQualifierId||Sn}),new mn({name:t.qualifier||Sn})]})}}]),r}(xn);ts.CLASS_NAME="PolicyQualifierInfo";var rs="policyIdentifier",as="policyQualifiers",ns=[rs,as],is=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).policyIdentifier=Gt(a,rs,r.defaultValues(rs)),as in a&&(e.policyQualifiers=Gt(a,as,r.defaultValues(as))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ns);var t=pn(e,e,r.schema({names:{policyIdentifier:rs,policyQualifiers:as}}));Cn.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),as in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,(function(e){return new ts({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new wa({value:Array.from(this.policyQualifiers,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case rs:return Sn;case as:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.policyIdentifier||Sn}),new wa({optional:!0,value:[new dn({name:t.policyQualifiers||Sn,value:ts.schema()})]})]})}}]),r}(xn);is.CLASS_NAME="PolicyInformation";var ss="certificatePolicies",us=[ss],os=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).certificatePolicies=Gt(a,ss,r.defaultValues(ss)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,us);var t=pn(e,e,r.schema({names:{certificatePolicies:ss}}));Cn.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,(function(e){return new is({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.certificatePolicies,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ss?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.certificatePolicies||Sn,value:is.schema()})]})}}]),r}(xn);os.CLASS_NAME="CertificatePolicies";var ls="templateID",cs="templateMajorVersion",hs="templateMinorVersion",fs=[ls,cs,hs],ms=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).templateID=Gt(a,ls,r.defaultValues(ls)),cs in a&&(e.templateMajorVersion=Gt(a,cs,r.defaultValues(cs))),hs in a&&(e.templateMinorVersion=Gt(a,hs,r.defaultValues(hs))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,fs);var t=pn(e,e,r.schema({names:{templateID:ls,templateMajorVersion:cs,templateMinorVersion:hs}}));Cn.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),cs in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),hs in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.templateID})),cs in this&&e.push(new oa({value:this.templateMajorVersion})),hs in this&&e.push(new oa({value:this.templateMinorVersion})),new wa({value:e})}},{key:"toJSON",value:function(){var e={templateID:this.templateID};return cs in this&&(e.templateMajorVersion=this.templateMajorVersion),hs in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}],[{key:"defaultValues",value:function(e){switch(e){case ls:return Sn;case cs:case hs:return 0;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.templateID||Sn}),new oa({name:t.templateMajorVersion||Sn,optional:!0}),new oa({name:t.templateMinorVersion||Sn,optional:!0})]})}}]),r}(xn),vs="distributionPoint",ds="distributionPointNames",gs="reasons",ps="cRLIssuer",ys="cRLIssuerNames",ks=[vs,ds,gs,ps,ys],ws=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),vs in a&&(e.distributionPoint=Gt(a,vs,r.defaultValues(vs))),gs in a&&(e.reasons=Gt(a,gs,r.defaultValues(gs))),ps in a&&(e.cRLIssuer=Gt(a,ps,r.defaultValues(ps))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ks);var t=pn(e,e,r.schema({names:{distributionPoint:vs,distributionPointNames:ds,reasons:gs,cRLIssuer:ps,cRLIssuerNames:ys}}));Cn.assertSchema(t,this.className),vs in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,(function(e){return new Hn({schema:e})}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new On({schema:new wa({value:t.result.distributionPoint.valueBlock.value})}))),gs in t.result&&(this.reasons=new ta({valueHex:t.result.reasons.valueBlock.valueHex})),ps in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,(function(e){return new Hn({schema:e})})))}},{key:"toSchema",value:function(){var e,t=[];this.distributionPoint&&(e=this.distributionPoint instanceof Array?new _r({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):new _r({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),t.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[e]})));return this.reasons&&t.push(new Pr({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&t.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(function(e){return e.toSchema()}))})),new wa({value:t})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case vs:return[];case gs:return new ta;case ps:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new vn({value:[new _r({name:t.distributionPoint||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dn({name:t.distributionPointNames||Sn,value:Hn.schema()})]}),new _r({name:t.distributionPoint||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:On.schema().valueBlock.value})]})]}),new Pr({name:t.reasons||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _r({name:t.cRLIssuer||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new dn({name:t.cRLIssuerNames||Sn,value:Hn.schema()})]})]})}}]),r}(xn);ws.CLASS_NAME="DistributionPoint";var bs="distributionPoints",Ss=[bs],Ns=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).distributionPoints=Gt(a,bs,r.defaultValues(bs)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ss);var t=pn(e,e,r.schema({names:{distributionPoints:bs}}));Cn.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,(function(e){return new ws({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.distributionPoints,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===bs?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.distributionPoints||Sn,value:ws.schema()})]})}}]),r}(xn);Ns.CLASS_NAME="CRLDistributionPoints";var As="keyPurposes",Cs=[As],xs=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).keyPurposes=Gt(a,As,r.defaultValues(As)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Cs);var t=pn(e,e,r.schema({names:{keyPurposes:As}}));Cn.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,(function(e){return e.valueBlock.toString()}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.keyPurposes,(function(e){return new ma({value:e})}))})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){return e===As?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.keyPurposes||Sn,value:new ma})]})}}]),r}(xn);xs.CLASS_NAME="ExtKeyUsage";var Es="accessDescriptions",Is=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).accessDescriptions=Gt(a,Es,r.defaultValues(Es)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[Es]);var t=pn(e,e,r.schema({names:{accessDescriptions:Es}}));Cn.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,(function(e){return new Jn({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.accessDescriptions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Es?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.accessDescriptions||Sn,value:Jn.schema()})]})}}]),r}(xn);Is.CLASS_NAME="InfoAccess";var Bs="distributionPoint",Vs="distributionPointNames",Rs="onlyContainsUserCerts",Ds="onlyContainsCACerts",Os="onlySomeReasons",Ps="indirectCRL",Us="onlyContainsAttributeCerts",Ts=[Bs,Vs,Rs,Ds,Os,Ps,Us],Ls=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),Bs in a&&(e.distributionPoint=Gt(a,Bs,r.defaultValues(Bs))),e.onlyContainsUserCerts=Gt(a,Rs,r.defaultValues(Rs)),e.onlyContainsCACerts=Gt(a,Ds,r.defaultValues(Ds)),Os in a&&(e.onlySomeReasons=Gt(a,Os,r.defaultValues(Os))),e.indirectCRL=Gt(a,Ps,r.defaultValues(Ps)),e.onlyContainsAttributeCerts=Gt(a,Us,r.defaultValues(Us)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ts);var t=pn(e,e,r.schema({names:{distributionPoint:Bs,distributionPointNames:Vs,onlyContainsUserCerts:Rs,onlyContainsCACerts:Ds,onlySomeReasons:Os,indirectCRL:Ps,onlyContainsAttributeCerts:Us}}));if(Cn.assertSchema(t,this.className),Bs in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,(function(e){return new Hn({schema:e})}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new On({schema:new wa({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Rs in t.result){var a=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==a[0]}if(Ds in t.result){var n=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==n[0]}if(Os in t.result){var i=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if(Ps in t.result){var s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if(Us in t.result){var u=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==u[0]}}},{key:"toSchema",value:function(){var e,t=[];this.distributionPoint&&(this.distributionPoint instanceof Array?e=new _r({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):((e=this.distributionPoint.toSchema()).idBlock.tagClass=3,e.idBlock.tagNumber=1),t.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[e]})));if(this.onlyContainsUserCerts!==r.defaultValues(Rs)&&t.push(new Pr({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==r.defaultValues(Ds)&&t.push(new Pr({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){var a=new ArrayBuffer(1);new Uint8Array(a)[0]=this.onlySomeReasons,t.push(new Pr({idBlock:{tagClass:3,tagNumber:3},valueHex:a}))}return this.indirectCRL!==r.defaultValues(Ps)&&t.push(new Pr({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==r.defaultValues(Us)&&t.push(new Pr({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new wa({value:t})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==r.defaultValues(Rs)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==r.defaultValues(Ds)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Os in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==r.defaultValues(Ps)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==r.defaultValues(Us)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bs:return[];case Rs:case Ds:return!1;case Os:return 0;case Ps:case Us:return!1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new vn({value:[new _r({name:t.distributionPoint||Sn,idBlock:{tagClass:3,tagNumber:0},value:[new dn({name:t.distributionPointNames||Sn,value:Hn.schema()})]}),new _r({name:t.distributionPoint||Sn,idBlock:{tagClass:3,tagNumber:1},value:On.schema().valueBlock.value})]})]}),new Pr({name:t.onlyContainsUserCerts||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Pr({name:t.onlyContainsCACerts||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Pr({name:t.onlySomeReasons||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Pr({name:t.indirectCRL||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Pr({name:t.onlyContainsAttributeCerts||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}]),r}(xn);Ls.CLASS_NAME="IssuingDistributionPoint";var Ms="base",Hs="minimum",_s="maximum",Ks=[Ms,Hs,_s],js=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).base=Gt(a,Ms,r.defaultValues(Ms)),e.minimum=Gt(a,Hs,r.defaultValues(Hs)),_s in a&&(e.maximum=Gt(a,_s,r.defaultValues(_s))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ks);var t=pn(e,e,r.schema({names:{base:{names:{blockName:Ms}},minimum:Hs,maximum:_s}}));Cn.assertSchema(t,this.className),this.base=new Hn({schema:t.result.base}),Hs in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),_s in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof oa?this.minimum:new oa({value:this.minimum}),e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(_s in this){var r=0;r=this.maximum instanceof oa?this.maximum:new oa({value:this.maximum}),e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new wa({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),void 0!==this.maximum&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ms:return new Hn;case Hs:case _s:return 0;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[Hn.schema(t.base||{}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new oa({name:t.minimum||Sn})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new oa({name:t.maximum||Sn})]})]})}}]),r}(xn);js.CLASS_NAME="GeneralSubtree";var Js="permittedSubtrees",Fs="excludedSubtrees",Gs=[Js,Fs],qs=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),Js in a&&(e.permittedSubtrees=Gt(a,Js,r.defaultValues(Js))),Fs in a&&(e.excludedSubtrees=Gt(a,Fs,r.defaultValues(Fs))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Gs);var t=pn(e,e,r.schema({names:{permittedSubtrees:Js,excludedSubtrees:Fs}}));Cn.assertSchema(t,this.className),Js in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,(function(e){return new js({schema:e})}))),Fs in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,(function(e){return new js({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return this.permittedSubtrees&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(function(e){return e.toSchema()}))})),this.excludedSubtrees&&e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,(function(e){return e.toJSON()}))),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Js:case Fs:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dn({name:t.permittedSubtrees||Sn,value:js.schema()})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dn({name:t.excludedSubtrees||Sn,value:js.schema()})]})]})}}]),r}(xn);qs.CLASS_NAME="NameConstraints";var Xs="requireExplicitPolicy",Ws="inhibitPolicyMapping",zs=[Xs,Ws],Qs=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),Xs in a&&(e.requireExplicitPolicy=Gt(a,Xs,r.defaultValues(Xs))),Ws in a&&(e.inhibitPolicyMapping=Gt(a,Ws,r.defaultValues(Ws))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,zs);var t=pn(e,e,r.schema({names:{requireExplicitPolicy:Xs,inhibitPolicyMapping:Ws}}));if(Cn.assertSchema(t,this.className),Xs in t.result){var a=t.result.requireExplicitPolicy;a.idBlock.tagClass=1,a.idBlock.tagNumber=2;var n=Lr(a.toBER(!1));Cn.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Ws in t.result){var i=t.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=Lr(i.toBER(!1));Cn.assert(s,"Integer"),this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(Xs in this){var t=new oa({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Ws in this){var r=new oa({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new wa({value:e})}},{key:"toJSON",value:function(){var e={};return Xs in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Ws in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case Xs:case Ws:return 0;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Pr({name:t.requireExplicitPolicy||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Pr({name:t.inhibitPolicyMapping||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(xn);Qs.CLASS_NAME="PolicyConstraints";var Ys="issuerDomainPolicy",Zs="subjectDomainPolicy",$s=[Ys,Zs],eu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).issuerDomainPolicy=Gt(a,Ys,r.defaultValues(Ys)),e.subjectDomainPolicy=Gt(a,Zs,r.defaultValues(Zs)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,$s);var t=pn(e,e,r.schema({names:{issuerDomainPolicy:Ys,subjectDomainPolicy:Zs}}));Cn.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.issuerDomainPolicy}),new ma({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case Ys:case Zs:return Sn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.issuerDomainPolicy||Sn}),new ma({name:t.subjectDomainPolicy||Sn})]})}}]),r}(xn);eu.CLASS_NAME="PolicyMapping";var tu="mappings",ru=[tu],au=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).mappings=Gt(a,tu,r.defaultValues(tu)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ru);var t=pn(e,e,r.schema({names:{mappings:tu}}));Cn.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,(function(e){return new eu({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.mappings,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===tu?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.mappings||Sn,value:eu.schema()})]})}}]),r}(xn);au.CLASS_NAME="PolicyMappings";var nu="notBefore",iu="notAfter",su=[nu,iu],uu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),nu in a&&(e.notBefore=Gt(a,nu,r.defaultValues(nu))),iu in a&&(e.notAfter=Gt(a,iu,r.defaultValues(iu))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,su);var t=pn(e,e,r.schema({names:{notBefore:nu,notAfter:iu}}));if(Cn.assertSchema(t,this.className),nu in t.result){var a=new rn;a.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=a.toDate()}if(iu in t.result){var n=new rn({valueHex:t.result.notAfter.valueBlock.valueHex});n.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=n.toDate()}}},{key:"toSchema",value:function(){var e=[];return nu in this&&e.push(new Pr({idBlock:{tagClass:3,tagNumber:0},valueHex:new rn({valueDate:this.notBefore}).valueBlock.valueHexView})),iu in this&&e.push(new Pr({idBlock:{tagClass:3,tagNumber:1},valueHex:new rn({valueDate:this.notAfter}).valueBlock.valueHexView})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case nu:case iu:return new Date;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Pr({name:t.notBefore||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Pr({name:t.notAfter||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(xn);uu.CLASS_NAME="PrivateKeyUsagePeriod";var ou="id",lu="type",cu="values",hu=[ou,lu],fu=[cu],mu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).id=Gt(a,ou,r.defaultValues(ou)),lu in a&&(e.type=Gt(a,lu,r.defaultValues(lu))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,hu);var t=pn(e,e,r.schema({names:{id:ou,type:lu}}));Cn.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),lu in t.result&&(this.type=t.result.type)}},{key:"toSchema",value:function(){var e=[new ma({value:this.id})];return lu in this&&e.push(this.type),new wa({value:e})}},{key:"toJSON",value:function(){var e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ou:return Sn;case lu:return new Gr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ou:return t===Sn;case lu:return t instanceof Gr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.id||Sn}),new mn({name:t.type||Sn,optional:!0})]})}}]),r}(xn);mu.CLASS_NAME="QCStatement";var vu,du=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).values=Gt(a,cu,r.defaultValues(cu)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,fu);var t=pn(e,e,r.schema({names:{values:cu}}));Cn.assertSchema(t,this.className),this.values=Array.from(t.result.values,(function(e){return new mu({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.values,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===cu?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===cu?0===t.length:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.values||Sn,value:mu.schema(t.value||{})})]})}}]),r}(xn);du.CLASS_NAME="QCStatements";var gu=function(){function e(){s(this,e)}return o(e,null,[{key:"register",value:function(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}},{key:"find",value:function(e){return this.namedCurves[e.toLowerCase()]||null}}]),e}();vu=gu,gu.namedCurves={},vu.register("P-256","1.2.840.10045.3.1.7",32),vu.register("P-384","1.3.132.0.34",48),vu.register("P-521","1.3.132.0.35",66),vu.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),vu.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),vu.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);var pu="x",yu="y",ku="namedCurve",wu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).x=Gt(a,pu,r.defaultValues(pu)),e.y=Gt(a,yu,r.defaultValues(yu)),e.namedCurve=Gt(a,ku,r.defaultValues(ku)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){var t=Kt.toUint8Array(e);if(4!==t[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var r=gu.find(this.namedCurve);if(!r)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));var a=r.size;if(t.byteLength!==2*a+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,2*a+1).buffer}},{key:"toSchema",value:function(){return new gn({data:zt(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e=gu.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:ar(ir(this.x),!0,!0,!1),y:ar(ir(this.y),!0,!0,!1)}}},{key:"fromJSON",value:function(e){An.assert("json",e,"crv","x","y");var t=0,r=gu.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=sr(nr(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);var n=new Uint8Array(this.x),i=new Uint8Array(a);n.set(i,1)}else this.x=a.slice(0,t);var s=sr(nr(e.y,!0));if(s.byteLength<t){this.y=new ArrayBuffer(t);var u=new Uint8Array(this.y),o=new Uint8Array(s);u.set(o,1)}else this.y=s.slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case pu:case yu:return bn;case ku:return Sn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case pu:case yu:return t instanceof ArrayBuffer&&$t(t,r.defaultValues(e));case ku:return"string"==typeof t&&t===r.defaultValues(e);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){return new gn}}]),r}(xn);wu.CLASS_NAME="ECPublicKey";var bu="modulus",Su="publicExponent",Nu=[bu,Su],Au=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).modulus=Gt(a,bu,r.defaultValues(bu)),e.publicExponent=Gt(a,Su,r.defaultValues(Su)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Nu);var t=pn(e,e,r.schema({names:{modulus:bu,publicExponent:Su}}));Cn.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}},{key:"toSchema",value:function(){return new wa({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:Ft.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ft.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){An.assert("json",e,"n","e");var t,r,a,n,i=sr(nr(e.n,!0));this.modulus=new oa({valueHex:i.slice(0,Math.pow(2,(t=i.byteLength,r=Math.log(t)/ur,a=Math.floor(r),n=Math.round(r),a===n?a:n)))}),this.publicExponent=new oa({valueHex:sr(nr(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case bu:case Su:return new oa;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.modulus||Sn}),new oa({name:t.publicExponent||Sn})]})}}]),r}(xn);Au.CLASS_NAME="RSAPublicKey";var Cu="algorithm",xu="subjectPublicKey",Eu=[Cu,xu],Iu=function(e){c(a,e);var t,r=y(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,a),(e=r.call(this)).algorithm=Gt(t,Cu,a.defaultValues(Cu)),e.subjectPublicKey=Gt(t,xu,a.defaultValues(xu));var n=Gt(t,"parsedKey",null);return n&&(e.parsedKey=n),t.json&&e.fromJSON(t.json),t.schema&&e.fromSchema(t.schema),e}return o(a,[{key:"parsedKey",get:function(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===ma.blockName())try{this._parsedKey=new wu({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":var e=Lr(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new Au({schema:e.result})}catch(e){}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0},set:function(e){this._parsedKey=e}},{key:"fromSchema",value:function(e){or(e,Eu);var t=pn(e,e,a.schema({names:{algorithm:{names:{blockName:Cu}},subjectPublicKey:xu}}));Cn.assertSchema(t,this.className),this.algorithm=new $n({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}},{key:"toSchema",value:function(){return new wa({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}var t=this.parsedKey.toJSON();return Object.assign(e,t),e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new wu({json:e}),this.algorithm=new $n({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ma({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Au({json:e}),this.algorithm=new $n({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Gr});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new ta({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:Lo(!0),e.prev=1,t){e.next=4;break}throw new Error("Need to provide publicKey input parameter");case 4:return e.next=6,r.exportKey("spki",t);case 6:a=e.sent,n=Lr(a),e.prev=8,this.fromSchema(n.result),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(8),new Error("Error during initializing object from schema");case 15:e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(1),i=e.t1 instanceof Error?e.t1.message:"".concat(e.t1),new Error("Error during exporting public key: ".concat(i));case 21:case"end":return e.stop()}}),e,this,[[1,17],[8,12]])}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Cu:return new $n;case xu:return new ta;default:return w(h(a),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.algorithm||{}),new ta({name:t.subjectPublicKey||Sn})]})}}]),a}(xn);Iu.CLASS_NAME="PublicKeyInfo";var Bu="version",Vu="privateKey",Ru="namedCurve",Du="publicKey",Ou=[Bu,Vu,Ru,Du],Pu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Bu,r.defaultValues(Bu)),e.privateKey=Gt(a,Vu,r.defaultValues(Vu)),Ru in a&&(e.namedCurve=Gt(a,Ru,r.defaultValues(Ru))),Du in a&&(e.publicKey=Gt(a,Du,r.defaultValues(Du))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ou);var t=pn(e,e,r.schema({names:{version:Bu,privateKey:Vu,namedCurve:Ru,publicKey:Du}}));if(Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,Ru in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),Du in t.result){var a={schema:t.result.publicKey.valueBlock.valueHex};Ru in this&&(a.namedCurve=this.namedCurve),this.publicKey=new wu(a)}}},{key:"toSchema",value:function(){var e=[new oa({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[new ma({value:this.namedCurve})]})),this.publicKey&&e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[new ta({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new wa({value:e})}},{key:"toJSON",value:function(){if(!this.namedCurve||r.compareWithDefault(Ru,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var e=gu.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:Ft.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){var a=this.publicKey.toJSON();t.x=a.x,t.y=a.y}return t}},{key:"fromJSON",value:function(e){An.assert("json",e,"crv","d");var t=0,r=gu.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=Ft.FromBase64Url(e.d);if(a.byteLength<t){var n=new ArrayBuffer(t),i=new Uint8Array(n),s=new Uint8Array(a);i.set(s,1),this.privateKey=new Yr({valueHex:n})}else this.privateKey=new Yr({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new wu({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case Bu:return 1;case Vu:return new Yr;case Ru:return Sn;case Du:return new wu;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Bu:return t===r.defaultValues(e);case Vu:return t.isEqual(r.defaultValues(e));case Ru:return t===Sn;case Du:return wu.compareWithDefault(Ru,t.namedCurve)&&wu.compareWithDefault("x",t.x)&&wu.compareWithDefault("y",t.y);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new Yr({name:t.privateKey||Sn}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ma({name:t.namedCurve||Sn})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ta({name:t.publicKey||Sn})]})]})}}]),r}(xn);Pu.CLASS_NAME="ECPrivateKey";var Uu="prime",Tu="exponent",Lu="coefficient",Mu=[Uu,Tu,Lu],Hu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).prime=Gt(a,Uu,r.defaultValues(Uu)),e.exponent=Gt(a,Tu,r.defaultValues(Tu)),e.coefficient=Gt(a,Lu,r.defaultValues(Lu)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Mu);var t=pn(e,e,r.schema({names:{prime:Uu,exponent:Tu,coefficient:Lu}}));Cn.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new wa({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:Ft.ToBase64Url(this.prime.valueBlock.valueHexView),d:Ft.ToBase64Url(this.exponent.valueBlock.valueHexView),t:Ft.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){An.assert("json",e,"r","d","r"),this.prime=new oa({valueHex:Ft.FromBase64Url(e.r)}),this.exponent=new oa({valueHex:Ft.FromBase64Url(e.d)}),this.coefficient=new oa({valueHex:Ft.FromBase64Url(e.t)})}}],[{key:"defaultValues",value:function(e){switch(e){case Uu:case Tu:case Lu:return new oa;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.prime||Sn}),new oa({name:t.exponent||Sn}),new oa({name:t.coefficient||Sn})]})}}]),r}(xn);Hu.CLASS_NAME="OtherPrimeInfo";var _u="version",Ku="modulus",ju="publicExponent",Ju="privateExponent",Fu="prime1",Gu="prime2",qu="exponent1",Xu="exponent2",Wu="coefficient",zu="otherPrimeInfos",Qu=[_u,Ku,ju,Ju,Fu,Gu,qu,Xu,Wu,zu],Yu=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,_u,r.defaultValues(_u)),e.modulus=Gt(a,Ku,r.defaultValues(Ku)),e.publicExponent=Gt(a,ju,r.defaultValues(ju)),e.privateExponent=Gt(a,Ju,r.defaultValues(Ju)),e.prime1=Gt(a,Fu,r.defaultValues(Fu)),e.prime2=Gt(a,Gu,r.defaultValues(Gu)),e.exponent1=Gt(a,qu,r.defaultValues(qu)),e.exponent2=Gt(a,Xu,r.defaultValues(Xu)),e.coefficient=Gt(a,Wu,r.defaultValues(Wu)),zu in a&&(e.otherPrimeInfos=Gt(a,zu,r.defaultValues(zu))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Qu);var t=pn(e,e,r.schema({names:{version:_u,modulus:Ku,publicExponent:ju,privateExponent:Ju,prime1:Fu,prime2:Gu,exponent1:qu,exponent2:Xu,coefficient:Wu,otherPrimeInfo:{names:{blockName:zu}}}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),zu in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,(function(e){return new Hu({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new wa({value:Array.from(this.otherPrimeInfos,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={n:Ft.ToBase64Url(this.modulus.valueBlock.valueHexView),e:Ft.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:Ft.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:Ft.ToBase64Url(this.prime1.valueBlock.valueHexView),q:Ft.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:Ft.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:Ft.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:Ft.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,(function(e){return e.toJSON()}))),e}},{key:"fromJSON",value:function(e){An.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new oa({valueHex:Ft.FromBase64Url(e.n)}),this.publicExponent=new oa({valueHex:Ft.FromBase64Url(e.e)}),this.privateExponent=new oa({valueHex:Ft.FromBase64Url(e.d)}),this.prime1=new oa({valueHex:Ft.FromBase64Url(e.p)}),this.prime2=new oa({valueHex:Ft.FromBase64Url(e.q)}),this.exponent1=new oa({valueHex:Ft.FromBase64Url(e.dp)}),this.exponent2=new oa({valueHex:Ft.FromBase64Url(e.dq)}),this.coefficient=new oa({valueHex:Ft.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,(function(e){return new Hu({json:e})})))}}],[{key:"defaultValues",value:function(e){switch(e){case _u:return 0;case Ku:case ju:case Ju:case Fu:case Gu:case qu:case Xu:case Wu:return new oa;case zu:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new oa({name:t.modulus||Sn}),new oa({name:t.publicExponent||Sn}),new oa({name:t.privateExponent||Sn}),new oa({name:t.prime1||Sn}),new oa({name:t.prime2||Sn}),new oa({name:t.exponent1||Sn}),new oa({name:t.exponent2||Sn}),new oa({name:t.coefficient||Sn}),new wa({optional:!0,value:[new dn({name:t.otherPrimeInfosName||Sn,value:Hu.schema(t.otherPrimeInfo||{})})]})]})}}]),r}(xn);Yu.CLASS_NAME="RSAPrivateKey";var Zu="version",$u="privateKeyAlgorithm",eo="privateKey",to="attributes",ro="parsedKey",ao=[Zu,$u,eo,to],no=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Zu,r.defaultValues(Zu)),e.privateKeyAlgorithm=Gt(a,$u,r.defaultValues($u)),e.privateKey=Gt(a,eo,r.defaultValues(eo)),to in a&&(e.attributes=Gt(a,to,r.defaultValues(to))),ro in a&&(e.parsedKey=Gt(a,ro,r.defaultValues(ro))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ao);var t=pn(e,e,r.schema({names:{version:Zu,privateKeyAlgorithm:{names:{blockName:$u}},privateKey:eo,attributes:to}}));switch(Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new $n({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,to in t.result&&(this.attributes=Array.from(t.result.attributes,(function(e){return new si({schema:e})}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var a=Lr(this.privateKey.valueBlock.valueHexView);-1!==a.offset&&(this.parsedKey=new Yu({schema:a.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof ma){var n=Lr(this.privateKey.valueBlock.valueHexView);-1!==n.offset&&(this.parsedKey=new Pu({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:n.result}))}}}},{key:"toSchema",value:function(){var e=[new oa({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){if(!this.parsedKey){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}))),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}var r=this.parsedKey.toJSON();return Object.assign(t,r),t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Pu({json:e}),this.privateKeyAlgorithm=new $n({algorithmId:"1.2.840.10045.2.1",algorithmParams:new ma({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Yu({json:e}),this.privateKeyAlgorithm=new $n({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Gr});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new Yr({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case Zu:return 0;case $u:return new $n;case eo:return new Yr;case to:return[];case ro:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),$n.schema(t.privateKeyAlgorithm||{}),new Yr({name:t.privateKey||Sn}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dn({name:t.attributes||Sn,value:si.schema()})]})]})}}]),r}(xn);no.CLASS_NAME="PrivateKeyInfo";var io="contentType",so="contentEncryptionAlgorithm",uo="encryptedContent",oo=[io,so,uo],lo=1024,co=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,r),(e=t.call(this)).contentType=Gt(a,io,r.defaultValues(io)),e.contentEncryptionAlgorithm=Gt(a,so,r.defaultValues(so)),uo in a&&a.encryptedContent&&(e.encryptedContent=a.encryptedContent,1===e.encryptedContent.idBlock.tagClass&&4===e.encryptedContent.idBlock.tagNumber&&!1===e.encryptedContent.idBlock.isConstructed&&!a.disableSplit)){for(var n=new Yr({idBlock:{isConstructed:!0},isConstructed:!0}),i=0,u=e.encryptedContent.valueBlock.valueHexView.slice().buffer,o=u.byteLength;o>0;){for(var l=new Uint8Array(u,i,i+lo>u.byteLength?u.byteLength-i:lo),c=new ArrayBuffer(l.length),h=new Uint8Array(c),f=0;f<h.length;f++)h[f]=l[f];n.valueBlock.value.push(new Yr({valueHex:c})),o-=l.length,i+=l.length}e.encryptedContent=n}return a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,oo);var t=pn(e,e,r.schema({names:{contentType:io,contentEncryptionAlgorithm:{names:{blockName:so}},encryptedContent:uo}}));Cn.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new $n({schema:t.result.contentEncryptionAlgorithm}),uo in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new ma({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new wa({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}},{key:"getEncryptedContent",value:function(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return Yr.prototype.getValue.call(this.encryptedContent)}}],[{key:"defaultValues",value:function(e){switch(e){case io:return Sn;case so:return new $n;case uo:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case io:return t===Sn;case so:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case uo:return t.isEqual(r.defaultValues(uo));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.contentType||Sn}),$n.schema(t.contentEncryptionAlgorithm||{}),new vn({value:[new _r({name:t.encryptedContent||Sn,idBlock:{tagClass:3,tagNumber:0},value:[new dn({value:new Yr})]}),new Pr({name:t.encryptedContent||Sn,idBlock:{tagClass:3,tagNumber:0}})]})]})}}]),r}(xn);co.CLASS_NAME="EncryptedContentInfo";var ho="hashAlgorithm",fo="maskGenAlgorithm",mo="saltLength",vo="trailerField",go=[ho,fo,mo,vo],po=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).hashAlgorithm=Gt(a,ho,r.defaultValues(ho)),e.maskGenAlgorithm=Gt(a,fo,r.defaultValues(fo)),e.saltLength=Gt(a,mo,r.defaultValues(mo)),e.trailerField=Gt(a,vo,r.defaultValues(vo)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,go);var t=pn(e,e,r.schema({names:{hashAlgorithm:{names:{blockName:ho}},maskGenAlgorithm:{names:{blockName:fo}},saltLength:mo,trailerField:vo}}));Cn.assertSchema(t,this.className),ho in t.result&&(this.hashAlgorithm=new $n({schema:t.result.hashAlgorithm})),fo in t.result&&(this.maskGenAlgorithm=new $n({schema:t.result.maskGenAlgorithm})),mo in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),vo in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(r.defaultValues(ho))||e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(r.defaultValues(fo))||e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==r.defaultValues(mo)&&e.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:[new oa({value:this.saltLength})]})),this.trailerField!==r.defaultValues(vo)&&e.push(new _r({idBlock:{tagClass:3,tagNumber:3},value:[new oa({value:this.trailerField})]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(r.defaultValues(ho))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(r.defaultValues(fo))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==r.defaultValues(mo)&&(e.saltLength=this.saltLength),this.trailerField!==r.defaultValues(vo)&&(e.trailerField=this.trailerField),e}}],[{key:"defaultValues",value:function(e){switch(e){case ho:return new $n({algorithmId:"1.3.14.3.2.26",algorithmParams:new Gr});case fo:return new $n({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new $n({algorithmId:"1.3.14.3.2.26",algorithmParams:new Gr}).toSchema()});case mo:return 20;case vo:return 1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[$n.schema(t.hashAlgorithm||{})]}),new _r({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[$n.schema(t.maskGenAlgorithm||{})]}),new _r({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new oa({name:t.saltLength||Sn})]}),new _r({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new oa({name:t.trailerField||Sn})]})]})}}]),r}(xn);po.CLASS_NAME="RSASSAPSSParams";var yo="salt",ko="iterationCount",wo="keyLength",bo="prf",So=[yo,ko,wo,bo],No=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).salt=Gt(a,yo,r.defaultValues(yo)),e.iterationCount=Gt(a,ko,r.defaultValues(ko)),wo in a&&(e.keyLength=Gt(a,wo,r.defaultValues(wo))),bo in a&&(e.prf=Gt(a,bo,r.defaultValues(bo))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,So);var t=pn(e,e,r.schema({names:{saltPrimitive:yo,saltConstructed:{names:{blockName:yo}},iterationCount:ko,keyLength:wo,prf:{names:{blockName:bo,optional:!0}}}}));Cn.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,wo in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),bo in t.result&&(this.prf=new $n({schema:t.result.prf}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.salt),e.push(new oa({value:this.iterationCount})),wo in this&&r.defaultValues(wo)!==this.keyLength&&e.push(new oa({value:this.keyLength})),this.prf&&!1===r.defaultValues(bo).isEqual(this.prf)&&e.push(this.prf.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return wo in this&&r.defaultValues(wo)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===r.defaultValues(bo).isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case yo:return{};case ko:return-1;case wo:return 0;case bo:return new $n({algorithmId:"1.3.14.3.2.26",algorithmParams:new Gr});default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new vn({value:[new Yr({name:t.saltPrimitive||Sn}),$n.schema(t.saltConstructed||{})]}),new oa({name:t.iterationCount||Sn}),new oa({name:t.keyLength||Sn,optional:!0}),$n.schema(t.prf||{names:{optional:!0}})]})}}]),r}(xn);No.CLASS_NAME="PBKDF2Params";var Ao="keyDerivationFunc",Co="encryptionScheme",xo=[Ao,Co],Eo=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).keyDerivationFunc=Gt(a,Ao,r.defaultValues(Ao)),e.encryptionScheme=Gt(a,Co,r.defaultValues(Co)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,xo);var t=pn(e,e,r.schema({names:{keyDerivationFunc:{names:{blockName:Ao}},encryptionScheme:{names:{blockName:Co}}}}));Cn.assertSchema(t,this.className),this.keyDerivationFunc=new $n({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new $n({schema:t.result.encryptionScheme})}},{key:"toSchema",value:function(){return new wa({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ao:case Co:return new $n;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.keyDerivationFunc||{}),$n.schema(t.encryptionScheme||{})]})}}]),r}(xn);Eo.CLASS_NAME="PBES2Params";var Io=function(){function e(t){s(this,e),this.crypto=t.crypto,this.subtle="webkitSubtle"in t.crypto?t.crypto.webkitSubtle:t.crypto.subtle,this.name=Gt(t,"name",Sn)}var t,r,a,n,u,l,c,h,f;return o(e,[{key:"encrypt",value:(f=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).encrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"decrypt",value:(h=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).decrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"sign",value:function(){var e;return(e=this.subtle).sign.apply(e,arguments)}},{key:"verify",value:(c=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).verify.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"digest",value:(l=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).digest.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"generateKey",value:(u=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).generateKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"deriveKey",value:(n=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"deriveBits",value:(a=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveBits.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"wrapKey",value:(r=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).wrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unwrapKey",value:(t=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).unwrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportKey",value:function(){var e;return(e=this.subtle).exportKey.apply(e,arguments)}},{key:"importKey",value:function(){var e;return(e=this.subtle).importKey.apply(e,arguments)}},{key:"getRandomValues",value:function(e){return this.crypto.getRandomValues(e)}}]),e}();function Bo(e,t,r,a,n,i){return Vo.apply(this,arguments)}function Vo(){return(Vo=i(regeneratorRuntime.mark((function e(t,r,a,n,i,s){var u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,N,A,C,x,E,I,B,V,R,D,O,P,U,T;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=[],e.t0=r.toUpperCase(),e.next="SHA-1"===e.t0?4:"SHA-256"===e.t0?7:"SHA-384"===e.t0?10:"SHA-512"===e.t0?13:16;break;case 4:return u=20,o=64,e.abrupt("break",17);case 7:return u=32,o=64,e.abrupt("break",17);case 10:return u=48,o=128,e.abrupt("break",17);case 13:return u=64,o=128,e.abrupt("break",17);case 16:throw new Error("Unsupported hashing algorithm");case 17:for(c=new Uint8Array(n),h=new ArrayBuffer(2*n.byteLength+2),f=new Uint8Array(h),m=0;m<c.length;m++)f[2*m]=0,f[2*m+1]=c[m];for(f[f.length-2]=0,f[f.length-1]=0,n=h.slice(0),v=new ArrayBuffer(o),d=new Uint8Array(v),g=0;g<v.byteLength;g++)d[g]=3;for(p=i.byteLength,y=o*Math.ceil(p/o),k=new ArrayBuffer(y),w=new Uint8Array(k),b=new Uint8Array(i),N=0;N<y;N++)w[N]=b[N%p];for(A=n.byteLength,C=o*Math.ceil(A/o),x=new ArrayBuffer(C),E=new Uint8Array(x),I=new Uint8Array(n),B=0;B<C;B++)E[B]=I[B%A];for(V=k.byteLength+x.byteLength,R=new ArrayBuffer(V),(D=new Uint8Array(R)).set(w),D.set(E,w.length),O=Math.ceil((a>>3)/u),P=Promise.resolve(R),U=0;U<=O;U++){for(P=P.then((function(e){var t=new ArrayBuffer(v.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(d),r.set(D,d.length),t})),T=0;T<s;T++)P=P.then((function(e){return t.digest({name:r},new Uint8Array(e))}));P=P.then((function(e){for(var t=new ArrayBuffer(o),r=new Uint8Array(t),a=0;a<t.byteLength;a++)r[a]=e[a%e.byteLength];for(var n=Math.ceil(p/o)+Math.ceil(A/o),i=[],s=0,u=o,c=0;c<n;c++){var h=Array.from(new Uint8Array(R.slice(s,s+u)));(s+=o)+o>R.byteLength&&(u=R.byteLength-s);for(var f=511,m=t.byteLength-1;m>=0;m--)f>>=8,f+=r[m]+h[m],h[m]=255&f;i.push.apply(i,S(h))}return R=new ArrayBuffer(i.length),(D=new Uint8Array(R)).set(i),l.push.apply(l,S(new Uint8Array(e))),R}))}return P=P.then((function(){var e=new ArrayBuffer(a>>3);return new Uint8Array(e).set(new Uint8Array(l).slice(0,a>>3)),e})),e.abrupt("return",P);case 49:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ro(e){var t="string"==typeof e?{name:e}:e;return"hash"in t?r(r({},t),{},{hash:Ro(t.hash)}):t}var Do=function(e){c(p,e);var t,r,a,n,u,l,h,f,m,v,d,g=y(p);function p(){return s(this,p),g.apply(this,arguments)}return o(p,[{key:"importKey",value:(d=i(regeneratorRuntime.mark((function e(t,r,a,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,N,A,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f={},m=Ro(a),e.t0=t.toLowerCase(),e.next="raw"===e.t0?5:"spki"===e.t0?6:"pkcs8"===e.t0?97:"jwk"===e.t0?185:187;break;case 5:return e.abrupt("return",this.subtle.importKey("raw",r,a,n,i));case 6:v=Lr(Kt.toArrayBuffer(r)),Cn.assert(v,"keyData"),d=new Iu,e.prev=9,d.fromSchema(v.result),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new Nn("Incorrect keyData");case 16:e.t2=m.name.toUpperCase(),e.next="RSA-PSS"===e.t2?19:"RSASSA-PKCS1-V1_5"===e.t2?33:"ECDSA"===e.t2?57:"ECDH"===e.t2?58:"RSA-OAEP"===e.t2?64:"RSAES-PKCS1-V1_5"===e.t2?88:95;break;case 19:if(m.hash){e.next=21;break}throw new An("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 21:e.t3=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t3?24:"SHA-256"===e.t3?26:"SHA-384"===e.t3?28:"SHA-512"===e.t3?30:32;break;case 24:return f.alg="PS1",e.abrupt("break",33);case 26:return f.alg="PS256",e.abrupt("break",33);case 28:return f.alg="PS384",e.abrupt("break",33);case 30:return f.alg="PS512",e.abrupt("break",33);case 32:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 33:if(i=["verify"],f.kty="RSA",f.ext=n,f.key_ops=i,"1.2.840.113549.1.1.1"===d.algorithm.algorithmId){e.next=39;break}throw new Error("Incorrect public key algorithm: ".concat(d.algorithm.algorithmId));case 39:if(f.alg){e.next=54;break}if(m.hash){e.next=42;break}throw new An("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 42:e.t4=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t4?45:"SHA-256"===e.t4?47:"SHA-384"===e.t4?49:"SHA-512"===e.t4?51:53;break;case 45:return f.alg="RS1",e.abrupt("break",54);case 47:return f.alg="RS256",e.abrupt("break",54);case 49:return f.alg="RS384",e.abrupt("break",54);case 51:return f.alg="RS512",e.abrupt("break",54);case 53:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 54:return g=d.toJSON(),Object.assign(f,g),e.abrupt("break",96);case 57:i=["verify"];case 58:if(f={kty:"EC",ext:n,key_ops:i},"1.2.840.10045.2.1"===d.algorithm.algorithmId){e.next=61;break}throw new Error("Incorrect public key algorithm: ".concat(d.algorithm.algorithmId));case 61:return p=d.toJSON(),Object.assign(f,p),e.abrupt("break",96);case 64:if(f.kty="RSA",f.ext=n,f.key_ops=i,"safari"!==this.name.toLowerCase()){e.next=71;break}f.alg="RSA-OAEP",e.next=85;break;case 71:if(m.hash){e.next=73;break}throw new An("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 73:e.t5=m.hash.name.toUpperCase(),e.next="SHA-1"===e.t5?76:"SHA-256"===e.t5?78:"SHA-384"===e.t5?80:"SHA-512"===e.t5?82:84;break;case 76:return f.alg="RSA-OAEP",e.abrupt("break",85);case 78:return f.alg="RSA-OAEP-256",e.abrupt("break",85);case 80:return f.alg="RSA-OAEP-384",e.abrupt("break",85);case 82:return f.alg="RSA-OAEP-512",e.abrupt("break",85);case 84:throw new Error("Incorrect hash algorithm: ".concat(m.hash.name.toUpperCase()));case 85:return y=d.toJSON(),Object.assign(f,y),e.abrupt("break",96);case 88:return f.kty="RSA",f.ext=n,f.key_ops=i,f.alg="PS1",k=d.toJSON(),Object.assign(f,k),e.abrupt("break",96);case 95:throw new Error("Incorrect algorithm name: ".concat(m.name.toUpperCase()));case 96:return e.abrupt("break",188);case 97:w=new no,b=Lr(Kt.toArrayBuffer(r)),Cn.assert(b,"keyData"),e.prev=100,w.fromSchema(b.result),e.next=107;break;case 104:throw e.prev=104,e.t6=e.catch(100),new Error("Incorrect keyData");case 107:if(w.parsedKey){e.next=109;break}throw new Error("Incorrect keyData");case 109:e.t7=m.name.toUpperCase(),e.next="RSA-PSS"===e.t7?112:"RSASSA-PKCS1-V1_5"===e.t7?124:"ECDSA"===e.t7?146:"ECDH"===e.t7?147:"RSA-OAEP"===e.t7?153:"RSAES-PKCS1-V1_5"===e.t7?175:183;break;case 112:e.t8=null===(s=m.hash)||void 0===s?void 0:s.name.toUpperCase(),e.next="SHA-1"===e.t8?115:"SHA-256"===e.t8?117:"SHA-384"===e.t8?119:"SHA-512"===e.t8?121:123;break;case 115:return f.alg="PS1",e.abrupt("break",124);case 117:return f.alg="PS256",e.abrupt("break",124);case 119:return f.alg="PS384",e.abrupt("break",124);case 121:return f.alg="PS512",e.abrupt("break",124);case 123:throw new Error("Incorrect hash algorithm: ".concat(null===(u=m.hash)||void 0===u?void 0:u.name.toUpperCase()));case 124:if(i=["sign"],f.kty="RSA",f.ext=n,f.key_ops=i,"1.2.840.113549.1.1.1"===w.privateKeyAlgorithm.algorithmId){e.next=130;break}throw new Error("Incorrect private key algorithm: ".concat(w.privateKeyAlgorithm.algorithmId));case 130:if("alg"in f!=0){e.next=143;break}e.t9=null===(o=m.hash)||void 0===o?void 0:o.name.toUpperCase(),e.next="SHA-1"===e.t9?134:"SHA-256"===e.t9?136:"SHA-384"===e.t9?138:"SHA-512"===e.t9?140:142;break;case 134:return f.alg="RS1",e.abrupt("break",143);case 136:return f.alg="RS256",e.abrupt("break",143);case 138:return f.alg="RS384",e.abrupt("break",143);case 140:return f.alg="RS512",e.abrupt("break",143);case 142:throw new Error("Incorrect hash algorithm: ".concat(null===(l=m.hash)||void 0===l?void 0:l.name.toUpperCase()));case 143:return S=w.toJSON(),Object.assign(f,S),e.abrupt("break",184);case 146:i=["sign"];case 147:if(f={kty:"EC",ext:n,key_ops:i},"1.2.840.10045.2.1"===w.privateKeyAlgorithm.algorithmId){e.next=150;break}throw new Error("Incorrect algorithm: ".concat(w.privateKeyAlgorithm.algorithmId));case 150:return N=w.toJSON(),Object.assign(f,N),e.abrupt("break",184);case 153:if(f.kty="RSA",f.ext=n,f.key_ops=i,"safari"!==this.name.toLowerCase()){e.next=160;break}f.alg="RSA-OAEP",e.next=172;break;case 160:e.t10=null===(c=m.hash)||void 0===c?void 0:c.name.toUpperCase(),e.next="SHA-1"===e.t10?163:"SHA-256"===e.t10?165:"SHA-384"===e.t10?167:"SHA-512"===e.t10?169:171;break;case 163:return f.alg="RSA-OAEP",e.abrupt("break",172);case 165:return f.alg="RSA-OAEP-256",e.abrupt("break",172);case 167:return f.alg="RSA-OAEP-384",e.abrupt("break",172);case 169:return f.alg="RSA-OAEP-512",e.abrupt("break",172);case 171:throw new Error("Incorrect hash algorithm: ".concat(null===(h=m.hash)||void 0===h?void 0:h.name.toUpperCase()));case 172:return A=w.toJSON(),Object.assign(f,A),e.abrupt("break",184);case 175:return i=["decrypt"],f.kty="RSA",f.ext=n,f.key_ops=i,f.alg="PS1",C=w.toJSON(),Object.assign(f,C),e.abrupt("break",184);case 183:throw new Error("Incorrect algorithm name: ".concat(m.name.toUpperCase()));case 184:return e.abrupt("break",188);case 185:return f=r,e.abrupt("break",188);case 187:throw new Error("Incorrect format: ".concat(t));case 188:if("safari"!==this.name.toLowerCase()){e.next=196;break}return e.prev=189,e.abrupt("return",this.subtle.importKey("jwk",sr(JSON.stringify(f)),a,n,i));case 193:return e.prev=193,e.t11=e.catch(189),e.abrupt("return",this.subtle.importKey("jwk",f,a,n,i));case 196:return e.abrupt("return",this.subtle.importKey("jwk",f,a,n,i));case 197:case"end":return e.stop()}}),e,this,[[9,13],[100,104],[189,193]])}))),function(e,t,r,a,n){return d.apply(this,arguments)})},{key:"exportKey",value:(v=i(regeneratorRuntime.mark((function e(t,r){var a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subtle.exportKey("jwk",r);case 2:a=e.sent,"safari"===this.name.toLowerCase()&&a instanceof ArrayBuffer&&(a=JSON.parse(ir(a))),e.t0=t.toLowerCase(),e.next="raw"===e.t0?7:"spki"===e.t0?8:"pkcs8"===e.t0?17:"jwk"===e.t0?26:27;break;case 7:return e.abrupt("return",this.subtle.exportKey("raw",r));case 8:n=new Iu,e.prev=9,n.fromJSON(a),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new Error("Incorrect key data");case 16:return e.abrupt("return",n.toSchema().toBER(!1));case 17:i=new no,e.prev=18,i.fromJSON(a),e.next=25;break;case 22:throw e.prev=22,e.t2=e.catch(18),new Error("Incorrect key data");case 25:return e.abrupt("return",i.toSchema().toBER(!1));case 26:return e.abrupt("return",a);case 27:throw new Error("Incorrect format: ".concat(t));case 28:case"end":return e.stop()}}),e,this,[[9,13],[18,22]])}))),function(e,t){return v.apply(this,arguments)})},{key:"convert",value:(m=i(regeneratorRuntime.mark((function e(t,r,a,n,i,s){var u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.toLowerCase()!==r.toLowerCase()){e.next=2;break}return e.abrupt("return",a);case 2:return e.next=4,this.importKey(t,a,n,i,s);case 4:return u=e.sent,e.abrupt("return",this.exportKey(r,u));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a,n,i){return m.apply(this,arguments)})},{key:"getAlgorithmByOID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(r?"for ".concat(r," "):Sn,": ").concat(e));return{}}},{key:"getOIDByAlgorithm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=Sn;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13"}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11"}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35"}if(!a&&t)throw new Error("Unsupported algorithm ".concat(r?"for ".concat(r," "):Sn,": ").concat(e.name));return a}},{key:"getAlgorithmParameters",value:function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}},{key:"getHashAlgorithm",value:function(e){var t=Sn;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new po({schema:e.algorithmParams});if(r.hashAlgorithm){var a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if(!("name"in a))return Sn;t=a.name}else t="SHA-1"}catch(e){}}return t}},{key:"encryptEncryptedContentInfo",value:(f=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return An.assert(t,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType"),r=this.getOIDByAlgorithm(t.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),a=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),n=this.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),i=new ArrayBuffer(16),s=new Uint8Array(i),this.getRandomValues(s),u=new ArrayBuffer(64),o=new Uint8Array(u),this.getRandomValues(o),l=new Uint8Array(t.contentToEncrypt),c=new No({salt:new Yr({valueHex:u}),iterationCount:t.iterationCount,prf:new $n({algorithmId:n,algorithmParams:new Gr})}),h=new Uint8Array(t.password),e.next=15,this.importKey("raw",h,"PBKDF2",!1,["deriveKey"]);case 15:return f=e.sent,e.next=18,this.deriveKey({name:"PBKDF2",hash:{name:t.hmacHashAlgorithm},salt:o,iterations:t.iterationCount},f,t.contentEncryptionAlgorithm,!1,["encrypt"]);case 18:return m=e.sent,e.next=21,this.encrypt({name:t.contentEncryptionAlgorithm.name,iv:s},m,l);case 21:return v=e.sent,d=new Eo({keyDerivationFunc:new $n({algorithmId:a,algorithmParams:c.toSchema()}),encryptionScheme:new $n({algorithmId:r,algorithmParams:new Yr({valueHex:i})})}),e.abrupt("return",new co({contentType:t.contentType,contentEncryptionAlgorithm:new $n({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:d.toSchema()}),encryptedContent:new Yr({valueHex:v})}));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"decryptEncryptedContentInfo",value:(h=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(An.assert(t,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"===t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId){e.next=3;break}throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));case 3:e.prev=3,r=new Eo({schema:t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(3),new Error('Incorrectly encoded "pbes2Parameters"');case 10:e.prev=10,a=new No({schema:r.keyDerivationFunc.algorithmParams}),e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(10),new Error('Incorrectly encoded "pbkdf2Params"');case 17:return n=this.getAlgorithmByOID(r.encryptionScheme.algorithmId,!0),i=r.encryptionScheme.algorithmParams.valueBlock.valueHex,s=new Uint8Array(i),u=a.salt.valueBlock.valueHex,o=new Uint8Array(u),l=a.iterationCount,c="SHA-1",a.prf&&(h=this.getAlgorithmByOID(a.prf.algorithmId,!0),c=h.hash.name),e.next=27,this.importKey("raw",t.password,"PBKDF2",!1,["deriveKey"]);case 27:return f=e.sent,e.next=30,this.deriveKey({name:"PBKDF2",hash:{name:c},salt:o,iterations:l},f,n,!1,["decrypt"]);case 30:return m=e.sent,v=t.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",this.decrypt({name:n.name,iv:s},m,v));case 33:case"end":return e.stop()}}),e,this,[[3,7],[10,14]])}))),function(e){return h.apply(this,arguments)})},{key:"stampDataWithPassword",value:(l=i(regeneratorRuntime.mark((function e(t){var r,a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object!=0){e.next=2;break}throw new Error('Parameters must have type "Object"');case 2:An.assert(t,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?6:"sha-256"===e.t0?8:"sha-384"===e.t0?10:"sha-512"===e.t0?12:14;break;case 6:return r=160,e.abrupt("break",15);case 8:return r=256,e.abrupt("break",15);case 10:return r=384,e.abrupt("break",15);case 12:return r=512,e.abrupt("break",15);case 14:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 15:return a={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=18,Bo(this,t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 18:return n=e.sent,e.next=21,this.importKey("raw",new Uint8Array(n),a,!1,["sign"]);case 21:return i=e.sent,e.abrupt("return",this.sign(a,i,new Uint8Array(t.contentToStamp)));case 23:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"verifyDataStampedWithPassword",value:(u=i(regeneratorRuntime.mark((function e(t){var r,a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:An.assert(t,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify"),r=0,e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?5:"sha-256"===e.t0?7:"sha-384"===e.t0?9:"sha-512"===e.t0?11:13;break;case 5:return r=160,e.abrupt("break",14);case 7:return r=256,e.abrupt("break",14);case 9:return r=384,e.abrupt("break",14);case 11:return r=512,e.abrupt("break",14);case 13:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 14:return a={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=17,Bo(this,t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 17:return n=e.sent,e.next=20,this.importKey("raw",new Uint8Array(n),a,!1,["verify"]);case 20:return i=e.sent,e.abrupt("return",this.verify(a,i,new Uint8Array(t.signatureToVerify),new Uint8Array(t.contentToVerify)));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getSignatureParameters",value:(n=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:"SHA-1",this.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),a=new $n,n=this.getAlgorithmParameters(t.algorithm.name,"sign"),Object.keys(n.algorithm).length){e.next=6;break}throw new Error("Parameter 'algorithm' is empty");case 6:(i=n.algorithm).hash.name=r,e.t0=t.algorithm.name.toUpperCase(),e.next="RSASSA-PKCS1-V1_5"===e.t0||"ECDSA"===e.t0?11:"RSA-PSS"===e.t0?13:29;break;case 11:return a.algorithmId=this.getOIDByAlgorithm(i,!0),e.abrupt("break",30);case 13:e.t1=r.toUpperCase(),e.next="SHA-256"===e.t1?16:"SHA-384"===e.t1?18:"SHA-512"===e.t1?20:22;break;case 16:return i.saltLength=32,e.abrupt("break",22);case 18:return i.saltLength=48,e.abrupt("break",22);case 20:return i.saltLength=64,e.abrupt("break",22);case 22:return s={},"SHA-1"!==r.toUpperCase()&&(u=this.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),s.hashAlgorithm=new $n({algorithmId:u,algorithmParams:new Gr}),s.maskGenAlgorithm=new $n({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:s.hashAlgorithm.toSchema()})),20!==i.saltLength&&(s.saltLength=i.saltLength),o=new po(s),a.algorithmId="1.2.840.113549.1.1.10",a.algorithmParams=o.toSchema(),e.abrupt("break",30);case 29:throw new Error("Unsupported signature algorithm: ".concat(t.algorithm.name));case 30:return e.abrupt("return",{signatureAlgorithm:a,parameters:n});case 31:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"signWithPrivateKey",value:(a=i(regeneratorRuntime.mark((function e(t,r,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sign(a.algorithm,r,t);case 2:if(n=e.sent,"ECDSA"!==a.algorithm.name){e.next=5;break}return e.abrupt("return",Mo(n));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"fillPublicKeyParameters",value:function(e,t){var r,a={},n=this.getHashAlgorithm(t);if(n===Sn)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));r="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;var i=this.getAlgorithmByOID(r,!0);if(a.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in a.algorithm.algorithm&&(a.algorithm.algorithm.hash.name=n),"ECDSA"===i.name){var s=e.algorithm;if(!s.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");var u=s.algorithmParams;if("idBlock"in s.algorithmParams&&(1!==u.idBlock.tagClass||6!==u.idBlock.tagNumber))throw new Error("Incorrect type for ECDSA public key parameters");var o=this.getAlgorithmByOID(u.valueBlock.toString(),!0);a.algorithm.algorithm.namedCurve=o.name}return a}},{key:"getPublicKey",value:(r=i(regeneratorRuntime.mark((function e(t,r,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a||(a=this.fillPublicKeyParameters(t,r)),n=t.toSchema().toBER(!1),e.abrupt("return",this.importKey("spki",n,a.algorithm.algorithm,!0,a.algorithm.usages));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return r.apply(this,arguments)})},{key:"verifyWithPublicKey",value:(t=i(regeneratorRuntime.mark((function e(t,r,a,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=9;break}if(i=this.getHashAlgorithm(n)){e.next=4;break}throw new Error("Unsupported signature algorithm: ".concat(n.algorithmId));case 4:return e.next=6,this.getPublicKey(a,n);case 6:s=e.sent,e.next=24;break;case 9:if(u={},o="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:a.algorithm.algorithmId,l=this.getAlgorithmByOID(o,!0),u.algorithm=this.getAlgorithmParameters(l.name,"importKey"),"hash"in u.algorithm.algorithm&&(u.algorithm.algorithm.hash.name=i),"ECDSA"!==l.name){e.next=21;break}if(c=!1,"algorithmParams"in a.algorithm==1&&"idBlock"in a.algorithm.algorithmParams&&1===a.algorithm.algorithmParams.idBlock.tagClass&&6===a.algorithm.algorithmParams.idBlock.tagNumber&&(c=!0),!1!==c){e.next=19;break}throw new Error("Incorrect type for ECDSA public key parameters");case 19:h=this.getAlgorithmByOID(a.algorithm.algorithmParams.valueBlock.toString(),!0),u.algorithm.algorithm.namedCurve=h.name;case 21:return e.next=23,this.getPublicKey(a,null,u);case 23:s=e.sent;case 24:if("hash"in(f=this.getAlgorithmParameters(s.algorithm.name,"verify")).algorithm&&(f.algorithm.hash.name=i),m=r.valueBlock.valueHexView,"ECDSA"!==s.algorithm.name){e.next=34;break}if(v=gu.find(s.algorithm.namedCurve)){e.next=31;break}throw new Error("Unsupported named curve in use");case 31:d=Lr(m),Cn.assert(d,"Signature value"),m=Ho(d.result,v.size);case 34:return"RSA-PSS"===s.algorithm.name&&(g=new po({schema:n.algorithmParams}),f.algorithm.saltLength="saltLength"in g?g.saltLength:20,p="SHA-1","hashAlgorithm"in g&&(y=this.getAlgorithmByOID(g.hashAlgorithm.algorithmId,!0),p=y.name),f.algorithm.hash.name=p),e.abrupt("return",this.verify(f.algorithm,s,m,t));case 36:case"end":return e.stop()}}),e,this)}))),function(e,r,a,n,i){return t.apply(this,arguments)})}]),p}(Io),Oo={name:"none",crypto:null};function Po(e){return!(!e||"object"!==a(e)||!("crypto"in e))}function Uo(e){var t=null;if((arguments.length<=1?0:arguments.length-1)<2)t=!(arguments.length<=1)&&arguments.length-1?arguments.length<=1?void 0:arguments[1]:"undefined"!=typeof self&&self.crypto?new Do({name:"browser",crypto:self.crypto}):null;else{var r=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2];Po(n)?t=n:Po(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new Do({crypto:r}))}if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!==a(global[process.pid]))throw new Error("Name global.".concat(process.pid," already exists and it is not an object"));if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!==a(global[process.pid].pkijs))throw new Error("Name global.".concat(process.pid,".pkijs already exists and it is not an object"));global[process.pid].pkijs.engine={name:e,crypto:t}}else Oo={name:e,crypto:t}}function To(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){var e;try{e=global[process.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return e}return Oo}function Lo(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=To();if(!t.crypto&&e)throw new Error("Unable to create WebCrypto object");return t.crypto}function Mo(e){if(e.byteLength%2!=0)return bn;var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var a=new oa({valueHex:r}),n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,t,t));var i=new oa({valueHex:n});return new wa({value:[a.convertToDER(),i.convertToDER()]}).toBER(!1)}function Ho(e,t){if(!(e instanceof wa&&2===e.valueBlock.value.length&&e.valueBlock.value[0]instanceof oa&&e.valueBlock.value[1]instanceof oa))return bn;var r=e.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,a=e.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,n=new Uint8Array(2*t);return n.set(r,t-r.byteLength),n.set(a,2*t-a.byteLength),n.buffer}function _o(e,t,r,a,n){return Ko.apply(this,arguments)}function Ko(){return(Ko=i(regeneratorRuntime.mark((function e(t,r,a,n,i){var s,u,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0||"SHA-256"===e.t0||"SHA-384"===e.t0||"SHA-512"===e.t0?3:4;break;case 3:return e.abrupt("break",5);case 4:throw new Nn("Unknown hash function: ".concat(t));case 5:if(Nn.assert(r,"zBuffer","ArrayBuffer"),0!==r.byteLength){e.next=8;break}throw new Nn("'zBuffer' has zero length, error");case 8:if(Nn.assert(n,"SharedInfo","ArrayBuffer"),!(a>255)){e.next=11;break}throw new Nn("Please set 'Counter' argument to value less or equal to 255");case 11:return s=new ArrayBuffer(4),(u=new Uint8Array(s))[0]=0,u[1]=0,u[2]=0,u[3]=a,o=zt(o=bn,r),o=zt(o,s),o=zt(o,n),e.next=23,i.digest({name:t},o);case 23:return l=e.sent,e.abrupt("return",{counter:a,result:l});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jo(e,t,r,a){return Jo.apply(this,arguments)}function Jo(){return Jo=i(regeneratorRuntime.mark((function e(t,r,a,n){var i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=b.length>4&&void 0!==b[4]?b[4]:Lo(!0),s=0,u=1,e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0?6:"SHA-256"===e.t0?8:"SHA-384"===e.t0?10:"SHA-512"===e.t0?12:14;break;case 6:return s=160,e.abrupt("break",15);case 8:return s=256,e.abrupt("break",15);case 10:return s=384,e.abrupt("break",15);case 12:return s=512,e.abrupt("break",15);case 14:throw new Nn("Unknown hash function: ".concat(t));case 15:if(Nn.assert(r,"Zbuffer","ArrayBuffer"),0!==r.byteLength){e.next=18;break}throw new Nn("'Zbuffer' has zero length, error");case 18:Nn.assert(n,"SharedInfo","ArrayBuffer"),o=a/s,Math.floor(o)>0&&(u=Math.floor(o),o-u>0&&u++),l=[],c=1;case 23:if(!(c<=u)){e.next=32;break}return e.t1=l,e.next=27,_o(t,r,c,n,i);case 27:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 29:c++,e.next=23;break;case 32:h=bn,f=1,m=!0;case 35:if(!m){e.next=59;break}m=!1,v=C(l),e.prev=38,v.s();case 40:if((d=v.n()).done){e.next=48;break}if((g=d.value).counter!==f){e.next=46;break}return h=zt(h,g.result),m=!0,e.abrupt("break",48);case 46:e.next=40;break;case 48:e.next=53;break;case 50:e.prev=50,e.t3=e.catch(38),v.e(e.t3);case 53:return e.prev=53,v.f(),e.finish(53);case 56:f++,e.next=35;break;case 59:if(a>>=3,!(h.byteLength>a)){e.next=66;break}for(p=new ArrayBuffer(a),y=new Uint8Array(p),k=new Uint8Array(h),w=0;w<a;w++)y[w]=k[w];return e.abrupt("return",p);case 66:return e.abrupt("return",h);case 67:case"end":return e.stop()}}),e,null,[[38,50,53,56]])}))),Jo.apply(this,arguments)}var Fo="version",Go="logID",qo="extensions",Xo="timestamp",Wo="hashAlgorithm",zo="signatureAlgorithm",Qo="signature",Yo="none",Zo="sha1",$o="sha224",el="sha256",tl="sha384",rl="sha512",al="anonymous",nl="ecdsa",il=function(e){c(a,e);var t,r=y(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=r.call(this)).version=Gt(t,Fo,a.defaultValues(Fo)),e.logID=Gt(t,Go,a.defaultValues(Go)),e.timestamp=Gt(t,Xo,a.defaultValues(Xo)),e.extensions=Gt(t,qo,a.defaultValues(qo)),e.hashAlgorithm=Gt(t,Wo,a.defaultValues(Wo)),e.signatureAlgorithm=Gt(t,zo,a.defaultValues(zo)),e.signature=Gt(t,Qo,a.defaultValues(Qo)),"stream"in t&&t.stream&&e.fromStream(t.stream),t.schema&&e.fromSchema(t.schema),e}return o(a,[{key:"fromSchema",value:function(e){if(e instanceof gn==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");var t=new wn({stream:new yn({buffer:e.data})});this.fromStream(t)}},{key:"fromStream",value:function(e){var t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Xt(new Uint8Array(e.getBlock(8)),8));var r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Yo;break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm=Zo;break;case 3:this.hashAlgorithm=$o;break;case 4:this.hashAlgorithm=el;break;case 5:this.hashAlgorithm=tl;break;case 6:this.hashAlgorithm=rl;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=al;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm=nl;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}var a=e.getUint16(),n=Lr(new Uint8Array(e.getBlock(a)).buffer.slice(0));if(Cn.assert(n,"SignedCertificateTimestamp"),this.signature=n.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}},{key:"toSchema",value:function(){var e=this.toStream();return new gn({data:e.stream.buffer})}},{key:"toStream",value:function(){var e=new wn;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));var t,r,a=new ArrayBuffer(8),n=new Uint8Array(a),i=Wt(this.timestamp.valueOf(),8);switch(n.set(new Uint8Array(i),8-i.byteLength),e.appendView(n),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case Yo:t=0;break;case"md5":t=1;break;case Zo:t=2;break;case $o:t=3;break;case el:t=4;break;case tl:t=5;break;case rl:t=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}switch(e.appendChar(t),this.signatureAlgorithm.toLowerCase()){case al:r=0;break;case"rsa":r=1;break;case"dsa":r=2;break;case nl:r=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(r);var s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}},{key:"toJSON",value:function(){return{version:this.version,logID:qt(this.logID),timestamp:this.timestamp,extensions:qt(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f,m,v,d,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=g.length>2&&void 0!==g[2]?g[2]:0,n=g.length>3&&void 0!==g[3]?g[3]:Lo(!0),i=ar(ir(this.logID)),s=null,u=new wn,o=C(t),e.prev=6,o.s();case 8:if((l=o.n()).done){e.next=15;break}if((c=l.value).log_id!==i){e.next=13;break}return s=c.key,e.abrupt("break",15);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),o.e(e.t0);case 20:return e.prev=20,o.f(),e.finish(20);case 23:if(s){e.next=25;break}throw new Error("Public key not found for CT with logId: ".concat(i));case 25:return h=sr(nr(s)),f=Iu.fromBER(h),u.appendChar(0),u.appendChar(0),m=new ArrayBuffer(8),v=new Uint8Array(m),d=Wt(this.timestamp.valueOf(),8),v.set(new Uint8Array(d),8-d.byteLength),u.appendView(v),u.appendUint16(a),0===a&&u.appendUint24(r.byteLength),u.appendView(new Uint8Array(r)),u.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&u.appendView(new Uint8Array(this.extensions)),e.abrupt("return",n.verifyWithPublicKey(u.buffer.slice(0,u.length),new Yr({valueHex:this.signature.toBER(!1)}),f,{algorithmId:Sn},"SHA-256"));case 40:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Fo:return 0;case Go:case qo:return bn;case Xo:return new Date(0);case Wo:case zo:return Sn;case Qo:return new mn;default:return w(h(a),"defaultValues",this).call(this,e)}}}]),a}(xn);il.CLASS_NAME="SignedCertificateTimestamp";var sl="timestamps",ul=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).timestamps=Gt(a,sl,r.defaultValues(sl)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){if(e instanceof Yr==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");var t=new wn({stream:new yn({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new il({stream:t}))}},{key:"toSchema",value:function(){var e,t=new wn,r=0,a=[],n=C(this.timestamps);try{for(n.s();!(e=n.n()).done;){var i=e.value.toStream();a.push(i),r+=i.stream.buffer.byteLength}}catch(e){n.e(e)}finally{n.f()}t.appendUint16(r);for(var s=0,u=a;s<u.length;s++){var o=u[s];t.appendView(o.stream.view)}return new Yr({valueHex:t.stream.buffer.slice(0)})}},{key:"toJSON",value:function(){return{timestamps:Array.from(this.timestamps,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===sl?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===sl?0===t.length:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Gt(t,"names",{});return null!==(e=r.optional)&&void 0!==e||(r.optional=!1),new Yr({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}}]),r}(xn);ul.CLASS_NAME="SignedCertificateTimestampList";var ol="attributes",ll=[ol],cl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).attributes=Gt(a,ol,r.defaultValues(ol)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ll);var t=pn(e,e,r.schema({names:{attributes:ol}}));Cn.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,(function(e){return new si({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ol?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.attributes||Sn,value:si.schema()})]})}}]),r}(xn);cl.CLASS_NAME="SubjectDirectoryAttributes";var hl=function(){function e(){s(this,e)}return o(e,null,[{key:"getItems",value:function(){return this.types||(this.types={},e.register(gi,"SubjectAltName",ri),e.register(pi,"IssuerAltName",ri),e.register(Ei,"AuthorityKeyIdentifier",Gi),e.register(yi,"BasicConstraints",Wi),e.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",Yi),e.register(Ai,"CertificatePolicies",os),e.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",os),e.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",ms),e.register(Si,"CRLDistributionPoints",Ns),e.register(Ni,"FreshestCRL",Ns),e.register("2.5.29.37","ExtKeyUsage",xs),e.register(wi,"CertificateIssuer",mi),e.register(Vi,"AuthorityInfoAccess",Is),e.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",Is),e.register(ki,"IssuingDistributionPoint",Ls),e.register(bi,"NameConstraints",qs),e.register(Ii,"PolicyConstraints",Qs),e.register(xi,"PolicyMappings",au),e.register("2.5.29.16","PrivateKeyUsagePeriod",uu),e.register("1.3.6.1.5.5.7.1.3","QCStatements",du),e.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",ul),e.register("2.5.29.9","SubjectDirectoryAttributes",cl)),this.types}},{key:"fromBER",value:function(e,t){var r=Lr(t);if(-1===r.offset)return null;var a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch(t){var n=new a.type;return n.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),n}return r.result}},{key:"find",value:function(e){return this.getItems()[e]||null}},{key:"register",value:function(e,t,r){this.getItems()[e]={name:t,type:r}}}]),e}(),fl="extnID",ml="critical",vl="extnValue",dl="parsedValue",gl=[fl,ml,vl],pl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).extnID=Gt(a,fl,r.defaultValues(fl)),e.critical=Gt(a,ml,r.defaultValues(ml)),e.extnValue=vl in a?new Yr({valueHex:a.extnValue}):r.defaultValues(vl),dl in a&&(e.parsedValue=Gt(a,dl,r.defaultValues(dl))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"parsedValue",get:function(){if(void 0===this._parsedValue){var e=hl.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0},set:function(e){this._parsedValue=e}},{key:"fromSchema",value:function(e){or(e,gl);var t=pn(e,e,r.schema({names:{extnID:fl,critical:ml,extnValue:vl}}));Cn.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),ml in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.extnID})),this.critical!==r.defaultValues(ml)&&e.push(new Wr({value:this.critical})),e.push(this.extnValue),new wa({value:e})}},{key:"toJSON",value:function(){var e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==r.defaultValues(ml)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case fl:return Sn;case ml:return!1;case vl:return new Yr;case dl:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.extnID||Sn}),new Wr({name:t.critical||Sn,optional:!0}),new Yr({name:t.extnValue||Sn})]})}}]),r}(xn);pl.CLASS_NAME="Extension";var yl="extensions",kl=[yl],wl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).extensions=Gt(a,yl,r.defaultValues(yl)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,kl);var t=pn(e,e,r.schema({names:{extensions:yl}}));Cn.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,(function(e){return new pl({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{extensions:this.extensions.map((function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===yl?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Gt(e,"names",{});return new wa({optional:t,name:r.blockName||Sn,value:[new dn({name:r.extensions||Sn,value:pl.schema(r.extension||{})})]})}}]),r}(xn);wl.CLASS_NAME="Extensions";var bl="issuer",Sl="serialNumber",Nl="issuerUID",Al=[bl,Sl,Nl],Cl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).issuer=Gt(a,bl,r.defaultValues(bl)),e.serialNumber=Gt(a,Sl,r.defaultValues(Sl)),Nl in a&&(e.issuerUID=Gt(a,Nl,r.defaultValues(Nl))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Al);var t=pn(e,e,r.schema({names:{issuer:{names:{blockName:bl}},serialNumber:Sl,issuerUID:Nl}}));Cn.assertSchema(t,this.className),this.issuer=new mi({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Nl in t.result&&(this.issuerUID=t.result.issuerUID)}},{key:"toSchema",value:function(){var e=new wa({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}},{key:"toJSON",value:function(){var e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case bl:return new mi;case Sl:return new oa;case Nl:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[mi.schema(t.issuer||{}),new oa({name:t.serialNumber||Sn}),new ta({optional:!0,name:t.issuerUID||Sn})]})}}]),r}(xn);Cl.CLASS_NAME="IssuerSerial";var xl="version",El="baseCertificateID",Il="subjectName",Bl="issuer",Vl="signature",Rl="serialNumber",Dl="attrCertValidityPeriod",Ol="attributes",Pl="issuerUniqueID",Ul="extensions",Tl=[xl,El,Il,Bl,Vl,Rl,Dl,Ol,Pl,Ul],Ll=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,xl,r.defaultValues(xl)),El in a&&(e.baseCertificateID=Gt(a,El,r.defaultValues(El))),Il in a&&(e.subjectName=Gt(a,Il,r.defaultValues(Il))),e.issuer=Gt(a,Bl,r.defaultValues(Bl)),e.signature=Gt(a,Vl,r.defaultValues(Vl)),e.serialNumber=Gt(a,Rl,r.defaultValues(Rl)),e.attrCertValidityPeriod=Gt(a,Dl,r.defaultValues(Dl)),e.attributes=Gt(a,Ol,r.defaultValues(Ol)),Pl in a&&(e.issuerUniqueID=Gt(a,Pl,r.defaultValues(Pl))),Ul in a&&(e.extensions=Gt(a,Ul,r.defaultValues(Ul))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Tl);var t=pn(e,e,r.schema({names:{version:xl,baseCertificateID:El,subjectName:Il,issuer:Bl,signature:{names:{blockName:Vl}},serialNumber:Rl,attrCertValidityPeriod:{names:{blockName:Dl}},attributes:Ol,issuerUniqueID:Pl,extensions:{names:{blockName:Ul}}}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,El in t.result&&(this.baseCertificateID=new Cl({schema:new wa({value:t.result.baseCertificateID.valueBlock.value})})),Il in t.result&&(this.subjectName=new mi({schema:new wa({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new $n({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ci({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(function(e){return new si({schema:e})})),Pl in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Ul in t.result&&(this.extensions=new wl({schema:t.result.extensions}))}},{key:"toSchema",value:function(){var e=new wa({value:[new oa({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new wa({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()})),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case xl:return 0;case El:return new Cl;case Il:case Bl:return new mi;case Vl:return new $n;case Rl:return new oa;case Dl:return new ci;case Ol:return[];case Pl:return new ta;case Ul:return new wl;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new vn({value:[new _r({name:t.baseCertificateID||Sn,idBlock:{tagClass:3,tagNumber:0},value:Cl.schema().valueBlock.value}),new _r({name:t.subjectName||Sn,idBlock:{tagClass:3,tagNumber:1},value:mi.schema().valueBlock.value})]}),mi.schema({names:{blockName:t.issuer||Sn}}),$n.schema(t.signature||{}),new oa({name:t.serialNumber||Sn}),ci.schema(t.attrCertValidityPeriod||{}),new wa({name:t.attributes||Sn,value:[new dn({value:si.schema()})]}),new ta({optional:!0,name:t.issuerUniqueID||Sn}),wl.schema(t.extensions||{},!0)]})}}]),r}(xn);Ll.CLASS_NAME="AttributeCertificateInfoV1";var Ml="acinfo",Hl="signatureAlgorithm",_l="signatureValue",Kl=[Ml,_l,Hl],jl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).acinfo=Gt(a,Ml,r.defaultValues(Ml)),e.signatureAlgorithm=Gt(a,Hl,r.defaultValues(Hl)),e.signatureValue=Gt(a,_l,r.defaultValues(_l)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Kl);var t=pn(e,e,r.schema({names:{acinfo:{names:{blockName:Ml}},signatureAlgorithm:{names:{blockName:Hl}},signatureValue:_l}}));Cn.assertSchema(t,this.className),this.acinfo=new Ll({schema:t.result.acinfo}),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"toSchema",value:function(){return new wa({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ml:return new Ll;case Hl:return new $n;case _l:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[Ll.schema(t.acinfo||{}),$n.schema(t.signatureAlgorithm||{}),new ta({name:t.signatureValue||Sn})]})}}]),r}(xn);jl.CLASS_NAME="AttributeCertificateV1";var Jl="digestedObjectType",Fl="otherObjectTypeID",Gl="digestAlgorithm",ql="objectDigest",Xl=[Jl,Fl,Gl,ql],Wl=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).digestedObjectType=Gt(a,Jl,r.defaultValues(Jl)),Fl in a&&(e.otherObjectTypeID=Gt(a,Fl,r.defaultValues(Fl))),e.digestAlgorithm=Gt(a,Gl,r.defaultValues(Gl)),e.objectDigest=Gt(a,ql,r.defaultValues(ql)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Xl);var t=pn(e,e,r.schema({names:{digestedObjectType:Jl,otherObjectTypeID:Fl,digestAlgorithm:{names:{blockName:Gl}},objectDigest:ql}}));Cn.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Fl in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new $n({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}},{key:"toSchema",value:function(){var e=new wa({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}},{key:"toJSON",value:function(){var e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Jl:return new la;case Fl:return new ma;case Gl:return new $n;case ql:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new la({name:t.digestedObjectType||Sn}),new ma({optional:!0,name:t.otherObjectTypeID||Sn}),$n.schema(t.digestAlgorithm||{}),new ta({name:t.objectDigest||Sn})]})}}]),r}(xn);Wl.CLASS_NAME="ObjectDigestInfo";var zl="issuerName",Ql="baseCertificateID",Yl="objectDigestInfo",Zl=[zl,Ql,Yl],$l=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),zl in a&&(e.issuerName=Gt(a,zl,r.defaultValues(zl))),Ql in a&&(e.baseCertificateID=Gt(a,Ql,r.defaultValues(Ql))),Yl in a&&(e.objectDigestInfo=Gt(a,Yl,r.defaultValues(Yl))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Zl);var t=pn(e,e,r.schema({names:{issuerName:zl,baseCertificateID:Ql,objectDigestInfo:Yl}}));Cn.assertSchema(t,this.className),zl in t.result&&(this.issuerName=new mi({schema:t.result.issuerName})),Ql in t.result&&(this.baseCertificateID=new Cl({schema:new wa({value:t.result.baseCertificateID.valueBlock.value})})),Yl in t.result&&(this.objectDigestInfo=new Wl({schema:new wa({value:t.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new wa;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case zl:return new mi;case Ql:return new Cl;case Yl:return new Wl;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[mi.schema({names:{blockName:t.issuerName}},!0),new _r({optional:!0,name:t.baseCertificateID||Sn,idBlock:{tagClass:3,tagNumber:0},value:Cl.schema().valueBlock.value}),new _r({optional:!0,name:t.objectDigestInfo||Sn,idBlock:{tagClass:3,tagNumber:1},value:Wl.schema().valueBlock.value})]})}}]),r}(xn);$l.CLASS_NAME="V2Form";var ec="baseCertificateID",tc="entityName",rc="objectDigestInfo",ac=[ec,tc,rc],nc=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),e=t.call(this),ec in a&&(e.baseCertificateID=Gt(a,ec,r.defaultValues(ec))),tc in a&&(e.entityName=Gt(a,tc,r.defaultValues(tc))),rc in a&&(e.objectDigestInfo=Gt(a,rc,r.defaultValues(rc))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ac);var t=pn(e,e,r.schema({names:{baseCertificateID:ec,entityName:tc,objectDigestInfo:rc}}));Cn.assertSchema(t,this.className),ec in t.result&&(this.baseCertificateID=new Cl({schema:new wa({value:t.result.baseCertificateID.valueBlock.value})})),tc in t.result&&(this.entityName=new mi({schema:new wa({value:t.result.entityName.valueBlock.value})})),rc in t.result&&(this.objectDigestInfo=new Wl({schema:new wa({value:t.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new wa;return this.baseCertificateID&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ec:return new Cl;case tc:return new mi;case rc:return new Wl;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({optional:!0,name:t.baseCertificateID||Sn,idBlock:{tagClass:3,tagNumber:0},value:Cl.schema().valueBlock.value}),new _r({optional:!0,name:t.entityName||Sn,idBlock:{tagClass:3,tagNumber:1},value:mi.schema().valueBlock.value}),new _r({optional:!0,name:t.objectDigestInfo||Sn,idBlock:{tagClass:3,tagNumber:2},value:Wl.schema().valueBlock.value})]})}}]),r}(xn);nc.CLASS_NAME="Holder";var ic="version",sc="holder",uc="issuer",oc="signature",lc="serialNumber",cc="attrCertValidityPeriod",hc="attributes",fc="issuerUniqueID",mc="extensions",vc=[ic,sc,uc,oc,lc,cc,hc,fc,mc],dc=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,ic,r.defaultValues(ic)),e.holder=Gt(a,sc,r.defaultValues(sc)),e.issuer=Gt(a,uc,r.defaultValues(uc)),e.signature=Gt(a,oc,r.defaultValues(oc)),e.serialNumber=Gt(a,lc,r.defaultValues(lc)),e.attrCertValidityPeriod=Gt(a,cc,r.defaultValues(cc)),e.attributes=Gt(a,hc,r.defaultValues(hc)),fc in a&&(e.issuerUniqueID=Gt(a,fc,r.defaultValues(fc))),mc in a&&(e.extensions=Gt(a,mc,r.defaultValues(mc))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,vc);var t=pn(e,e,r.schema({names:{version:ic,holder:{names:{blockName:sc}},issuer:uc,signature:{names:{blockName:oc}},serialNumber:lc,attrCertValidityPeriod:{names:{blockName:cc}},attributes:hc,issuerUniqueID:fc,extensions:{names:{blockName:mc}}}}));if(Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new nc({schema:t.result.holder}),3!==t.result.issuer.idBlock.tagClass)throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.issuer=new $l({schema:new wa({value:t.result.issuer.valueBlock.value})}),this.signature=new $n({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ci({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(function(e){return new si({schema:e})})),fc in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),mc in t.result&&(this.extensions=new wl({schema:t.result.extensions}))}},{key:"toSchema",value:function(){var e=new wa({value:[new oa({value:this.version}),this.holder.toSchema(),new _r({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new wa({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ic:return 1;case sc:return new nc;case uc:return{};case oc:return new $n;case lc:return new oa;case cc:return new ci;case hc:return[];case fc:return new ta;case mc:return new wl;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),nc.schema(t.holder||{}),new vn({value:[mi.schema({names:{blockName:t.issuer||Sn}}),new _r({name:t.issuer||Sn,idBlock:{tagClass:3,tagNumber:0},value:$l.schema().valueBlock.value})]}),$n.schema(t.signature||{}),new oa({name:t.serialNumber||Sn}),ci.schema(t.attrCertValidityPeriod||{}),new wa({name:t.attributes||Sn,value:[new dn({value:si.schema()})]}),new ta({optional:!0,name:t.issuerUniqueID||Sn}),wl.schema(t.extensions||{},!0)]})}}]),r}(xn);dc.CLASS_NAME="AttributeCertificateInfoV2";var gc="acinfo",pc="signatureAlgorithm",yc="signatureValue",kc=[gc,pc,yc],wc=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).acinfo=Gt(a,gc,r.defaultValues(gc)),e.signatureAlgorithm=Gt(a,pc,r.defaultValues(pc)),e.signatureValue=Gt(a,yc,r.defaultValues(yc)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,kc);var t=pn(e,e,r.schema({names:{acinfo:{names:{blockName:gc}},signatureAlgorithm:{names:{blockName:pc}},signatureValue:yc}}));Cn.assertSchema(t,this.className),this.acinfo=new dc({schema:t.result.acinfo}),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"toSchema",value:function(){return new wa({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case gc:return new dc;case pc:return new $n;case yc:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[dc.schema(t.acinfo||{}),$n.schema(t.signatureAlgorithm||{}),new ta({name:t.signatureValue||Sn})]})}}]),r}(xn);wc.CLASS_NAME="AttributeCertificateV2";var bc="contentType",Sc="content",Nc=[bc,Sc],Ac=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).contentType=Gt(a,bc,r.defaultValues(bc)),e.content=Gt(a,Sc,r.defaultValues(Sc)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Nc);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.contentType}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}},{key:"toJSON",value:function(){var e={contentType:this.contentType};return this.content instanceof mn||(e.content=this.content.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case bc:return Sn;case Sc:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case bc:return"string"==typeof t&&t===this.defaultValues(bc);case Sc:return t instanceof mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new wa({name:t.blockName||"ContentInfo",optional:t.optional,value:[new ma({name:t.contentType||bc}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.content||Sc})]})]})}}]),r}(xn);Ac.CLASS_NAME="ContentInfo",Ac.DATA=Ri,Ac.SIGNED_DATA=Di,Ac.ENVELOPED_DATA=Oi,Ac.ENCRYPTED_DATA=Pi;var Cc,xc="type",Ec="value",Ic="utcTimeName",Bc="generalTimeName",Vc=[Ic,Bc];!function(e){e[e.UTCTime=0]="UTCTime",e[e.GeneralizedTime=1]="GeneralizedTime",e[e.empty=2]="empty"}(Cc||(Cc={}));var Rc=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).type=Gt(a,xc,r.defaultValues(xc)),e.value=Gt(a,Ec,r.defaultValues(Ec)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Vc);var t=pn(e,e,r.schema({names:{utcTimeName:Ic,generalTimeName:Bc}}));Cn.assertSchema(t,this.className),Ic in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),Bc in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){return 0===this.type?new en({valueDate:this.value}):1===this.type?new rn({valueDate:this.value}):{}}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case xc:return 0;case Ec:return new Date(0,0,0);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Gt(e,"names",{});return new vn({optional:t,value:[new en({name:r.utcTimeName||Sn}),new rn({name:r.generalTimeName||Sn})]})}}]),r}(xn);Rc.CLASS_NAME="Time";var Dc="tbs",Oc="version",Pc="serialNumber",Uc="signature",Tc="issuer",Lc="notBefore",Mc="notAfter",Hc="subject",_c="subjectPublicKeyInfo",Kc="issuerUniqueID",jc="subjectUniqueID",Jc="extensions",Fc="signatureAlgorithm",Gc="signatureValue",qc="tbsCertificate",Xc="".concat(qc,".").concat(Oc),Wc="".concat(qc,".").concat(Pc),zc="".concat(qc,".").concat(Uc),Qc="".concat(qc,".").concat(Tc),Yc="".concat(qc,".").concat(Lc),Zc="".concat(qc,".").concat(Mc),$c="".concat(qc,".").concat(Hc),eh="".concat(qc,".").concat(_c),th="".concat(qc,".").concat(Kc),rh="".concat(qc,".").concat(jc),ah="".concat(qc,".").concat(Jc),nh=[qc,Xc,Wc,zc,Qc,Yc,Zc,$c,eh,th,rh,ah,Fc,Gc];function ih(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||qc,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new oa({name:t.tbsCertificateVersion||Xc})]}),new oa({name:t.tbsCertificateSerialNumber||Wc}),$n.schema(t.signature||{names:{blockName:zc}}),On.schema(t.issuer||{names:{blockName:Qc}}),new wa({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[Rc.schema(t.notBefore||{names:{utcTimeName:Yc,generalTimeName:Yc}}),Rc.schema(t.notAfter||{names:{utcTimeName:Zc,generalTimeName:Zc}})]}),On.schema(t.subject||{names:{blockName:$c}}),Iu.schema(t.subjectPublicKeyInfo||{names:{blockName:eh}}),new Pr({name:t.tbsCertificateIssuerUniqueID||th,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Pr({name:t.tbsCertificateSubjectUniqueID||rh,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[wl.schema(t.extensions||{names:{blockName:ah}})]})]})}var sh=function(e){c(l,e);var t,r,a,n,u=y(l);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,l),(e=u.call(this)).tbsView=new Uint8Array(Gt(t,Dc,l.defaultValues(Dc))),e.version=Gt(t,Oc,l.defaultValues(Oc)),e.serialNumber=Gt(t,Pc,l.defaultValues(Pc)),e.signature=Gt(t,Uc,l.defaultValues(Uc)),e.issuer=Gt(t,Tc,l.defaultValues(Tc)),e.notBefore=Gt(t,Lc,l.defaultValues(Lc)),e.notAfter=Gt(t,Mc,l.defaultValues(Mc)),e.subject=Gt(t,Hc,l.defaultValues(Hc)),e.subjectPublicKeyInfo=Gt(t,_c,l.defaultValues(_c)),Kc in t&&(e.issuerUniqueID=Gt(t,Kc,l.defaultValues(Kc))),jc in t&&(e.subjectUniqueID=Gt(t,jc,l.defaultValues(jc))),Jc in t&&(e.extensions=Gt(t,Jc,l.defaultValues(Jc))),e.signatureAlgorithm=Gt(t,Fc,l.defaultValues(Fc)),e.signatureValue=Gt(t,Gc,l.defaultValues(Gc)),t.schema&&e.fromSchema(t.schema),e}return o(l,[{key:"tbs",get:function(){return Kt.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){or(e,nh);var t=pn(e,e,l.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:ah}}}}}}));Cn.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Xc in t.result&&(this.version=t.result[Xc].valueBlock.valueDec),this.serialNumber=t.result[Wc],this.signature=new $n({schema:t.result[zc]}),this.issuer=new On({schema:t.result[Qc]}),this.notBefore=new Rc({schema:t.result[Yc]}),this.notAfter=new Rc({schema:t.result[Zc]}),this.subject=new On({schema:t.result[$c]}),this.subjectPublicKeyInfo=new Iu({schema:t.result[eh]}),th in t.result&&(this.issuerUniqueID=t.result[th].valueBlock.valueHex),rh in t.result&&(this.subjectUniqueID=t.result[rh].valueBlock.valueHex),ah in t.result&&(this.extensions=Array.from(t.result[ah],(function(e){return new pl({schema:e})}))),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return Oc in this&&this.version!==l.defaultValues(Oc)&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new oa({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new wa({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new Pr({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new wa({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})]})),new wa({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(!this.tbsView.byteLength)return l.schema().value[0];var r=Lr(this.tbsView);Cn.assert(r,"TBS Certificate"),e=r.result}else e=this.encodeTBS();return new wa({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ft.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Oc in this&&this.version!==l.defaultValues(Oc)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=Ft.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=Ft.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"getPublicKey",value:(n=i(regeneratorRuntime.mark((function e(t){var r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:Lo(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getKeyHash",value:(a=i(regeneratorRuntime.mark((function e(){var t,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"SHA-1",r=a.length>1&&void 0!==a[1]?a[1]:Lo(!0),e.abrupt("return",r.digest({name:t},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView));case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"sign",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:Lo(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signature=n.signatureAlgorithm,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,a.signWithPrivateKey(this.tbsView,t,i);case 13:s=e.sent,this.signatureValue=new ta({valueHex:s});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:Lo(!0),t?a=t.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(a=this.subjectPublicKeyInfo),a instanceof Iu){e.next=4;break}throw new Error("Please provide issuer certificate as a parameter");case 4:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Dc:return bn;case Oc:return 0;case Pc:return new oa;case Uc:return new $n;case Tc:return new On;case Lc:case Mc:return new Rc;case Hc:return new On;case _c:return new Iu;case Kc:case jc:return bn;case Jc:return[];case Fc:return new $n;case Gc:return new ta;default:return w(h(l),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[ih(t.tbsCertificate),$n.schema(t.signatureAlgorithm||{names:{blockName:Fc}}),new ta({name:t.signatureValue||Gc})]})}}]),l}(xn);function uh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&e.issuer.isEqual(t.issuer)&&e.serialNumber.isEqual(t.serialNumber))return null;var r=!1;if(e.extensions){var a,n=C(e.extensions);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.extnID===yi&&i.parsedValue instanceof Wi&&i.parsedValue.cA){r=!0;break}}}catch(e){n.e(e)}finally{n.f()}}return r?e:null}sh.CLASS_NAME="Certificate";var oh="certId",lh="certValue",ch="parsedValue",hh=[oh,lh],fh=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).certId=Gt(a,oh,r.defaultValues(oh)),e.certValue=Gt(a,lh,r.defaultValues(lh)),ch in a&&(e.parsedValue=Gt(a,ch,r.defaultValues(ch))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,hh);var t=pn(e,e,r.schema({names:{id:oh,value:lh}}));Cn.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;var a=this.certValue.valueBlock.valueHexView;switch(this.certId){case Ti:try{this.parsedValue=sh.fromBER(a)}catch(e){wc.fromBER(a)}break;case Li:this.parsedValue=wc.fromBER(a);break;default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}},{key:"toSchema",value:function(){return ch in this&&("acinfo"in this.parsedValue?this.certId=Li:this.certId=Ti,this.certValue=new Yr({valueHex:this.parsedValue.toSchema().toBER(!1)})),new wa({value:[new ma({value:this.certId}),new _r({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}},{key:"toJSON",value:function(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case oh:return Sn;case lh:return new mn;case ch:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case oh:return t===Sn;case lh:return t instanceof mn;case ch:return t instanceof Object&&0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.id||"id"}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.value||"value"})]})]})}}]),r}(xn);fh.CLASS_NAME="CertBag";var mh="userCertificate",vh="revocationDate",dh="crlEntryExtensions",gh=[mh,vh,dh],ph=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).userCertificate=Gt(a,mh,r.defaultValues(mh)),e.revocationDate=Gt(a,vh,r.defaultValues(vh)),dh in a&&(e.crlEntryExtensions=Gt(a,dh,r.defaultValues(dh))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,gh);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Rc({schema:t.result.revocationDate}),dh in t.result&&(this.crlEntryExtensions=new wl({schema:t.result.crlEntryExtensions}))}},{key:"toSchema",value:function(){var e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case mh:return new oa;case vh:return new Rc;case dh:return new wl;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.userCertificate||mh}),Rc.schema({names:{utcTimeName:t.revocationDate||vh,generalTimeName:t.revocationDate||vh}}),wl.schema({names:{blockName:t.crlEntryExtensions||dh}},!0)]})}}]),r}(xn);ph.CLASS_NAME="RevokedCertificate";var yh="tbs",kh="version",wh="signature",bh="issuer",Sh="thisUpdate",Nh="nextUpdate",Ah="revokedCertificates",Ch="crlExtensions",xh="signatureAlgorithm",Eh="signatureValue",Ih="tbsCertList",Bh="".concat(Ih,".version"),Vh="".concat(Ih,".signature"),Rh="".concat(Ih,".issuer"),Dh="".concat(Ih,".thisUpdate"),Oh="".concat(Ih,".nextUpdate"),Ph="".concat(Ih,".revokedCertificates"),Uh="".concat(Ih,".extensions"),Th=[Ih,Bh,Vh,Rh,Dh,Oh,Ph,Uh,xh,Eh];function Lh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Ih,value:[new oa({optional:!0,name:t.tbsCertListVersion||Bh,value:2}),$n.schema(t.signature||{names:{blockName:Vh}}),On.schema(t.issuer||{names:{blockName:Rh}}),Rc.schema(t.tbsCertListThisUpdate||{names:{utcTimeName:Dh,generalTimeName:Dh}}),Rc.schema(t.tbsCertListNextUpdate||{names:{utcTimeName:Oh,generalTimeName:Oh}},!0),new wa({optional:!0,value:[new dn({name:t.tbsCertListRevokedCertificates||Ph,value:new wa({value:[new oa,Rc.schema(),wl.schema({},!0)]})})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[wl.schema(t.crlExtensions||{names:{blockName:Uh}})]})]})}var Mh=[Ei,pi,"2.5.29.20","2.5.29.27",ki,Ni,Vi,"2.5.29.21","2.5.29.24",wi],Hh=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).tbsView=new Uint8Array(Gt(t,yh,n.defaultValues(yh))),e.version=Gt(t,kh,n.defaultValues(kh)),e.signature=Gt(t,wh,n.defaultValues(wh)),e.issuer=Gt(t,bh,n.defaultValues(bh)),e.thisUpdate=Gt(t,Sh,n.defaultValues(Sh)),Nh in t&&(e.nextUpdate=Gt(t,Nh,n.defaultValues(Nh))),Ah in t&&(e.revokedCertificates=Gt(t,Ah,n.defaultValues(Ah))),Ch in t&&(e.crlExtensions=Gt(t,Ch,n.defaultValues(Ch))),e.signatureAlgorithm=Gt(t,xh,n.defaultValues(xh)),e.signatureValue=Gt(t,Eh,n.defaultValues(Eh)),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"tbs",get:function(){return Kt.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){or(e,Th);var t=pn(e,e,n.schema());Cn.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Bh in t.result&&(this.version=t.result[Bh].valueBlock.valueDec),this.signature=new $n({schema:t.result[Vh]}),this.issuer=new On({schema:t.result[Rh]}),this.thisUpdate=new Rc({schema:t.result[Dh]}),Oh in t.result&&(this.nextUpdate=new Rc({schema:t.result[Oh]})),Ph in t.result&&(this.revokedCertificates=Array.from(t.result[Ph],(function(e){return new ph({schema:e})}))),Uh in t.result&&(this.crlExtensions=new wl({schema:t.result[Uh]})),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return this.version!==n.defaultValues(kh)&&e.push(new oa({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new wa({value:Array.from(this.revokedCertificates,(function(e){return e.toSchema()}))})),this.crlExtensions&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new wa({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)e=this.encodeTBS();else{if(!this.tbsView.byteLength)return n.schema();var r=Lr(this.tbsView);Cn.assert(r,"TBS Certificate Revocation List"),e=r.result}return new wa({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ft.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==n.defaultValues(kh)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,(function(e){return e.toJSON()}))),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}},{key:"isCertificateRevoked",value:function(e){if(!this.issuer.isEqual(e.issuer))return!1;if(!this.revokedCertificates)return!1;var t,r=C(this.revokedCertificates);try{for(r.s();!(t=r.n()).done;){if(t.value.userCertificate.isEqual(e.serialNumber))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"sign",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:Lo(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signature=n.signatureAlgorithm,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,a.signWithPrivateKey(this.tbsView,t,i);case 13:s=e.sent,this.signatureValue=new ta({valueHex:s});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1&&void 0!==u[1]?u[1]:Lo(!0),!t.issuerCertificate){e.next=6;break}if(a=t.issuerCertificate.subjectPublicKeyInfo,this.issuer.isEqual(t.issuerCertificate.subject)){e.next=6;break}return e.abrupt("return",!1);case 6:if(t.publicKeyInfo&&(a=t.publicKeyInfo),a){e.next=9;break}throw new Error("Issuer's certificate must be provided as an input parameter");case 9:if(!this.crlExtensions){e.next=28;break}n=C(this.crlExtensions.extensions),e.prev=11,n.s();case 13:if((i=n.n()).done){e.next=20;break}if(!(s=i.value).critical){e.next=18;break}if(Mh.includes(s.extnID)){e.next=18;break}return e.abrupt("return",!1);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(11),n.e(e.t0);case 25:return e.prev=25,n.f(),e.finish(25);case 28:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,a,this.signatureAlgorithm));case 29:case"end":return e.stop()}}),e,this,[[11,22,25,28]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case yh:return bn;case kh:return 0;case wh:return new $n;case bh:return new On;case Sh:case Nh:return new Rc;case Ah:return[];case Ch:return new wl;case xh:return new $n;case Eh:return new ta;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||"CertificateList",value:[Lh(e),$n.schema(t.signatureAlgorithm||{names:{blockName:xh}}),new ta({name:t.signatureValue||Eh})]})}}]),n}(xn);Hh.CLASS_NAME="CertificateRevocationList";var _h="crlId",Kh="crlValue",jh="parsedValue",Jh=[_h,Kh],Fh=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).crlId=Gt(a,_h,r.defaultValues(_h)),e.crlValue=Gt(a,Kh,r.defaultValues(Kh)),jh in a&&(e.parsedValue=Gt(a,jh,r.defaultValues(jh))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Jh);var t=pn(e,e,r.schema({names:{id:_h,value:Kh}}));if(Cn.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId!==Mi)throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId));this.parsedValue=Hh.fromBER(this.certValue.valueBlock.valueHex)}},{key:"toSchema",value:function(){return this.parsedValue&&(this.crlId=Mi,this.crlValue=new Yr({valueHex:this.parsedValue.toSchema().toBER(!1)})),new wa({value:[new ma({value:this.crlId}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case _h:return Sn;case Kh:return new mn;case jh:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case _h:return t===Sn;case Kh:return t instanceof mn;case jh:return t instanceof Object&&0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.id||"id"}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.value||"value"})]})]})}}]),r}(xn);Fh.CLASS_NAME="CRLBag";var Gh="version",qh="encryptedContentInfo",Xh="unprotectedAttrs",Wh=[Gh,qh,Xh],zh=function(e){c(u,e);var t,a,n=y(u);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,u),(e=n.call(this)).version=Gt(t,Gh,u.defaultValues(Gh)),e.encryptedContentInfo=Gt(t,qh,u.defaultValues(qh)),Xh in t&&(e.unprotectedAttrs=Gt(t,Xh,u.defaultValues(Xh))),t.schema&&e.fromSchema(t.schema),e}return o(u,[{key:"fromSchema",value:function(e){or(e,Wh);var t=pn(e,e,u.schema({names:{version:Gh,encryptedContentInfo:{names:{blockName:qh}},unprotectedAttrs:Xh}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new co({schema:t.result.encryptedContentInfo}),Xh in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,(function(e){return new si({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"encrypt",value:(a=i(regeneratorRuntime.mark((function e(t){var a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>1&&void 0!==i[1]?i[1]:Lo(!0),Nn.assert(t,"parameters","object"),n=r(r({},t),{},{contentType:"1.2.840.113549.1.7.1"}),e.next=5,a.encryptEncryptedContentInfo(n);case 5:this.encryptedContentInfo=e.sent;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"decrypt",value:(t=i(regeneratorRuntime.mark((function e(t){var a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>1&&void 0!==i[1]?i[1]:Lo(!0),Nn.assert(t,"parameters","object"),n=r(r({},t),{},{encryptedContentInfo:this.encryptedContentInfo}),e.abrupt("return",a.decryptEncryptedContentInfo(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Gh:return 0;case qh:return new co;case Xh:return[];default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Gh:return 0===t;case qh:return co.compareWithDefault("contentType",t.contentType)&&co.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&co.compareWithDefault("encryptedContent",t.encryptedContent);case Xh:return 0===t.length;default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),co.schema(t.encryptedContentInfo||{}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dn({name:t.unprotectedAttrs||Sn,value:si.schema()})]})]})}}]),u}(xn);zh.CLASS_NAME="EncryptedData";var Qh="encryptionAlgorithm",Yh="encryptedData",Zh="parsedValue",$h=[Qh,Yh],ef=function(e){c(u,e);var t,a,n=y(u);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,u),(e=n.call(this)).encryptionAlgorithm=Gt(t,Qh,u.defaultValues(Qh)),e.encryptedData=Gt(t,Yh,u.defaultValues(Yh)),Zh in t&&(e.parsedValue=Gt(t,Zh,u.defaultValues(Zh))),t.schema&&e.fromSchema(t.schema),e}return o(u,[{key:"fromSchema",value:function(e){or(e,$h);var t=pn(e,e,u.schema({names:{encryptionAlgorithm:{names:{blockName:Qh}},encryptedData:Yh}}));Cn.assertSchema(t,this.className),this.encryptionAlgorithm=new $n({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}},{key:"toSchema",value:function(){return new wa({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}},{key:"toJSON",value:function(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}},{key:"parseInternalValues",value:(a=i(regeneratorRuntime.mark((function e(t){var r,a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:Lo(!0),a=new zh({encryptedContentInfo:new co({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}),e.next=4,a.decrypt(t,r);case 4:n=e.sent,this.parsedValue=no.fromBER(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"makeInternalValues",value:(t=i(regeneratorRuntime.mark((function e(t){var a,n,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>1&&void 0!==s[1]?s[1]:Lo(!0),this.parsedValue){e.next=3;break}throw new Error('Please initialize "parsedValue" first');case 3:return n=new zh,i=r(r({},t),{},{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)}),e.next=7,n.encrypt(i,a);case 7:if(n.encryptedContentInfo.encryptedContent){e.next=9;break}throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");case 9:this.encryptionAlgorithm=n.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=n.encryptedContentInfo.encryptedContent;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Qh:return new $n;case Yh:return new Yr;case Zh:return{};default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Qh:return $n.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case Yh:return t.isEqual(u.defaultValues(e));case Zh:return t instanceof Object&&0===Object.keys(t).length;default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.encryptionAlgorithm||{names:{blockName:Qh}}),new vn({value:[new Yr({name:t.encryptedData||Yh}),new Yr({idBlock:{isConstructed:!0},name:t.encryptedData||Yh})]})]})}}]),u}(xn);ef.CLASS_NAME="PKCS8ShroudedKeyBag";var tf="secretTypeId",rf="secretValue",af=[tf,rf],nf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).secretTypeId=Gt(a,tf,r.defaultValues(tf)),e.secretValue=Gt(a,rf,r.defaultValues(rf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,af);var t=pn(e,e,r.schema({names:{id:tf,value:rf}}));Cn.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.secretTypeId}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case tf:return Sn;case rf:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case tf:return t===Sn;case rf:return t instanceof mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.id||"id"}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.value||"value"})]})]})}}]),r}(xn);nf.CLASS_NAME="SecretBag";var sf=function(){function e(){s(this,e)}return o(e,null,[{key:"getItems",value:function(){return this.items||(this.items={},e.register("1.2.840.113549.1.12.10.1.1",no),e.register("1.2.840.113549.1.12.10.1.2",ef),e.register("1.2.840.113549.1.12.10.1.3",fh),e.register("1.2.840.113549.1.12.10.1.4",Fh),e.register("1.2.840.113549.1.12.10.1.5",nf),e.register("1.2.840.113549.1.12.10.1.6",mf)),this.items}},{key:"register",value:function(e,t){this.getItems()[e]=t}},{key:"find",value:function(e){return this.getItems()[e]||null}}]),e}(),uf="bagId",of="bagValue",lf="bagAttributes",cf=[uf,of,lf],hf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).bagId=Gt(a,uf,r.defaultValues(uf)),e.bagValue=Gt(a,of,r.defaultValues(of)),lf in a&&(e.bagAttributes=Gt(a,lf,r.defaultValues(lf))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,cf);var t=pn(e,e,r.schema({names:{bagId:uf,bagValue:of,bagAttributes:lf}}));Cn.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();var a=sf.find(this.bagId);if(!a)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new a({schema:t.result.bagValue}),lf in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,(function(e){return new si({schema:e})})))}},{key:"toSchema",value:function(){var e=[new ma({value:this.bagId}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new ba({value:Array.from(this.bagAttributes,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case uf:return Sn;case of:return new mn;case lf:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case uf:return t===Sn;case of:return t instanceof mn;case lf:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.bagId||uf}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.bagValue||of})]}),new ba({optional:!0,value:[new dn({name:t.bagAttributes||lf,value:si.schema()})]})]})}}]),r}(xn);hf.CLASS_NAME="SafeBag";var ff="safeBags",mf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).safeBags=Gt(a,ff,r.defaultValues(ff)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[ff]);var t=pn(e,e,r.schema({names:{safeBags:ff}}));Cn.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,(function(e){return new hf({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.safeBags,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeBags:Array.from(this.safeBags,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ff?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===ff?0===t.length:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.safeBags||Sn,value:hf.schema()})]})}}]),r}(xn);mf.CLASS_NAME="SafeContents";var vf="otherCertFormat",df="otherCert",gf=[vf,df],pf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).otherCertFormat=Gt(a,vf,r.defaultValues(vf)),e.otherCert=Gt(a,df,r.defaultValues(df)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,gf);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.otherCertFormat}),this.otherCert]})}},{key:"toJSON",value:function(){var e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof mn||(e.otherCert=this.otherCert.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case vf:return Sn;case df:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.otherCertFormat||vf}),new mn({name:t.otherCert||df})]})}}]),r}(xn),yf="certificates",kf=[yf],wf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).certificates=Gt(a,yf,r.defaultValues(yf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,kf);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],(function(e){var t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new sh({schema:e});var r=new wa({value:e.valueBlock.value});switch(t){case 1:return 1===r.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec?new wc({schema:r}):new jl({schema:r});case 2:return new wc({schema:r});case 3:return new pf({schema:r})}return e}))}},{key:"toSchema",value:function(){return new ba({value:Array.from(this.certificates,(function(e){switch(!0){case e instanceof sh:return e.toSchema();case e instanceof jl:return new _r({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof wc:return new _r({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof pf:return new _r({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificates:Array.from(this.certificates,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===yf?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new ba({name:t.blockName||Sn,value:[new dn({name:t.certificates||yf,value:new vn({value:[sh.schema(),new _r({idBlock:{tagClass:3,tagNumber:0},value:[new mn]}),new _r({idBlock:{tagClass:3,tagNumber:1},value:[new wa]}),new _r({idBlock:{tagClass:3,tagNumber:2},value:wc.schema().valueBlock.value}),new _r({idBlock:{tagClass:3,tagNumber:3},value:pf.schema().valueBlock.value})]})})]})}}]),r}(xn);wf.CLASS_NAME="CertificateSet";var bf="otherRevInfoFormat",Sf="otherRevInfo",Nf=[bf,Sf],Af=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).otherRevInfoFormat=Gt(a,bf,r.defaultValues(bf)),e.otherRevInfo=Gt(a,Sf,r.defaultValues(Sf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Nf);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.otherRevInfoFormat}),this.otherRevInfo]})}},{key:"toJSON",value:function(){var e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof mn||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case bf:return Sn;case Sf:return new mn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.otherRevInfoFormat||bf}),new mn({name:t.otherRevInfo||Sf})]})}}]),r}(xn);Af.CLASS_NAME="OtherRevocationInfoFormat";var Cf="crls",xf="otherRevocationInfos",Ef=[Cf],If=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).crls=Gt(a,Cf,r.defaultValues(Cf)),e.otherRevocationInfos=Gt(a,xf,r.defaultValues(xf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ef);var t=pn(e,e,r.schema({names:{crls:Cf}}));if(Cn.assertSchema(t,this.className),t.result.crls){var a,n=C(t.result.crls);try{for(n.s();!(a=n.n()).done;){var i=a.value;1===i.idBlock.tagClass?this.crls.push(new Hh({schema:i})):this.otherRevocationInfos.push(new Af({schema:i}))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"toSchema",value:function(){var e=[];return e.push.apply(e,S(Array.from(this.crls,(function(e){return e.toSchema()})))),e.push.apply(e,S(Array.from(this.otherRevocationInfos,(function(e){var t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t})))),new ba({value:e})}},{key:"toJSON",value:function(){return{crls:Array.from(this.crls,(function(e){return e.toJSON()})),otherRevocationInfos:Array.from(this.otherRevocationInfos,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case Cf:case xf:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new ba({name:t.blockName||Sn,value:[new dn({name:t.crls||Sn,value:new vn({value:[Hh.schema(),new _r({idBlock:{tagClass:3,tagNumber:1},value:[new ma,new mn]})]})})]})}}]),r}(xn);If.CLASS_NAME="RevocationInfoChoices";var Bf="certs",Vf="crls",Rf=[Bf,Vf],Df=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).crls=Gt(a,Vf,r.defaultValues(Vf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Rf);var t=pn(e,e,r.schema({names:{certs:Bf,crls:Vf}}));Cn.assertSchema(t,this.className),Bf in t.result&&(this.certs=new wf({schema:new ba({value:t.result.certs.valueBlock.value})})),Vf in t.result&&(this.crls=new If({schema:new ba({value:t.result.crls.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=[];return this.certs&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bf:return new wf;case Vf:return new If;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Bf:return 0===t.certificates.length;case Vf:return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({name:t.certs||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:wf.schema().valueBlock.value}),new _r({name:t.crls||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:If.schema().valueBlock.value})]})}}]),r}(xn);Df.CLASS_NAME="OriginatorInfo";var Of="issuer",Pf="serialNumber",Uf=[Of,Pf],Tf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).issuer=Gt(a,Of,r.defaultValues(Of)),e.serialNumber=Gt(a,Pf,r.defaultValues(Pf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Uf);var t=pn(e,e,r.schema({names:{issuer:{names:{blockName:Of}},serialNumber:Pf}}));Cn.assertSchema(t,this.className),this.issuer=new On({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}},{key:"toSchema",value:function(){return new wa({value:[this.issuer.toSchema(),this.serialNumber]})}},{key:"toJSON",value:function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Of:return new On;case Pf:return new oa;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[On.schema(t.issuer||{}),new oa({name:t.serialNumber||Sn})]})}}]),r}(xn);Tf.CLASS_NAME="IssuerAndSerialNumber";var Lf="variant",Mf="value",Hf=["blockName"],_f=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).variant=Gt(a,Lf,r.defaultValues(Lf)),Mf in a&&(e.value=Gt(a,Mf,r.defaultValues(Mf))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Hf);var t=pn(e,e,r.schema({names:{blockName:"blockName"}}));Cn.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Tf({schema:t.result.blockName})):(this.variant=2,this.value=new Yr({valueHex:t.result.blockName.valueBlock.valueHex}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:if(!(this.value instanceof Tf))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof Yr))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new Pr({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new mn}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||!this.value||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Lf:return-1;case Mf:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Lf:return-1===t;case Mf:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new vn({value:[Tf.schema({names:{blockName:t.blockName||Sn}}),new Pr({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:0}})]})}}]),r}(xn);_f.CLASS_NAME="RecipientIdentifier";var Kf="version",jf="rid",Jf="keyEncryptionAlgorithm",Ff="encryptedKey",Gf="recipientCertificate",qf=[Kf,jf,Jf,Ff],Xf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Kf,r.defaultValues(Kf)),e.rid=Gt(a,jf,r.defaultValues(jf)),e.keyEncryptionAlgorithm=Gt(a,Jf,r.defaultValues(Jf)),e.encryptedKey=Gt(a,Ff,r.defaultValues(Ff)),e.recipientCertificate=Gt(a,Gf,r.defaultValues(Gf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,qf);var t=pn(e,e,r.schema({names:{version:Kf,rid:{names:{blockName:jf}},keyEncryptionAlgorithm:{names:{blockName:Jf}},encryptedKey:Ff}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,3===t.result.rid.idBlock.tagClass?this.rid=new Yr({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Tf({schema:t.result.rid}),this.keyEncryptionAlgorithm=new $n({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return this.rid instanceof Tf?(this.version=0,e.push(new oa({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new oa({value:this.version})),e.push(new Pr({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new wa({value:e})}},{key:"toJSON",value:function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Kf:return-1;case jf:return{};case Jf:return new $n;case Ff:return new Yr;case Gf:return new sh;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kf:return t===r.defaultValues(Kf);case jf:return 0===Object.keys(t).length;case Jf:case Ff:return t.isEqual(r.defaultValues(e));case Gf:return!1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),_f.schema(t.rid||{}),$n.schema(t.keyEncryptionAlgorithm||{}),new Yr({name:t.encryptedKey||Sn})]})}}]),r}(xn);Xf.CLASS_NAME="KeyTransRecipientInfo";var Wf="algorithm",zf="publicKey",Qf=[Wf,zf],Yf=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).algorithm=Gt(a,Wf,r.defaultValues(Wf)),e.publicKey=Gt(a,zf,r.defaultValues(zf)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Qf);var t=pn(e,e,r.schema({names:{algorithm:{names:{blockName:Wf}},publicKey:zf}}));Cn.assertSchema(t,this.className),this.algorithm=new $n({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}},{key:"toSchema",value:function(){return new wa({value:[this.algorithm.toSchema(),this.publicKey]})}},{key:"toJSON",value:function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Wf:return new $n;case zf:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Wf:case zf:return t.isEqual(r.defaultValues(e));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.algorithm||{}),new ta({name:t.publicKey||Sn})]})}}]),r}(xn);Yf.CLASS_NAME="OriginatorPublicKey";var Zf="variant",$f="value",em=["blockName"],tm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).variant=Gt(a,Zf,r.defaultValues(Zf)),$f in a&&(e.value=Gt(a,$f,r.defaultValues($f))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,em);var t=pn(e,e,r.schema({names:{blockName:"blockName"}}));Cn.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Tf({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new Yf({schema:new wa({value:t.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:var e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e;default:return new mn}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Zf:return-1;case $f:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Zf:return-1===t;case $f:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new vn({value:[Tf.schema({names:{blockName:t.blockName||Sn}}),new Pr({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||Sn}),new _r({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||Sn,value:Yf.schema().valueBlock.value})]})}}]),r}(xn);tm.CLASS_NAME="OriginatorIdentifierOrKey";var rm="keyAttrId",am="keyAttr",nm=[rm,am],im=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).keyAttrId=Gt(a,rm,r.defaultValues(rm)),am in a&&(e.keyAttr=Gt(a,am,r.defaultValues(am))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,nm);var t=pn(e,e,r.schema({names:{keyAttrId:rm,keyAttr:am}}));Cn.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),am in t.result&&(this.keyAttr=t.result.keyAttr)}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.keyAttrId})),am in this&&e.push(this.keyAttr),new wa({value:e})}},{key:"toJSON",value:function(){var e={keyAttrId:this.keyAttrId};return am in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case rm:return Sn;case am:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case rm:return"string"==typeof t&&t===Sn;case am:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({optional:t.optional||!0,name:t.blockName||Sn,value:[new ma({name:t.keyAttrId||Sn}),new mn({optional:!0,name:t.keyAttr||Sn})]})}}]),r}(xn);im.CLASS_NAME="OtherKeyAttribute";var sm="subjectKeyIdentifier",um="date",om="other",lm=[sm,um,om],cm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).subjectKeyIdentifier=Gt(a,sm,r.defaultValues(sm)),um in a&&(e.date=Gt(a,um,r.defaultValues(um))),om in a&&(e.other=Gt(a,om,r.defaultValues(om))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,lm);var t=pn(e,e,r.schema({names:{subjectKeyIdentifier:sm,date:um,other:{names:{blockName:om}}}}));Cn.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,um in t.result&&(this.date=t.result.date),om in t.result&&(this.other=new im({schema:t.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case sm:return new Yr;case um:return new rn;case om:return new im;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case sm:return t.isEqual(r.defaultValues(sm));case um:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case om:return t.keyAttrId===Sn&&"keyAttr"in t==!1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Yr({name:t.subjectKeyIdentifier||Sn}),new rn({optional:!0,name:t.date||Sn}),im.schema(t.other||{})]})}}]),r}(xn);cm.CLASS_NAME="RecipientKeyIdentifier";var hm="variant",fm="value",mm=["blockName"],vm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).variant=Gt(a,hm,r.defaultValues(hm)),e.value=Gt(a,fm,r.defaultValues(fm)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,mm);var t=pn(e,e,r.schema({names:{blockName:"blockName"}}));Cn.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Tf({schema:t.result.blockName})):(this.variant=2,this.value=new cm({schema:new wa({value:t.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new _r({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new mn}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case hm:return-1;case fm:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case hm:return-1===t;case fm:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new vn({value:[Tf.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||Sn}}),new _r({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:0},value:cm.schema(t.rKeyId||{names:{blockName:t.blockName||Sn}}).valueBlock.value})]})}}]),r}(xn);vm.CLASS_NAME="KeyAgreeRecipientIdentifier";var dm="rid",gm="encryptedKey",pm=[dm,gm],ym=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).rid=Gt(a,dm,r.defaultValues(dm)),e.encryptedKey=Gt(a,gm,r.defaultValues(gm)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,pm);var t=pn(e,e,r.schema({names:{rid:{names:{blockName:dm}},encryptedKey:gm}}));Cn.assertSchema(t,this.className),this.rid=new vm({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){return new wa({value:[this.rid.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case dm:return new vm;case gm:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case dm:return-1===t.variant&&"value"in t==!1;case gm:return t.isEqual(r.defaultValues(gm));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[vm.schema(t.rid||{}),new Yr({name:t.encryptedKey||Sn})]})}}]),r}(xn);ym.CLASS_NAME="RecipientEncryptedKey";var km="encryptedKeys",wm="RecipientEncryptedKeys",bm=[wm],Sm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).encryptedKeys=Gt(a,km,r.defaultValues(km)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,bm);var t=pn(e,e,r.schema({names:{RecipientEncryptedKeys:wm}}));Cn.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,(function(e){return new ym({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.encryptedKeys,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{encryptedKeys:Array.from(this.encryptedKeys,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===km?[]:w(h(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===km?0===t.length:w(h(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.RecipientEncryptedKeys||Sn,value:ym.schema()})]})}}]),r}(xn);Sm.CLASS_NAME="RecipientEncryptedKeys";var Nm="version",Am="originator",Cm="ukm",xm="keyEncryptionAlgorithm",Em="recipientEncryptedKeys",Im="recipientCertificate",Bm="recipientPublicKey",Vm=[Nm,Am,Cm,xm,Em],Rm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Nm,r.defaultValues(Nm)),e.originator=Gt(a,Am,r.defaultValues(Am)),Cm in a&&(e.ukm=Gt(a,Cm,r.defaultValues(Cm))),e.keyEncryptionAlgorithm=Gt(a,xm,r.defaultValues(xm)),e.recipientEncryptedKeys=Gt(a,Em,r.defaultValues(Em)),e.recipientCertificate=Gt(a,Im,r.defaultValues(Im)),e.recipientPublicKey=Gt(a,Bm,r.defaultValues(Bm)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Vm);var t=pn(e,e,r.schema({names:{version:Nm,originator:{names:{blockName:Am}},ukm:Cm,keyEncryptionAlgorithm:{names:{blockName:xm}},recipientEncryptedKeys:{names:{blockName:Em}}}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new tm({schema:t.result.originator}),Cm in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new $n({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Sm({schema:t.result.recipientEncryptedKeys})}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Nm:return 0;case Am:return new tm;case Cm:return new Yr;case xm:return new $n;case Em:return new Sm;case Im:return new sh;case Bm:return null;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Nm:return 0===t;case Am:return-1===t.variant&&"value"in t==!1;case Cm:return t.isEqual(r.defaultValues(Cm));case xm:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case Em:return 0===t.encryptedKeys.length;case Im:case Bm:return!1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new _r({idBlock:{tagClass:3,tagNumber:0},value:[tm.schema(t.originator||{})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Yr({name:t.ukm||Sn})]}),$n.schema(t.keyEncryptionAlgorithm||{}),Sm.schema(t.recipientEncryptedKeys||{})]})}}]),r}(xn);Rm.CLASS_NAME="KeyAgreeRecipientInfo";var Dm="keyIdentifier",Om="date",Pm="other",Um=[Dm,Om,Pm],Tm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).keyIdentifier=Gt(a,Dm,r.defaultValues(Dm)),Om in a&&(e.date=Gt(a,Om,r.defaultValues(Om))),Pm in a&&(e.other=Gt(a,Pm,r.defaultValues(Pm))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Um);var t=pn(e,e,r.schema({names:{keyIdentifier:Dm,date:Om,other:{names:{blockName:Pm}}}}));Cn.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,Om in t.result&&(this.date=t.result.date),Pm in t.result&&(this.other=new im({schema:t.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Dm:return new Yr;case Om:return new rn;case Pm:return new im;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Dm:return t.isEqual(r.defaultValues(Dm));case Om:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case Pm:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&"keyAttr"in t==!1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new Yr({name:t.keyIdentifier||Sn}),new rn({optional:!0,name:t.date||Sn}),im.schema(t.other||{})]})}}]),r}(xn);Tm.CLASS_NAME="KEKIdentifier";var Lm="version",Mm="kekid",Hm="keyEncryptionAlgorithm",_m="encryptedKey",Km="preDefinedKEK",jm=[Lm,Mm,Hm,_m],Jm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Lm,r.defaultValues(Lm)),e.kekid=Gt(a,Mm,r.defaultValues(Mm)),e.keyEncryptionAlgorithm=Gt(a,Hm,r.defaultValues(Hm)),e.encryptedKey=Gt(a,_m,r.defaultValues(_m)),e.preDefinedKEK=Gt(a,Km,r.defaultValues(Km)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,jm);var t=pn(e,e,r.schema({names:{version:Lm,kekid:{names:{blockName:Mm}},keyEncryptionAlgorithm:{names:{blockName:Hm}},encryptedKey:_m}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Tm({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new $n({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){return new wa({value:[new oa({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Lm:return 0;case Mm:return new Tm;case Hm:return new $n;case _m:return new Yr;case Km:return bn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"KEKRecipientInfo":return t===r.defaultValues(Lm);case Mm:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&"date"in t==!1&&"other"in t==!1;case Hm:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case _m:return t.isEqual(r.defaultValues(_m));case Km:return 0===t.byteLength;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),Tm.schema(t.kekid||{}),$n.schema(t.keyEncryptionAlgorithm||{}),new Yr({name:t.encryptedKey||Sn})]})}}]),r}(xn);Jm.CLASS_NAME="KEKRecipientInfo";var Fm="version",Gm="keyDerivationAlgorithm",qm="keyEncryptionAlgorithm",Xm="encryptedKey",Wm="password",zm=[Fm,Gm,qm,Xm],Qm=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Fm,r.defaultValues(Fm)),Gm in a&&(e.keyDerivationAlgorithm=Gt(a,Gm,r.defaultValues(Gm))),e.keyEncryptionAlgorithm=Gt(a,qm,r.defaultValues(qm)),e.encryptedKey=Gt(a,Xm,r.defaultValues(Xm)),e.password=Gt(a,Wm,r.defaultValues(Wm)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,zm);var t=pn(e,e,r.schema({names:{version:Fm,keyDerivationAlgorithm:Gm,keyEncryptionAlgorithm:{names:{blockName:qm}},encryptedKey:Xm}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Gm in t.result&&(this.keyDerivationAlgorithm=new $n({schema:new wa({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new $n({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),this.keyDerivationAlgorithm&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fm:return-1;case Gm:case qm:return new $n;case Xm:return new Yr;case Wm:return bn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Fm:return-1===t;case Gm:case qm:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case Xm:return t.isEqual(r.defaultValues(Xm));case Wm:return 0===t.byteLength;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new _r({name:t.keyDerivationAlgorithm||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:$n.schema().valueBlock.value}),$n.schema(t.keyEncryptionAlgorithm||{}),new Yr({name:t.encryptedKey||Sn})]})}}]),r}(xn);Qm.CLASS_NAME="PasswordRecipientInfo";var Ym="oriType",Zm="oriValue",$m=[Ym,Zm],ev=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).oriType=Gt(a,Ym,r.defaultValues(Ym)),e.oriValue=Gt(a,Zm,r.defaultValues(Zm)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,$m);var t=pn(e,e,r.schema({names:{oriType:Ym,oriValue:Zm}}));Cn.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.oriType}),this.oriValue]})}},{key:"toJSON",value:function(){var e={oriType:this.oriType};return r.compareWithDefault(Zm,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ym:return Sn;case Zm:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Ym:return t===Sn;case Zm:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.oriType||Sn}),new mn({name:t.oriValue||Sn})]})}}]),r}(xn);ev.CLASS_NAME="OtherRecipientInfo";var tv="variant",rv="value",av=["blockName"],nv=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).variant=Gt(a,tv,r.defaultValues(tv)),rv in a&&(e.value=Gt(a,rv,r.defaultValues(rv))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,av);var t=pn(e,e,r.schema({names:{blockName:"blockName"}}));if(Cn.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new Xf({schema:t.result.blockName});else{var a=new wa({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Rm({schema:a});break;case 2:this.variant=3,this.value=new Jm({schema:a});break;case 3:this.variant=4,this.value=new Qm({schema:a});break;case 4:this.variant=5,this.value=new ev({schema:a});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}},{key:"toSchema",value:function(){An.assertEmpty(this.value,"value","RecipientInfo");var e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new mn}}},{key:"toJSON",value:function(){var e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case tv:return-1;case rv:return{};default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case tv:return t===r.defaultValues(e);case rv:return 0===Object.keys(t).length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new vn({value:[Xf.schema({names:{blockName:t.blockName||Sn}}),new _r({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:1},value:Rm.schema().valueBlock.value}),new _r({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:2},value:Jm.schema().valueBlock.value}),new _r({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:3},value:Qm.schema().valueBlock.value}),new _r({name:t.blockName||Sn,idBlock:{tagClass:3,tagNumber:4},value:ev.schema().valueBlock.value})]})}}]),r}(xn);nv.CLASS_NAME="RecipientInfo";var iv="hashAlgorithm",sv="maskGenAlgorithm",uv="pSourceAlgorithm",ov=[iv,sv,uv],lv=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).hashAlgorithm=Gt(a,iv,r.defaultValues(iv)),e.maskGenAlgorithm=Gt(a,sv,r.defaultValues(sv)),e.pSourceAlgorithm=Gt(a,uv,r.defaultValues(uv)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ov);var t=pn(e,e,r.schema({names:{hashAlgorithm:{names:{blockName:iv}},maskGenAlgorithm:{names:{blockName:sv}},pSourceAlgorithm:{names:{blockName:uv}}}}));Cn.assertSchema(t,this.className),iv in t.result&&(this.hashAlgorithm=new $n({schema:t.result.hashAlgorithm})),sv in t.result&&(this.maskGenAlgorithm=new $n({schema:t.result.maskGenAlgorithm})),uv in t.result&&(this.pSourceAlgorithm=new $n({schema:t.result.pSourceAlgorithm}))}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(r.defaultValues(iv))||e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(r.defaultValues(sv))||e.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(r.defaultValues(uv))||e.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(r.defaultValues(iv))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(r.defaultValues(sv))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(r.defaultValues(uv))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case iv:return new $n({algorithmId:"1.3.14.3.2.26",algorithmParams:new Gr});case sv:return new $n({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new $n({algorithmId:"1.3.14.3.2.26",algorithmParams:new Gr}).toSchema()});case uv:return new $n({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new Yr({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new _r({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[$n.schema(t.hashAlgorithm||{})]}),new _r({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[$n.schema(t.maskGenAlgorithm||{})]}),new _r({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[$n.schema(t.pSourceAlgorithm||{})]})]})}}]),r}(xn);lv.CLASS_NAME="RSAESOAEPParams";var cv="keyInfo",hv="entityUInfo",fv="suppPubInfo",mv=[cv,hv,fv],vv=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).keyInfo=Gt(a,cv,r.defaultValues(cv)),hv in a&&(e.entityUInfo=Gt(a,hv,r.defaultValues(hv))),e.suppPubInfo=Gt(a,fv,r.defaultValues(fv)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,mv);var t=pn(e,e,r.schema({names:{keyInfo:{names:{blockName:cv}},entityUInfo:hv,suppPubInfo:fv}}));Cn.assertSchema(t,this.className),this.keyInfo=new $n({schema:t.result.keyInfo}),hv in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case cv:return new $n;case hv:case fv:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case cv:case hv:case fv:return t.isEqual(r.defaultValues(e));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.keyInfo||{}),new _r({name:t.entityUInfo||Sn,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new Yr]}),new _r({name:t.suppPubInfo||Sn,idBlock:{tagClass:3,tagNumber:2},value:[new Yr]})]})}}]),r}(xn);vv.CLASS_NAME="ECCCMSSharedInfo";var dv="version",gv="originatorInfo",pv="recipientInfos",yv="encryptedContentInfo",kv="unprotectedAttrs",wv=[dv,gv,pv,yv,kv],bv={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},Sv={"P-256":256,"P-384":384,"P-521":528},Nv=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).version=Gt(t,dv,n.defaultValues(dv)),gv in t&&(e.originatorInfo=Gt(t,gv,n.defaultValues(gv))),e.recipientInfos=Gt(t,pv,n.defaultValues(pv)),e.encryptedContentInfo=Gt(t,yv,n.defaultValues(yv)),kv in t&&(e.unprotectedAttrs=Gt(t,kv,n.defaultValues(kv))),e.policy={disableSplit:!!t.disableSplit},t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,wv);var t=pn(e,e,n.schema({names:{version:dv,originatorInfo:gv,recipientInfos:pv,encryptedContentInfo:{names:{blockName:yv}},unprotectedAttrs:kv}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,gv in t.result&&(this.originatorInfo=new Df({schema:new wa({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,(function(e){return new nv({schema:e})})),this.encryptedContentInfo=new co({schema:t.result.encryptedContentInfo}),kv in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,(function(e){return new si({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),this.originatorInfo&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new ba({value:Array.from(this.recipientInfos,(function(e){return e.toSchema()}))})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,recipientInfos:Array.from(this.recipientInfos,(function(e){return e.toJSON()})),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"addRecipientByCertificate",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lo(!0),n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},bv,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))r=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));r=2}switch(r){case 1:var i,s;if(!0===n.useOAEP){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");var u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),o=new $n({algorithmId:u,algorithmParams:new Gr}),l=new lv({hashAlgorithm:o,maskGenAlgorithm:new $n({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:o.toSchema()})});s=l.toSchema()}else{if((i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}))===Sn)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");s=new Gr}var c=new Xf({version:0,rid:new Tf({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new $n({algorithmId:i,algorithmParams:s}),recipientCertificate:e});this.recipientInfos.push(new nv({variant:1,value:c}));break;case 2:var h=new vm({variant:1,value:new Tf({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(h,n,{recipientCertificate:e},a);break;default:throw new Error('Unknown "variant" value: '.concat(r))}return!0}},{key:"addRecipientByPreDefinedData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lo(!0);if(Nn.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){var n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new Gr),r){case 1:var s=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new Jm({version:4,kekid:new Tm({keyIdentifier:new Yr({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new $n({algorithmId:s,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new nv({variant:3,value:u}));break;case 2:var o=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),l=new ArrayBuffer(64),c=new Uint8Array(l);a.getRandomValues(c);var h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),f=new No({salt:new Yr({valueHex:l}),iterationCount:t.iterationCount,prf:new $n({algorithmId:h,algorithmParams:new Gr})}),m=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),v=new Qm({version:0,keyDerivationAlgorithm:new $n({algorithmId:o,algorithmParams:f.toSchema()}),keyEncryptionAlgorithm:new $n({algorithmId:m,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new nv({variant:4,value:v}));break;default:throw new Error('Unknown value for "variant": '.concat(r))}}},{key:"addRecipientByKeyIdentifier",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lo(!0),n=Object.assign({},bv,r||{}),i=new vm({variant:2,value:new cm({subjectKeyIdentifier:new Yr({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}},{key:"_addKeyAgreeRecipientInfo",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lo(!0),n=new ym({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),s=new $n({algorithmId:i}),u=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),o=new ArrayBuffer(64),l=new Uint8Array(o);a.getRandomValues(l);var c={version:3,ukm:new Yr({valueHex:o}),keyEncryptionAlgorithm:new $n({algorithmId:u,algorithmParams:s.toSchema()}),recipientEncryptedKeys:new Sm({encryptedKeys:[n]})},h=new Rm(Object.assign(c,r));this.recipientInfos.push(new nv({variant:2,value:h}))}},{key:"encrypt",value:(r=i(regeneratorRuntime.mark((function e(t,r){var a,n,s,u,o,l,c,h,f,m,v,d,g,p,y=this,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>2&&void 0!==k[2]?k[2]:Lo(!0),n=new ArrayBuffer(16),s=new Uint8Array(n),a.getRandomValues(s),u=new Uint8Array(r),o=a.getOIDByAlgorithm(t,!0,"contentEncryptionAlgorithm"),e.next=8,a.generateKey(t,!0,["encrypt"]);case 8:return l=e.sent,e.next=11,a.encrypt({name:t.name,iv:s},l,u);case 11:return c=e.sent,e.next=14,a.exportKey("raw",l);case 14:h=e.sent,this.version=2,this.encryptedContentInfo=new co({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new $n({algorithmId:o,algorithmParams:new Yr({valueHex:n})}),encryptedContent:new Yr({valueHex:c})}),f=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,n,i,s,u,o,c,h,f,m,v,d,g,p,k,w,b,S,N,A,C,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=y.recipientInfos[t].value).recipientPublicKey){e.next=6;break}n=r.recipientPublicKey.algorithm.namedCurve,i=r.recipientPublicKey,e.next=27;break;case 6:if(!r.recipientCertificate){e.next=26;break}if((s=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===ma.blockName()){e.next=10;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 10:u=s.valueBlock.toString(),e.t0=u,e.next="1.2.840.10045.3.1.7"===e.t0?14:"1.3.132.0.34"===e.t0?16:"1.3.132.0.35"===e.t0?18:20;break;case 14:return n="P-256",e.abrupt("break",21);case 16:return n="P-384",e.abrupt("break",21);case 18:return n="P-521",e.abrupt("break",21);case 20:throw new Error("Incorrect curve OID for index ".concat(t));case 21:return e.next=23,r.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:n},usages:[]}},a);case 23:i=e.sent,e.next=27;break;case 26:throw new Error("Unsupported RecipientInfo");case 27:return o=Sv[n],e.next=30,a.generateKey({name:"ECDH",namedCurve:n},!0,["deriveBits"]);case 30:return c=e.sent,e.next=33,a.exportKey("spki",c.publicKey);case 33:return h=e.sent,e.next=36,a.deriveBits({name:"ECDH",public:i},c.privateKey,o);case 36:for(f=e.sent,m=new $n({schema:r.keyEncryptionAlgorithm.algorithmParams}),v=a.getAlgorithmByOID(m.algorithmId,!0,"aesKWAlgorithm"),d=v.length,g=new ArrayBuffer(4),p=new Uint8Array(g),k=3;k>=0;k--)p[k]=d,d>>=8;return w=new vv({keyInfo:new $n({algorithmId:m.algorithmId}),entityUInfo:r.ukm,suppPubInfo:new Yr({valueHex:g})}),b=w.toSchema().toBER(!1),S=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),e.next=48,jo(S.kdf,f,v.length,b,a);case 48:return N=e.sent,e.next=51,a.importKey("raw",N,{name:"AES-KW"},!0,["wrapKey"]);case 51:return A=e.sent,e.next=54,a.wrapKey("raw",l,A,{name:"AES-KW"});case 54:return C=e.sent,(x=new tm).variant=3,x.value=Yf.fromBER(h),r.originator=x,r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new Yr({valueHex:C}),e.abrupt("return",{ecdhPrivateKey:c.privateKey});case 61:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,n,i,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.recipientInfos[t].value,"RSA-OAEP"!==(n=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=8;break}if(i=r.keyEncryptionAlgorithm.algorithmParams,s=new lv({schema:i}),n.hash=a.getAlgorithmByOID(s.hashAlgorithm.algorithmId),"name"in n.hash!=0){e.next=8;break}throw new Error("Incorrect OID for hash algorithm: ".concat(s.hashAlgorithm.algorithmId));case 8:return e.prev=8,e.next=11,r.recipientCertificate.getPublicKey({algorithm:{algorithm:n,usages:["encrypt","wrapKey"]}},a);case 11:return u=e.sent,e.next=14,a.encrypt(u.algorithm,u,h);case 14:o=e.sent,r.encryptedKey=new Yr({valueHex:o}),e.next=20;break;case 18:e.prev=18,e.t0=e.catch(8);case 20:case"end":return e.stop()}}),e,null,[[8,18]])})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.recipientInfos[t].value,n=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=4,a.importKey("raw",new Uint8Array(r.preDefinedKEK),n,!0,["wrapKey"]);case 4:return i=e.sent,e.next=7,a.wrapKey("raw",l,i,n);case 7:s=e.sent,r.encryptedKey=new Yr({valueHex:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,n,i,s,u,o,c,h,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=y.recipientInfos[t].value).keyDerivationAlgorithm){e.next=3;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 3:if(r.keyDerivationAlgorithm.algorithmParams){e.next=5;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 5:e.prev=5,n=new No({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 12:return i=new Uint8Array(r.password),e.next=15,a.importKey("raw",i,"PBKDF2",!1,["deriveKey"]);case 15:return s=e.sent,u=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),o="SHA-1",n.prf&&(c=a.getAlgorithmByOID(n.prf.algorithmId,!0,"prfAlgorithm"),o=c.hash.name),h=new Uint8Array(n.salt.valueBlock.valueHex),f=n.iterationCount,e.next=23,a.deriveKey({name:"PBKDF2",hash:{name:o},salt:h,iterations:f},s,u,!0,["wrapKey"]);case 23:return m=e.sent,e.next=26,a.wrapKey("raw",l,m,u);case 26:v=e.sent,r.encryptedKey=new Yr({valueHex:v});case 28:case"end":return e.stop()}}),e,null,[[5,9]])})));return function(t){return e.apply(this,arguments)}}(),g=[],p=0;case 23:if(!(p<this.recipientInfos.length)){e.next=55;break}e.t0=this.recipientInfos[p].variant,e.next=1===e.t0?27:2===e.t0?33:3===e.t0?39:4===e.t0?45:51;break;case 27:return e.t1=g,e.next=30,m(p);case 30:return e.t2=e.sent,e.t1.push.call(e.t1,e.t2),e.abrupt("break",52);case 33:return e.t3=g,e.next=36,f(p);case 36:return e.t4=e.sent,e.t3.push.call(e.t3,e.t4),e.abrupt("break",52);case 39:return e.t5=g,e.next=42,v(p);case 42:return e.t6=e.sent,e.t5.push.call(e.t5,e.t6),e.abrupt("break",52);case 45:return e.t7=g,e.next=48,d(p);case 48:return e.t8=e.sent,e.t7.push.call(e.t7,e.t8),e.abrupt("break",52);case 51:throw new Error("Unknown recipient type in array with index ".concat(p));case 52:p++,e.next=23;break;case 55:return e.abrupt("return",g);case 56:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"decrypt",value:(t=i(regeneratorRuntime.mark((function e(t,r){var a,n,s,u,o,l,c,h,f,m,v,d,g=this,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>2&&void 0!==p[2]?p[2]:Lo(!0),n=r||{},!(t+1>this.recipientInfos.length)){e.next=4;break}throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));case 4:s=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,s,u,o,l,c,h,f,m,v,d,p,y,k,w,b,S,N,A,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=i(regeneratorRuntime.mark((function e(t){var n,i,s,u,o,l,c,h,f,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=t||!1,n=new $n({schema:r.keyEncryptionAlgorithm.algorithmParams}),i=a.getAlgorithmByOID(n.algorithmId,!0,"kwAlgorithm"),s=i.length,u=new ArrayBuffer(4),o=new Uint8Array(u),l=3;l>=0;l--)o[l]=s,s>>=8;if(c={algorithmId:n.algorithmId},t&&(c.algorithmParams=new Gr),h=new vv({keyInfo:new $n(c),entityUInfo:r.ukm,suppPubInfo:new Yr({valueHex:u})}),f=h.toSchema().toBER(!1),(m=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm")).name){e.next=14;break}throw new Error("Incorrect OID for key encryption algorithm: ".concat(r.keyEncryptionAlgorithm.algorithmId));case 14:return e.abrupt("return",jo(m.kdf,p,i.length,f,a));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)},y=function(e){return k.apply(this,arguments)},r=g.recipientInfos[t].value,l=r.originator,!n.recipientCertificate){e.next=11;break}if((c=n.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===ma.blockName()){e.next=8;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 8:s=c.valueBlock.toString(),e.next=19;break;case 11:if(!l.value.algorithm.algorithmParams){e.next=18;break}if((h=l.value.algorithm.algorithmParams).constructor.blockName()===ma.blockName()){e.next=15;break}throw new Error("Incorrect originator for index ".concat(t));case 15:s=h.valueBlock.toString(),e.next=19;break;case 18:throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');case 19:if(n.recipientPrivateKey){e.next=21;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');case 21:e.t0=s,e.next="1.2.840.10045.3.1.7"===e.t0?24:"1.3.132.0.34"===e.t0?27:"1.3.132.0.35"===e.t0?30:33;break;case 24:return u="P-256",o=256,e.abrupt("break",34);case 27:return u="P-384",o=384,e.abrupt("break",34);case 30:return u="P-521",o=528,e.abrupt("break",34);case 33:throw new Error("Incorrect curve OID for index ".concat(t));case 34:if(m=a,!Kt.isBufferSource(n.recipientPrivateKey)){e.next=41;break}return e.next=38,a.importKey("pkcs8",n.recipientPrivateKey,{name:"ECDH",namedCurve:u},!0,["deriveBits"]);case 38:f=e.sent,e.next=43;break;case 41:f=n.recipientPrivateKey,"crypto"in n&&n.crypto&&(m=n.crypto.subtle);case 43:return"algorithmParams"in l.value.algorithm==0&&(l.value.algorithm.algorithmParams=new ma({value:s})),v=l.value.toSchema().toBER(!1),e.next=47,a.importKey("spki",v,{name:"ECDH",namedCurve:u},!0,[]);case 47:return d=e.sent,e.next=50,m.deriveBits({name:"ECDH",public:d},f,o);case 50:return p=e.sent,e.next=53,y();case 53:return w=e.sent,b=function(){var e=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.importKey("raw",t,{name:"AES-KW"},!0,["unwrapKey"]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=57,b(w);case 57:return S=e.sent,N=function(){var e=i(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,i=a.getAlgorithmByOID(n,!0,"contentEncryptionAlgorithm"),e.abrupt("return",a.unwrapKey("raw",r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,t,{name:"AES-KW"},i,!0,["decrypt"]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=59,e.next=62,N(S);case 62:return e.abrupt("return",e.sent);case 65:return e.prev=65,e.t1=e.catch(59),e.next=69,y(!0);case 69:return A=e.sent,e.next=72,b(A);case 72:return C=e.sent,e.abrupt("return",N(C));case 74:case"end":return e.stop()}}),e,null,[[59,65]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,i,s,u,o,l,c,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,n.recipientPrivateKey){e.next=3;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');case 3:if("RSA-OAEP"!==(i=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=10;break}if(s=r.keyEncryptionAlgorithm.algorithmParams,u=new lv({schema:s}),i.hash=a.getAlgorithmByOID(u.hashAlgorithm.algorithmId),"name"in i.hash!=0){e.next=10;break}throw new Error("Incorrect OID for hash algorithm: ".concat(u.hashAlgorithm.algorithmId));case 10:if(l=a,!Kt.isBufferSource(n.recipientPrivateKey)){e.next=17;break}return e.next=14,a.importKey("pkcs8",n.recipientPrivateKey,i,!0,["decrypt"]);case 14:o=e.sent,e.next=19;break;case 17:o=n.recipientPrivateKey,"crypto"in n&&n.crypto&&(l=n.crypto.subtle);case 19:return e.next=21,l.decrypt(o.algorithm,o,r.encryptedKey.valueBlock.valueHexView);case 21:if(c=e.sent,h=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,"name"in(f=a.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"))!=0){e.next=26;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(h));case 26:return e.abrupt("return",a.importKey("raw",c,f,!0,["decrypt"]));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,i,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,n.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:return i=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=6,a.importKey("raw",n.preDefinedData,i,!0,["unwrapKey"]);case 6:if(s=e.sent,u=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,(o=a.getAlgorithmByOID(u,!0,"contentEncryptionAlgorithm")).name){e.next=11;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(u));case 11:return e.abrupt("return",a.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,s,i,o,!0,["decrypt"]));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=i(regeneratorRuntime.mark((function e(t){var r,i,s,u,o,l,c,h,f,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.recipientInfos[t].value,n.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:if(r.keyDerivationAlgorithm){e.next=5;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 5:if(r.keyDerivationAlgorithm.algorithmParams){e.next=7;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 7:e.prev=7,i=new No({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(7),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 14:return e.next=16,a.importKey("raw",n.preDefinedData,"PBKDF2",!1,["deriveKey"]);case 16:return s=e.sent,u=a.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),o=i.prf?a.getAlgorithmByOID(i.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",l=new Uint8Array(i.salt.valueBlock.valueHex),c=i.iterationCount,e.next=23,a.deriveKey({name:"PBKDF2",hash:{name:o},salt:l,iterations:c},s,u,!0,["unwrapKey"]);case 23:return h=e.sent,f=g.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=a.getAlgorithmByOID(f,!0,"contentEncryptionAlgorithm"),e.abrupt("return",a.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,h,u,m,!0,["decrypt"]));case 27:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t){return e.apply(this,arguments)}}(),e.t0=this.recipientInfos[t].variant,e.next=1===e.t0?11:2===e.t0?15:3===e.t0?19:4===e.t0?23:27;break;case 11:return e.next=13,u(t);case 13:case 17:case 21:case 25:return c=e.sent,e.abrupt("break",28);case 15:return e.next=17,s(t);case 19:return e.next=21,o(t);case 23:return e.next=25,l(t);case 27:throw new Error("Unknown recipient type in array with index ".concat(t));case 28:if(h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,f=a.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"),m=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,v=new Uint8Array(m),this.encryptedContentInfo.encryptedContent){e.next=34;break}throw new Error("Required property `encryptedContent` is empty");case 34:return d=this.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",a.decrypt({name:f.name,iv:v},c,d));case 36:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case dv:return 0;case gv:return new Df;case pv:return[];case yv:return new co;case kv:return[];default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case dv:return t===n.defaultValues(e);case gv:return 0===t.certs.certificates.length&&0===t.crls.crls.length;case pv:case kv:return 0===t.length;case yv:return co.compareWithDefault("contentType",t.contentType)&&co.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&co.compareWithDefault("encryptedContent",t.encryptedContent);default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||Sn}),new _r({name:t.originatorInfo||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Df.schema().valueBlock.value}),new ba({value:[new dn({name:t.recipientInfos||Sn,value:nv.schema()})]}),co.schema(t.encryptedContentInfo||{}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dn({name:t.unprotectedAttrs||Sn,value:si.schema()})]})]})}}]),n}(xn);Nv.CLASS_NAME="EnvelopedData";var Av="safeContents",Cv="parsedValue",xv="contentInfos",Ev=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).safeContents=Gt(t,Av,n.defaultValues(Av)),Cv in t&&(e.parsedValue=Gt(t,Cv,n.defaultValues(Cv))),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,[xv]);var t=pn(e,e,n.schema({names:{contentInfos:xv}}));Cn.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,(function(e){return new Ac({schema:e})}))}},{key:"toSchema",value:function(){return new wa({value:Array.from(this.safeContents,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeContents:Array.from(this.safeContents,(function(e){return e.toJSON()}))}}},{key:"parseInternalValues",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=k.length>1&&void 0!==k[1]?k[1]:Lo(!0),An.assert(t,Av),Nn.assert(t.safeContents,Av,"Array"),t.safeContents.length===this.safeContents.length){e.next=5;break}throw new Nn('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');case 5:this.parsedValue={safeContents:[]},a=C(this.safeContents.entries()),e.prev=7,a.s();case 9:if((n=a.n()).done){e.next=41;break}i=b(n.value,2),s=i[0],u=i[1],o=t.safeContents[s],l="parameters.safeContents[".concat(s,"]"),e.t0=u.contentType,e.next=e.t0===Ri?16:e.t0===Oi?20:e.t0===Pi?30:38;break;case 16:return Nn.assert(u.content,"this.safeContents[j].content",Yr),c=u.content.getValue(),this.parsedValue.safeContents.push({privacyMode:0,value:mf.fromBER(c)}),e.abrupt("break",39);case 20:return h=new Nv({schema:u.content}),An.assert(l,o,"recipientCertificate","recipientKey"),m=(f=o).recipientCertificate,v=f.recipientKey,e.next=27,h.decrypt(0,{recipientCertificate:m,recipientPrivateKey:v},r);case 27:return d=e.sent,this.parsedValue.safeContents.push({privacyMode:2,value:mf.fromBER(d)}),e.abrupt("break",39);case 30:return g=new zh({schema:u.content}),An.assert(l,o,"password"),p=o.password,e.next=35,g.decrypt({password:p},r);case 35:return y=e.sent,this.parsedValue.safeContents.push({privacyMode:1,value:mf.fromBER(y)}),e.abrupt("break",39);case 38:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(u.contentType));case 39:e.next=9;break;case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(7),a.e(e.t1);case 46:return e.prev=46,a.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[7,43,46,49]])}))),function(e){return r.apply(this,arguments)})},{key:"makeInternalValues",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l,c,h,f,m,v,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:Lo(!0),this.parsedValue){e.next=3;break}throw new Error('Please run "parseValues" first or add "parsedValue" manually');case 3:if(Nn.assert(this.parsedValue,"this.parsedValue","object"),Nn.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),Nn.assert(t,"parameters","object"),An.assert(t,"safeContents"),Nn.assert(t.safeContents,"parameters.safeContents","Array"),t.safeContents.length===this.parsedValue.safeContents.length){e.next=10;break}throw new Nn('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');case 10:this.safeContents=[],a=C(this.parsedValue.safeContents.entries()),e.prev=12,a.s();case 14:if((n=a.n()).done){e.next=54;break}i=b(n.value,2),s=i[0],u=i[1],An.assert("content",u,"privacyMode","value"),Nn.assert(u.value,"content.value",mf),e.t0=u.privacyMode,e.next=0===e.t0?21:1===e.t0?24:2===e.t0?31:51;break;case 21:return o=u.value.toSchema().toBER(!1),this.safeContents.push(new Ac({contentType:"1.2.840.113549.1.7.1",content:new Yr({valueHex:o})})),e.abrupt("break",52);case 24:return l=new zh,(c=t.safeContents[s]).contentToEncrypt=u.value.toSchema().toBER(!1),e.next=29,l.encrypt(c,r);case 29:return this.safeContents.push(new Ac({contentType:"1.2.840.113549.1.7.6",content:l.toSchema()})),e.abrupt("break",52);case 31:h=new Nv,f=u.value.toSchema().toBER(!1),m=t.safeContents[s],An.assert("parameters.safeContents[".concat(s,"]"),m,"encryptingCertificate","encryptionAlgorithm"),e.t1=!0,e.next=e.t1===("aes-cbc"===m.encryptionAlgorithm.name.toLowerCase())||e.t1===("aes-gcm"===m.encryptionAlgorithm.name.toLowerCase())?38:39;break;case 38:return e.abrupt("break",40);case 39:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(m.encryptionAlgorithm));case 40:e.t2=!0,e.next=e.t2===(128===m.encryptionAlgorithm.length)||e.t2===(192===m.encryptionAlgorithm.length)||e.t2===(256===m.encryptionAlgorithm.length)?43:44;break;case 43:return e.abrupt("break",45);case 44:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(m.encryptionAlgorithm.length));case 45:return v=m.encryptionAlgorithm,h.addRecipientByCertificate(m.encryptingCertificate,{},void 0,r),e.next=49,h.encrypt(v,f,r);case 49:return this.safeContents.push(new Ac({contentType:"1.2.840.113549.1.7.3",content:h.toSchema()})),e.abrupt("break",52);case 51:throw new Error('Incorrect value for "content.privacyMode": '.concat(u.privacyMode));case 52:e.next=14;break;case 54:e.next=59;break;case 56:e.prev=56,e.t3=e.catch(12),a.e(e.t3);case 59:return e.prev=59,a.f(),e.finish(59);case 62:return e.abrupt("return",this);case 63:case"end":return e.stop()}}),e,this,[[12,56,59,62]])}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Av:return[];case Cv:return{};default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Av:return 0===t.length;case Cv:return t instanceof Object&&0===Object.keys(t).length;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new dn({name:t.contentInfos||Sn,value:Ac.schema()})]})}}]),n}(xn);Ev.CLASS_NAME="AuthenticatedSafe";var Iv="hashAlgorithm",Bv="issuerNameHash",Vv="issuerKeyHash",Rv="serialNumber",Dv=[Iv,Bv,Vv,Rv],Ov=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).hashAlgorithm=Gt(t,Iv,n.defaultValues(Iv)),e.issuerNameHash=Gt(t,Bv,n.defaultValues(Bv)),e.issuerKeyHash=Gt(t,Vv,n.defaultValues(Vv)),e.serialNumber=Gt(t,Rv,n.defaultValues(Rv)),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,Dv);var t=pn(e,e,n.schema({names:{hashAlgorithm:Iv,issuerNameHash:Bv,issuerKeyHash:Vv,serialNumber:Rv}}));Cn.assertSchema(t,this.className),this.hashAlgorithm=new $n({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}},{key:"toSchema",value:function(){return new wa({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}},{key:"isEqual",value:function(e){return this.hashAlgorithm.algorithmId===e.hashAlgorithm.algorithmId&&(!!Kt.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)&&(!!Kt.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)&&!!this.serialNumber.isEqual(e.serialNumber)))}},{key:"createForCertificate",value:(r=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:Lo(!0),An.assert(r,Iv,"issuerCertificate"),n=a.getOIDByAlgorithm({name:r.hashAlgorithm},!0,"hashAlgorithm"),this.hashAlgorithm=new $n({algorithmId:n,algorithmParams:new Gr}),i=r.issuerCertificate,this.serialNumber=t.serialNumber,e.next=8,a.digest({name:r.hashAlgorithm},i.subject.toSchema().toBER(!1));case 8:return s=e.sent,this.issuerNameHash=new Yr({valueHex:s}),u=i.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,e.next=13,a.digest({name:r.hashAlgorithm},u);case 13:o=e.sent,this.issuerKeyHash=new Yr({valueHex:o});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"create",value:(t=i(regeneratorRuntime.mark((function e(t,r){var a,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:Lo(!0),i=new n,e.next=4,i.createForCertificate(t,r,a);case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case Iv:return new $n;case Bv:case Vv:return new Yr;case Rv:return new oa;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Iv:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case Bv:case Vv:case Rv:return t.isEqual(n.defaultValues(Rv));default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||Sn}}),new Yr({name:t.issuerNameHash||Sn}),new Yr({name:t.issuerKeyHash||Sn}),new oa({name:t.serialNumber||Sn})]})}}]),n}(xn);Ov.CLASS_NAME="CertID";var Pv="certID",Uv="certStatus",Tv="thisUpdate",Lv="nextUpdate",Mv="singleExtensions",Hv=[Pv,Uv,Tv,Lv,Mv],_v=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).certID=Gt(a,Pv,r.defaultValues(Pv)),e.certStatus=Gt(a,Uv,r.defaultValues(Uv)),e.thisUpdate=Gt(a,Tv,r.defaultValues(Tv)),Lv in a&&(e.nextUpdate=Gt(a,Lv,r.defaultValues(Lv))),Mv in a&&(e.singleExtensions=Gt(a,Mv,r.defaultValues(Mv))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Hv);var t=pn(e,e,r.schema({names:{certID:{names:{blockName:Pv}},certStatus:Uv,thisUpdate:Tv,nextUpdate:Lv,singleExtensions:{names:{blockName:Mv}}}}));Cn.assertSchema(t,this.className),this.certID=new Ov({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Lv in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),Mv in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new rn({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[new rn({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new wa({value:Array.from(this.singleExtensions,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Pv:return new Ov;case Uv:return{};case Tv:case Lv:return new Date(0,0,0);case Mv:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Pv:return Ov.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Ov.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Ov.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Ov.compareWithDefault("serialNumber",t.serialNumber);case Uv:return 0===Object.keys(t).length;case Tv:case Lv:return t===r.defaultValues(e);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[Ov.schema(t.certID||{}),new vn({value:[new Pr({name:t.certStatus||Sn,idBlock:{tagClass:3,tagNumber:0}}),new _r({name:t.certStatus||Sn,idBlock:{tagClass:3,tagNumber:1},value:[new rn,new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new la]})]}),new Pr({name:t.certStatus||Sn,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new rn({name:t.thisUpdate||Sn}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new rn({name:t.nextUpdate||Sn})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[wl.schema(t.singleExtensions||{})]})]})}}]),r}(xn);_v.CLASS_NAME="SingleResponse";var Kv="tbs",jv="version",Jv="responderID",Fv="producedAt",Gv="responses",qv="responseExtensions",Xv="ResponseData",Wv="".concat(Xv,".").concat(jv),zv="".concat(Xv,".").concat(Jv),Qv="".concat(Xv,".").concat(Fv),Yv="".concat(Xv,".").concat(Gv),Zv="".concat(Xv,".").concat(qv),$v=[Xv,Wv,zv,Qv,Yv,Zv],ed=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).tbsView=new Uint8Array(Gt(a,Kv,r.defaultValues(Kv))),jv in a&&(e.version=Gt(a,jv,r.defaultValues(jv))),e.responderID=Gt(a,Jv,r.defaultValues(Jv)),e.producedAt=Gt(a,Fv,r.defaultValues(Fv)),e.responses=Gt(a,Gv,r.defaultValues(Gv)),qv in a&&(e.responseExtensions=Gt(a,qv,r.defaultValues(qv))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"tbs",get:function(){return Kt.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){or(e,$v);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Wv in t.result&&(this.version=t.result[Wv].valueBlock.valueDec),1===t.result[zv].idBlock.tagNumber?this.responderID=new On({schema:t.result[zv].valueBlock.value[0]}):this.responderID=t.result[zv].valueBlock.value[0],this.producedAt=t.result[Qv].toDate(),this.responses=Array.from(t.result[Yv],(function(e){return new _v({schema:e})})),Zv in t.result&&(this.responseExtensions=Array.from(t.result[Zv].valueBlock.value,(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(!this.tbsView.byteLength)return r.schema();var a=Lr(this.tbsView);Cn.assert(a,"TBS Response Data"),e=a.result}else{var n=[];jv in this&&n.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[new oa({value:this.version})]})),this.responderID instanceof On?n.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):n.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),n.push(new rn({valueDate:this.producedAt})),n.push(new wa({value:Array.from(this.responses,(function(e){return e.toSchema()}))})),this.responseExtensions&&n.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[new wa({value:Array.from(this.responseExtensions,(function(e){return e.toSchema()}))})]})),e=new wa({value:n})}return e}},{key:"toJSON",value:function(){var e={};return jv in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,(function(e){return e.toJSON()}))),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case jv:return 0;case Kv:return bn;case Jv:return{};case Fv:return new Date(0,0,0);case Gv:case qv:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kv:return 0===t.byteLength;case Jv:return 0===Object.keys(t).length;case Fv:return t===r.defaultValues(e);case Gv:case qv:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Xv,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new oa({name:t.version||Wv})]}),new vn({value:[new _r({name:t.responderID||zv,idBlock:{tagClass:3,tagNumber:1},value:[On.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new _r({name:t.responderID||zv,idBlock:{tagClass:3,tagNumber:2},value:[new Yr({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new rn({name:t.producedAt||Qv}),new wa({value:[new dn({name:Yv,value:_v.schema(t.response||{})})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[wl.schema(t.extensions||{names:{blockName:Zv}})]})]})}}]),r}(xn);ed.CLASS_NAME="ResponseData";var td,rd="trustedCerts",ad="certs",nd="crls",id="ocsps",sd="checkDate",ud="findOrigin",od="findIssuer";!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.noRevocation=11]="noRevocation",e[e.noPath=60]="noPath",e[e.noValidPath=97]="noValidPath"}(td||(td={}));var ld=function(e){c(r,e);var t=y(r);function r(e,a){var n;return s(this,r),(n=t.call(this,a)).name=r.NAME,n.code=e,n.message=a,n}return o(r)}(d(Error));function cd(e,t){for(var r=0;r<t.length;r++)if(Kt.isEqual(e.tbsView,t[r].tbsView))return!0;return!1}ld.NAME="ChainValidationError";var hd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),this.trustedCerts=Gt(t,rd,this.defaultValues(rd)),this.certs=Gt(t,ad,this.defaultValues(ad)),this.crls=Gt(t,nd,this.defaultValues(nd)),this.ocsps=Gt(t,id,this.defaultValues(id)),this.checkDate=Gt(t,sd,this.defaultValues(sd)),this.findOrigin=Gt(t,ud,this.defaultValues(ud)),this.findIssuer=Gt(t,od,this.defaultValues(od))}var t,r,n;return o(e,[{key:"defaultFindIssuer",value:(n=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(e){if(null!==i&&e.extensions){var r,a=!1,o=C(e.extensions);try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l.extnID===vi&&l.parsedValue){a=!0,Kt.isEqual(l.parsedValue.valueBlock.valueHex,i.valueBlock.valueHexView)&&n.push(e);break}}}catch(e){o.e(e)}finally{o.f()}if(a)return}var c=!1;null!==u&&(c=e.serialNumber.isEqual(u)),null!==s?e.subject.isEqual(s)&&c&&n.push(e):t.issuer.isEqual(e.subject)&&n.push(e)},a=k.length>2&&void 0!==k[2]?k[2]:Lo(!0),n=[],i=null,s=null,u=null,!t.subject.isEqual(t.issuer)){e.next=17;break}return e.prev=7,e.next=10,t.verify(void 0,a);case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",[t]);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(7);case 17:if(!t.extensions){e.next=36;break}o=C(t.extensions),e.prev=19,o.s();case 21:if((l=o.n()).done){e.next=28;break}if(!((c=l.value).extnID===Ei&&c.parsedValue instanceof Gi)){e.next=26;break}return c.parsedValue.keyIdentifier?i=c.parsedValue.keyIdentifier:(c.parsedValue.authorityCertIssuer&&(s=c.parsedValue.authorityCertIssuer),c.parsedValue.authorityCertSerialNumber&&(u=c.parsedValue.authorityCertSerialNumber)),e.abrupt("break",28);case 26:e.next=21;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(19),o.e(e.t1);case 33:return e.prev=33,o.f(),e.finish(33);case 36:f=C(r.trustedCerts);try{for(f.s();!(m=f.n()).done;)v=m.value,h(v)}catch(e){f.e(e)}finally{f.f()}d=C(r.certs);try{for(d.s();!(g=d.n()).done;)p=g.value,h(p)}catch(e){d.e(e)}finally{d.f()}y=0;case 41:if(!(y<n.length)){e.next=55;break}return e.prev=42,e.next=45,t.verify(n[y],a);case 45:!1===e.sent&&n.splice(y,1),e.next=52;break;case 49:e.prev=49,e.t2=e.catch(42),n.splice(y,1);case 52:y++,e.next=41;break;case 55:return e.abrupt("return",n);case 56:case"end":return e.stop()}}),e,null,[[7,15],[19,30,33,36],[42,49]])}))),function(e,t){return n.apply(this,arguments)})},{key:"defaultValues",value:function(t){switch(t){case rd:case ad:case nd:case id:return[];case sd:return new Date;case ud:return e.defaultFindOrigin;case od:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(t))}}},{key:"sort",value:(r=i(regeneratorRuntime.mark((function e(){var t,r,a,n,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,N,A,x,E,I=this,B=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=function(){return l=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o,l,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]&&c[1],a=!1,n=!1,i=!1,s=!1,!t.extensions){e.next=22;break}u=0;case 7:if(!(u<t.extensions.length)){e.next=16;break}if(!(o=t.extensions[u]).critical||o.parsedValue){e.next=11;break}return e.abrupt("return",{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(o.extnID)});case 11:o.extnID===di&&(i=!0,4==(4&(l=new Uint8Array(o.parsedValue.valueBlock.valueHex))[0])&&(n=!0),2==(2&l[0])&&(s=!0)),o.extnID===yi&&"cA"in o.parsedValue&&!0===o.parsedValue.cA&&(a=!0);case 13:u++,e.next=7;break;case 16:if(!0!==n||!1!==a){e.next=18;break}return e.abrupt("return",{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'});case 18:if(!0!==i||!0!==a||!1!==n){e.next=20;break}return e.abrupt("return",{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'});case 20:if(!0!==a||!0!==i||!r||!1!==s){e.next=22;break}return e.abrupt("return",{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'});case 22:if(!1!==a){e.next=24;break}return e.abrupt("return",{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"});case 24:return e.abrupt("return",{result:!0,resultCode:0,resultMessage:Sn});case 25:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)},o=function(e){return l.apply(this,arguments)},t=B.length>0&&void 0!==B[0]&&B[0],r=B.length>1&&void 0!==B[1]?B[1]:Lo(!0),a=[],n=function(){var e=i(regeneratorRuntime.mark((function e(t,r){var a,i,s,u,o,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(e){for(var t=!0,r=0;r<e.length;r++){for(var a=0;a<e.length;a++)if(a!==r&&e[r]===e[a]){t=!1;break}if(!t)break}return t},a=[],!cd(t,I.trustedCerts)){e.next=4;break}return e.abrupt("return",[[t]]);case 4:return e.next=6,I.findIssuer(t,I,r);case 6:if(0!==(s=e.sent).length){e.next=9;break}throw new Error("No valid certificate paths found");case 9:u=0;case 10:if(!(u<s.length)){e.next=21;break}if(!Kt.isEqual(s[u].tbsView,t.tbsView)){e.next=14;break}return a.push([s[u]]),e.abrupt("continue",18);case 14:return e.next=16,n(s[u],r);case 16:for(o=e.sent,l=0;l<o.length;l++)(c=o[l].slice()).splice(0,0,s[u]),i(c)?a.push(c):a.push(o[l]);case 18:u++,e.next=10;break;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),s=function(){var e=i(regeneratorRuntime.mark((function e(t){var n,i,s,u,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s=[],(n=[]).push.apply(n,S(a.filter((function(e){return t.issuer.isEqual(e.subject)})))),0!==n.length){e.next=6;break}return e.abrupt("return",{status:1,statusMessage:"No certificate's issuers"});case 6:if(i.push.apply(i,S(I.crls.filter((function(e){return e.issuer.isEqual(t.issuer)})))),0!==i.length){e.next=9;break}return e.abrupt("return",{status:2,statusMessage:"No CRLs for specific certificate issuer"});case 9:u=0;case 10:if(!(u<i.length)){e.next=33;break}if(!((o=i[u]).nextUpdate&&o.nextUpdate.value<I.checkDate)){e.next=14;break}return e.abrupt("continue",30);case 14:l=0;case 15:if(!(l<n.length)){e.next=30;break}return e.prev=16,e.next=19,i[u].verify({issuerCertificate:n[l]},r);case 19:if(!e.sent){e.next=23;break}return s.push({crl:i[u],certificate:n[l]}),e.abrupt("break",30);case 23:e.next=27;break;case 25:e.prev=25,e.t0=e.catch(16);case 27:l++,e.next=15;break;case 30:u++,e.next=10;break;case 33:if(!s.length){e.next=35;break}return e.abrupt("return",{status:0,statusMessage:Sn,result:s});case 35:return e.abrupt("return",{status:3,statusMessage:"No valid CRLs found"});case 36:case"end":return e.stop()}}),e,null,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=i(regeneratorRuntime.mark((function e(t,a){var n,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r.getAlgorithmByOID(t.signatureAlgorithm.algorithmId)).name){e.next=3;break}return e.abrupt("return",1);case 3:if(n.hash){e.next=5;break}return e.abrupt("return",1);case 5:i=0;case 6:if(!(i<I.ocsps.length)){e.next=18;break}return s=I.ocsps[i],e.next=10,s.getCertificateStatus(t,a,r);case 10:if(!(u=e.sent).isForCertificate){e.next=15;break}if(0!==u.status){e.next=14;break}return e.abrupt("return",0);case 14:return e.abrupt("return",1);case 15:i++,e.next=6;break;case 18:return e.abrupt("return",2);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),c=function(){var e=i(regeneratorRuntime.mark((function e(r,a){var n,i,l,c,h,f,m,v,d,g,p,y,k,w,S,N;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<r.length)){e.next=7;break}if(!(r[n].notBefore.value>a||r[n].notAfter.value<a)){e.next=4;break}return e.abrupt("return",{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"});case 4:n++,e.next=1;break;case 7:if(!(r.length<2)){e.next=9;break}return e.abrupt("return",{result:!1,resultCode:9,resultMessage:"Too short certificate path"});case 9:i=r.length-2;case 10:if(!(i>=0)){e.next=17;break}if(!1!==r[i].issuer.isEqual(r[i].subject)){e.next=14;break}if(!1!==r[i].issuer.isEqual(r[i+1].subject)){e.next=14;break}return e.abrupt("return",{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"});case 14:i--,e.next=10;break;case 17:if(0===I.crls.length&&0===I.ocsps.length){e.next=86;break}l=0;case 19:if(!(l<r.length-1)){e.next=86;break}if(c=2,h={status:0,statusMessage:Sn},0===I.ocsps.length){e.next=31;break}return e.next=25,u(r[l],r[l+1]);case 25:c=e.sent,e.t0=c,e.next=0===e.t0?29:1===e.t0?30:31;break;case 29:return e.abrupt("continue",83);case 30:return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"});case 31:if(0===I.crls.length){e.next=55;break}return e.next=34,s(r[l]);case 34:if(0!==(h=e.sent).status||!h.result){e.next=51;break}f=0;case 37:if(!(f<h.result.length)){e.next=49;break}if(!h.result[f].crl.isCertificateRevoked(r[l])){e.next=41;break}return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"});case 41:return e.next=43,o(h.result[f].certificate,!0);case 43:if(!1!==e.sent.result){e.next=46;break}return e.abrupt("return",{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"});case 46:f++,e.next=37;break;case 49:e.next=53;break;case 51:if(!1!==t){e.next=53;break}throw new ld(td.noRevocation,"No revocation values found for one of certificates: ".concat(h.statusMessage));case 53:e.next=57;break;case 55:if(2!==c){e.next=57;break}return e.abrupt("return",{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"});case 57:if(2!==c||2!==h.status||!t){e.next=83;break}if(m=r[l+1],v=!1,!m.extensions){e.next=81;break}d=C(m.extensions),e.prev=62,d.s();case 64:if((g=d.n()).done){e.next=73;break}p=g.value,e.t1=p.extnID,e.next=e.t1===Si||e.t1===Ni||e.t1===Vi?69:71;break;case 69:return v=!0,e.abrupt("break",71);case 71:e.next=64;break;case 73:e.next=78;break;case 75:e.prev=75,e.t2=e.catch(62),d.e(e.t2);case 78:return e.prev=78,d.f(),e.finish(78);case 81:if(!v){e.next=83;break}throw new ld(td.noRevocation,"No revocation values found for one of certificates: ".concat(h.statusMessage));case 83:l++,e.next=19;break;case 86:y=C(r.entries()),e.prev=87,y.s();case 89:if((k=y.n()).done){e.next=100;break}if(w=b(k.value,2),S=w[0],N=w[1],S){e.next=93;break}return e.abrupt("continue",98);case 93:return e.next=95,o(N);case 95:if(e.sent.result){e.next=98;break}return e.abrupt("return",{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"});case 98:e.next=89;break;case 100:e.next=105;break;case 102:e.prev=102,e.t3=e.catch(87),y.e(e.t3);case 105:return e.prev=105,y.f(),e.finish(105);case 108:return e.abrupt("return",{result:!0});case 109:case"end":return e.stop()}}),e,null,[[62,75,78,81],[87,102,105,108]])})));return function(t,r){return e.apply(this,arguments)}}(),a.push.apply(a,S(this.trustedCerts)),a.push.apply(a,S(this.certs)),h=0;case 12:if(!(h<a.length)){e.next=27;break}f=0;case 14:if(!(f<a.length)){e.next=24;break}if(h!==f){e.next=17;break}return e.abrupt("continue",21);case 17:if(!Kt.isEqual(a[h].tbsView,a[f].tbsView)){e.next=21;break}return a.splice(f,1),h=0,e.abrupt("break",24);case 21:f++,e.next=14;break;case 24:h++,e.next=12;break;case 27:return m=a[a.length-1],d=[m],e.next=31,n(m,r);case 31:if(0!==(v=e.sent).length){e.next=34;break}throw new ld(td.noPath,"Unable to find certificate path");case 34:g=0;case 35:if(!(g<v.length)){e.next=57;break}p=!1,y=0;case 38:if(!(y<v[g].length)){e.next=53;break}k=v[g][y],w=0;case 41:if(!(w<this.trustedCerts.length)){e.next=48;break}if(!Kt.isEqual(k.tbsView,this.trustedCerts[w].tbsView)){e.next=45;break}return p=!0,e.abrupt("break",48);case 45:w++,e.next=41;break;case 48:if(!p){e.next=50;break}return e.abrupt("break",53);case 50:y++,e.next=38;break;case 53:p||(v.splice(g,1),g=0);case 54:g++,e.next=35;break;case 57:if(0!==v.length){e.next=59;break}throw new ld(td.noValidPath,"No valid certificate paths found");case 59:for(N=v[0].length,A=0,x=0;x<v.length;x++)v[x].length<N&&(N=v[x].length,A=x);for(E=0;E<v[A].length;E++)d.push(v[A][E]);return e.next=65,c(d,this.checkDate);case 65:if(!1!==(v=e.sent).result){e.next=68;break}throw v;case 68:return e.abrupt("return",d);case 69:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,N,A,C,x,E,I,B,V,R,D,O,P,U,T,L,M,H,_,K,j,J,F,G,q,X,W,z,Q,Y,Z,$,ee,te,re,ae,ne,ie,se,ue,oe,le,ce,he,fe,me,ve,de,ge,pe,ye,ke,we,be,Se,Ne,Ae,Ce,xe,Ee,Ie,Be,Ve,Re,De,Oe,Pe,Ue,Te,Le,Me,He,_e=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;for(var r=!0,a=0,n=0;n<t.typesAndValues.length;n++){for(var i=!1,s=a;s<e.typesAndValues.length;s++)if(i=e.typesAndValues[s].isEqual(t.typesAndValues[n]),e.typesAndValues[s].type===t.typesAndValues[n].type&&(r=r&&i),!0===i){if(0===a||a===s){a=s+1;break}return!1}if(!1===i)return!1}return 0!==a&&r},u=function(e,t){var r=e.valueBlock.valueHexView,a=t.valueBlock.valueHexView;if(4===r.length&&8===a.length){for(var n=0;n<4;n++)if((r[n]^a[n])&a[n+4])return!1;return!0}if(16===r.length&&32===a.length){for(var i=0;i<16;i++)if((r[i]^a[i])&a[i+16])return!1;return!0}return!1},s=function(e,t){var r=En(e),a=En(t),i=r.split("/");if(a.split("/").length>1)return!1;if(i.length>1)for(var s=0;s<i.length;s++)if(i[s].length>0&&":"!==i[s].charAt(i[s].length-1)){r=i[s].split(":")[0];break}if(n(r,a)){var u=r.split("."),o=a.split(".");return 0===o[0].length||u.length===o.length}return!1},i=function(e,t){var r=En(e),a=En(t),i=r.split("@"),s=a.split("@");if(0===i.length||0===s.length||i.length<s.length)return!1;if(1===s.length){if(n(i[1],s[0])){var u=i[1].split("."),o=s[0].split(".");return 0===o[0].length||u.length===o.length}return!1}return 0===r.localeCompare(a)},n=function(e,t){var r=En(e),a=En(t),n=r.split("."),i=a.split("."),s=n.length,u=i.length;if(0===s||0===u||s<u)return!1;for(var o=0;o<s;o++)if(0===n[o].length)return!1;for(var l=0;l<u;l++)if(0===i[l].length){if(0===l){if(1===u)return!1;continue}return!1}for(var c=0;c<u;c++)if(0!==i[u-1-c].length&&0!==n[s-1-c].localeCompare(i[u-1-c]))return!1;return!0},t=_e.length>0&&void 0!==_e[0]?_e[0]:{},r=_e.length>1&&void 0!==_e[1]?_e[1]:Lo(!0),e.prev=7,0!==this.certs.length){e.next=10;break}throw new Error("Empty certificate array");case 10:return l=t.passedWhenNotRevValues||!1,c=t.initialPolicySet||[Ci],h=t.initialExplicitPolicy||!1,f=t.initialPolicyMappingInhibit||!1,m=t.initialInhibitPolicy||!1,v=t.initialPermittedSubtreesSet||[],d=t.initialExcludedSubtreesSet||[],g=t.initialRequiredNameForms||[],p=h,y=f,k=m,w=[!1,!1,!1],b=0,S=0,N=0,A=v,C=d,x=g,e.next=31,this.sort(l,r);case 31:for(this.certs=e.sent,(E=[]).push(Ci),I=[],B=new Array(this.certs.length-1),V=0;V<this.certs.length-1;V++)B[V]=!0;I.push(B),R=new Array(this.certs.length-1),D=new Array(this.certs.length-1),O=p?this.certs.length-1:-1,P=this.certs.length-2;case 42:if(!(P>=0)){e.next=100;break}if(!(U=this.certs[P]).extensions){e.next=97;break}T=0;case 46:if(!(T<U.extensions.length)){e.next=83;break}if((L=U.extensions[T]).extnID!==Ai){e.next=74;break}D[P]=L.parsedValue,M=0;case 51:if(!(M<E.length)){e.next=58;break}if(E[M]!==Ci){e.next=55;break}return delete I[M][P],e.abrupt("break",58);case 55:M++,e.next=51;break;case 58:H=0;case 59:if(!(H<L.parsedValue.certificatePolicies.length)){e.next=74;break}_=-1,K=L.parsedValue.certificatePolicies[H].policyIdentifier,j=0;case 63:if(!(j<E.length)){e.next=70;break}if(K!==E[j]){e.next=67;break}return _=j,e.abrupt("break",70);case 67:j++,e.next=63;break;case 70:-1===_?(E.push(K),(J=new Array(this.certs.length-1))[P]=!0,I.push(J)):I[_][P]=!0;case 71:H++,e.next=59;break;case 74:if(L.extnID!==xi){e.next=78;break}if(!y){e.next=77;break}return e.abrupt("return",{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"});case 77:R[P]=L.parsedValue;case 78:L.extnID===Ii&&!1===p&&(0===L.parsedValue.requireExplicitPolicy?(p=!0,O=P):!1===w[0]?(w[0]=!0,b=L.parsedValue.requireExplicitPolicy):b=b>L.parsedValue.requireExplicitPolicy?L.parsedValue.requireExplicitPolicy:b,0===L.parsedValue.inhibitPolicyMapping?y=!0:!1===w[1]?(w[1]=!0,S=L.parsedValue.inhibitPolicyMapping+1):S=S>L.parsedValue.inhibitPolicyMapping+1?L.parsedValue.inhibitPolicyMapping+1:S),L.extnID===Bi&&!1===k&&(0===L.parsedValue.valueBlock.valueDec?k=!0:!1===w[2]?(w[2]=!0,N=L.parsedValue.valueBlock.valueDec):N=N>L.parsedValue.valueBlock.valueDec?L.parsedValue.valueBlock.valueDec:N);case 80:T++,e.next=46;break;case 83:if(!0!==k){e.next=94;break}F=-1,G=0;case 86:if(!(G<E.length)){e.next=93;break}if(E[G]!==Ci){e.next=90;break}return F=G,e.abrupt("break",93);case 90:G++,e.next=86;break;case 93:-1!==F&&delete I[0][P];case 94:!1===p&&!0===w[0]&&0==--b&&(p=!0,O=P,w[0]=!1),!1===y&&!0===w[1]&&0==--S&&(y=!0,w[1]=!1),!1===k&&!0===w[2]&&0==--N&&(k=!0,w[2]=!1);case 97:P--,e.next=42;break;case 100:q=0;case 101:if(!(q<this.certs.length-1)){e.next=118;break}if(!(q<this.certs.length-2&&void 0!==R[q+1])){e.next=115;break}X=0;case 104:if(!(X<R[q+1].mappings.length)){e.next=115;break}if(R[q+1].mappings[X].issuerDomainPolicy!==Ci&&R[q+1].mappings[X].subjectDomainPolicy!==Ci){e.next=107;break}return e.abrupt("return",{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'});case 107:for(W=-1,z=-1,Q=0;Q<E.length;Q++)E[Q]===R[q+1].mappings[X].issuerDomainPolicy&&(W=Q),E[Q]===R[q+1].mappings[X].subjectDomainPolicy&&(z=Q);for(void 0!==I[W][q]&&delete I[W][q],Y=0;Y<D[q].certificatePolicies.length;Y++)if(R[q+1].mappings[X].subjectDomainPolicy===D[q].certificatePolicies[Y].policyIdentifier&&-1!==W&&-1!==z)for(Z=0;Z<=q;Z++)void 0!==I[z][Z]&&(I[W][Z]=!0,delete I[z][Z]);case 112:X++,e.next=104;break;case 115:q++,e.next=101;break;case 118:for($=0;$<E.length;$++)if(E[$]===Ci)for(ee=0;ee<O;ee++)delete I[$][ee];te=[],re=0;case 121:if(!(re<I.length)){e.next=149;break}ae=!0,ne=0;case 124:if(!(ne<this.certs.length-1)){e.next=145;break}if(ie=!1,!(ne<O&&E[re]===Ci&&E.length>1)){e.next=129;break}return ae=!1,e.abrupt("break",145);case 129:if(void 0!==I[re][ne]){e.next=142;break}if(!(ne>=O)){e.next=139;break}se=0;case 132:if(!(se<E.length)){e.next=139;break}if(E[se]!==Ci){e.next=136;break}return!0===I[se][ne]&&(ie=!0),e.abrupt("break",139);case 136:se++,e.next=132;break;case 139:if(ie){e.next=142;break}return ae=!1,e.abrupt("break",145);case 142:ne++,e.next=124;break;case 145:!0===ae&&te.push(E[re]);case 146:re++,e.next=121;break;case 149:if(ue=[],1!==c.length||c[0]!==Ci||!1!==p){e.next=154;break}ue=c,e.next=171;break;case 154:if(1!==te.length||te[0]!==Ci){e.next=158;break}ue=c,e.next=171;break;case 158:oe=0;case 159:if(!(oe<te.length)){e.next=171;break}le=0;case 161:if(!(le<c.length)){e.next=168;break}if(c[le]!==te[oe]&&c[le]!==Ci){e.next=165;break}return ue.push(te[oe]),e.abrupt("break",168);case 165:le++,e.next=161;break;case 168:oe++,e.next=159;break;case 171:if(ce={result:ue.length>0,resultCode:0,resultMessage:ue.length>0?Sn:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:te,userConstrPolicies:ue,explicitPolicyIndicator:p,policyMappings:R,certificatePath:this.certs},0!==ue.length){e.next=174;break}return e.abrupt("return",ce);case 174:if(!1!==ce.result){e.next=176;break}return e.abrupt("return",ce);case 176:he=this.certs.length-2;case 178:if(!(he>=0)){e.next=296;break}if(fe=this.certs[he],me=[],ve=[],de=[],fe.extensions)for(ge=0;ge<fe.extensions.length;ge++)(pe=fe.extensions[ge]).extnID===bi&&("permittedSubtrees"in pe.parsedValue&&(ve=ve.concat(pe.parsedValue.permittedSubtrees)),"excludedSubtrees"in pe.parsedValue&&(de=de.concat(pe.parsedValue.excludedSubtrees))),pe.extnID===gi&&(me=me.concat(pe.parsedValue.altNames));ye=x.length<=0,ke=0;case 186:if(!(ke<x.length)){e.next=207;break}e.t0=x[ke].base.type,e.next=4===e.t0?190:204;break;case 190:if(x[ke].base.value.typesAndValues.length===fe.subject.typesAndValues.length){e.next=192;break}return e.abrupt("continue",204);case 192:ye=!0,we=0;case 194:if(!(we<fe.subject.typesAndValues.length)){e.next=201;break}if(fe.subject.typesAndValues[we].type===x[ke].base.value.typesAndValues[we].type){e.next=198;break}return ye=!1,e.abrupt("break",201);case 198:we++,e.next=194;break;case 201:if(!0!==ye){e.next=203;break}return e.abrupt("break",204);case 203:return e.abrupt("break",204);case 204:ke++,e.next=186;break;case 207:if(!1!==ye){e.next=212;break}throw ce.result=!1,ce.resultCode=21,ce.resultMessage="No necessary name form found",ce;case 212:be=[[],[],[],[],[]],Se=0;case 214:if(!(Se<A.length)){e.next=231;break}e.t1=A[Se].base.type,e.next=1===e.t1?218:2===e.t1?220:4===e.t1?222:6===e.t1?224:7===e.t1?226:228;break;case 218:return be[0].push(A[Se]),e.abrupt("break",228);case 220:return be[1].push(A[Se]),e.abrupt("break",228);case 222:return be[2].push(A[Se]),e.abrupt("break",228);case 224:return be[3].push(A[Se]),e.abrupt("break",228);case 226:return be[4].push(A[Se]),e.abrupt("break",228);case 228:Se++,e.next=214;break;case 231:Ne=0;case 232:if(!(Ne<5)){e.next=265;break}Ae=!1,Ce=!1,xe=be[Ne],Ee=0;case 237:if(!(Ee<xe.length)){e.next=257;break}e.t2=Ne,e.next=0===e.t2?241:1===e.t2?243:2===e.t2?245:3===e.t2?248:4===e.t2?250:252;break;case 241:if(me.length>0)for(Ie=0;Ie<me.length;Ie++)1===me[Ie].type&&(Ce=!0,Ae=Ae||i(me[Ie].value,xe[Ee].base.value));else for(Be=0;Be<fe.subject.typesAndValues.length;Be++)"1.2.840.113549.1.9.1"!==fe.subject.typesAndValues[Be].type&&"0.9.2342.19200300.100.1.3"!==fe.subject.typesAndValues[Be].type||(Ce=!0,Ae=Ae||i(fe.subject.typesAndValues[Be].value.valueBlock.value,xe[Ee].base.value));return e.abrupt("break",252);case 243:if(me.length>0)for(Ve=0;Ve<me.length;Ve++)2===me[Ve].type&&(Ce=!0,Ae=Ae||n(me[Ve].value,xe[Ee].base.value));return e.abrupt("break",252);case 245:return Ce=!0,Ae=o(fe.subject,xe[Ee].base.value),e.abrupt("break",252);case 248:if(me.length>0)for(Re=0;Re<me.length;Re++)6===me[Re].type&&(Ce=!0,Ae=Ae||s(me[Re].value,xe[Ee].base.value));return e.abrupt("break",252);case 250:if(me.length>0)for(De=0;De<me.length;De++)7===me[De].type&&(Ce=!0,Ae=Ae||u(me[De].value,xe[Ee].base.value));return e.abrupt("break",252);case 252:if(!Ae){e.next=254;break}return e.abrupt("break",257);case 254:Ee++,e.next=237;break;case 257:if(!(!1===Ae&&xe.length>0&&Ce)){e.next=262;break}throw ce.result=!1,ce.resultCode=41,ce.resultMessage='Failed to meet "permitted sub-trees" name constraint',ce;case 262:Ne++,e.next=232;break;case 265:Oe=!1,Pe=0;case 267:if(!(Pe<C.length)){e.next=286;break}e.t3=C[Pe].base.type,e.next=1===e.t3?271:2===e.t3?273:4===e.t3?275:6===e.t3?277:7===e.t3?279:281;break;case 271:if(me.length>=0)for(Ue=0;Ue<me.length;Ue++)1===me[Ue].type&&(Oe=Oe||i(me[Ue].value,C[Pe].base.value));else for(Te=0;Te<fe.subject.typesAndValues.length;Te++)"1.2.840.113549.1.9.1"!==fe.subject.typesAndValues[Te].type&&"0.9.2342.19200300.100.1.3"!==fe.subject.typesAndValues[Te].type||(Oe=Oe||i(fe.subject.typesAndValues[Te].value.valueBlock.value,C[Pe].base.value));return e.abrupt("break",281);case 273:if(me.length>0)for(Le=0;Le<me.length;Le++)2===me[Le].type&&(Oe=Oe||n(me[Le].value,C[Pe].base.value));return e.abrupt("break",281);case 275:return Oe=Oe||o(fe.subject,C[Pe].base.value),e.abrupt("break",281);case 277:if(me.length>0)for(Me=0;Me<me.length;Me++)6===me[Me].type&&(Oe=Oe||s(me[Me].value,C[Pe].base.value));return e.abrupt("break",281);case 279:if(me.length>0)for(He=0;He<me.length;He++)7===me[He].type&&(Oe=Oe||u(me[He].value,C[Pe].base.value));return e.abrupt("break",281);case 281:if(!Oe){e.next=283;break}return e.abrupt("break",286);case 283:Pe++,e.next=267;break;case 286:if(!0!==Oe){e.next=291;break}throw ce.result=!1,ce.resultCode=42,ce.resultMessage='Failed to meet "excluded sub-trees" name constraint',ce;case 291:A=A.concat(ve),C=C.concat(de);case 293:he--,e.next=178;break;case 296:return e.abrupt("return",ce);case 299:if(e.prev=299,e.t4=e.catch(7),!(e.t4 instanceof Error)){e.next=305;break}if(!(e.t4 instanceof ld)){e.next=304;break}return e.abrupt("return",{result:!1,resultCode:e.t4.code,resultMessage:e.t4.message,error:e.t4});case 304:return e.abrupt("return",{result:!1,resultCode:td.unknown,resultMessage:e.t4.message,error:e.t4});case 305:if(!e.t4||"object"!==a(e.t4)||!("resultMessage"in e.t4)){e.next=307;break}return e.abrupt("return",e.t4);case 307:return e.abrupt("return",{result:!1,resultCode:-1,resultMessage:"".concat(e.t4)});case 308:case"end":return e.stop()}}),e,this,[[7,299]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultFindOrigin",value:function(e,t){0===e.tbsView.byteLength&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));var r,a=C(t.certs);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(0===n.tbsView.byteLength&&(n.tbsView=new Uint8Array(n.encodeTBS().toBER())),Kt.isEqual(e.tbsView,n.tbsView))return"Intermediate Certificates"}}catch(e){a.e(e)}finally{a.f()}var i,s=C(t.trustedCerts);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(0===u.tbsView.byteLength&&(u.tbsView=new Uint8Array(u.encodeTBS().toBER())),Kt.isEqual(e.tbsView,u.tbsView))return"Trusted Certificates"}}catch(e){s.e(e)}finally{s.f()}return"Unknown"}}]),e}(),fd="tbsResponseData",md="signatureAlgorithm",vd="signature",dd="certs",gd="BasicOCSPResponse",pd="".concat(gd,".").concat(fd),yd="".concat(gd,".").concat(md),kd="".concat(gd,".").concat(vd),wd="".concat(gd,".").concat(dd),bd=[pd,yd,kd,wd],Sd=function(e){c(u,e);var t,r,a,n=y(u);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,u),(e=n.call(this)).tbsResponseData=Gt(t,fd,u.defaultValues(fd)),e.signatureAlgorithm=Gt(t,md,u.defaultValues(md)),e.signature=Gt(t,vd,u.defaultValues(vd)),dd in t&&(e.certs=Gt(t,dd,u.defaultValues(dd))),t.schema&&e.fromSchema(t.schema),e}return o(u,[{key:"fromSchema",value:function(e){or(e,bd);var t=pn(e,e,u.schema());Cn.assertSchema(t,this.className),this.tbsResponseData=new ed({schema:t.result[pd]}),this.signatureAlgorithm=new $n({schema:t.result[yd]}),this.signature=t.result[kd],wd in t.result&&(this.certs=Array.from(t.result[wd],(function(e){return new sh({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[new wa({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}},{key:"getCertificateStatus",value:(a=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=y.length>2&&void 0!==y[2]?y[2]:Lo(!0),n={isForCertificate:!1,status:2},i={},s=[],u=C(this.tbsResponseData.responses),e.prev=5,u.s();case 7:if((o=u.n()).done){e.next=18;break}if(l=o.value,c=a.getAlgorithmByOID(l.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm"),i[c.name]){e.next=16;break}return i[c.name]=1,h=new Ov,s.push(h),e.next=16,h.createForCertificate(t,{hashAlgorithm:c.name,issuerCertificate:r},a);case 16:e.next=7;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:f=C(this.tbsResponseData.responses),e.prev=27,f.s();case 29:if((m=f.n()).done){e.next=69;break}v=m.value,d=C(s),e.prev=32,d.s();case 34:if((g=d.n()).done){e.next=59;break}if(p=g.value,!v.certID.isEqual(p)){e.next=57;break}n.isForCertificate=!0,e.prev=38,e.t1=v.certStatus.idBlock.isConstructed,e.next=!0===e.t1?42:!1===e.t1?44:52;break;case 42:return 1===v.certStatus.idBlock.tagNumber&&(n.status=1),e.abrupt("break",52);case 44:e.t2=v.certStatus.idBlock.tagNumber,e.next=0===e.t2?47:2===e.t2?49:51;break;case 47:return n.status=0,e.abrupt("break",51);case 49:return n.status=2,e.abrupt("break",51);case 51:return e.abrupt("break",52);case 52:e.next=56;break;case 54:e.prev=54,e.t3=e.catch(38);case 56:return e.abrupt("return",n);case 57:e.next=34;break;case 59:e.next=64;break;case 61:e.prev=61,e.t4=e.catch(32),d.e(e.t4);case 64:return e.prev=64,d.f(),e.finish(64);case 67:e.next=29;break;case 69:e.next=74;break;case 71:e.prev=71,e.t5=e.catch(27),f.e(e.t5);case 74:return e.prev=74,f.f(),e.finish(74);case 77:return e.abrupt("return",n);case 78:case"end":return e.stop()}}),e,this,[[5,20,23,26],[27,71,74,77],[32,61,64,67],[38,54]])}))),function(e,t){return a.apply(this,arguments)})},{key:"sign",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:Lo(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:if(n=e.sent,"name"in(i=n.parameters.algorithm)){e.next=10;break}throw new Error("Empty algorithm");case 10:return this.signatureAlgorithm=n.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER()),e.next=14,a.signWithPrivateKey(this.tbsResponseData.tbsView,t,{algorithm:i});case 14:s=e.sent,this.signature=new ta({valueHex:s});case 16:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,S=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.length>0&&void 0!==S[0]?S[0]:{},r=S.length>1&&void 0!==S[1]?S[1]:Lo(!0),a=null,n=-1,i=t.trustedCerts||[],this.certs){e.next=7;break}throw new Error("No certificates attached to the BasicOCSPResponse");case 7:e.t0=!0,e.next=e.t0===this.tbsResponseData.responderID instanceof On?10:e.t0===this.tbsResponseData.responderID instanceof Yr?29:51;break;case 10:s=C(this.certs.entries()),e.prev=11,s.s();case 13:if((u=s.n()).done){e.next=20;break}if(o=b(u.value,2),l=o[0],!o[1].subject.isEqual(this.tbsResponseData.responderID)){e.next=18;break}return n=l,e.abrupt("break",20);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(11),s.e(e.t1);case 25:return e.prev=25,s.f(),e.finish(25);case 28:return e.abrupt("break",52);case 29:c=C(this.certs.entries()),e.prev=30,c.s();case 32:if((h=c.n()).done){e.next=42;break}return f=b(h.value,2),m=f[0],v=f[1],e.next=36,r.digest({name:"sha-1"},v.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 36:if(!$t(e.sent,this.tbsResponseData.responderID.valueBlock.valueHex)){e.next=40;break}return n=m,e.abrupt("break",42);case 40:e.next=32;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e.catch(30),c.e(e.t2);case 47:return e.prev=47,c.f(),e.finish(47);case 50:return e.abrupt("break",52);case 51:throw new Error("Wrong value for responderID");case 52:if(-1!==n){e.next=54;break}throw new Error("Correct certificate was not found in OCSP response");case 54:a=this.certs[n],d=[a],g=C(this.certs),e.prev=57,g.s();case 59:if((p=g.n()).done){e.next=67;break}return y=p.value,e.next=63,uh(y,a);case 63:(k=e.sent)&&d.push(k);case 65:e.next=59;break;case 67:e.next=72;break;case 69:e.prev=69,e.t3=e.catch(57),g.e(e.t3);case 72:return e.prev=72,g.f(),e.finish(72);case 75:return w=new hd({certs:d,trustedCerts:i}),e.next=78,w.verify({},r);case 78:if(e.sent.result){e.next=81;break}throw new Error("Validation of signer's certificate failed");case 81:return e.abrupt("return",r.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[n].subjectPublicKeyInfo,this.signatureAlgorithm));case 82:case"end":return e.stop()}}),e,this,[[11,22,25,28],[30,44,47,50],[57,69,72,75]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case fd:return new ed;case md:return new $n;case vd:return new ta;case dd:return[];default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"type":var r=ed.compareWithDefault("tbs",t.tbs)&&ed.compareWithDefault("responderID",t.responderID)&&ed.compareWithDefault("producedAt",t.producedAt)&&ed.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&ed.compareWithDefault("responseExtensions",t.responseExtensions)),r;case md:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case vd:return t.isEqual(u.defaultValues(e));case dd:return 0===t.length;default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||gd,value:[ed.schema(t.tbsResponseData||{names:{blockName:pd}}),$n.schema(t.signatureAlgorithm||{names:{blockName:yd}}),new ta({name:t.signature||kd}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new wa({value:[new dn({name:wd,value:sh.schema(t.certs||{})})]})]})]})}}]),u}(xn);Sd.CLASS_NAME="BasicOCSPResponse";var Nd="tbs",Ad="version",Cd="subject",xd="subjectPublicKeyInfo",Ed="attributes",Id="signatureAlgorithm",Bd="signatureValue",Vd="CertificationRequestInfo",Rd="".concat(Vd,".version"),Dd="".concat(Vd,".subject"),Od="".concat(Vd,".subjectPublicKeyInfo"),Pd="".concat(Vd,".attributes"),Ud=[Vd,Rd,Dd,Od,Pd,Id,Bd];function Td(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.CertificationRequestInfo||Vd,value:[new oa({name:t.CertificationRequestInfoVersion||Rd}),On.schema(t.subject||{names:{blockName:Dd}}),Iu.schema({names:{blockName:Od}}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dn({optional:!0,name:t.CertificationRequestInfoAttributes||Pd,value:si.schema(t.attributes||{})})]})]})}var Ld=function(e){c(u,e);var t,r,a,n=y(u);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,u),(e=n.call(this)).tbsView=new Uint8Array(Gt(t,Nd,u.defaultValues(Nd))),e.version=Gt(t,Ad,u.defaultValues(Ad)),e.subject=Gt(t,Cd,u.defaultValues(Cd)),e.subjectPublicKeyInfo=Gt(t,xd,u.defaultValues(xd)),Ed in t&&(e.attributes=Gt(t,Ed,u.defaultValues(Ed))),e.signatureAlgorithm=Gt(t,Id,u.defaultValues(Id)),e.signatureValue=Gt(t,Bd,u.defaultValues(Bd)),t.schema&&e.fromSchema(t.schema),e}return o(u,[{key:"tbs",get:function(){return Kt.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){or(e,Ud);var t=pn(e,e,u.schema());Cn.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Rd].valueBlock.valueDec,this.subject=new On({schema:t.result[Dd]}),this.subjectPublicKeyInfo=new Iu({schema:t.result[Od]}),Pd in t.result&&(this.attributes=Array.from(t.result[Pd],(function(e){return new si({schema:e})}))),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[new oa({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return Ed in this&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(0===this.tbsView.byteLength)return u.schema();var r=Lr(this.tbsView);Cn.assert(r,"PKCS#10 Certificate Request"),e=r.result}else e=this.encodeTBS();return new wa({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:Ft.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Ed in this&&(e.attributes=Array.from(this.attributes||[],(function(e){return e.toJSON()}))),e}},{key:"sign",value:(a=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"SHA-1",a=u.length>2&&void 0!==u[2]?u[2]:Lo(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,a.getSignatureParameters(t,r);case 6:return n=e.sent,i=n.parameters,this.signatureAlgorithm=n.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=12,a.signWithPrivateKey(this.tbsView,t,i);case 12:s=e.sent,this.signatureValue=new ta({valueHex:s});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"verify",value:(r=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:Lo(!0),e.abrupt("return",t.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getPublicKey",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:Lo(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Nd:return bn;case Ad:return 0;case Cd:return new On;case xd:return new Iu;case Ed:return[];case Id:return new $n;case Bd:return new ta;default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({value:[Td(t.certificationRequestInfo||{}),new wa({name:t.signatureAlgorithm||Id,value:[new ma,new mn({optional:!0})]}),new ta({name:t.signatureValue||Bd})]})}}]),u}(xn);Ld.CLASS_NAME="CertificationRequest";var Md="digestAlgorithm",Hd="digest",_d=[Md,Hd],Kd=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).digestAlgorithm=Gt(a,Md,r.defaultValues(Md)),e.digest=Gt(a,Hd,r.defaultValues(Hd)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,_d);var t=pn(e,e,r.schema({names:{digestAlgorithm:{names:{blockName:Md}},digest:Hd}}));Cn.assertSchema(t,this.className),this.digestAlgorithm=new $n({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}},{key:"toSchema",value:function(){return new wa({value:[this.digestAlgorithm.toSchema(),this.digest]})}},{key:"toJSON",value:function(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Md:return new $n;case Hd:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Md:return $n.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case Hd:return t.isEqual(r.defaultValues(e));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.digestAlgorithm||{names:{blockName:Md}}),new Yr({name:t.digest||Hd})]})}}]),r}(xn);Kd.CLASS_NAME="DigestInfo";var jd="eContentType",Jd="eContent",Fd=[jd,Jd],Gd=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,r),(e=t.call(this)).eContentType=Gt(a,jd,r.defaultValues(jd)),Jd in a&&(e.eContent=Gt(a,Jd,r.defaultValues(Jd)),1===e.eContent.idBlock.tagClass&&4===e.eContent.idBlock.tagNumber&&!1===e.eContent.idBlock.isConstructed)){for(var n=new Yr({idBlock:{isConstructed:!0},isConstructed:!0}),i=0,u=e.eContent.valueBlock.valueHexView.slice().buffer,o=u.byteLength;o>0;){for(var l=new Uint8Array(u,i,i+65536>u.byteLength?u.byteLength-i:65536),c=new ArrayBuffer(l.length),h=new Uint8Array(c),f=0;f<h.length;f++)h[f]=l[f];n.valueBlock.value.push(new Yr({valueHex:c})),o-=l.length,i+=l.length}e.eContent=n}return a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Fd);var t=pn(e,e,r.schema({names:{eContentType:jd,eContent:Jd}}));Cn.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),Jd in t.result&&(this.eContent=t.result.eContent)}},{key:"toSchema",value:function(){var e=[];return e.push(new ma({value:this.eContentType})),this.eContent&&!1===r.compareWithDefault(Jd,this.eContent)&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={eContentType:this.eContentType};return this.eContent&&!1===r.compareWithDefault(Jd,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case jd:return Sn;case Jd:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case jd:return t===Sn;case Jd:return 1===t.idBlock.tagClass&&4===t.idBlock.tagNumber&&t.isEqual(r.defaultValues(Jd));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.eContentType||Sn}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new mn({name:t.eContent||Sn})]})]})}}]),r}(xn);Gd.CLASS_NAME="EncapsulatedContentInfo";var qd="mac",Xd="macSalt",Wd="iterations",zd=[qd,Xd,Wd],Qd=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).mac=Gt(a,qd,r.defaultValues(qd)),e.macSalt=Gt(a,Xd,r.defaultValues(Xd)),Wd in a&&(e.iterations=Gt(a,Wd,r.defaultValues(Wd))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,zd);var t=pn(e,e,r.schema({names:{mac:{names:{blockName:qd}},macSalt:Xd,iterations:Wd}}));Cn.assertSchema(t,this.className),this.mac=new Kd({schema:t.result.mac}),this.macSalt=t.result.macSalt,Wd in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new oa({value:this.iterations})),new wa({value:e})}},{key:"toJSON",value:function(){var e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}],[{key:"defaultValues",value:function(e){switch(e){case qd:return new Kd;case Xd:return new Yr;case Wd:return 1;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case qd:return Kd.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&Kd.compareWithDefault("digest",t.digest);case Xd:return t.isEqual(r.defaultValues(e));case Wd:return t===r.defaultValues(e);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,optional:t.optional||!0,value:[Kd.schema(t.mac||{names:{blockName:qd}}),new Yr({name:t.macSalt||Xd}),new oa({optional:!0,name:t.iterations||Wd})]})}}]),r}(xn);Qd.CLASS_NAME="MacData";var Yd="hashAlgorithm",Zd="hashedMessage",$d=[Yd,Zd],eg=function(e){c(a,e);var t,r=y(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=r.call(this)).hashAlgorithm=Gt(t,Yd,a.defaultValues(Yd)),e.hashedMessage=Gt(t,Zd,a.defaultValues(Zd)),t.schema&&e.fromSchema(t.schema),e}return o(a,[{key:"fromSchema",value:function(e){or(e,$d);var t=pn(e,e,a.schema({names:{hashAlgorithm:{names:{blockName:Yd}},hashedMessage:Zd}}));Cn.assertSchema(t,this.className),this.hashAlgorithm=new $n({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}},{key:"toSchema",value:function(){return new wa({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}],[{key:"create",value:(t=i(regeneratorRuntime.mark((function e(t,r){var n,i,s,u,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:Lo(!0),i=n.getOIDByAlgorithm({name:t},!0,"hashAlgorithm"),e.next=4,n.digest(t,r);case 4:return s=e.sent,u=new a({hashAlgorithm:new $n({algorithmId:i,algorithmParams:new Gr}),hashedMessage:new Yr({valueHex:s})}),e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case Yd:return new $n;case Zd:return new Yr;default:return w(h(a),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Yd:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case Zd:return 0===t.isEqual(a.defaultValues(e));default:return w(h(a),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.hashAlgorithm||{}),new Yr({name:t.hashedMessage||Sn})]})}}]),a}(xn);eg.CLASS_NAME="MessageImprint";var tg="reqCert",rg="singleRequestExtensions",ag=[tg,rg],ng=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).reqCert=Gt(a,tg,r.defaultValues(tg)),rg in a&&(e.singleRequestExtensions=Gt(a,rg,r.defaultValues(rg))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,ag);var t=pn(e,e,r.schema({names:{reqCert:{names:{blockName:tg}},extensions:{names:{blockName:rg}}}}));Cn.assertSchema(t,this.className),this.reqCert=new Ov({schema:t.result.reqCert}),rg in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new wa({value:Array.from(this.singleRequestExtensions,(function(e){return e.toSchema()}))})]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case tg:return new Ov;case rg:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case tg:return t.isEqual(r.defaultValues(e));case rg:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[Ov.schema(t.reqCert||{}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[pl.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||Sn}})]})]})}}]),r}(xn);ng.CLASS_NAME="Request";var ig="tbs",sg="version",ug="requestorName",og="requestList",lg="requestExtensions",cg="TBSRequest",hg="".concat(cg,".").concat(sg),fg="".concat(cg,".").concat(ug),mg="".concat(cg,".requests"),vg="".concat(cg,".").concat(lg),dg=[cg,hg,fg,mg,vg],gg=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).tbsView=new Uint8Array(Gt(a,ig,r.defaultValues(ig))),sg in a&&(e.version=Gt(a,sg,r.defaultValues(sg))),ug in a&&(e.requestorName=Gt(a,ug,r.defaultValues(ug))),e.requestList=Gt(a,og,r.defaultValues(og)),lg in a&&(e.requestExtensions=Gt(a,lg,r.defaultValues(lg))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"tbs",get:function(){return Kt.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){or(e,dg);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,hg in t.result&&(this.version=t.result[hg].valueBlock.valueDec),fg in t.result&&(this.requestorName=new Hn({schema:t.result[fg]})),this.requestList=Array.from(t.result[mg],(function(e){return new ng({schema:e})})),vg in t.result&&(this.requestExtensions=Array.from(t.result[vg].valueBlock.value,(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(0===this.tbsView.byteLength)return r.schema();var a=Lr(this.tbsView);if(Cn.assert(a,"TBS Request"),!(a.result instanceof wa))throw new Error("ASN.1 result should be SEQUENCE");e=a.result}else{var n=[];void 0!==this.version&&n.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[new oa({value:this.version})]})),this.requestorName&&n.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),n.push(new wa({value:Array.from(this.requestList,(function(e){return e.toSchema()}))})),this.requestExtensions&&n.push(new _r({idBlock:{tagClass:3,tagNumber:2},value:[new wa({value:Array.from(this.requestExtensions,(function(e){return e.toSchema()}))})]})),e=new wa({value:n})}return e}},{key:"toJSON",value:function(){var e={};return null!=this.version&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,(function(e){return e.toJSON()})),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case ig:return bn;case sg:return 0;case ug:return new Hn;case og:case lg:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ig:return 0===t.byteLength;case sg:return t===r.defaultValues(e);case ug:return t.type===Hn.defaultValues("type")&&0===Object.keys(t.value).length;case og:case lg:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||cg,value:[new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new oa({name:t.TBSRequestVersion||hg})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Hn.schema(t.requestorName||{names:{blockName:fg}})]}),new wa({name:t.requestList||"TBSRequest.requestList",value:[new dn({name:t.requests||mg,value:ng.schema(t.requestNames||{})})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[wl.schema(t.extensions||{names:{blockName:t.requestExtensions||vg}})]})]})}}]),r}(xn);gg.CLASS_NAME="TBSRequest";var pg="signatureAlgorithm",yg="signature",kg="certs",wg=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).signatureAlgorithm=Gt(a,pg,r.defaultValues(pg)),e.signature=Gt(a,yg,r.defaultValues(yg)),kg in a&&(e.certs=Gt(a,kg,r.defaultValues(kg))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,[pg,yg,kg]);var t=pn(e,e,r.schema({names:{signatureAlgorithm:{names:{blockName:pg}},signature:yg,certs:kg}}));Cn.assertSchema(t,this.className),this.signatureAlgorithm=new $n({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,kg in t.result&&(this.certs=Array.from(t.result.certs,(function(e){return new sh({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new wa({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case pg:return new $n;case yg:return new ta;case kg:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case pg:return t.algorithmId===Sn&&"algorithmParams"in t==!1;case yg:return t.isEqual(r.defaultValues(e));case kg:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[$n.schema(t.signatureAlgorithm||{}),new ta({name:t.signature||Sn}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new wa({value:[new dn({name:t.certs||Sn,value:sh.schema({})})]})]})]})}}]),r}(xn);wg.CLASS_NAME="Signature";var bg="tbsRequest",Sg="optionalSignature",Ng=[bg,Sg],Ag=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).tbsRequest=Gt(t,bg,n.defaultValues(bg)),Sg in t&&(e.optionalSignature=Gt(t,Sg,n.defaultValues(Sg))),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,Ng);var t=pn(e,e,n.schema());Cn.assertSchema(t,this.className),this.tbsRequest=new gg({schema:t.result.tbsRequest}),Sg in t.result&&(this.optionalSignature=new wg({schema:t.result.optionalSignature}))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new wa({value:t})}},{key:"toJSON",value:function(){var e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}},{key:"createForCertificate",value:(r=i(regeneratorRuntime.mark((function e(t,r){var a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:Lo(!0),n=new Ov,e.next=4,n.createForCertificate(t,r,a);case 4:this.tbsRequest.requestList.push(new ng({reqCert:n}));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"sign",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",a=o.length>2&&void 0!==o[2]?o[2]:Lo(!0),An.assertEmpty(t,"privateKey","OCSPRequest.sign method"),this.optionalSignature){e.next=5;break}throw new Error('Need to create "optionalSignature" field before signing');case 5:return e.next=7,a.getSignatureParameters(t,r);case 7:return n=e.sent,i=n.parameters,this.optionalSignature.signatureAlgorithm=n.signatureAlgorithm,s=this.tbsRequest.toSchema(!0).toBER(!1),e.next=13,a.signWithPrivateKey(s,t,i);case 13:u=e.sent,this.optionalSignature.signature=new ta({valueHex:u});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"verify",value:function(){}}],[{key:"defaultValues",value:function(e){switch(e){case bg:return new gg;case Sg:return new wg;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case bg:return gg.compareWithDefault("tbs",t.tbs)&&gg.compareWithDefault("version",t.version)&&gg.compareWithDefault("requestorName",t.requestorName)&&gg.compareWithDefault("requestList",t.requestList)&&gg.compareWithDefault("requestExtensions",t.requestExtensions);case Sg:return wg.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&wg.compareWithDefault("signature",t.signature)&&wg.compareWithDefault("certs",t.certs);default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||"OCSPRequest",value:[gg.schema(t.tbsRequest||{names:{blockName:bg}}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[wg.schema(t.optionalSignature||{names:{blockName:Sg}})]})]})}}]),n}(xn);Ag.CLASS_NAME="OCSPRequest";var Cg="responseType",xg="response",Eg=[Cg,xg],Ig=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).responseType=Gt(a,Cg,r.defaultValues(Cg)),e.response=Gt(a,xg,r.defaultValues(xg)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Eg);var t=pn(e,e,r.schema({names:{responseType:Cg,response:xg}}));Cn.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}},{key:"toSchema",value:function(){return new wa({value:[new ma({value:this.responseType}),this.response]})}},{key:"toJSON",value:function(){return{responseType:this.responseType,response:this.response.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Cg:return Sn;case xg:return new Yr;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Cg:return t===Sn;case xg:return t.isEqual(r.defaultValues(e));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new ma({name:t.responseType||Sn}),new Yr({name:t.response||Sn})]})}}]),r}(xn);Ig.CLASS_NAME="ResponseBytes";var Bg="responseStatus",Vg="responseBytes",Rg=function(e){c(u,e);var t,r,a,n=y(u);function u(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,u),(e=n.call(this)).responseStatus=Gt(t,Bg,u.defaultValues(Bg)),Vg in t&&(e.responseBytes=Gt(t,Vg,u.defaultValues(Vg))),t.schema&&e.fromSchema(t.schema),e}return o(u,[{key:"fromSchema",value:function(e){or(e,[Bg,Vg]);var t=pn(e,e,u.schema());Cn.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,Vg in t.result&&(this.responseBytes=new Ig({schema:t.result.responseBytes}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new wa({value:e})}},{key:"toJSON",value:function(){var e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}},{key:"getCertificateStatus",value:(a=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:Lo(!0),i={isForCertificate:!1,status:2},this.responseBytes){e.next=4;break}return e.abrupt("return",i);case 4:if(this.responseBytes.responseType===_i){e.next=6;break}return e.abrupt("return",i);case 6:e.prev=6,s=Lr(this.responseBytes.response.valueBlock.valueHexView),Cn.assert(s,"Basic OCSP response"),n=new Sd({schema:s.result}),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",i);case 15:return e.abrupt("return",n.getCertificateStatus(t,r,a));case 16:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e,t){return a.apply(this,arguments)})},{key:"sign",value:(r=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>2&&void 0!==s[2]?s[2]:Lo(!0),!this.responseBytes||this.responseBytes.responseType!==_i){e.next=4;break}return i=Sd.fromBER(this.responseBytes.response.valueBlock.valueHexView),e.abrupt("return",i.sign(t,r,a));case 4:throw new Error("Unknown ResponseBytes type: ".concat((null===(n=this.responseBytes)||void 0===n?void 0:n.responseType)||"Unknown"));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:null,r=i.length>1&&void 0!==i[1]?i[1]:Lo(!0),Vg in this!=0){e.next=4;break}throw new Error("Empty ResponseBytes field");case 4:if(!this.responseBytes||this.responseBytes.responseType!==_i){e.next=8;break}return n=Sd.fromBER(this.responseBytes.response.valueBlock.valueHexView),null!==t&&(n.certs||(n.certs=[]),n.certs.push(t)),e.abrupt("return",n.verify({},r));case 8:throw new Error("Unknown ResponseBytes type: ".concat((null===(a=this.responseBytes)||void 0===a?void 0:a.responseType)||"Unknown"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Bg:return new la;case Vg:return new Ig;default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Bg:return t.isEqual(u.defaultValues(e));case Vg:return Ig.compareWithDefault("responseType",t.responseType)&&Ig.compareWithDefault("response",t.response);default:return w(h(u),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||"OCSPResponse",value:[new la({name:t.responseStatus||Bg}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ig.schema(t.responseBytes||{names:{blockName:Vg}})]})]})}}]),u}(xn);Rg.CLASS_NAME="OCSPResponse";var Dg="type",Og="attributes",Pg="encodedValue",Ug=[Og],Tg=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).type=Gt(a,Dg,r.defaultValues(Dg)),e.attributes=Gt(a,Og,r.defaultValues(Og)),e.encodedValue=Gt(a,Pg,r.defaultValues(Pg)),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Ug);var t=pn(e,e,r.schema({names:{tagNumber:this.type,attributes:Og}}));if(Cn.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Kt.toArrayBuffer(t.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,Og in t.result!=!1)this.attributes=Array.from(t.result.attributes,(function(e){return new si({schema:e})}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}},{key:"toSchema",value:function(){if(r.compareWithDefault(Dg,this.type)||r.compareWithDefault(Og,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new _r({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){if(r.compareWithDefault(Dg,this.type)||r.compareWithDefault(Og,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case Dg:return-1;case Og:return[];case Pg:return bn;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Dg:return t===r.defaultValues(Dg);case Og:return 0===t.length;case Pg:return 0===t.byteLength;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new _r({name:t.blockName||Sn,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new dn({name:t.attributes||Sn,value:si.schema()})]})}}]),r}(xn);Tg.CLASS_NAME="SignedAndUnsignedAttributes";var Lg="version",Mg="sid",Hg="digestAlgorithm",_g="signedAttrs",Kg="signatureAlgorithm",jg="signature",Jg="unsignedAttrs",Fg="SignerInfo",Gg="".concat(Fg,".").concat(Lg),qg="".concat(Fg,".").concat(Mg),Xg="".concat(Fg,".").concat(Hg),Wg="".concat(Fg,".").concat(_g),zg="".concat(Fg,".").concat(Kg),Qg="".concat(Fg,".").concat(jg),Yg="".concat(Fg,".").concat(Jg),Zg=[Gg,qg,Xg,Wg,zg,Qg,Yg],$g=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Lg,r.defaultValues(Lg)),e.sid=Gt(a,Mg,r.defaultValues(Mg)),e.digestAlgorithm=Gt(a,Hg,r.defaultValues(Hg)),_g in a&&(e.signedAttrs=Gt(a,_g,r.defaultValues(_g))),e.signatureAlgorithm=Gt(a,Kg,r.defaultValues(Kg)),e.signature=Gt(a,jg,r.defaultValues(jg)),Jg in a&&(e.unsignedAttrs=Gt(a,Jg,r.defaultValues(Jg))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Zg);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.version=t.result[Gg].valueBlock.valueDec;var a=t.result[qg];1===a.idBlock.tagClass?this.sid=new Tf({schema:a}):this.sid=a,this.digestAlgorithm=new $n({schema:t.result[Xg]}),Wg in t.result&&(this.signedAttrs=new Tg({type:0,schema:t.result[Wg]})),this.signatureAlgorithm=new $n({schema:t.result[zg]}),this.signature=t.result[Qg],Yg in t.result&&(this.unsignedAttrs=new Tg({type:1,schema:t.result[Yg]}))}},{key:"toSchema",value:function(){if(r.compareWithDefault(Mg,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e=[];return e.push(new oa({value:this.version})),this.sid instanceof Tf?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===r.compareWithDefault(_g,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===r.compareWithDefault(Jg,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){if(r.compareWithDefault(Mg,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof mn||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===r.compareWithDefault(_g,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===r.compareWithDefault(Jg,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Lg:return 0;case Mg:return new mn;case Hg:return new $n;case _g:return new Tg({type:0});case Kg:return new $n;case jg:return new Yr;case Jg:return new Tg({type:1});default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Lg:return r.defaultValues(Lg)===t;case Mg:return t instanceof mn;case Hg:return t instanceof $n!=!1&&t.isEqual(r.defaultValues(Hg));case _g:return Tg.compareWithDefault("type",t.type)&&Tg.compareWithDefault("attributes",t.attributes)&&Tg.compareWithDefault("encodedValue",t.encodedValue);case Kg:return t instanceof $n!=!1&&t.isEqual(r.defaultValues(Kg));case jg:case Jg:return Tg.compareWithDefault("type",t.type)&&Tg.compareWithDefault("attributes",t.attributes)&&Tg.compareWithDefault("encodedValue",t.encodedValue);default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:Fg,value:[new oa({name:t.version||Gg}),new vn({value:[Tf.schema(t.sidSchema||{names:{blockName:qg}}),new vn({value:[new _r({optional:!0,name:t.sid||qg,idBlock:{tagClass:3,tagNumber:0},value:[new Yr]}),new Pr({optional:!0,name:t.sid||qg,idBlock:{tagClass:3,tagNumber:0}})]})]}),$n.schema(t.digestAlgorithm||{names:{blockName:Xg}}),Tg.schema(t.signedAttrs||{names:{blockName:Wg,tagNumber:0}}),$n.schema(t.signatureAlgorithm||{names:{blockName:zg}}),new Yr({name:t.signature||Qg}),Tg.schema(t.unsignedAttrs||{names:{blockName:Yg,tagNumber:1}})]})}}]),r}(xn);$g.CLASS_NAME="SignerInfo";var ep="version",tp="policy",rp="messageImprint",ap="serialNumber",np="genTime",ip="ordering",sp="nonce",up="accuracy",op="tsa",lp="extensions",cp="TSTInfo",hp="".concat(cp,".").concat(ep),fp="".concat(cp,".").concat(tp),mp="".concat(cp,".").concat(rp),vp="".concat(cp,".").concat(ap),dp="".concat(cp,".").concat(np),gp="".concat(cp,".").concat(up),pp="".concat(cp,".").concat(ip),yp="".concat(cp,".").concat(sp),kp="".concat(cp,".").concat(op),wp="".concat(cp,".").concat(lp),bp=[hp,fp,mp,vp,dp,gp,pp,yp,kp,wp],Sp=function(e){c(a,e);var t,r=y(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=r.call(this)).version=Gt(t,ep,a.defaultValues(ep)),e.policy=Gt(t,tp,a.defaultValues(tp)),e.messageImprint=Gt(t,rp,a.defaultValues(rp)),e.serialNumber=Gt(t,ap,a.defaultValues(ap)),e.genTime=Gt(t,np,a.defaultValues(np)),up in t&&(e.accuracy=Gt(t,up,a.defaultValues(up))),ip in t&&(e.ordering=Gt(t,ip,a.defaultValues(ip))),sp in t&&(e.nonce=Gt(t,sp,a.defaultValues(sp))),op in t&&(e.tsa=Gt(t,op,a.defaultValues(op))),lp in t&&(e.extensions=Gt(t,lp,a.defaultValues(lp))),t.schema&&e.fromSchema(t.schema),e}return o(a,[{key:"fromSchema",value:function(e){or(e,bp);var t=pn(e,e,a.schema());Cn.assertSchema(t,this.className),this.version=t.result[hp].valueBlock.valueDec,this.policy=t.result[fp].valueBlock.toString(),this.messageImprint=new eg({schema:t.result[mp]}),this.serialNumber=t.result[vp],this.genTime=t.result[dp].toDate(),gp in t.result&&(this.accuracy=new Xn({schema:t.result[gp]})),pp in t.result&&(this.ordering=t.result[pp].valueBlock.value),yp in t.result&&(this.nonce=t.result[yp]),kp in t.result&&(this.tsa=new Hn({schema:t.result[kp]})),wp in t.result&&(this.extensions=Array.from(t.result[wp],(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),e.push(new ma({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new rn({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new Wr({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:Lo(!0),t.data){e.next=3;break}throw new Error('"data" is a mandatory attribute for TST_INFO verification');case 3:if(a=t.data,!t.notBefore){e.next=7;break}if(!(this.genTime<t.notBefore)){e.next=7;break}throw new Error("Generation time for TSTInfo object is less than notBefore value");case 7:if(!t.notAfter){e.next=10;break}if(!(this.genTime>t.notAfter)){e.next=10;break}throw new Error("Generation time for TSTInfo object is more than notAfter value");case 10:return n=r.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),e.next=13,r.digest(n.name,new Uint8Array(a));case 13:return i=e.sent,e.abrupt("return",Kt.isEqual(i,this.messageImprint.hashedMessage.valueBlock.valueHexView));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case ep:return 0;case tp:return Sn;case rp:return new eg;case ap:return new oa;case np:return new Date(0,0,0);case up:return new Xn;case ip:return!1;case sp:return new oa;case op:return new Hn;case lp:return[];default:return w(h(a),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ep:case tp:case np:case ip:return t===a.defaultValues(ip);case rp:return eg.compareWithDefault(Yd,t.hashAlgorithm)&&eg.compareWithDefault(Zd,t.hashedMessage);case ap:case sp:return t.isEqual(a.defaultValues(sp));case up:return Xn.compareWithDefault(Fn,t.seconds)&&Xn.compareWithDefault(Gn,t.millis)&&Xn.compareWithDefault(qn,t.micros);case op:return Hn.compareWithDefault(Pn,t.type)&&Hn.compareWithDefault(Un,t.value);case lp:return 0===t.length;default:return w(h(a),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||cp,value:[new oa({name:t.version||hp}),new ma({name:t.policy||fp}),eg.schema(t.messageImprint||{names:{blockName:mp}}),new oa({name:t.serialNumber||vp}),new rn({name:t.genTime||dp}),Xn.schema(t.accuracy||{names:{blockName:gp}}),new Wr({name:t.ordering||pp,optional:!0}),new oa({name:t.nonce||yp,optional:!0}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Hn.schema(t.tsa||{names:{blockName:kp}})]}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new dn({name:t.extensions||wp,value:pl.schema(t.extension||{})})]})]})}}]),a}(xn);Sp.CLASS_NAME="TSTInfo";var Np="version",Ap="digestAlgorithms",Cp="encapContentInfo",xp="certificates",Ep="crls",Ip="signerInfos",Bp="ocsps",Vp="SignedData",Rp="".concat(Vp,".").concat(Np),Dp="".concat(Vp,".").concat(Ap),Op="".concat(Vp,".").concat(Cp),Pp="".concat(Vp,".").concat(xp),Up="".concat(Vp,".").concat(Ep),Tp="".concat(Vp,".").concat(Ip),Lp=[Rp,Dp,Op,Pp,Up,Tp],Mp=function(e){c(r,e);var t=y(r);function r(e){var a,n=e.message,i=e.code,u=void 0===i?0:i,o=e.date,l=void 0===o?new Date:o,c=e.signatureVerified,h=void 0===c?null:c,f=e.signerCertificate,m=void 0===f?null:f,v=e.signerCertificateVerified,d=void 0===v?null:v,g=e.timestampSerial,p=void 0===g?null:g,y=e.certificatePath,k=void 0===y?[]:y;return s(this,r),(a=t.call(this,n)).name="SignedDataVerifyError",a.date=l,a.code=u,a.timestampSerial=p,a.signatureVerified=h,a.signerCertificate=m,a.signerCertificateVerified=d,a.certificatePath=k,a}return o(r)}(d(Error)),Hp=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).version=Gt(t,Np,n.defaultValues(Np)),e.digestAlgorithms=Gt(t,Ap,n.defaultValues(Ap)),e.encapContentInfo=Gt(t,Cp,n.defaultValues(Cp)),xp in t&&(e.certificates=Gt(t,xp,n.defaultValues(xp))),Ep in t&&(e.crls=Gt(t,Ep,n.defaultValues(Ep))),Bp in t&&(e.ocsps=Gt(t,Bp,n.defaultValues(Bp))),e.signerInfos=Gt(t,Ip,n.defaultValues(Ip)),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,Lp);var t=pn(e,e,n.schema());if(Cn.assertSchema(t,this.className),this.version=t.result[Rp].valueBlock.valueDec,Dp in t.result&&(this.digestAlgorithms=Array.from(t.result[Dp],(function(e){return new $n({schema:e})}))),this.encapContentInfo=new Gd({schema:t.result[Op]}),Pp in t.result){var r=new wf({schema:new ba({value:t.result[Pp].valueBlock.value})});this.certificates=r.certificates.slice(0)}Up in t.result&&(this.crls=Array.from(t.result[Up],(function(e){return 1===e.idBlock.tagClass?new Hh({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new Af({schema:e}))}))),Tp in t.result&&(this.signerInfos=Array.from(t.result[Tp],(function(e){return new $g({schema:e})})))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];if(this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof pf}))||this.crls&&this.crls.length&&this.crls.some((function(e){return e instanceof Af}))?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof wc}))?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof jl}))||this.signerInfos.some((function(e){return 3===e.version}))||this.encapContentInfo.eContentType!==n.ID_DATA?this.version=3:this.version=1,t.push(new oa({value:this.version})),t.push(new ba({value:Array.from(this.digestAlgorithms,(function(e){return e.toSchema()}))})),t.push(this.encapContentInfo.toSchema()),this.certificates){var r=new wf({certificates:this.certificates}),a=r.toSchema();t.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:a.valueBlock.value}))}return this.crls&&t.push(new _r({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,(function(t){if(t instanceof Af){var r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r}return t.toSchema(e)}))})),t.push(new ba({value:Array.from(this.signerInfos,(function(e){return e.toSchema()}))})),new wa({value:t})}},{key:"toJSON",value:function(){var e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,(function(e){return e.toJSON()})),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,(function(e){return e.toJSON()}))};return this.certificates&&(e.certificates=Array.from(this.certificates,(function(e){return e.toJSON()}))),this.crls&&(e.crls=Array.from(this.crls,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(r=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,N,A,x,E,I,B,V,R,D,O,P,U,T,L,M,H,_,K,j,J,F,G,q,X,W,z,Q,Y,Z,$,ee=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ee.length>0&&void 0!==ee[0]?ee[0]:{},r=t.signer,a=void 0===r?-1:r,n=t.data,i=void 0===n?bn:n,s=t.trustedCerts,u=void 0===s?[]:s,o=t.checkDate,l=void 0===o?new Date:o,c=t.checkChain,h=void 0!==c&&c,f=t.passedWhenNotRevValues,m=void 0!==f&&f,v=t.extendedMode,d=void 0!==v&&v,g=t.findOrigin,p=void 0===g?null:g,y=t.findIssuer,k=void 0===y?null:y,w=ee.length>1&&void 0!==ee[1]?ee[1]:Lo(!0),b=null,N=null,e.prev=4,A=bn,x=Sn,E=[],I=this.signerInfos[a]){e.next=11;break}throw new Mp({date:l,code:1,message:"Unable to get signer by supplied index"});case 11:if(this.certificates){e.next=13;break}throw new Mp({date:l,code:2,message:"No certificates attached to this signed data"});case 13:if(!(I.sid instanceof Tf)){e.next=36;break}B=C(this.certificates),e.prev=15,B.s();case 17:if((V=B.n()).done){e.next=26;break}if((R=V.value)instanceof sh){e.next=21;break}return e.abrupt("continue",24);case 21:if(!R.issuer.isEqual(I.sid.issuer)||!R.serialNumber.isEqual(I.sid.serialNumber)){e.next=24;break}return b=R,e.abrupt("break",26);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(15),B.e(e.t0);case 31:return e.prev=31,B.f(),e.finish(31);case 34:e.next=61;break;case 36:D=I.sid,O=D.idBlock.isConstructed?D.valueBlock.value[0].valueBlock.valueHex:D.valueBlock.valueHex,P=C(this.certificates),e.prev=39,P.s();case 41:if((U=P.n()).done){e.next=53;break}if((T=U.value)instanceof sh){e.next=45;break}return e.abrupt("continue",51);case 45:return e.next=47,w.digest({name:"sha-1"},T.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 47:if(!$t(e.sent,O)){e.next=51;break}return b=T,e.abrupt("break",53);case 51:e.next=41;break;case 53:e.next=58;break;case 55:e.prev=55,e.t1=e.catch(39),P.e(e.t1);case 58:return e.prev=58,P.f(),e.finish(58);case 61:if(b){e.next=63;break}throw new Mp({date:l,code:3,message:"Unable to find signer certificate"});case 63:if(this.encapContentInfo.eContentType!==Ui){e.next=81;break}if(this.encapContentInfo.eContent){e.next=66;break}throw new Mp({date:l,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0});case 66:e.prev=66,L=Sp.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView),e.next=73;break;case 70:throw e.prev=70,e.t2=e.catch(66),new Mp({date:l,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0});case 73:if(l=L.genTime,N=L.serialNumber.valueBlock.valueHexView.slice(),0!==i.byteLength){e.next=77;break}throw new Mp({date:l,code:4,message:"Missed detached data input array"});case 77:return e.next=79,L.verify({data:i},w);case 79:if(e.sent){e.next=81;break}throw new Mp({date:l,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0});case 81:if(!h){e.next=96;break}if(M=this.certificates.filter((function(e){return e instanceof sh&&!!uh(e,b)})),H={checkDate:l,certs:M,trustedCerts:u},k&&(H.findIssuer=k),p&&(H.findOrigin=p),(_=new hd(H)).certs.push(b),this.crls){K=C(this.crls);try{for(K.s();!(j=K.n()).done;)"thisUpdate"in(J=j.value)?_.crls.push(J):J.otherRevInfoFormat===_i&&_.ocsps.push(new Sd({schema:J.otherRevInfo}))}catch(e){K.e(e)}finally{K.f()}}return this.ocsps&&(F=_.ocsps).push.apply(F,S(this.ocsps)),e.next=92,_.verify({passedWhenNotRevValues:m},w).catch((function(e){throw new Mp({date:l,code:5,message:"Validation of signer's certificate failed with error: ".concat(e instanceof Object?e.resultMessage:e),signerCertificate:b,signerCertificateVerified:!1})}));case 92:if((G=e.sent).certificatePath&&(E=G.certificatePath),G.result){e.next=96;break}throw new Mp({date:l,code:5,message:"Validation of signer's certificate failed: ".concat(G.resultMessage),signerCertificate:b,signerCertificateVerified:!1});case 96:if("name"in(q=w.getAlgorithmByOID(I.digestAlgorithm.algorithmId))){e.next=99;break}throw new Mp({date:l,code:7,message:"Unsupported signature algorithm: ".concat(I.digestAlgorithm.algorithmId),signerCertificate:b,signerCertificateVerified:!0});case 99:if(x=q.name,!(X=this.encapContentInfo.eContent)){e.next=105;break}i=1===X.idBlock.tagClass&&4===X.idBlock.tagNumber?X.getValue():X.valueBlock.valueBeforeDecodeView,e.next=107;break;case 105:if(0!==i.byteLength){e.next=107;break}throw new Mp({date:l,code:8,message:"Missed detached data input array",signerCertificate:b,signerCertificateVerified:!0});case 107:if(!I.signedAttrs){e.next=133;break}W=!1,z=!1,Q=C(I.signedAttrs.attributes),e.prev=111,Q.s();case 113:if((Y=Q.n()).done){e.next=121;break}if("1.2.840.113549.1.9.3"===(Z=Y.value).type&&(W=!0),"1.2.840.113549.1.9.4"===Z.type&&(z=!0,A=Z.values[0].valueBlock.valueHex),!W||!z){e.next=119;break}return e.abrupt("break",121);case 119:e.next=113;break;case 121:e.next=126;break;case 123:e.prev=123,e.t3=e.catch(111),Q.e(e.t3);case 126:return e.prev=126,Q.f(),e.finish(126);case 129:if(!1!==W){e.next=131;break}throw new Mp({date:l,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:b,signerCertificateVerified:!0});case 131:if(!1!==z){e.next=133;break}throw new Mp({date:l,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:b,signerCertificateVerified:!0});case 133:if(!I.signedAttrs){e.next=140;break}return e.next=136,w.digest(x,new Uint8Array(i));case 136:if($t(e.sent,A)){e.next=139;break}throw new Mp({date:l,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0});case 139:i=I.signedAttrs.encodedValue;case 140:return e.next=142,w.verifyWithPublicKey(i,I.signature,b.subjectPublicKeyInfo,b.signatureAlgorithm,x);case 142:if($=e.sent,!d){e.next=147;break}return e.abrupt("return",{date:l,code:14,message:Sn,signatureVerified:$,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0,certificatePath:E});case 147:return e.abrupt("return",$);case 148:e.next=155;break;case 150:if(e.prev=150,e.t4=e.catch(4),!(e.t4 instanceof Mp)){e.next=154;break}throw e.t4;case 154:throw new Mp({date:l,code:15,message:"Error during verification: ".concat(e.t4 instanceof Error?e.t4.message:e.t4),signatureVerified:null,signerCertificate:b,timestampSerial:N,signerCertificateVerified:!0});case 155:case"end":return e.stop()}}),e,this,[[4,150],[15,28,31,34],[39,55,58,61],[66,70],[111,123,126,129]])}))),function(){return r.apply(this,arguments)})},{key:"sign",value:(t=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=f.length>2&&void 0!==f[2]?f[2]:"SHA-1",n=f.length>3&&void 0!==f[3]?f[3]:bn,i=f.length>4&&void 0!==f[4]?f[4]:Lo(!0),t){e.next=5;break}throw new Error("Need to provide a private key for signing");case 5:if(s=i.getOIDByAlgorithm({name:a},!0,"hashAlgorithm"),0===this.digestAlgorithms.filter((function(e){return e.algorithmId===s})).length&&this.digestAlgorithms.push(new $n({algorithmId:s,algorithmParams:new Gr})),u=this.signerInfos[r]){e.next=10;break}throw new RangeError("SignerInfo index is out of range");case 10:return u.digestAlgorithm=new $n({algorithmId:s,algorithmParams:new Gr}),e.next=13,i.getSignatureParameters(t,a);case 13:if(o=e.sent,l=o.parameters,u.signatureAlgorithm=o.signatureAlgorithm,!u.signedAttrs){e.next=20;break}0!==u.signedAttrs.encodedValue.byteLength?n=u.signedAttrs.encodedValue:(n=u.signedAttrs.toSchema().toBER(),Kt.toUint8Array(n)[0]=49),e.next=27;break;case 20:if(!(c=this.encapContentInfo.eContent)){e.next=25;break}n=1===c.idBlock.tagClass&&4===c.idBlock.tagNumber?c.getValue():c.valueBlock.valueBeforeDecodeView,e.next=27;break;case 25:if(0!==n.byteLength){e.next=27;break}throw new Error("Missed detached data input array");case 27:return e.next=29,i.signWithPrivateKey(n,t,l);case 29:h=e.sent,u.signature=new Yr({valueHex:h});case 31:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Np:return 0;case Ap:return[];case Cp:return new Gd;case xp:case Ep:case Bp:case Ip:return[];default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Np:return t===n.defaultValues(Np);case Cp:return Gd.compareWithDefault("eContentType",t.eContentType)&&Gd.compareWithDefault("eContent",t.eContent);case Ap:case xp:case Ep:case Bp:case Ip:return 0===t.length;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return void 0===t.optional&&(t.optional=!1),new wa({name:t.blockName||Vp,optional:t.optional,value:[new oa({name:t.version||Rp}),new ba({value:[new dn({name:t.digestAlgorithms||Dp,value:$n.schema()})]}),Gd.schema(t.encapContentInfo||{names:{blockName:Op}}),new _r({name:t.certificates||Pp,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:wf.schema().valueBlock.value}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:If.schema(t.crls||{names:{crls:Up}}).valueBlock.value}),new ba({value:[new dn({name:t.signerInfos||Tp,value:$g.schema()})]})]})}}]),n}(xn);Hp.CLASS_NAME="SignedData",Hp.ID_DATA=Ri;var _p="version",Kp="authSafe",jp="macData",Jp="parsedValue",Fp=[_p,Kp,jp],Gp=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).version=Gt(t,_p,n.defaultValues(_p)),e.authSafe=Gt(t,Kp,n.defaultValues(Kp)),jp in t&&(e.macData=Gt(t,jp,n.defaultValues(jp))),Jp in t&&(e.parsedValue=Gt(t,Jp,n.defaultValues(Jp))),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,Fp);var t=pn(e,e,n.schema({names:{version:_p,authSafe:{names:{blockName:Kp}},macData:{names:{blockName:jp}}}}));Cn.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Ac({schema:t.result.authSafe}),jp in t.result&&(this.macData=new Qd({schema:t.result.macData}))}},{key:"toSchema",value:function(){var e=[new oa({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}},{key:"makeInternalValues",value:(r=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u,o,l,c,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},r=h.length>1&&void 0!==h[1]?h[1]:Lo(!0),Nn.assert(t,"parameters","object"),this.parsedValue){e.next=5;break}throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');case 5:An.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),An.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),e.t0=this.parsedValue.integrityMode,e.next=0===e.t0?10:1===e.t0?25:43;break;case 10:if("iterations"in t){e.next=12;break}throw new An("iterations");case 12:return An.assertEmpty(t.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),An.assertEmpty(t.hmacHashAlgorithm,"hmacHashAlgorithm"),An.assertEmpty(t.password,"password"),a=new ArrayBuffer(64),n=new Uint8Array(a),r.getRandomValues(n),i=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),this.authSafe=new Ac({contentType:Ac.DATA,content:new Yr({valueHex:i})}),e.next=22,r.stampDataWithPassword({password:t.password,hashAlgorithm:t.hmacHashAlgorithm,salt:a,iterationCount:t.iterations,contentToStamp:i});case 22:return s=e.sent,this.macData=new Qd({mac:new Kd({digestAlgorithm:new $n({algorithmId:r.getOIDByAlgorithm({name:t.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new Yr({valueHex:s})}),macSalt:new Yr({valueHex:a}),iterations:t.iterations}),e.abrupt("break",44);case 25:if("signingCertificate"in t){e.next=27;break}throw new An("signingCertificate");case 27:return An.assertEmpty(t.privateKey,"privateKey"),An.assertEmpty(t.hashAlgorithm,"hashAlgorithm"),u=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),o=new Hp({version:1,encapContentInfo:new Gd({eContentType:"1.2.840.113549.1.7.1",eContent:new Yr({valueHex:u})}),certificates:[t.signingCertificate]}),e.next=33,r.digest({name:t.hashAlgorithm},new Uint8Array(u));case 33:return l=e.sent,(c=[]).push(new si({type:"1.2.840.113549.1.9.3",values:[new ma({value:"1.2.840.113549.1.7.1"})]})),c.push(new si({type:"1.2.840.113549.1.9.5",values:[new en({valueDate:new Date})]})),c.push(new si({type:"1.2.840.113549.1.9.4",values:[new Yr({valueHex:l})]})),o.signerInfos.push(new $g({version:1,sid:new Tf({issuer:t.signingCertificate.issuer,serialNumber:t.signingCertificate.serialNumber}),signedAttrs:new Tg({type:0,attributes:c})})),e.next=41,o.sign(t.privateKey,0,t.hashAlgorithm,void 0,r);case 41:return this.authSafe=new Ac({contentType:"1.2.840.113549.1.7.2",content:o.toSchema(!0)}),e.abrupt("break",44);case 43:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode));case 44:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"parseInternalValues",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>1&&void 0!==o[1]?o[1]:Lo(!0),Nn.assert(t,"parameters","object"),void 0===t.checkIntegrity&&(t.checkIntegrity=!0),this.parsedValue={},e.t0=this.authSafe.contentType,e.next=e.t0===Ac.DATA?7:e.t0===Ac.SIGNED_DATA?22:35;break;case 7:if(An.assertEmpty(t.password,"password"),this.parsedValue.integrityMode=0,Nn.assert(this.authSafe.content,"authSafe.content",Yr),a=this.authSafe.content.getValue(),this.parsedValue.authenticatedSafe=Ev.fromBER(a),!t.checkIntegrity){e.next=21;break}if(this.macData){e.next=15;break}throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');case 15:return n=r.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm"),e.next=18,r.verifyDataStampedWithPassword({password:t.password,hashAlgorithm:n.name,salt:Kt.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:a,signatureToVerify:Kt.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)});case 18:if(e.sent){e.next=21;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 21:case 34:return e.abrupt("break",36);case 22:return this.parsedValue.integrityMode=1,i=new Hp({schema:this.authSafe.content}),s=i.encapContentInfo.eContent,An.assert(s,"eContent","cmsSigned.encapContentInfo"),Nn.assert(s,"eContent",Yr),u=s.getValue(),this.parsedValue.authenticatedSafe=Ev.fromBER(u),e.next=31,i.verify({signer:0,checkChain:!1},r);case 31:if(e.sent){e.next=34;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 35:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType));case 36:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case _p:return 3;case Kp:return new Ac;case jp:return new Qd;case Jp:return{};default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case _p:return t===n.defaultValues(e);case Kp:return Ac.compareWithDefault("contentType",t.contentType)&&Ac.compareWithDefault("content",t.content);case jp:return Qd.compareWithDefault("mac",t.mac)&&Qd.compareWithDefault("macSalt",t.macSalt)&&Qd.compareWithDefault("iterations",t.iterations);case Jp:return t instanceof Object&&0===Object.keys(t).length;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.version||_p}),Ac.schema(t.authSafe||{names:{blockName:Kp}}),Qd.schema(t.macData||{names:{blockName:jp,optional:!0}})]})}}]),n}(xn);Gp.CLASS_NAME="PFX";var qp,Xp="status",Wp="statusStrings",zp="failInfo",Qp=[Xp,Wp,zp];!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(qp||(qp={}));var Yp=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).status=Gt(a,Xp,r.defaultValues(Xp)),Wp in a&&(e.statusStrings=Gt(a,Wp,r.defaultValues(Wp))),zp in a&&(e.failInfo=Gt(a,zp,r.defaultValues(zp))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,Qp);var t=pn(e,e,r.schema({names:{status:Xp,statusStrings:Wp,failInfo:zp}}));Cn.assertSchema(t,this.className);var a=t.result.status;if(!0===a.valueBlock.isHexOnly||a.valueBlock.valueDec<0||a.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=a.valueBlock.valueDec,Wp in t.result&&(this.statusStrings=t.result.statusStrings),zp in t.result&&(this.failInfo=t.result.failInfo)}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.status})),this.statusStrings&&e.push(new wa({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new wa({value:e})}},{key:"toJSON",value:function(){var e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,(function(e){return e.toJSON()}))),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Xp:return 2;case Wp:return[];case zp:return new ta;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Xp:return t===r.defaultValues(e);case Wp:return 0===t.length;case zp:return t.isEqual(r.defaultValues(e));default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||Sn,value:[new oa({name:t.status||Sn}),new wa({optional:!0,value:[new dn({name:t.statusStrings||Sn,value:new Ea})]}),new ta({name:t.failInfo||Sn,optional:!0})]})}}]),r}(xn);Yp.CLASS_NAME="PKIStatusInfo";var Zp="version",$p="messageImprint",ey="reqPolicy",ty="nonce",ry="certReq",ay="extensions",ny="TimeStampReq",iy="".concat(ny,".").concat(Zp),sy="".concat(ny,".").concat($p),uy="".concat(ny,".").concat(ey),oy="".concat(ny,".").concat(ty),ly="".concat(ny,".").concat(ry),cy="".concat(ny,".").concat(ay),hy=[iy,sy,uy,oy,ly,cy],fy=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this)).version=Gt(a,Zp,r.defaultValues(Zp)),e.messageImprint=Gt(a,$p,r.defaultValues($p)),ey in a&&(e.reqPolicy=Gt(a,ey,r.defaultValues(ey))),ty in a&&(e.nonce=Gt(a,ty,r.defaultValues(ty))),ry in a&&(e.certReq=Gt(a,ry,r.defaultValues(ry))),ay in a&&(e.extensions=Gt(a,ay,r.defaultValues(ay))),a.schema&&e.fromSchema(a.schema),e}return o(r,[{key:"fromSchema",value:function(e){or(e,hy);var t=pn(e,e,r.schema());Cn.assertSchema(t,this.className),this.version=t.result[iy].valueBlock.valueDec,this.messageImprint=new eg({schema:t.result[sy]}),uy in t.result&&(this.reqPolicy=t.result[uy].valueBlock.toString()),oy in t.result&&(this.nonce=t.result[oy]),ly in t.result&&(this.certReq=t.result[ly].valueBlock.value),cy in t.result&&(this.extensions=Array.from(t.result[cy],(function(e){return new pl({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new oa({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new ma({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),ry in this&&!1===r.compareWithDefault(ry,this.certReq)&&e.push(new Wr({value:this.certReq})),this.extensions&&e.push(new _r({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new wa({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,messageImprint:this.messageImprint.toJSON()};return void 0!==this.reqPolicy&&(e.reqPolicy=this.reqPolicy),void 0!==this.nonce&&(e.nonce=this.nonce.toJSON()),void 0!==this.certReq&&!1===r.compareWithDefault(ry,this.certReq)&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Zp:return 0;case $p:return new eg;case ey:return Sn;case ty:return new oa;case ry:return!1;case ay:return[];default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Zp:case ey:case ry:return t===r.defaultValues(e);case $p:return eg.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&eg.compareWithDefault("hashedMessage",t.hashedMessage);case ty:return t.isEqual(r.defaultValues(e));case ay:return 0===t.length;default:return w(h(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||ny,value:[new oa({name:t.version||iy}),eg.schema(t.messageImprint||{names:{blockName:sy}}),new ma({name:t.reqPolicy||uy,optional:!0}),new oa({name:t.nonce||oy,optional:!0}),new Wr({name:t.certReq||ly,optional:!0}),new _r({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new dn({name:t.extensions||cy,value:pl.schema()})]})]})}}]),r}(xn);fy.CLASS_NAME="TimeStampReq";var my="status",vy="timeStampToken",dy="TimeStampResp",gy="".concat(dy,".").concat(my),py="".concat(dy,".").concat(vy),yy=[gy,py],ky=function(e){c(n,e);var t,r,a=y(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,n),(e=a.call(this)).status=Gt(t,my,n.defaultValues(my)),vy in t&&(e.timeStampToken=Gt(t,vy,n.defaultValues(vy))),t.schema&&e.fromSchema(t.schema),e}return o(n,[{key:"fromSchema",value:function(e){or(e,yy);var t=pn(e,e,n.schema());Cn.assertSchema(t,this.className),this.status=new Yp({schema:t.result[gy]}),py in t.result&&(this.timeStampToken=new Ac({schema:t.result[py]}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new wa({value:e})}},{key:"toJSON",value:function(){var e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}},{key:"sign",value:(r=i(regeneratorRuntime.mark((function e(t,r){var a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:Lo(!0),this.assertContentType(),n=new Hp({schema:this.timeStampToken.content}),e.abrupt("return",n.sign(t,0,r,void 0,a));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"verify",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{signer:0,trustedCerts:[],data:bn},r=n.length>1&&void 0!==n[1]?n[1]:Lo(!0),this.assertContentType(),a=new Hp({schema:this.timeStampToken.content}),e.abrupt("return",a.verify(t,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"assertContentType",value:function(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==Di)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}],[{key:"defaultValues",value:function(e){switch(e){case my:return new Yp;case vy:return new Ac;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case my:return Yp.compareWithDefault(my,t.status)&&"statusStrings"in t==!1&&"failInfo"in t==!1;case vy:return t.contentType===Sn&&t.content instanceof mn;default:return w(h(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gt(e,"names",{});return new wa({name:t.blockName||dy,value:[Yp.schema(t.status||{names:{blockName:gy}}),Ac.schema(t.timeStampToken||{names:{blockName:py,optional:!0}})]})}}]),n}(xn);function wy(e,t,r,n){var i,s=arguments.length,u=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":a(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(u=(s<3?i(u):s>3?i(t,r,u):i(t,r))||u);return s>3&&u&&Object.defineProperty(t,r,u),u}function by(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Sy(e){for(var t=0,r=0,a=0;a<e.length;a++){t+=e[a].byteLength}for(var n=new Uint8Array(t),i=0;i<e.length;i++){var s=e[i];n.set(new Uint8Array(s),r),r+=s.byteLength}return n.buffer}function Ny(e,t,r,a){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}ky.CLASS_NAME="TimeStampResp",function(){if("undefined"!=typeof self){if("crypto"in self){var e="webcrypto";"webkitSubtle"in self.crypto&&(e="safari"),Uo(e,new Do({name:e,crypto:crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){var t="NodeJS ^15",r=crypto.webcrypto;Uo(t,new Do({name:t,crypto:r}))}}(),"function"==typeof SuppressedError&&SuppressedError;var Ay=function(){function e(){s(this,e),this.items=[]}return o(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return Sy(this.items)}}]),e}(),Cy=[new Uint8Array([1])],xy="0123456789",Ey="",Iy=new ArrayBuffer(0),By=new Uint8Array(0),Vy="EndOfContent",Ry="OCTET STRING",Dy="BIT STRING";function Oy(e){var t;return t=function(e){c(a,e);var t=y(a);function a(){var e,r;s(this,a);for(var n=arguments.length,i=new Array(n),u=0;u<n;u++)i[u]=arguments[u];e=t.call.apply(t,[this].concat(i));var o=i[0]||{};return e.isHexOnly=null!==(r=o.isHexOnly)&&void 0!==r&&r,e.valueHexView=o.valueHex?Kt.toUint8Array(o.valueHex):By,e}return o(a,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Ny(this,a,t,r))return-1;var n=t+r;return this.valueHexView=a.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Iy)}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isHexOnly:this.isHexOnly,valueHex:Ft.ToHex(this.valueHexView)})}}]),a}(e),t.NAME="hexBlock",t}var Py=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,a=void 0===r?0:r,n=t.error,i=void 0===n?Ey:n,u=t.warnings,o=void 0===u?[]:u,l=t.valueBeforeDecode,c=void 0===l?By:l;s(this,e),this.blockLength=a,this.error=i,this.warnings=o,this.valueBeforeDecodeView=Kt.toUint8Array(c)}return o(e,[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ft.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]),e}();Py.NAME="baseBlock";var Uy=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}]),r}(Py);Uy.NAME="valueBlock";var Ty=function(e){c(a,e);var t=y(a);function a(){var e,r,n,i,u,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=o.idBlock,c=void 0===l?{}:l;return s(this,a),e=t.call(this),c?(e.isHexOnly=null!==(r=c.isHexOnly)&&void 0!==r&&r,e.valueHexView=c.valueHex?Kt.toUint8Array(c.valueHex):By,e.tagClass=null!==(n=c.tagClass)&&void 0!==n?n:-1,e.tagNumber=null!==(i=c.tagNumber)&&void 0!==i?i:-1,e.isConstructed=null!==(u=c.isConstructed)&&void 0!==u&&u):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return o(a,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Iy}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var a=this.tagNumber;t|=a&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var n=Wt(this.tagNumber,7),i=new Uint8Array(n),s=n.byteLength,u=new Uint8Array(s+1);if(u[0]=31|t,!e){for(var o=0;o<s-1;o++)u[o+1]=128|i[o];u[s]=i[s-1]}return u.buffer}var l=new Uint8Array(this.valueHexView.byteLength+1);if(l[0]=31|t,!e){for(var c=this.valueHexView,h=0;h<c.length-1;h++)l[h+1]=128|c[h];l[this.valueHexView.byteLength]=c[c.length-1]}return l.buffer}},{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!Ny(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{for(var s=1,u=this.valueHexView=new Uint8Array(255),o=255;128&n[s];){if(u[s-1]=127&n[s],++s>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(s===o){o+=255;for(var l=new Uint8Array(o),c=0;c<u.length;c++)l[c]=u[c];u=this.valueHexView=new Uint8Array(o)}}this.blockLength=s+1,u[s-1]=127&n[s];for(var h=new Uint8Array(s),f=0;f<s;f++)h[f]=u[f];(u=this.valueHexView=new Uint8Array(s)).set(h),this.blockLength<=9?this.tagNumber=Xt(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}]),a}(Oy(Py));Ty.NAME="identificationBlock";var Ly=function(e){c(a,e);var t=y(a);function a(){var e,r,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.lenBlock,l=void 0===o?{}:o;return s(this,a),(e=t.call(this)).isIndefiniteForm=null!==(r=l.isIndefiniteForm)&&void 0!==r&&r,e.longFormUsed=null!==(n=l.longFormUsed)&&void 0!==n&&n,e.length=null!==(i=l.length)&&void 0!==i?i:0,e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!Ny(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;var s=t+1,u=a.subarray(s,s+i);return 0===u[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Xt(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var a=Wt(this.length,8);if(a.byteLength>127)return this.error="Too big length",Iy;if(e=new ArrayBuffer(a.byteLength+1),r)return e;var n=new Uint8Array(a);(t=new Uint8Array(e))[0]=128|a.byteLength;for(var i=0;i<a.byteLength;i++)t[i+1]=n[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}]),a}(Py);Ly.NAME="lengthBlock";var My={},Hy=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=r.name,u=void 0===i?Ey:i,o=r.optional,l=void 0!==o&&o,c=r.primitiveSchema,h=g(r,J);return s(this,a),(e=t.call(this,h)).name=u,e.optional=l,c&&(e.primitiveSchema=c),e.idBlock=new Ty(h),e.lenBlock=new Ly(h),e.valueBlock=n?new n(h):new Uy(h),e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"toBER",value:function(e,t){var r=t||new Ay;t||_y(this);var a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;var i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?Iy:r.final()}},{key:"toJSON",value:function(){var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii";return"ascii"===e?this.onAsciiEncoding():Ft.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(Ft.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&$t(this.toBER(),e.toBER())}}]),a}(Py);function _y(e){if(e instanceof My.Constructed){var t,r=C(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;){_y(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}Hy.NAME="BaseBlock";var Ky=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=a.value,u=void 0===i?Ey:i,o=g(a,F);return s(this,r),e=t.call(this,o,n),u&&e.fromString(u),e}return o(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}]),r}(Hy);Ky.NAME="BaseStringBlock";var jy,Jy=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.isHexOnly,i=void 0===n||n,u=g(a,G);return s(this,r),(e=t.call(this,u)).isHexOnly=i,e}return o(r)}(Oy(Uy));Jy.NAME="PrimitiveValueBlock";var Fy=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Jy)).idBlock.isConstructed=!1,e}return o(r)}(Hy);function Gy(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function qy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,a=t,n=new Hy({},Uy),i=new Py;if(!Ny(i,e,t,r))return n.error=i.error,{offset:-1,result:n};var s=e.subarray(t,t+r);if(!s.length)return n.error="Zero buffer length",{offset:-1,result:n};var u=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===u)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=u,r-=n.idBlock.blockLength,u=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===u)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=u,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};var o=Hy;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};o=My.EndOfContent;break;case 1:o=My.Boolean;break;case 2:o=My.Integer;break;case 3:o=My.BitString;break;case 4:o=My.OctetString;break;case 5:o=My.Null;break;case 6:o=My.ObjectIdentifier;break;case 10:o=My.Enumerated;break;case 12:o=My.Utf8String;break;case 13:o=My.RelativeObjectIdentifier;break;case 14:o=My.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:o=My.Sequence;break;case 17:o=My.Set;break;case 18:o=My.NumericString;break;case 19:o=My.PrintableString;break;case 20:o=My.TeletexString;break;case 21:o=My.VideotexString;break;case 22:o=My.IA5String;break;case 23:o=My.UTCTime;break;case 24:o=My.GeneralizedTime;break;case 25:o=My.GraphicString;break;case 26:o=My.VisibleString;break;case 27:o=My.GeneralString;break;case 28:o=My.UniversalString;break;case 29:o=My.CharacterString;break;case 30:o=My.BmpString;break;case 31:o=My.DATE;break;case 32:o=My.TimeOfDay;break;case 33:o=My.DateTime;break;case 34:o=My.Duration;break;default:var l=n.idBlock.isConstructed?new My.Constructed:new My.Primitive;l.idBlock=n.idBlock,l.lenBlock=n.lenBlock,l.warnings=n.warnings,n=l}}else o=n.idBlock.isConstructed?My.Constructed:My.Primitive;return u=(n=Gy(n,o)).fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(a,a+n.blockLength),{offset:u,result:n}}jy=Fy,My.Primitive=jy,Fy.NAME="PRIMITIVE";var Xy,Wy=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?[]:n,u=r.isIndefiniteForm,o=void 0!==u&&u,l=g(r,q);return s(this,a),(e=t.call(this,l)).value=i,e.isIndefiniteForm=o,e}return o(a,[{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);if(!Ny(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var n,i,s=t;n=this.isIndefiniteForm,i=r,(n?1:i)>0;){var u=qy(a,s,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(s=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===Vy)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Vy?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}},{key:"toBER",value:function(e,t){for(var r=t||new Ay,a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?Iy:r.final()}},{key:"toJSON",value:function(){var e,t=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),n=C(this.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.value.push(i.toJSON())}}catch(e){n.e(e)}finally{n.f()}return t}}]),a}(Uy);Wy.NAME="ConstructedValueBlock";var zy=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Wy)).idBlock.isConstructed=!0,e}return o(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=C(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var n=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(n," :\n").concat(t.join("\n")):"".concat(n," :")}}]),r}(Hy);Xy=zy,My.Constructed=Xy,zy.NAME="CONSTRUCTED";var Qy,Yy=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return Iy}}]),r}(Uy);Yy.override="EndOfContentValueBlock";var Zy,$y=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Yy)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return o(r)}(Hy);Qy=$y,My.EndOfContent=Qy,$y.NAME=Vy;var ek=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,Uy)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return o(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}]),r}(Hy);Zy=ek,My.Null=Zy,ek.NAME="NULL";var tk,rk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=g(r,X);return s(this,a),e=t.call(this,i),i.valueHex?e.valueHexView=Kt.toUint8Array(i.valueHex):e.valueHexView=new Uint8Array(1),n&&(e.value=n),e}return o(a,[{key:"value",get:function(){var e,t=C(this.valueHexView);try{for(t.s();!(e=t.n()).done;){if(e.value>0)return!0}}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var a=Kt.toUint8Array(e);return Ny(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Yt.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(Oy(Uy));rk.NAME="BooleanValueBlock";var ak=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,rk)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return o(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}]),r}(Hy);tk=ak,My.Boolean=tk,ak.NAME="BOOLEAN";var nk,ik=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.isConstructed,i=void 0!==n&&n,u=g(r,W);return s(this,a),(e=t.call(this,u)).isConstructed=i,e}return o(a,[{key:"fromBER",value:function(e,t,r){var n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=Wy.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.NAME;if(s===Vy){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==Ry)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=w(h(a.prototype),"fromBER",this).call(this,e,t,r),this.blockLength=r;return n}},{key:"toBER",value:function(e,t){return this.isConstructed?Wy.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{isConstructed:this.isConstructed})}}]),a}(Oy(Wy));ik.NAME="OctetStringValueBlock";var sk=function(e){c(a,e);var t=y(a);function a(){var e,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.idBlock,l=void 0===o?{}:o,c=u.lenBlock,h=void 0===c?{}:c,f=g(u,z);return s(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),ik)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){var i=qy(n,0,n.byteLength);-1!==i.offset&&i.offset===r&&(this.valueBlock.value=[i.result])}}catch(e){}}return w(h(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?zy.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(Ft.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,t=[],r=C(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;n instanceof a&&t.push(n.valueBlock.valueHexView)}}catch(e){r.e(e)}finally{r.f()}return Kt.concat(t)}}]),a}(Hy);nk=sk,My.OctetString=nk,sk.NAME=Ry;var uk,ok=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.unusedBits,i=void 0===n?0:n,u=r.isConstructed,o=void 0!==u&&u,l=g(r,Q);return s(this,a),(e=t.call(this,l)).unusedBits=i,e.isConstructed=o,e.blockLength=e.valueHexView.byteLength,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=-1;if(this.isConstructed){if(-1===(a=Wy.prototype.fromBER.call(this,e,t,r)))return a;var n,i=C(this.value);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=s.constructor.NAME;if(u===Vy){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==Dy)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var o=s.valueBlock;if(this.unusedBits>0&&o.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=o.unusedBits}}catch(e){i.e(e)}finally{i.f()}return a}var l=Kt.toUint8Array(e);if(!Ny(this,l,t,r))return-1;var c=l.subarray(t,t+r);if(this.unusedBits=c[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var h=c.subarray(1);try{if(h.byteLength){var f=qy(h,0,h.byteLength);-1!==f.offset&&f.offset===r-1&&(this.value=[f.result])}}catch(e){}}return this.valueHexView=c.subarray(1),this.blockLength=c.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return Wy.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Iy;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}]),a}(Oy(Wy));ok.NAME="BitStringValueBlock";var lk,ck=function(e){c(a,e);var t=y(a);function a(){var e,n,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=u.idBlock,l=void 0===o?{}:o,c=u.lenBlock,h=void 0===c?{}:c,f=g(u,Y);return s(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),ok)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return o(a,[{key:"fromBER",value:function(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,w(h(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return zy.prototype.onAsciiEncoding.call(this);var e,t=[],r=C(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var n=t.join("");return"".concat(this.constructor.NAME," : ").concat(n.substring(0,n.length-this.valueBlock.unusedBits))}}]),a}(Hy);function hk(e,t){for(var r=new Uint8Array([0]),a=new Uint8Array(e),n=new Uint8Array(t),i=a.slice(0),s=i.length-1,u=n.slice(0),o=u.length-1,l=0,c=0,h=o<s?s:o;h>=0;h--,c++){if(!0==c<u.length)l=i[s-c]+u[o-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=Qt(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=Qt(r,i)),i}function fk(e){if(e>=Cy.length)for(var t=Cy.length;t<=e;t++){for(var r=new Uint8Array([0]),a=Cy[t-1].slice(0),n=a.length-1;n>=0;n--){var i=new Uint8Array([(a[n]<<1)+r[0]]);r[0]=i[0]/10,a[n]=i[0]%10}r[0]>0&&(a=Qt(r,a)),Cy.push(a)}return Cy[e]}function mk(e,t){for(var r,a=0,n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),u=s.length-1,o=i.slice(0),l=o.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[u-c]-o[l-c]-a)<0)a=1,s[u-c]=r+10;else a=0,s[u-c]=r;if(a>0)for(var f=u-l+1;f>=0;f--,c++){if(!((r=s[u-c]-a)<0)){a=0,s[u-c]=r;break}a=1,s[u-c]=r+10}return s.slice()}uk=ck,My.BitString=uk,ck.NAME=Dy;var vk,dk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=g(r,Z);return s(this,a),(e=t.call(this,i))._valueDec=0,i.valueHex&&e.setValueHex(),void 0!==n&&(e.valueDec=n),e}return o(a,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Yt.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Zt(e))}},{key:"fromDER",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this.fromBER(e,t,r);if(-1===n)return n;var i=this.valueHexView;return 0===i[0]&&0!=(128&i[1])?this.valueHexView=i.subarray(1):0!==a&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,r){var n=w(h(a.prototype),"fromBER",this).call(this,e,t,r);return-1===n||this.setValueHex(),n}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),a=0,n=this.valueHexView,i="",s=!1,u=n.byteLength-1;u>=0;u--){e=n[u];for(var o=0;o<8;o++){if(1==(1&e))if(a===t)r=mk(fk(a),r),i="-";else r=hk(r,fk(a));a++,e>>=1}}for(var l=0;l<r.length;l++)r[l]&&(s=!0),s&&(i+=xy.charAt(r[l]));return!1===s&&(i+=xy.charAt(0)),i}}]),a}(Oy(Uy));lk=dk,dk.NAME="IntegerValueBlock",Object.defineProperty(lk.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var gk,pk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a,dk)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return o(r,[{key:"toBigInt",value:function(){return by(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new r({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){by();var t=BigInt(e),a=new Ay,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(Ft.FromHex(n));if(t<0){var s=new Uint8Array(i.length+(128&i[0]?1:0));s[0]|=128;var u=BigInt("0x".concat(Ft.ToHex(s)))+t,o=Kt.toUint8Array(Ft.FromHex(u.toString(16)));o[0]|=128,a.write(o)}else 128&i[0]&&a.write(new Uint8Array([0])),a.write(i);return new r({valueHex:a.final()})}}]),r}(Hy);vk=pk,My.Integer=vk,pk.NAME="INTEGER";var yk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return o(r)}(pk);gk=yk,My.Enumerated=gk,yk.NAME="ENUMERATED";var kk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?-1:n,u=r.isFirstSid,o=void 0!==u&&u,l=g(r,$);return s(this,a),(e=t.call(this,l)).valueDec=i,e.isFirstSid=o,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=Kt.toUint8Array(e);if(!Ny(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xt(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){by();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),a=0;a<r.length;a++)r[a]=parseInt(t.slice(7*a,7*a+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Wt(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",Iy;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=Ft.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}]),a}(Oy(Uy));kk.NAME="sidBlock";var wk,bk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?Ey:n,u=g(r,ee);return s(this,a),(e=t.call(this,u)).value=[],i&&e.fromString(i),e}return o(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new kk;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;0===this.value.length&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var a=this.value[r].toBER(e);if(0===a.byteLength)return this.error=this.value[r].error,Iy;t.push(a)}return Sy(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="",n=!1;do{if(a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,n){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return void(this.value=[])}var u=parseInt(a,10);if(isNaN(u))return;i.valueDec=u+s,n=!1}else{var o=new kk;if(a>Number.MAX_SAFE_INTEGER){by();var l=BigInt(a);o.valueBigInt=l}else if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,n=!0),this.value.push(o)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(a="{".concat(a,"}"),this.value[r].isFirstSid?e="2.{".concat(a," - 80}"):e+=a):e+=a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(Uy);bk.NAME="ObjectIdentifierValueBlock";var Sk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=t.call(this,r,bk)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return o(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(Hy);wk=Sk,My.ObjectIdentifier=wk,Sk.NAME="OBJECT IDENTIFIER";var Nk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?0:n,u=g(r,te);return s(this,a),(e=t.call(this,u)).valueDec=i,e}return o(a,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var a=Kt.toUint8Array(e);if(!Ny(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Xt(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Wt(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",Iy;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i.buffer}},{key:"toString",value:function(){return this.isHexOnly?Ft.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}}]),a}(Oy(Py));Nk.NAME="relativeSidBlock";var Ak,Ck=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?Ey:n,u=g(r,re);return s(this,a),(e=t.call(this,u)).value=[],i&&e.fromString(i),e}return o(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new Nk;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e,t){for(var r=[],a=0;a<this.value.length;a++){var n=this.value[a].toBER(e);if(0===n.byteLength)return this.error=this.value[a].error,Iy;r.push(n)}return Sy(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="";do{a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var n=new Nk;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?a="{".concat(a,"}"):a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(Uy);Ck.NAME="RelativeObjectIdentifierValueBlock";var xk,Ek=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),(e=t.call(this,r,Ck)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return o(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(Hy);Ak=Ek,My.RelativeObjectIdentifier=Ak,Ek.NAME="RelativeObjectIdentifier";var Ik,Bk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return o(r)}(zy);xk=Bk,My.Sequence=xk,Bk.NAME="SEQUENCE";var Vk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return o(r)}(zy);Ik=Vk,My.Set=Ik,Vk.NAME="SET";var Rk=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},r);return s(this,a),(e=t.call(this,n)).isHexOnly=!0,e.value=Ey,e}return o(a,[{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(Oy(Uy));Rk.NAME="StringValueBlock";var Dk=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Rk);Dk.NAME="SimpleStringValueBlock";var Ok=function(e){c(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},e);return s(this,r),t.call(this,a,Dk)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,Kt.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}]),r}(Ky);Ok.NAME="SIMPLE STRING";var Pk,Uk=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=Kt.toUint8Array(e);try{this.valueBlock.value=Ft.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=Ft.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(Ft.FromUtf8String(e)),this.valueBlock.value=e}}]),r}(Ok);Uk.NAME="Utf8StringValueBlock";var Tk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return o(r)}(Uk);Pk=Tk,My.Utf8String=Pk,Tk.NAME="UTF8String";var Lk,Mk=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=Ft.ToUtf16String(e),this.valueBlock.valueHexView=Kt.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ft.FromUtf16String(e))}}]),r}(Ok);Mk.NAME="BmpStringValueBlock";var Hk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},a);return s(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return o(r)}(Mk);Lk=Hk,My.BmpString=Lk,Hk.NAME="BMPString";var _k,Kk=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),a=0;a<t;a++){var n=Wt(e.charCodeAt(a),8),i=new Uint8Array(n);if(!(i.length>4))for(var s=4-i.length,u=i.length-1;u>=0;u--)r[4*a+u+s]=i[u]}this.valueBlock.value=e}}]),r}(Ok);Kk.NAME="UniversalStringValueBlock";var jk,Jk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},a);return s(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return o(r)}(Kk);_k=Jk,My.UniversalString=_k,Jk.NAME="UniversalString";var Fk,Gk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return o(r)}(Ok);jk=Gk,My.NumericString=jk,Gk.NAME="NumericString";var qk,Xk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return o(r)}(Ok);Fk=Xk,My.PrintableString=Fk,Xk.NAME="PrintableString";var Wk,zk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return o(r)}(Ok);qk=zk,My.TeletexString=qk,zk.NAME="TeletexString";var Qk,Yk=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return o(r)}(Ok);Wk=Yk,My.VideotexString=Wk,Yk.NAME="VideotexString";var Zk,$k=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return o(r)}(Ok);Qk=$k,My.IA5String=Qk,$k.NAME="IA5String";var ew,tw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return o(r)}(Ok);Zk=tw,My.GraphicString=Zk,tw.NAME="GraphicString";var rw,aw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return o(r)}(Ok);ew=aw,My.VisibleString=ew,aw.NAME="VisibleString";var nw,iw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return o(r)}(Ok);rw=iw,My.GeneralString=rw,iw.NAME="GeneralString";var sw,uw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return o(r)}(Ok);nw=uw,My.CharacterString=nw,uw.NAME="CharacterString";var ow,lw=function(e){c(a,e);var t=y(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=r.valueDate,u=g(r,ae);if(s(this,a),(e=t.call(this,u)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,n){e.fromString(n),e.valueBlock.valueHexView=new Uint8Array(n.length);for(var o=0;o<n.length;o++)e.valueBlock.valueHexView[o]=n.charCodeAt(o)}return i&&(e.fromDate(i),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return o(a,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,Kt.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=new Array(7);return t[0]=er(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=er(this.month,2),t[2]=er(this.day,2),t[3]=er(this.hour,2),t[4]=er(this.minute,2),t[5]=er(this.second,2),t[6]="Z",t.join("")}return w(h(a.prototype),"toString",this).call(this,e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}]),a}(aw);sw=lw,My.UTCTime=sw,lw.NAME="UTCTime";var cw,hw=function(e){c(a,e);var t=y(a);function a(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,a),null!==(r=(e=t.call(this,n)).millisecond)&&void 0!==r||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return o(a,[{key:"fromDate",value:function(e){w(h(a.prototype),"fromDate",this).call(this,e),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,a="",n="",i=0,s=0,u=0;if("Z"===e[e.length-1])a=e.substring(0,e.length-1),r=!0;else{var o=new Number(e[e.length-1]);if(isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");a=e}if(r){if(-1!==a.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==a.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=a.indexOf("+"),h="";if(-1===c&&(c=a.indexOf("-"),l=-1),-1!==c){if(h=a.substring(c+1),a=a.substring(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=parseInt(h.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=parseInt(h.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");u=l*f}}}var m=a.indexOf(".");if(-1===m&&(m=a.indexOf(",")),-1!==m){var v=new Number("0".concat(a.substring(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),n=a.substring(0,m)}else n=a;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for conversion")}var y=t.exec(n);if(null===y)throw new Error("Wrong input string for conversion");for(var k=1;k<y.length;k++)switch(k){case 1:this.year=parseInt(y[k],10);break;case 2:this.month=parseInt(y[k],10);break;case 3:this.day=parseInt(y[k],10);break;case 4:this.hour=parseInt(y[k],10)+s;break;case 5:this.minute=parseInt(y[k],10)+u;break;case 6:this.second=parseInt(y[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=[];return t.push(er(this.year,4)),t.push(er(this.month,2)),t.push(er(this.day,2)),t.push(er(this.hour,2)),t.push(er(this.minute,2)),t.push(er(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(er(this.millisecond,3))),t.push("Z"),t.join("")}return w(h(a.prototype),"toString",this).call(this,e)}},{key:"toJSON",value:function(){return r(r({},w(h(a.prototype),"toJSON",this).call(this)),{},{millisecond:this.millisecond})}}]),a}(lw);ow=hw,My.GeneralizedTime=ow,hw.NAME="GeneralizedTime";var fw,mw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return o(r)}(Tk);cw=mw,My.DATE=cw,mw.NAME="DATE";var vw,dw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return o(r)}(Tk);fw=dw,My.TimeOfDay=fw,dw.NAME="TimeOfDay";var gw,pw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return o(r)}(Tk);vw=pw,My.DateTime=vw,pw.NAME="DateTime";var yw,kw=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return o(r)}(Tk);gw=kw,My.Duration=gw,kw.NAME="Duration";var ww=function(e){c(r,e);var t=y(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return o(r)}(Tk);yw=ww,My.TIME=yw,ww.NAME="TIME";var bw=null,Sw=function(){function e(){s(this,e)}return o(e,null,[{key:"setEngine",value:function(e,t){bw=Object.assign(t,{name:e}),Uo(e,new Do({name:e,crypto:t}))}},{key:"crypto",get:function(){if(!bw)throw new yt(pt.CRYPTOGRAPHIC_NO_MODULE);return bw}},{key:"isNodePlugin",value:function(){return"undefined"==typeof self&&"undefined"==typeof window}}]),e}();Sw.isNodePlugin()||Sw.setEngine("W3 WebCrypto module",self.crypto);var Nw,Aw=function(){function e(){s(this,e)}return o(e,[{key:"getAlgorithmName",value:function(){return this.namespaceURI}}]),e}(),Cw=function(e){c(a,e);var t,r=y(a);function a(){return s(this,a),r.apply(this,arguments)}return o(a,[{key:"Digest",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t?r=bt.FromString(t,"utf8"):ArrayBuffer.isView(t)?r=new Uint8Array(t.buffer):t instanceof ArrayBuffer?r=new Uint8Array(t):(a=(new XMLSerializer).serializeToString(t),r=bt.FromString(a,"utf8")),e.next=3,Sw.crypto.subtle.digest(this.algorithm,r);case 3:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(Aw),xw=function(e){c(n,e);var t,r,a=y(n);function n(){return s(this,n),a.apply(this,arguments)}return o(n,[{key:"Sign",value:(r=i(regeneratorRuntime.mark((function e(t,r,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=bt.FromString(t,"utf8"),e.abrupt("return",Sw.crypto.subtle.sign(a,r,n));case 2:case"end":return e.stop()}}),e)}))),function(e,t,a){return r.apply(this,arguments)})},{key:"Verify",value:(t=i(regeneratorRuntime.mark((function e(t,r,a,n){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=bt.FromString(t,"utf8"),e.abrupt("return",Sw.crypto.subtle.verify(n||this.algorithm,r,a,i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,a,n){return t.apply(this,arguments)})}]),n}(Aw),Ew="SHA-1",Iw="SHA-256",Bw="SHA-384",Vw="SHA-512",Rw="http://www.w3.org/2000/09/xmldsig#sha1",Dw="http://www.w3.org/2001/04/xmlenc#sha256",Ow="http://www.w3.org/2001/04/xmldsig-more#sha384",Pw="http://www.w3.org/2001/04/xmlenc#sha512",Uw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Ew},e.namespaceURI=Rw,e}return o(r)}(Cw),Tw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Iw},e.namespaceURI=Dw,e}return o(r)}(Cw),Lw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Bw},e.namespaceURI=Ow,e}return o(r)}(Cw),Mw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Vw},e.namespaceURI=Pw,e}return o(r)}(Cw),Hw="ECDSA",_w="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1",Kw="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256",jw="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384",Jw="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512",Fw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Hw,hash:{name:Ew}},e.namespaceURI=_w,e}return o(r)}(xw),Gw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Hw,hash:{name:Iw}},e.namespaceURI=Kw,e}return o(r)}(xw),qw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Hw,hash:{name:Bw}},e.namespaceURI=jw,e}return o(r)}(xw),Xw=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Hw,hash:{name:Vw}},e.namespaceURI=Jw,e}return o(r)}(xw),Ww="HMAC",zw="http://www.w3.org/2000/09/xmldsig#hmac-sha1",Qw="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256",Yw="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384",Zw="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512",$w=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Ww,hash:{name:Ew}},e.namespaceURI=zw,e}return o(r)}(xw),eb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Ww,hash:{name:Iw}},e.namespaceURI=Qw,e}return o(r)}(xw),tb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Ww,hash:{name:Bw}},e.namespaceURI=Yw,e}return o(r)}(xw),rb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:Ww,hash:{name:Vw}},e.namespaceURI=Zw,e}return o(r)}(xw),ab="RSASSA-PKCS1-v1_5",nb="http://www.w3.org/2000/09/xmldsig#rsa-sha1",ib="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",sb="http://www.w3.org/2001/04/xmldsig-more#rsa-sha384",ub="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512",ob=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:ab,hash:{name:Ew}},e.namespaceURI=nb,e}return o(r)}(xw),lb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:ab,hash:{name:Iw}},e.namespaceURI=ib,e}return o(r)}(xw),cb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:ab,hash:{name:Bw}},e.namespaceURI=sb,e}return o(r)}(xw),hb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).algorithm={name:ab,hash:{name:Vw}},e.namespaceURI=ub,e}return o(r)}(xw),fb="RSA-PSS",mb="http://www.w3.org/2007/05/xmldsig-more#rsa-pss",vb=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this)).algorithm={name:fb,hash:{name:Ew}},a.namespaceURI=mb,e&&(a.algorithm.saltLength=e),a}return o(r)}(xw),db=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this,e)).algorithm.hash.name=Ew,a}return o(r)}(vb),gb=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this,e)).algorithm.hash.name=Iw,a}return o(r)}(vb),pb=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this,e)).algorithm.hash.name=Bw,a}return o(r)}(vb),yb=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this,e)).algorithm.hash.name=Vw,a}return o(r)}(vb),kb="http://www.w3.org/2007/05/xmldsig-more#sha1-rsa-MGF1",wb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.call(this)).algorithm={name:fb,hash:{name:Ew}},e.namespaceURI=kb,e}return o(r)}(xw),bb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.call(this)).algorithm.hash.name=Ew,e.algorithm.saltLength=20,e}return o(r)}(wb),Sb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.call(this)).algorithm.hash.name=Iw,e.algorithm.saltLength=32,e}return o(r)}(wb),Nb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.call(this)).algorithm.hash.name=Bw,e.algorithm.saltLength=48,e}return o(r)}(wb),Ab=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.call(this)).algorithm.hash.name=Vw,e.algorithm.saltLength=64,e}return o(r)}(wb);!function(e){e[e.BeforeDocElement=0]="BeforeDocElement",e[e.InsideDocElement=1]="InsideDocElement",e[e.AfterDocElement=2]="AfterDocElement"}(Nw||(Nw={}));var Cb=function(){function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _t;s(this,e),this.propagatedNamespaces=new _t,this.result=[],this.visibleNamespaces=new _t,this.inclusiveNamespacesPrefixList=[],this.state=Nw.BeforeDocElement,this.withComments=t,this.exclusive=r,this.propagatedNamespaces=a}return o(e,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.inclusiveNamespacesPrefixList.join(" ")},set:function(e){this.inclusiveNamespacesPrefixList=e.split(" ")}},{key:"Canonicalize",value:function(e){if(!e)throw new yt(pt.CRYPTOGRAPHIC,"Parameter 1 is not Node");return this.WriteNode(e),this.result.join("")}},{key:"WriteNode",value:function(e){switch(e.nodeType){case wt.Document:case wt.DocumentFragment:this.WriteDocumentNode(e);break;case wt.Element:this.WriteElementNode(e);break;case wt.CDATA:case wt.SignificantWhitespace:case wt.Text:Pt(e.parentNode)||this.WriteTextNode(e);break;case wt.Whitespace:this.state===Nw.InsideDocElement&&this.WriteTextNode(e);break;case wt.Comment:this.WriteCommentNode(e);break;case wt.ProcessingInstruction:this.WriteProcessingInstructionNode(e);break;case wt.EntityReference:for(var t=0;t<e.childNodes.length;t++)this.WriteNode(e.childNodes[t]);break;case wt.Attribute:case wt.EndElement:case wt.EndEntity:throw new yt(pt.CRYPTOGRAPHIC,"Attribute node is impossible here");case wt.DocumentType:case wt.Entity:case wt.Notation:case wt.XmlDeclaration:}}},{key:"WriteDocumentNode",value:function(e){this.state=Nw.BeforeDocElement;for(var t=e.firstChild;null!=t;t=t.nextSibling)this.WriteNode(t)}},{key:"WriteCommentNode",value:function(e){this.withComments&&(this.state===Nw.AfterDocElement?this.result.push(String.fromCharCode(10)+"\x3c!--"):this.result.push("\x3c!--"),this.result.push(this.NormalizeString(e.nodeValue,wt.Comment)),this.state===Nw.BeforeDocElement?this.result.push("--\x3e"+String.fromCharCode(10)):this.result.push("--\x3e"))}},{key:"WriteTextNode",value:function(e){this.result.push(this.NormalizeString(e.nodeValue,e.nodeType))}},{key:"WriteProcessingInstructionNode",value:function(e){var t=e.nodeName||e.tagName;"xml"!==t&&(this.state===Nw.AfterDocElement?this.result.push("\n<?"):this.result.push("<?"),this.result.push(t),e.nodeValue&&(this.result.push(" "),this.result.push(this.NormalizeString(e.nodeValue,wt.ProcessingInstruction))),this.state===Nw.BeforeDocElement?this.result.push("?>\n"):this.result.push("?>"))}},{key:"WriteElementNode",value:function(e){var t=this.state;this.state===Nw.BeforeDocElement&&(this.state=Nw.InsideDocElement),this.result.push("<"),this.result.push(e.nodeName);var r=this.WriteNamespacesAxis(e);this.WriteAttributesAxis(e),this.result.push(">");for(var a=e.firstChild;null!=a;a=a.nextSibling)this.WriteNode(a);for(this.result.push("</"),this.result.push(e.nodeName),this.result.push(">"),t===Nw.BeforeDocElement&&(this.state=Nw.AfterDocElement);r--;)this.visibleNamespaces.Pop()}},{key:"WriteNamespacesAxis",value:function(e){for(var t=this,r=[],a=0,n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(Bb(i)){if("xmlns"===i.localName&&!i.prefix&&!i.nodeValue){var s={prefix:i.prefix,namespace:i.nodeValue};r.push(s),this.visibleNamespaces.Add(s),a++}var u,o=null;(u=/xmlns:([\w\.-]+)/.exec(i.nodeName))&&(o=u[1]);var l=!0;if(this.exclusive&&!this.IsNamespaceInclusive(e,o)){var c=Ib(e,o);if(c>1)l=!1;else if(0===c)continue}if(!this.IsNamespaceRendered(o,i.nodeValue)&&l){var h={prefix:o,namespace:i.nodeValue};r.push(h),this.visibleNamespaces.Add(h),a++}}else if(i.prefix&&!this.IsNamespaceRendered(i.prefix,i.namespaceURI)){var f={prefix:i.prefix,namespace:i.namespaceURI};r.push(f),this.visibleNamespaces.Add(f),a++}}if(!this.IsNamespaceRendered(e.prefix,e.namespaceURI)&&"http://www.w3.org/2000/xmlns/"!==e.namespaceURI){var m={prefix:e.prefix,namespace:e.namespaceURI};r.push(m),this.visibleNamespaces.Add(m),a++}r.sort(xb);var v=null;return r.forEach((function(e){e.prefix!==v&&(v=e.prefix,t.result.push(" xmlns"),e.prefix&&t.result.push(":"+e.prefix),t.result.push('="'),t.result.push(e.namespace),t.result.push('"'))})),a}},{key:"WriteAttributesAxis",value:function(e){for(var t=this,r=[],a=0;a<e.attributes.length;a++){var n=e.attributes[a];Bb(n)||r.push(n)}r.sort(Eb),r.forEach((function(e){null!=e&&(t.result.push(" "),t.result.push(e.nodeName),t.result.push('="'),t.result.push(t.NormalizeString(e.nodeValue,wt.Attribute)),t.result.push('"'))}))}},{key:"NormalizeString",value:function(e,t){var r=[];if(e)for(var a=0;a<e.length;a++){var n=e[a];"<"!==n||t!==wt.Attribute&&!this.IsTextNode(t)?">"===n&&this.IsTextNode(t)?r.push("&gt;"):"&"!==n||t!==wt.Attribute&&!this.IsTextNode(t)?'"'===n&&t===wt.Attribute?r.push("&quot;"):"\t"===n&&t===wt.Attribute?r.push("&#x9;"):"\n"===n&&t===wt.Attribute?r.push("&#xA;"):"\r"===n?r.push("&#xD;"):r.push(n):r.push("&amp;"):r.push("&lt;")}return r.join("")}},{key:"IsTextNode",value:function(e){switch(e){case wt.Text:case wt.CDATA:case wt.SignificantWhitespace:case wt.Whitespace:return!0}return!1}},{key:"IsNamespaceInclusive",value:function(e,t){var r=t||null;return e.prefix!==r&&-1!==this.inclusiveNamespacesPrefixList.indexOf(r||"")}},{key:"IsNamespaceRendered",value:function(e,t){if(t=t||"",!(e=e||"")&&!t)return!0;if("xml"===e&&"http://www.w3.org/XML/1998/namespace"===t)return!0;var r=this.visibleNamespaces.GetPrefix(e);return!!r&&r.namespace===t}}]),e}();function xb(e,t){return e==t?0:e?t?e.prefix?t.prefix?e.prefix<t.prefix?-1:e.prefix>t.prefix?1:0:1:-1:1:-1}function Eb(e,t){if(!e.namespaceURI&&t.namespaceURI)return-1;if(!t.namespaceURI&&e.namespaceURI)return 1;var r=e.namespaceURI+e.localName,a=t.namespaceURI+t.localName;return r===a?0:r<a?-1:1}function Ib(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=t||null;if(e.prefix===a)return++r;if(e.attributes)for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(!Bb(i)&&t&&e.attributes[n].prefix===t)return++r}for(var s=e.firstChild;s;s=s.nextSibling)if(s.nodeType===wt.Element){var u=s,o=Ib(u,t,r);if(s.nodeType===wt.Element&&o)return++r+o}return r}function Bb(e){return!(null===e||e.nodeType!==wt.Attribute||"xmlns"!==e.nodeName&&!/xmlns:/.test(e.nodeName))}var Vb="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",Rb="http://www.w3.org/2001/04/xmlenc#sha256",Db="ds",Ob={CanonicalizationMethod:"CanonicalizationMethod",DigestMethod:"DigestMethod",DigestValue:"DigestValue",DSAKeyValue:"DSAKeyValue",DomainParameters:"DomainParameters",EncryptedKey:"EncryptedKey",HMACOutputLength:"HMACOutputLength",RSAPSSParams:"RSAPSSParams",MaskGenerationFunction:"MaskGenerationFunction",SaltLength:"SaltLength",KeyInfo:"KeyInfo",KeyName:"KeyName",KeyValue:"KeyValue",Modulus:"Modulus",Exponent:"Exponent",Manifest:"Manifest",Object:"Object",Reference:"Reference",RetrievalMethod:"RetrievalMethod",RSAKeyValue:"RSAKeyValue",ECDSAKeyValue:"ECDSAKeyValue",NamedCurve:"NamedCurve",PublicKey:"PublicKey",Signature:"Signature",SignatureMethod:"SignatureMethod",SignatureValue:"SignatureValue",SignedInfo:"SignedInfo",Transform:"Transform",Transforms:"Transforms",X509Data:"X509Data",PGPData:"PGPData",SPKIData:"SPKIData",SPKIexp:"SPKIexp",MgmtData:"MgmtData",X509IssuerSerial:"X509IssuerSerial",X509IssuerName:"X509IssuerName",X509SerialNumber:"X509SerialNumber",X509SKI:"X509SKI",X509SubjectName:"X509SubjectName",X509Certificate:"X509Certificate",X509CRL:"X509CRL",XPath:"XPath",X:"X",Y:"Y"},Pb={Algorithm:"Algorithm",Encoding:"Encoding",Id:"Id",MimeType:"MimeType",Type:"Type",URI:"URI"},Ub={XmlDsigBase64Transform:"http://www.w3.org/2000/09/xmldsig#base64",XmlDsigC14NTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",XmlDsigC14NWithCommentsTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",XmlDsigEnvelopedSignatureTransform:"http://www.w3.org/2000/09/xmldsig#enveloped-signature",XmlDsigXPathTransform:"http://www.w3.org/TR/1999/REC-xpath-19991116",XmlDsigXsltTransform:"http://www.w3.org/TR/1999/REC-xslt-19991116",XmlDsigExcC14NTransform:"http://www.w3.org/2001/10/xml-exc-c14n#",XmlDsigExcC14NWithCommentsTransform:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments",XmlDecryptionTransform:"http://www.w3.org/2002/07/decrypt#XML",XmlLicenseTransform:"urn:mpeg:mpeg21:2003:01-REL-R-NS:licenseTransform"},Tb="http://www.w3.org/2000/09/xmldsig#",Lb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mt);Lb=wy([ct({localName:"xmldsig",namespaceURI:Tb,prefix:Db})],Lb);var Mb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ht);Mb=wy([ct({localName:"xmldsig_collection",namespaceURI:Tb,prefix:Db})],Mb);var Hb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb),_b=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ft({localName:Pb.Algorithm,required:!0,defaultValue:Vb})],_b.prototype,"Algorithm",void 0),_b=wy([ct({localName:Ob.CanonicalizationMethod})],_b);var Kb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ft({localName:Pb.Id,defaultValue:""})],Kb.prototype,"Id",void 0),wy([ft({localName:Pb.MimeType,defaultValue:""})],Kb.prototype,"MimeType",void 0),wy([ft({localName:Pb.Encoding,defaultValue:""})],Kb.prototype,"Encoding",void 0),Kb=wy([ct({localName:Ob.Object})],Kb);var jb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mb);jb=wy([ct({localName:"xmldsig_objects",parser:Kb})],jb);var Jb=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),a=t.call(this),e&&(a.Algorithm=e),a}return o(r)}(Lb);wy([ft({localName:Pb.Algorithm,required:!0,defaultValue:Rb})],Jb.prototype,"Algorithm",void 0),Jb=wy([ct({localName:Ob.DigestMethod})],Jb);var Fb=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===wt.Element){var a=null;switch(r.localName){case Ob.KeyValue:a=NS;break;case Ob.X509Data:a=IS;break;case Ob.SPKIData:a=BS}if(a){var n=new a;n.LoadXml(r),this.Add(n)}}}}}]),r}(Mb);wy([ft({localName:Pb.Id,defaultValue:""})],Fb.prototype,"Id",void 0),Fb=wy([ct({localName:Ob.KeyInfo})],Fb);var Gb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).innerXml=null,e}return o(r,[{key:"GetOutput",value:function(){throw new yt(pt.METHOD_NOT_IMPLEMENTED)}},{key:"LoadInnerXml",value:function(e){if(!e)throw new yt(pt.PARAM_REQUIRED,"node");this.innerXml=e}},{key:"GetInnerXml",value:function(){return this.innerXml}}]),r}(Lb);wy([ft({localName:Pb.Algorithm,defaultValue:""})],Gb.prototype,"Algorithm",void 0),wy([ht({localName:Ob.XPath,defaultValue:""})],Gb.prototype,"XPath",void 0);var qb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm=Ub.XmlDsigBase64Transform,e}return o(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new yt(pt.PARAM_REQUIRED,"innerXml");return bt.FromString(this.innerXml.textContent||"","base64")}}]),r}(Gb=wy([ct({localName:Ob.Transform})],Gb)),Xb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",e.xmlCanonicalizer=new Cb(!1,!1),e}return o(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new yt(pt.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}}]),r}(Gb),Wb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",e.xmlCanonicalizer=new Cb(!0,!1),e}return o(r)}(Xb),zb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature",e}return o(r,[{key:"GetOutput",value:function(){var e;if(!this.innerXml)throw new yt(pt.PARAM_REQUIRED,"innerXml");for(var t=this.innerXml.firstChild,r=[];t;)Ot(t)&&t.localName===Ob.Signature&&t.namespaceURI===Tb&&r.push(t),t=t.nextSibling;for(var a=0,n=r;a<n.length;a++){var i=n[a];null===(e=i.parentNode)||void 0===e||e.removeChild(i)}return this.innerXml}}]),r}(Gb),Qb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#",e.xmlCanonicalizer=new Cb(!1,!0),e}return o(r,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.xmlCanonicalizer.InclusiveNamespacesPrefixList},set:function(e){this.xmlCanonicalizer.InclusiveNamespacesPrefixList=e}},{key:"LoadXml",value:function(e){if(w(h(r.prototype),"LoadXml",this).call(this,e),this.Element&&this.Element.childNodes)for(var t=0;t<this.Element.childNodes.length;t++){var a=this.Element.childNodes[t];if(a&&1===a.nodeType&&"InclusiveNamespaces"===a.localName)this.setInclusiveNamespacesElement(a)}}},{key:"GetOutput",value:function(){if(!this.innerXml)throw new yt(pt.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}},{key:"setInclusiveNamespacesElement",value:function(e){var t=e.getAttribute("PrefixList");t&&t.length>0&&(this.xmlCanonicalizer.InclusiveNamespacesPrefixList=t)}}]),r}(Gb),Yb=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#WithComments",e.xmlCanonicalizer=new Cb(!0,!0),e}return o(r)}(Qb);function Zb(e){return e.parentNode?Zb(e.parentNode):e}var $b=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).Algorithm=Ub.XmlDsigXPathTransform,e}return o(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new yt(pt.PARAM_REQUIRED,"innerXml");this.Filter(Zb(this.innerXml),this.XPath)}},{key:"Filter",value:function(e,t){for(var r=this,a=e.childNodes,n=[],i=0;a&&i<a.length;i++){var s=a.item(i);n.push(s)}n.forEach((function(e){r.Evaluate(e,t)?e.parentNode&&e.parentNode.removeChild(e):r.Filter(e,t)}))}},{key:"GetEvaluator",value:function(e){return"undefined"!=typeof self?null==e.ownerDocument?e:e.ownerDocument:require("xpath")}},{key:"Evaluate",value:function(e,t){try{var r=this.GetEvaluator(e),a=this.GetXml().firstChild,n="boolean(".concat(t,")");return!r.evaluate(n,e,{lookupNamespaceURI:function(e){return a.lookupNamespaceURI(e)}},("undefined"==typeof self?require("xpath"):self).XPathResult.ANY_TYPE,null).booleanValue}catch(e){return!1}}}]),r}(Gb);wy([ht({localName:Ob.XPath,namespaceURI:Tb,prefix:Db,required:!0})],$b.prototype,"XPath",void 0);var eS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){w(h(r.prototype),"OnLoadXml",this).call(this,e),this.items=this.GetIterator().map((function(e){switch(e.Algorithm){case Ub.XmlDsigEnvelopedSignatureTransform:return tS(e,zb);case Ub.XmlDsigC14NTransform:return tS(e,Xb);case Ub.XmlDsigC14NWithCommentsTransform:return tS(e,Wb);case Ub.XmlDsigExcC14NTransform:return tS(e,Qb);case Ub.XmlDsigExcC14NWithCommentsTransform:return tS(e,Yb);case Ub.XmlDsigBase64Transform:return tS(e,qb);case Ub.XmlDsigXPathTransform:return tS(e,$b);default:throw new yt(pt.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.Algorithm)}}))}}]),r}(Mb);function tS(e,t){var r=new t;return r.LoadXml(e.Element),r}eS=wy([ct({localName:Ob.Transforms,parser:Gb})],eS);var rS=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),(a=t.call(this)).DigestMethod=new Jb,e&&(a.Uri=e),a}return o(r)}(Lb);wy([ft({defaultValue:""})],rS.prototype,"Id",void 0),wy([ft({localName:Pb.URI})],rS.prototype,"Uri",void 0),wy([ft({localName:Pb.Type,defaultValue:""})],rS.prototype,"Type",void 0),wy([ht({parser:eS})],rS.prototype,"Transforms",void 0),wy([ht({required:!0,parser:Jb})],rS.prototype,"DigestMethod",void 0),wy([ht({required:!0,localName:Ob.DigestValue,namespaceURI:Tb,prefix:Db,converter:Ut})],rS.prototype,"DigestValue",void 0),rS=wy([ct({localName:Ob.Reference})],rS);var aS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mb);aS=wy([ct({localName:"References",parser:rS})],aS);var nS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===wt.Element&&r.nodeName!==Ob.HMACOutputLength){var a=void 0;if(r.localName===Ob.RSAPSSParams)a=SS;if(a){var n=new a;n.LoadXml(r),this.Add(n)}}}}}]),r}(Mb);nS=wy([ct({localName:"Other"})],nS);var iS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ft({localName:Pb.Algorithm,required:!0,defaultValue:""})],iS.prototype,"Algorithm",void 0),wy([ht({localName:Ob.HMACOutputLength,namespaceURI:Tb,prefix:Db,converter:Tt})],iS.prototype,"HMACOutputLength",void 0),wy([ht({parser:nS,noRoot:!0,minOccurs:0})],iS.prototype,"Any",void 0),iS=wy([ct({localName:Ob.SignatureMethod})],iS);var sS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ft({localName:Pb.Id,defaultValue:""})],sS.prototype,"Id",void 0),wy([ht({parser:_b,required:!0})],sS.prototype,"CanonicalizationMethod",void 0),wy([ht({parser:iS,required:!0})],sS.prototype,"SignatureMethod",void 0),wy([ht({parser:aS,minOccurs:1,noRoot:!0})],sS.prototype,"References",void 0),sS=wy([ct({localName:Ob.SignedInfo})],sS);var uS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ft({localName:Pb.Id,defaultValue:""})],uS.prototype,"Id",void 0),wy([ht({parser:sS,required:!0})],uS.prototype,"SignedInfo",void 0),wy([ht({localName:Ob.SignatureValue,namespaceURI:Tb,prefix:Db,required:!0,converter:Ut,defaultValue:null})],uS.prototype,"SignatureValue",void 0),wy([ht({parser:Fb})],uS.prototype,"KeyInfo",void 0),wy([ht({parser:jb,noRoot:!0})],uS.prototype,"ObjectList",void 0),uS=wy([ct({localName:Ob.Signature})],uS);var oS="http://www.w3.org/2001/04/xmldsig-more#",lS="ecdsa",cS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mt);wy([ht({localName:Ob.X,namespaceURI:oS,prefix:lS,required:!0,converter:Ut})],cS.prototype,"X",void 0),wy([ht({localName:Ob.Y,namespaceURI:oS,prefix:lS,required:!0,converter:Ut})],cS.prototype,"Y",void 0),cS=wy([ct({localName:Ob.PublicKey,namespaceURI:oS,prefix:lS})],cS);var hS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mt);wy([ft({localName:Pb.URI,required:!0})],hS.prototype,"Uri",void 0),hS=wy([ct({localName:Ob.NamedCurve,namespaceURI:oS,prefix:lS})],hS);var fS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mt);wy([ht({parser:hS})],fS.prototype,"NamedCurve",void 0),fS=wy([ct({localName:Ob.DomainParameters,namespaceURI:oS,prefix:lS})],fS);var mS,vS=function(e){c(n,e);var t,r,a=y(n);function n(){var e;return s(this,n),(e=a.apply(this,arguments)).name=Ob.ECDSAKeyValue,e.key=null,e.jwk=null,e.keyUsage=null,e}return o(n,[{key:"NamedCurve",get:function(){return dS(this.DomainParameters.NamedCurve.Uri)}},{key:"importKey",value:(r=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ECDSA"===t.algorithm.name.toUpperCase()){e.next=2;break}throw new yt(pt.ALGORITHM_WRONG_NAME,t.algorithm.name);case 2:return e.next=4,Sw.crypto.subtle.exportKey("jwk",t);case 4:return r=e.sent,this.key=t,this.jwk=r,this.PublicKey=new cS,this.PublicKey.X=bt.FromString(r.x,"base64url"),this.PublicKey.Y=bt.FromString(r.y,"base64url"),this.DomainParameters||(this.DomainParameters=new fS),this.DomainParameters.NamedCurve||(this.DomainParameters.NamedCurve=new hS),this.DomainParameters.NamedCurve.Uri=dS(r.crv),this.keyUsage=t.usages,e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.key){e.next=2;break}return e.abrupt("return",this.key);case 2:return r=bt.ToBase64Url(this.PublicKey.X),a=bt.ToBase64Url(this.PublicKey.Y),n=gS(this.DomainParameters.NamedCurve.Uri),i={kty:"EC",crv:n,x:r,y:a,ext:!0},this.keyUsage=["verify"],e.next=9,Sw.crypto.subtle.importKey("jwk",i,{name:"ECDSA",namedCurve:n},!0,this.keyUsage);case 9:return s=e.sent,this.key=s,e.abrupt("return",this.key);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(Hb);function dS(e){switch(e){case"P-256":return"urn:oid:1.2.840.10045.3.1.7";case"P-384":return"urn:oid:1.3.132.0.34";case"P-521":return"urn:oid:1.3.132.0.35"}throw new yt(pt.CRYPTOGRAPHIC,"Unknown NamedCurve")}function gS(e){switch(e){case"urn:oid:1.2.840.10045.3.1.7":return"P-256";case"urn:oid:1.3.132.0.34":return"P-384";case"urn:oid:1.3.132.0.35":return"P-521"}throw new yt(pt.CRYPTOGRAPHIC,"Unknown NamedCurve OID")}wy([ht({parser:fS})],vS.prototype,"DomainParameters",void 0),wy([ht({parser:cS,required:!0})],vS.prototype,"PublicKey",void 0),vS=wy([ct({localName:Ob.ECDSAKeyValue,namespaceURI:oS,prefix:lS})],vS);var pS={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},yS=function(e){c(n,e);var t,r,a=y(n);function n(){var e;return s(this,n),(e=a.apply(this,arguments)).key=null,e.jwk=null,e.keyUsage=[],e}return o(n,[{key:"importKey",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.algorithm.name.toUpperCase())===ab.toUpperCase()||r===fb.toUpperCase()){e.next=3;break}throw new yt(pt.ALGORITHM_WRONG_NAME,t.algorithm.name);case 3:return this.key=t,e.next=6,Sw.crypto.subtle.exportKey("jwk",t);case 6:return a=e.sent,this.jwk=a,this.Modulus=bt.FromBase64Url(a.n),this.Exponent=bt.FromBase64Url(a.e),this.keyUsage=t.usages,e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:pS,!this.key){e.next=3;break}return e.abrupt("return",this.key);case 3:if(this.Modulus){e.next=5;break}throw new yt(pt.CRYPTOGRAPHIC,"RsaKeyValue has no Modulus");case 5:if(r=bt.ToBase64Url(this.Modulus),this.Exponent){e.next=8;break}throw new yt(pt.CRYPTOGRAPHIC,"RsaKeyValue has no Exponent");case 8:a=bt.ToBase64Url(this.Exponent),e.t0=t.name.toUpperCase(),e.next=e.t0===ab.toUpperCase()?12:e.t0===fb.toUpperCase()?14:16;break;case 12:return n="R",e.abrupt("break",17);case 14:return n="P",e.abrupt("break",17);case 16:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,t.name);case 17:e.t1=t.hash.name.toUpperCase(),e.next=e.t1===Ew?20:e.t1===Iw?22:e.t1===Bw?24:e.t1===Vw?26:28;break;case 20:return n+="S1",e.abrupt("break",28);case 22:return n+="S256",e.abrupt("break",28);case 24:return n+="S384",e.abrupt("break",28);case 26:return n+="S512",e.abrupt("break",28);case 28:return i={kty:"RSA",alg:n,n:r,e:a,ext:!0},e.abrupt("return",Sw.crypto.subtle.importKey("jwk",i,t,!0,this.keyUsage));case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"LoadXml",value:function(e){w(h(n.prototype),"LoadXml",this).call(this,e),this.keyUsage=["verify"]}}]),n}(Hb);wy([ht({localName:Ob.Modulus,prefix:Db,namespaceURI:Tb,required:!0,converter:Ut})],yS.prototype,"Modulus",void 0),wy([ht({localName:Ob.Exponent,prefix:Db,namespaceURI:Tb,required:!0,converter:Ut})],yS.prototype,"Exponent",void 0),yS=wy([ct({localName:Ob.RSAKeyValue})],yS);var kS="http://www.w3.org/2007/05/xmldsig-more#",wS="pss",bS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Mt);wy([ht({parser:Jb})],bS.prototype,"DigestMethod",void 0),wy([ft({localName:Pb.Algorithm,defaultValue:"http://www.w3.org/2007/05/xmldsig-more#MGF1"})],bS.prototype,"Algorithm",void 0),bS=wy([ct({localName:Ob.MaskGenerationFunction,prefix:wS,namespaceURI:kS})],bS);var SS=mS=function(e){c(r,e);var t=y(r);function r(e){var a;return s(this,r),a=t.call(this),e&&a.FromAlgorithm(e),a}return o(r,[{key:"FromAlgorithm",value:function(e){this.DigestMethod=new Jb;var t=DS.GetHashAlgorithm(e.hash);this.DigestMethod.Algorithm=t.namespaceURI,e.saltLength&&(this.SaltLength=e.saltLength)}}],[{key:"FromAlgorithm",value:function(e){return new mS(e)}}]),r}(Mt);wy([ht({parser:Jb})],SS.prototype,"DigestMethod",void 0),wy([ht({parser:bS})],SS.prototype,"MGF",void 0),wy([ht({converter:Tt,prefix:wS,namespaceURI:kS})],SS.prototype,"SaltLength",void 0),wy([ht({converter:Tt})],SS.prototype,"TrailerField",void 0),SS=mS=wy([ct({localName:Ob.RSAPSSParams,prefix:wS,namespaceURI:kS})],SS);var NS=function(e){c(n,e);var t,r,a=y(n);function n(e){var t;return s(this,n),t=a.call(this),e&&(t.Value=e),t}return o(n,[{key:"Value",get:function(){return this.value},set:function(e){this.element=null,this.value=e}},{key:"importKey",value:(r=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.algorithm.name.toUpperCase(),e.next=e.t0===fb.toUpperCase()||e.t0===ab.toUpperCase()?3:e.t0===Hw.toUpperCase()?7:11;break;case 3:return this.Value=new yS,e.next=6,this.Value.importKey(t);case 6:case 10:return e.abrupt("break",12);case 7:return this.Value=new vS,e.next=10,this.Value.importKey(t);case 11:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,t.algorithm.name);case 12:return e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Value){e.next=2;break}throw new yt(pt.NULL_REFERENCE);case 2:return e.abrupt("return",this.Value.exportKey(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"OnGetXml",value:function(e){if(!this.Value)throw new yt(pt.CRYPTOGRAPHIC,"KeyValue has empty value");var t=this.Value.GetXml();t&&e.appendChild(t)}},{key:"OnLoadXml",value:function(e){for(var t=0,r=[yS,vS];t<r.length;t++){var a=r[t];try{for(var n=new a,i=0;i<e.childNodes.length;i++){var s=e.childNodes.item(i);if(Ot(s))return n.LoadXml(s),void(this.value=n)}}catch(e){}}throw new yt(pt.CRYPTOGRAPHIC,"Unsupported KeyValue in use")}}]),n}(Hb);NS=wy([ct({localName:Ob.KeyValue})],NS);var AS,CS={"2.5.4.3":{short:"CN",long:"CommonName"},"2.5.4.6":{short:"C",long:"Country"},"2.5.4.5":{long:"DeviceSerialNumber"},"0.9.2342.19200300.100.1.25":{short:"DC",long:"DomainComponent"},"1.2.840.113549.1.9.1":{short:"E",long:"EMail"},"2.5.4.42":{short:"G",long:"GivenName"},"2.5.4.43":{short:"I",long:"Initials"},"2.5.4.7":{short:"L",long:"Locality"},"2.5.4.10":{short:"O",long:"Organization"},"2.5.4.11":{short:"OU",long:"OrganizationUnit"},"2.5.4.8":{short:"ST",long:"State"},"2.5.4.9":{short:"Street",long:"StreetAddress"},"2.5.4.4":{short:"SN",long:"SurName"},"2.5.4.12":{short:"T",long:"Title"},"1.2.840.113549.1.9.8":{long:"UnstructuredAddress"},"1.2.840.113549.1.9.2":{long:"UnstructuredName"}},xS=function(){function e(t){if(s(this,e),this.publicKey=null,t){var r=new Uint8Array(t);this.LoadRaw(r),this.raw=r}}var t,r;return o(e,[{key:"SerialNumber",get:function(){return this.simpl.serialNumber.valueBlock.toString()}},{key:"Issuer",get:function(){return this.NameToString(this.simpl.issuer)}},{key:"Subject",get:function(){return this.NameToString(this.simpl.subject)}},{key:"Thumbprint",value:(r=i(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"SHA-1",e.abrupt("return",Sw.crypto.subtle.digest(t,this.raw));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"PublicKey",get:function(){return this.publicKey}},{key:"GetRaw",value:function(){return this.raw}},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=15;break}if((r={algorithm:t,usages:["verify"]}).algorithm.name.toUpperCase()!==Hw){e.next=9;break}if(!("crv"in(a=this.simpl.subjectPublicKeyInfo.toJSON()))||!a.crv){e.next=8;break}r.algorithm.namedCurve=a.crv,e.next=9;break;case 8:throw new Error("Cannot get Curved name from the ECDSA public key");case 9:return this.isHashedAlgorithm(r.algorithm)&&"string"==typeof r.algorithm.hash&&(r.algorithm.hash={name:r.algorithm.hash}),e.next=12,this.simpl.getPublicKey({algorithm:r});case 12:return n=e.sent,this.publicKey=n,e.abrupt("return",n);case 15:if("1.2.840.113549.1.1.1"!==this.simpl.subjectPublicKeyInfo.algorithm.algorithmId){e.next=21;break}return e.next=18,this.simpl.getPublicKey({algorithm:{algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]}});case 18:this.publicKey=e.sent,e.next=24;break;case 21:return e.next=23,this.simpl.getPublicKey();case 23:this.publicKey=e.sent;case 24:return e.abrupt("return",this.publicKey);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"NameToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=[];return e.typesAndValues.forEach((function(e){var t=e.type,a=CS[t.toString()],n=a?a.short:null;r.push("".concat(n||t,"=").concat(e.value.valueBlock.value))})),r.join(t+" ")}},{key:"LoadRaw",value:function(e){this.raw=new Uint8Array(e);var t=function(e){if(!e.byteLength){var t=new Hy({},Uy);return t.error="Input buffer has zero length",{offset:-1,result:t}}return qy(Kt.toUint8Array(e).slice(),0,e.byteLength)}(this.raw.buffer);this.simpl=new sh({schema:t.result})}},{key:"isHashedAlgorithm",value:function(e){return!!e.hash}}]),e}(),ES=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Lb);wy([ht({localName:Ob.X509IssuerName,namespaceURI:Tb,prefix:Db,required:!0})],ES.prototype,"X509IssuerName",void 0),wy([ht({localName:Ob.X509SerialNumber,namespaceURI:Tb,prefix:Db,required:!0})],ES.prototype,"X509SerialNumber",void 0),ES=wy([ct({localName:Ob.X509IssuerSerial})],ES),function(e){e[e.None=0]="None",e[e.EndCertOnly=1]="EndCertOnly",e[e.ExcludeRoot=2]="ExcludeRoot",e[e.WholeChain=3]="WholeChain"}(AS||(AS={}));var IS=function(e){c(n,e);var t,r,a=y(n);function n(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AS.None;if(s(this,n),(t=a.call(this)).x509crl=null,t.SubjectKeyIdList=[],e)if(e instanceof Uint8Array)t.AddCertificate(new xS(e));else if(e instanceof xS)switch(r){case AS.None:case AS.EndCertOnly:t.AddCertificate(e);break;case AS.ExcludeRoot:t.AddCertificatesChainFrom(e,!1);break;case AS.WholeChain:t.AddCertificatesChainFrom(e,!0)}return t}return o(n,[{key:"importKey",value:(r=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new yt(pt.METHOD_NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Certificates.length){e.next=2;break}throw new yt(pt.NULL_REFERENCE);case 2:return e.next=4,this.Certificates[0].exportKey(t);case 4:return this.Key=e.sent,e.abrupt("return",this.Key);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Certificates",get:function(){return this.X509CertificateList}},{key:"CRL",get:function(){return this.x509crl},set:function(e){this.x509crl=e}},{key:"IssuerSerials",get:function(){return this.IssuerSerialList}},{key:"SubjectKeyIds",get:function(){return this.SubjectKeyIdList}},{key:"SubjectNames",get:function(){return this.SubjectNameList}},{key:"AddCertificate",value:function(e){if(!e)throw new yt(pt.PARAM_REQUIRED,"certificate");this.X509CertificateList||(this.X509CertificateList=[]),this.X509CertificateList.push(e)}},{key:"AddIssuerSerial",value:function(e,t){if(null==e)throw new yt(pt.PARAM_REQUIRED,"issuerName");null==this.IssuerSerialList&&(this.IssuerSerialList=[]);var r={issuerName:e,serialNumber:t};this.IssuerSerialList.push(r)}},{key:"AddSubjectKeyId",value:function(e){var t;(this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),"string"==typeof e)?null!=e&&(t=bt.FromBase64(e),this.SubjectKeyIdList.push(t)):this.SubjectKeyIdList.push(e)}},{key:"AddSubjectName",value:function(e){null==this.SubjectNameList&&(this.SubjectNameList=[]),this.SubjectNameList.push(e)}},{key:"GetXml",value:function(){var e=this.CreateDocument(),t=this.CreateElement(e),r=this.GetPrefix();if(null!=this.IssuerSerialList&&this.IssuerSerialList.length>0&&this.IssuerSerialList.forEach((function(a){var n=e.createElementNS(Tb,r+Ob.X509IssuerSerial),i=e.createElementNS(Tb,r+Ob.X509IssuerName);i.textContent=a.issuerName,n.appendChild(i);var s=e.createElementNS(Tb,r+Ob.X509SerialNumber);s.textContent=a.serialNumber,n.appendChild(s),t.appendChild(n)})),null!=this.SubjectKeyIdList&&this.SubjectKeyIdList.length>0&&this.SubjectKeyIdList.forEach((function(a){var n=e.createElementNS(Tb,r+Ob.X509SKI);n.textContent=bt.ToBase64(a),t.appendChild(n)})),null!=this.SubjectNameList&&this.SubjectNameList.length>0&&this.SubjectNameList.forEach((function(a){var n=e.createElementNS(Tb,r+Ob.X509SubjectName);n.textContent=a,t.appendChild(n)})),null!=this.X509CertificateList&&this.X509CertificateList.length>0&&this.X509CertificateList.forEach((function(a){var n=e.createElementNS(Tb,r+Ob.X509Certificate);n.textContent=bt.ToBase64(a.GetRaw()),t.appendChild(n)})),null!=this.x509crl){var a=e.createElementNS(Tb,r+Ob.X509CRL);a.textContent=bt.ToBase64(this.x509crl),t.appendChild(a)}return t}},{key:"LoadXml",value:function(e){var t=this;w(h(n.prototype),"LoadXml",this).call(this,e),this.IssuerSerialList&&(this.IssuerSerialList=[]),this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),this.SubjectNameList&&(this.SubjectNameList=[]),this.X509CertificateList&&(this.X509CertificateList=[]),this.x509crl=null;var r=this.GetChildren(Ob.X509IssuerSerial);r&&r.forEach((function(e){var r=Lb.GetChild(e,Ob.X509IssuerName,Tb,!0),a=Lb.GetChild(e,Ob.X509SerialNumber,Tb,!0);r&&r.textContent&&a&&a.textContent&&t.AddIssuerSerial(r.textContent,a.textContent)})),(r=this.GetChildren(Ob.X509SKI))&&r.forEach((function(e){if(e.textContent){var r=bt.FromBase64(e.textContent);t.AddSubjectKeyId(r)}})),null!=(r=this.GetChildren(Ob.X509SubjectName))&&r.forEach((function(e){e.textContent&&t.AddSubjectName(e.textContent)})),(r=this.GetChildren(Ob.X509Certificate))&&r.forEach((function(e){if(e.textContent){var r=bt.FromBase64(e.textContent);t.AddCertificate(new xS(r))}}));var a=this.GetChild(Ob.X509CRL,!1);a&&a.textContent&&(this.x509crl=bt.FromBase64(a.textContent))}},{key:"AddCertificatesChainFrom",value:function(e,t){throw new yt(pt.METHOD_NOT_IMPLEMENTED)}}]),n}(Hb);IS=wy([ct({localName:Ob.X509Data})],IS);var BS=function(e){c(n,e);var t,r,a=y(n);function n(){return s(this,n),a.apply(this,arguments)}return o(n,[{key:"importKey",value:(r=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sw.crypto.subtle.exportKey("spki",t);case 2:return r=e.sent,this.SPKIexp=new Uint8Array(r),this.Key=t,e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=i(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sw.crypto.subtle.importKey("spki",this.SPKIexp,t,!0,["verify"]);case 2:return r=e.sent,this.Key=r,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(Hb);wy([ht({localName:Ob.SPKIexp,namespaceURI:Tb,prefix:Db,required:!0,converter:Ut})],BS.prototype,"SPKIexp",void 0),BS=wy([ct({localName:Ob.SPKIData})],BS);var VS={};VS[nb]=ob,VS[ib]=lb,VS[sb]=cb,VS[ub]=hb,VS[_w]=Fw,VS[Kw]=Gw,VS[jw]=qw,VS[Jw]=Xw,VS[zw]=$w,VS[Qw]=eb,VS[Yw]=tb,VS[Zw]=rb,VS[kb]=bb,VS["http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1"]=Sb,VS["http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1"]=Nb,VS["http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1"]=Ab;var RS={};RS[Rw]=Uw,RS[Dw]=Tw,RS[Ow]=Lw,RS[Pw]=Mw;var DS=function(){function e(){s(this,e)}return o(e,null,[{key:"CreateFromName",value:function(e){var t;switch(e){case Ub.XmlDsigBase64Transform:t=new qb;break;case Ub.XmlDsigC14NTransform:t=new Xb;break;case Ub.XmlDsigC14NWithCommentsTransform:t=new Wb;break;case Ub.XmlDsigEnvelopedSignatureTransform:t=new zb;break;case Ub.XmlDsigXPathTransform:case Ub.XmlDsigXsltTransform:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,e);case Ub.XmlDsigExcC14NTransform:t=new Qb;break;case Ub.XmlDsigExcC14NWithCommentsTransform:t=new Yb;break;case Ub.XmlDecryptionTransform:default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,e)}return t}},{key:"CreateSignatureAlgorithm",value:function(e){var t=VS[e.Algorithm]||null;if(t)return new t;if(e.Algorithm===mb){var r;if(e.Any.Some((function(e){return e instanceof SS&&(r=e),!!r})),r)switch(r.DigestMethod.Algorithm){case Rw:return new db(r.SaltLength);case Dw:return new gb(r.SaltLength);case Ow:return new pb(r.SaltLength);case Pw:return new yb(r.SaltLength)}throw new yt(pt.CRYPTOGRAPHIC,"Cannot get params for RSA-PSS algoriithm")}throw new Error("signature algorithm '".concat(e.Algorithm,"' is not supported"))}},{key:"CreateHashAlgorithm",value:function(e){var t=RS[e];if(t)return new t;throw new Error("hash algorithm '"+e+"' is not supported")}},{key:"GetHashAlgorithm",value:function(e){var t="string"==typeof e?{name:e}:e;switch(t.name.toUpperCase()){case Ew:return new Uw;case Iw:return new Tw;case Bw:return new Lw;case Vw:return new Mw;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,t.name)}}},{key:"GetSignatureAlgorithm",value:function(e){"string"==typeof e.hash&&(e.hash={name:e.hash});var t,r=e.hash.name;if(!r)throw new Error("Signing algorithm doesn't have name for hash");switch(e.name.toUpperCase()){case ab.toUpperCase():switch(r.toUpperCase()){case Ew:t=new ob;break;case Iw:t=new lb;break;case Bw:t=new cb;break;case Vw:t=new hb;break;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case fb.toUpperCase():var a=e.saltLength;switch(r.toUpperCase()){case Ew:t=a?new db(a):new bb;break;case Iw:t=a?new gb(a):new Sb;break;case Bw:t=a?new pb(a):new Nb;break;case Vw:t=a?new yb(a):new Ab;break;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}e.saltLength=t.algorithm.saltLength;break;case Hw:switch(r.toUpperCase()){case Ew:t=new Fw;break;case Iw:t=new Gw;break;case Bw:t=new qw;break;case Vw:t=new Xw;break;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case Ww:switch(r.toUpperCase()){case Ew:t=new $w;break;case Iw:t=new eb;break;case Bw:t=new tb;break;case Vw:t=new rb;break;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;default:throw new yt(pt.ALGORITHM_NOT_SUPPORTED,e.name)}return t}}]),e}(),OS=function(){function e(t){if(s(this,e),this.signature=new uS,t&&t.nodeType===wt.Document)this.document=t;else if(t&&t.nodeType===wt.Element){var r=(new XMLSerializer).serializeToString(t);this.document=(new DOMParser).parseFromString(r,St)}}var t,r,a,n,u,l,c,h,f,m;return o(e,[{key:"XmlSignature",get:function(){return this.signature}},{key:"Signature",get:function(){return this.XmlSignature.SignatureValue}},{key:"Sign",value:(m=i(regeneratorRuntime.mark((function e(t,r,a){var n,i,s,u,o,l,c,h,f,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>3&&void 0!==v[3]?v[3]:{},Pt(a)?a=a.cloneNode(!0).documentElement:Ot(a)&&(a=a.cloneNode(!0)),u=Rt({},t),r.algorithm.hash&&(u.hash=r.algorithm.hash),i=DS.GetSignatureAlgorithm(u),e.next=7,this.ApplySignOptions(this.XmlSignature,t,r,n);case 7:return s=this.XmlSignature.SignedInfo,e.next=10,this.DigestReferences(a);case 10:if(s.SignatureMethod.Algorithm=i.namespaceURI,!(i instanceof vb)){e.next=18;break}"string"==typeof(o=Rt({},r.algorithm,u)).hash&&(o.hash={name:o.hash}),l=new SS(o),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(l),e.next=33;break;case 18:if(Ww.toUpperCase()!==t.name.toUpperCase()){e.next=33;break}c=0,h=r.algorithm,e.t0=h.hash.name.toUpperCase(),e.next=e.t0===Ew?24:e.t0===Iw?26:e.t0===Bw?28:e.t0===Vw?30:32;break;case 24:return c=h.length||160,e.abrupt("break",32);case 26:return c=h.length||256,e.abrupt("break",32);case 28:return c=h.length||384,e.abrupt("break",32);case 30:return c=h.length||512,e.abrupt("break",32);case 32:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=c;case 33:return f=this.TransformSignedInfo(a),e.next=36,i.Sign(f,r,u);case 36:return m=e.sent,this.Key=r,this.XmlSignature.SignatureValue=new Uint8Array(m),Ot(a)&&(this.document=a.ownerDocument),e.abrupt("return",this.XmlSignature);case 41:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return m.apply(this,arguments)})},{key:"SignDetached",value:(f=i(regeneratorRuntime.mark((function e(t,r){var a,n,i,s,u,o,l,c,h,f,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>2&&void 0!==m[2]?m[2]:{},s=Rt({},t),r.algorithm.hash&&(s.hash=r.algorithm.hash),n=DS.GetSignatureAlgorithm(s),e.next=6,this.ApplySignOptions(this.XmlSignature,t,r,a);case 6:return i=this.XmlSignature.SignedInfo,e.next=9,this.DigestDetachedReferences();case 9:if(i.SignatureMethod.Algorithm=n.namespaceURI,!(n instanceof vb)){e.next=17;break}"string"==typeof(u=Rt({},r.algorithm,s)).hash&&(u.hash={name:u.hash}),o=new SS(u),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(o),e.next=32;break;case 17:if(Ww.toUpperCase()!==t.name.toUpperCase()){e.next=32;break}l=0,c=r.algorithm,e.t0=c.hash.name.toUpperCase(),e.next=e.t0===Ew?23:e.t0===Iw?25:e.t0===Bw?27:e.t0===Vw?29:31;break;case 23:return l=c.length||160,e.abrupt("break",31);case 25:return l=c.length||256,e.abrupt("break",31);case 27:return l=c.length||384,e.abrupt("break",31);case 29:return l=c.length||512,e.abrupt("break",31);case 31:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=l;case 32:return h=this.TransformSignedInfo(),e.next=35,n.Sign(h,r,s);case 35:return f=e.sent,this.Key=r,this.XmlSignature.SignatureValue=new Uint8Array(f),e.abrupt("return",this.XmlSignature);case 39:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"Verify",value:(h=i(regeneratorRuntime.mark((function e(t){var r,a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("algorithm"in t&&"usages"in t&&"type"in t?a=t:(a=t.key,r=t.content)),r){e.next=6;break}if((n=this.document)&&n.documentElement){e.next=5;break}throw new yt(pt.NULL_PARAM,"SignedXml","document");case 5:r=n.documentElement;case 6:return(Pt(r)||Ot(r))&&(r=r.cloneNode(!0)),e.next=9,this.ValidateReferences(r);case 9:if(!e.sent){e.next=22;break}if(!a){e.next=15;break}e.t0=[a],e.next=18;break;case 15:return e.next=17,this.GetPublicKeys();case 17:e.t0=e.sent;case 18:return i=e.t0,e.abrupt("return",this.ValidateSignatureValue(i));case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"GetXml",value:function(){return this.signature.GetXml()}},{key:"LoadXml",value:function(e){this.signature=uS.LoadXml(e)}},{key:"toString",value:function(){var e=this.XmlSignature;if(e.SignedInfo.References&&e.SignedInfo.References.Some((function(e){return e.Transforms&&e.Transforms.Some((function(e){return e instanceof zb}))}))){var t=this.document.documentElement.cloneNode(!0),r=this.XmlSignature.GetXml();if(!r)throw new yt(pt.XML_EXCEPTION,"Cannot get Xml element from Signature");var a=r.cloneNode(!0);return t.appendChild(a),(new XMLSerializer).serializeToString(t)}return this.XmlSignature.toString()}},{key:"GetPublicKeys",value:(c=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u,o,l,c,h,f,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=DS.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),a=C(this.XmlSignature.KeyInfo.GetIterator()),e.prev=3,a.s();case 5:if((n=a.n()).done){e.next=35;break}if(!((i=n.value)instanceof IS)){e.next=29;break}s=C(i.Certificates),e.prev=9,s.s();case 11:if((u=s.n()).done){e.next=19;break}return o=u.value,e.next=15,o.exportKey();case 15:l=e.sent,t.push(l);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),s.e(e.t0);case 24:return e.prev=24,s.f(),e.finish(24);case 27:e.next=33;break;case 29:return e.next=31,i.exportKey();case 31:c=e.sent,t.push(c);case 33:e.next=5;break;case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(3),a.e(e.t1);case 40:return e.prev=40,a.f(),e.finish(40);case 43:if(!r.algorithm.name.startsWith("RSA")){e.next=58;break}h=0;case 45:if(!(h<t.length)){e.next=58;break}if(!(f=t[h]).algorithm.name.startsWith("RSA")){e.next=55;break}return e.next=50,Sw.crypto.subtle.exportKey("spki",f);case 50:return m=e.sent,e.next=53,Sw.crypto.subtle.importKey("spki",m,r.algorithm,!0,["verify"]);case 53:v=e.sent,t[h]=v;case 55:h++,e.next=45;break;case 58:return e.abrupt("return",t);case 59:case"end":return e.stop()}}),e,this,[[3,37,40,43],[9,21,24,27]])}))),function(){return c.apply(this,arguments)})},{key:"GetSignatureNamespaces",value:function(){var e={};return this.XmlSignature.NamespaceURI&&(e[this.XmlSignature.Prefix||""]=this.XmlSignature.NamespaceURI),e}},{key:"CopyNamespaces",value:function(e,t,r){var a;this.InjectNamespaces((TS(e,a={}),a),t,r)}},{key:"InjectNamespaces",value:function(e,t,r){for(var a in e){var n=e[a];r&&""===a||t.setAttribute("xmlns"+(a?":"+a:""),n)}}},{key:"DigestReference",value:(l=i(regeneratorRuntime.mark((function e(t,r,a){var n,i,s,u,o,l,c,h,f,m,v,d,g,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHandler){e.next=5;break}return e.next=3,this.contentHandler(r,this);case 3:(n=e.sent)&&(t=Pt(n)?n.documentElement:n);case 5:if(!r.Uri){e.next=30;break}if(r.Uri.indexOf("#xpointer")?"#"===r.Uri[0]&&(i=r.Uri.substring(1)):(s=(s=(s=r.Uri).substring(9).replace(/[\r\n\t\s]/g,"")).length<2||"("!==s[0]||")"!==s[s.length-1]?"":s.substring(1,s.length-1)).length>6&&0===s.indexOf("id(")&&")"===s[s.length-1]&&(i=s.substring(4,s.length-2)),!i){e.next=30;break}u=null,o=[this.XmlSignature.KeyInfo.GetXml()],this.XmlSignature.ObjectList.ForEach((function(e){o.push(e.GetXml())})),l=0,c=o;case 12:if(!(l<c.length)){e.next=27;break}if(!(h=c[l])){e.next=24;break}if(!(u=PS(h,i))){e.next=24;break}return f=u.cloneNode(!0),Ot(t)&&this.CopyNamespaces(t,f,!1),this.Parent&&(m=this.Parent instanceof Mt?this.Parent.GetXml():this.Parent,this.CopyNamespaces(m,f,!0)),this.CopyNamespaces(u,f,!1),this.InjectNamespaces(this.GetSignatureNamespaces(),f,!0),t=f,e.abrupt("break",27);case 24:l++,e.next=12;break;case 27:if(!u&&t&&Ot(t)&&(u=Mt.GetElementById(t,i))&&(v=u.cloneNode(!0),this.CopyNamespaces(u,v,!1),this.CopyNamespaces(t,v,!1),t=v),null!=u){e.next=30;break}throw new yt(pt.CRYPTOGRAPHIC,"Cannot get object by reference: ".concat(i));case 30:if(d=null,!r.Transforms||!r.Transforms.Count){e.next=37;break}if(!Kt.isBufferSource(t)){e.next=34;break}throw new Error("Transformation for argument 'source' of type BufferSource is not implemented");case 34:d=this.ApplyTransforms(r.Transforms,t),e.next=51;break;case 37:if(!r.Uri||"#"===r.Uri[0]){e.next=47;break}if(!Ot(t)){e.next=44;break}if(t.ownerDocument){e.next=41;break}throw new Error("Cannot get ownerDocument from the XML document");case 41:d=(new XMLSerializer).serializeToString(t.ownerDocument),e.next=45;break;case 44:d=Kt.toArrayBuffer(t);case 45:e.next=51;break;case 47:g=new Xb,Kt.isBufferSource(t)&&(t=Et(Ft.ToUtf8String(t)).documentElement),g.LoadInnerXml(t),d=g.GetOutput();case 51:if(r.DigestMethod.Algorithm){e.next=53;break}throw new yt(pt.NULL_PARAM,"Reference","DigestMethod");case 53:return p=DS.CreateHashAlgorithm(r.DigestMethod.Algorithm),e.abrupt("return",p.Digest(d));case 55:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"DigestDetachedReferences",value:(u=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=C(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=20;break}if(!(a=r.value).DigestValue){e.next=7;break}return e.abrupt("continue",18);case 7:if(a.DigestMethod.Algorithm||(a.DigestMethod.Algorithm=(new Tw).namespaceURI),a.DigestSource){e.next=13;break}return e.next=11,this.DigestReference(void 0,a,!1);case 11:return a.DigestValue=e.sent,e.abrupt("continue",18);case 13:return n=DS.CreateHashAlgorithm(a.DigestMethod.Algorithm),e.next=16,n.Digest(a.DigestSource);case 16:i=e.sent,a.DigestValue=i;case 18:e.next=3;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),t.e(e.t0);case 25:return e.prev=25,t.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[1,22,25,28]])}))),function(){return u.apply(this,arguments)})},{key:"DigestReferences",value:(n=i(regeneratorRuntime.mark((function e(t){var r,a,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=C(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=14;break}if(!(n=a.value).DigestValue){e.next=7;break}return e.abrupt("continue",12);case 7:return n.DigestMethod.Algorithm||(n.DigestMethod.Algorithm=(new Tw).namespaceURI),e.next=10,this.DigestReference(t,n,!1);case 10:i=e.sent,n.DigestValue=i;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))),function(e){return n.apply(this,arguments)})},{key:"TransformSignedInfo",value:function(e){var t=DS.CreateFromName(this.XmlSignature.SignedInfo.CanonicalizationMethod.Algorithm),r=this.XmlSignature.SignedInfo.GetXml();if(!r)throw new yt(pt.XML_EXCEPTION,"Cannot get Xml element from SignedInfo");var a=r.cloneNode(!0);if(this.CopyNamespaces(r,a,!1),e&&!Kt.isBufferSource(e)&&(e.nodeType===wt.Document?this.CopyNamespaces(e.documentElement,a,!1):this.CopyNamespaces(e,a,!1)),this.Parent){var n=this.Parent instanceof Mt?this.Parent.GetXml():this.Parent;n&&this.CopyNamespaces(n,a,!1)}var i=Vt(r);for(var s in i){var u=i[s];s!==a.prefix&&a.setAttribute("xmlns"+(s?":"+s:""),u)}return t.LoadInnerXml(a),t.GetOutput()}},{key:"ResolveTransform",value:function(e){if("string"==typeof e)switch(e){case"enveloped":return new zb;case"c14n":return new Xb;case"c14n-com":return new Wb;case"exc-c14n":return new Qb;case"exc-c14n-com":return new Yb;case"base64":return new qb;default:throw new yt(pt.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e)}if("xpath"===e.name){var t=new $b;t.XPath=e.selector;var r=t.GetXml();if(r&&e.namespaces)for(var a=0,n=Object.entries(e.namespaces);a<n.length;a++){var i=b(n[a],2),s=i[0],u=i[1];r.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:".concat(s),u)}return t}throw new yt(pt.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.name)}},{key:"ApplyTransforms",value:function(e,t){var r=null;if(e.Sort((function(e,t){var r=[Xb,Wb,Qb,Yb];return r.some((function(t){return e instanceof t}))?1:r.some((function(e){return t instanceof e}))?-1:0})).ForEach((function(e){e.LoadInnerXml(t),e instanceof $b?e.GetOutput():r=e.GetOutput()})),1===e.Count&&e.Item(0)instanceof zb){var a=new Xb;a.LoadInnerXml(t),r=a.GetOutput()}return r}},{key:"ApplySignOptions",value:(a=i(regeneratorRuntime.mark((function e(t,r,a,n){var i,s,u,o,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.id&&(this.XmlSignature.Id=n.id),!n.keyValue||a.algorithm.name.toUpperCase()===Ww){e.next=8;break}return t.KeyInfo||(t.KeyInfo=new Fb),i=t.KeyInfo,s=new NS,i.Add(s),e.next=8,s.importKey(n.keyValue);case 8:n.x509&&(t.KeyInfo||(t.KeyInfo=new Fb),u=t.KeyInfo,n.x509.forEach((function(e){var t=bt.FromBase64(e),r=new IS(t);u.Add(r)}))),n.references&&n.references.forEach((function(e){var r=new rS;e.id&&(r.Id=e.id),null!==e.uri&&void 0!==e.uri&&(r.Uri=e.uri),e.type&&(r.Type=e.type),e.digestSource&&(r.DigestSource=e.digestSource),e.digestValue&&(r.DigestValue=new Uint8Array(e.digestValue));var a=DS.GetHashAlgorithm(e.hash);if(r.DigestMethod.Algorithm=a.namespaceURI,e.transforms&&e.transforms.length){var n=new eS;e.transforms.forEach((function(e){n.Add(l.ResolveTransform(e))})),r.Transforms=n}t.SignedInfo.References||(t.SignedInfo.References=new aS),t.SignedInfo.References.Add(r)})),t.SignedInfo.References.Count||(o=new rS,t.SignedInfo.References.Add(o));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return a.apply(this,arguments)})},{key:"ValidateReferences",value:(r=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=C(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=15;break}return n=a.value,e.next=7,this.DigestReference(t,n,!1);case 7:if(i=e.sent,s=bt.ToBase64(i),u=bt.ToString(n.DigestValue,"base64"),s===u){e.next=13;break}throw o="Invalid digest for uri '".concat(n.Uri,"'. Calculated digest is ").concat(s," but the xml to validate supplies digest ").concat(u),new yt(pt.CRYPTOGRAPHIC,o);case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this,[[1,17,20,23]])}))),function(e){return r.apply(this,arguments)})},{key:"ValidateSignatureValue",value:(t=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.TransformSignedInfo(this.document),r=DS.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),n=C(t),e.prev=3,n.s();case 5:if((i=n.n()).done){e.next=14;break}return s=i.value,e.next=9,r.Verify(a,s,this.Signature);case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",!0);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})}]),e}();function PS(e,t){if(e.nodeType!==wt.Element)return null;if(e.hasAttribute("Id")&&e.getAttribute("Id")===t)return e;if(e.childNodes&&e.childNodes.length)for(var r=0;r<e.childNodes.length;r++){var a=PS(e.childNodes[r],t);if(a)return a}return null}function US(e,t,r){t in e||(e[t]=r)}function TS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ot(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&US(t,e.prefix?e.prefix:"",e.namespaceURI);for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);a&&"xmlns"===a.prefix&&US(t,a.localName?a.localName:"",a.value)}e.parentNode&&TS(e.parentNode,t)}}var LS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:Jb,required:!0})],LS.prototype,"DigestMethod",void 0),ne([he({localName:Ob.DigestValue,namespaceURI:Tb,prefix:Db,converter:Pe,required:!0})],LS.prototype,"DigestValue",void 0),LS=ne([ce({localName:He.ElementNames.DigestAlgAndValue})],LS);var MS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(ES);MS=ne([ce({localName:He.ElementNames.IssuerSerial,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],MS);var HS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.CertDigest,parser:LS,required:!0})],HS.prototype,"CertDigest",void 0),ne([he({parser:MS,required:!0})],HS.prototype,"IssuerSerial",void 0),ne([fe({localName:He.AttributeNames.URI})],HS.prototype,"Uri",void 0),HS=ne([ce({localName:He.ElementNames.Cert})],HS);var _S=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke),KS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_S=ne([ce({localName:"CertIDList",parser:HS})],_S));KS=ne([ce({localName:He.ElementNames.SigningCertificate})],KS);var jS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],jS.prototype,"Id",void 0),ne([he({localName:He.ElementNames.CertRefs,parser:_S,required:!0})],jS.prototype,"CertRefs",void 0),jS=ne([ce({localName:He.ElementNames.CompleteCertificateRefs})],jS);var JS=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,FS=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,GS=/[^-+\dA-Z]/g;var qS={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},XS={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};function WS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;for(e=String(e);e.length<t;)e="0"+e;return e}function zS(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var a=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-a);var n=(t.getTime()-r.getTime())/6048e5;return 1+Math.floor(n)}function QS(e){var t=e.getDay();return 0===t&&(t=7),t}function YS(e){return null===e?"null":void 0===e?"undefined":"object"!==a(e)?a(e):Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}var ZS=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){e.textContent&&(this.Value=new Date(e.textContent))}},{key:"OnGetXml",value:function(e){this.Format?e.textContent=function(e,t,r,a){if(1!==arguments.length||"string"!==YS(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var n=(t=String(qS[t]||t||qS.default)).slice(0,4);"UTC:"!==n&&"GMT:"!==n||(t=t.slice(4),r=!0,"GMT:"===n&&(a=!0));var i=r?"getUTC":"get",s=e[i+"Date"](),u=e[i+"Day"](),o=e[i+"Month"](),l=e[i+"FullYear"](),c=e[i+"Hours"](),h=e[i+"Minutes"](),f=e[i+"Seconds"](),m=e[i+"Milliseconds"](),v=r?0:e.getTimezoneOffset(),d=zS(e),g=QS(e),p={d:s,dd:WS(s),ddd:XS.dayNames[u],dddd:XS.dayNames[u+7],m:o+1,mm:WS(o+1),mmm:XS.monthNames[o],mmmm:XS.monthNames[o+12],yy:String(l).slice(2),yyyy:l,h:c%12||12,hh:WS(c%12||12),H:c,HH:WS(c),M:h,MM:WS(h),s:f,ss:WS(f),l:WS(m,3),L:WS(Math.round(m/10)),t:c<12?XS.timeNames[0]:XS.timeNames[1],tt:c<12?XS.timeNames[2]:XS.timeNames[3],T:c<12?XS.timeNames[4]:XS.timeNames[5],TT:c<12?XS.timeNames[6]:XS.timeNames[7],Z:a?"GMT":r?"UTC":(String(e).match(FS)||[""]).pop().replace(GS,""),o:(v>0?"-":"+")+WS(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),W:d,N:g};return t.replace(JS,(function(e){return e in p?p[e]:e.slice(1,e.length-1)}))}(this.Value,this.Format):e.textContent=this.Value.toISOString()}}]),r}(_e);ne([me({defaultValue:new Date,required:!0})],ZS.prototype,"Value",void 0),ZS=ne([ce({localName:"XadesDateTime",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],ZS);var $S=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);$S=ne([ce({localName:He.ElementNames.OtherRef})],$S);var eN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);eN=ne([ce({localName:He.ElementNames.OtherRefs})],eN);var tN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.ByName,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,required:!0})],tN.prototype,"ByName",void 0),ne([he({localName:He.ElementNames.ByKey,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,converter:Pe,required:!0})],tN.prototype,"ByKey",void 0),tN=ne([ce({localName:He.ElementNames.OCSPIdentifier})],tN);var rN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.URI,defaultValue:""})],rN.prototype,"URI",void 0),ne([he({parser:tN,required:!0})],rN.prototype,"ResponderID",void 0),ne([he({localName:He.ElementNames.IssueTime,parser:ZS,required:!0})],rN.prototype,"ProducedAt",void 0),rN=ne([ce({localName:He.ElementNames.OCSPIdentifier})],rN);var aN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:rN})],aN.prototype,"OCSPIdentifier",void 0),ne([he({parser:LS,required:!0})],aN.prototype,"DigestAlgAndValue",void 0),aN=ne([ce({localName:He.ElementNames.OCSPRef})],aN);var nN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);nN=ne([ce({localName:He.ElementNames.OCSPRefs})],nN);var iN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.URI,defaultValue:""})],iN.prototype,"URI",void 0),ne([he({localName:He.ElementNames.Issuer,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,required:!0})],iN.prototype,"Issuer",void 0),ne([he({localName:He.ElementNames.IssueTime,parser:ZS,required:!0})],iN.prototype,"IssueTime",void 0),ne([he({localName:He.ElementNames.Number,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,converter:Ue})],iN.prototype,"Number",void 0),iN=ne([ce({localName:He.ElementNames.CRLIdentifier})],iN);var sN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:LS,required:!0})],sN.prototype,"DigestAlgAndValue",void 0),ne([he({parser:iN})],sN.prototype,"CRLIdentifier",void 0),sN=ne([ce({localName:He.ElementNames.CRLRef})],sN);var uN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);uN=ne([ce({localName:He.ElementNames.CRLRefs})],uN);var oN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],oN.prototype,"Id",void 0),ne([he({parser:uN})],oN.prototype,"CRLRefs",void 0),ne([he({parser:nN})],oN.prototype,"OCSPRefs",void 0),ne([he({parser:eN})],oN.prototype,"OtherRefs",void 0),oN=ne([ce({localName:He.ElementNames.CompleteRevocationRefs})],oN);var lN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:uS,required:!0})],lN.prototype,"Signature",void 0),lN=ne([ce({localName:He.ElementNames.CounterSignature})],lN);var cN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.ObjectReference,required:!0})],cN.prototype,"ObjectReference",void 0),ne([he({localName:He.ElementNames.Description,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],cN.prototype,"Description",void 0),ne([he({parser:$e})],cN.prototype,"ObjectIdentifier",void 0),ne([he({localName:He.ElementNames.MimeType,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],cN.prototype,"MimeType",void 0),ne([he({localName:He.ElementNames.Encoding,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],cN.prototype,"Encoding",void 0),cN=ne([ce({localName:He.ElementNames.DataObjectFormat})],cN);var hN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.URI,defaultValue:"",required:!0})],hN.prototype,"Uri",void 0),ne([fe({localName:He.AttributeNames.ReferencedData,defaultValue:!1})],hN.prototype,"ReferencedData",void 0),hN=ne([ce({localName:He.ElementNames.Include})],hN);var fN=function(e){c(r,e);var t=y(r);function r(){var e;return s(this,r),(e=t.apply(this,arguments)).DigestMethod=new Jb,e}return o(r)}(_e);ne([fe({localName:He.AttributeNames.URI,defaultValue:""})],fN.prototype,"Uri",void 0),ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],fN.prototype,"Id",void 0),ne([he({required:!0,parser:Jb})],fN.prototype,"DigestMethod",void 0),ne([he({required:!0,localName:Ob.DigestValue,namespaceURI:Tb,prefix:Db,converter:Pe})],fN.prototype,"DigestValue",void 0),fN=ne([ce({localName:He.ElementNames.ReferenceInfo})],fN);var mN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);mN=ne([ce({localName:"ReferenceInfos",parser:fN})],mN);var vN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);vN=ne([ce({localName:He.ElementNames.EncapsulatedTimeStamp})],vN);var dN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);dN=ne([ce({localName:"EncapsulatedPKIDatas",parser:vN})],dN);var gN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);gN=ne([ce({localName:He.ElementNames.XMLTimeStamp})],gN);var pN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);pN=ne([ce({localName:"XMLTimeStampCollection",parser:gN})],pN);var yN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],yN.prototype,"Id",void 0),ne([he({parser:hN})],yN.prototype,"Include",void 0),ne([he({parser:mN,noRoot:!0})],yN.prototype,"ReferenceInfo",void 0),ne([he({parser:_b})],yN.prototype,"CanonicalizationMethod",void 0),ne([he({parser:dN,noRoot:!0})],yN.prototype,"EncapsulatedTimeStamp",void 0),ne([he({parser:pN,noRoot:!0})],yN.prototype,"XMLTimeStamp",void 0),yN=ne([ce({localName:"GenericTimeStamp"})],yN);var kN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],kN.prototype,"Id",void 0),ne([he({parser:mN,noRoot:!0})],kN.prototype,"ReferenceInfo",void 0),ne([he({parser:_b})],kN.prototype,"CanonicalizationMethod",void 0),ne([he({parser:dN,noRoot:!0})],kN.prototype,"EncapsulatedTimeStamp",void 0),ne([he({parser:pN,noRoot:!0})],kN.prototype,"XMLTimeStamp",void 0),kN=ne([ce({localName:He.ElementNames.OtherTimeStamp})],kN);var wN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],wN.prototype,"Id",void 0),ne([he({parser:hN})],wN.prototype,"Include",void 0),ne([he({parser:_b})],wN.prototype,"CanonicalizationMethod",void 0),ne([he({parser:dN,noRoot:!0})],wN.prototype,"EncapsulatedTimeStamp",void 0),ne([he({parser:pN,noRoot:!0})],wN.prototype,"XMLTimeStamp",void 0);var bN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN=ne([ce({localName:He.ElementNames.XAdESTimeStamp})],wN));bN=ne([ce({localName:He.ElementNames.IndividualDataObjectsTimeStamp})],bN);var SN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);SN=ne([ce({localName:"IndividualDataObjectsTimeStampCollection",parser:bN})],SN);var NN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN);NN=ne([ce({localName:He.ElementNames.AllDataObjectsTimeStamp})],NN);var AN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);AN=ne([ce({localName:"DataObjectFormatCollection",parser:cN})],AN);var CN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);CN=ne([ce({localName:"CommitmentTypeIndicationCollection",parser:nt})],CN);var xN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);xN=ne([ce({localName:"AllDataObjectsTimeStampCollection",parser:NN})],xN);var EN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],EN.prototype,"Id",void 0),ne([he({parser:AN,noRoot:!0})],EN.prototype,"DataObjectFormats",void 0),ne([he({parser:CN,noRoot:!0})],EN.prototype,"CommitmentTypeIndications",void 0),ne([he({parser:xN,noRoot:!0})],EN.prototype,"AllDataObjectsTimeStamps",void 0),ne([he({parser:SN,noRoot:!0})],EN.prototype,"IndividualDataObjectsTimeStamps",void 0),EN=ne([ce({localName:He.ElementNames.SignedDataObjectProperties})],EN);var IN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}($e);IN=ne([ce({localName:He.ElementNames.SigPolicyId})],IN);var BN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(LS);BN=ne([ce({localName:He.ElementNames.SigPolicyHash})],BN);var VN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Je);VN=ne([ce({localName:He.ElementNames.SigPolicyQualifier})],VN);var RN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([me({converter:Ue,required:!0})],RN.prototype,"Value",void 0),RN=ne([ce({localName:"int"})],RN);var DN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);DN=ne([ce({localName:"IntegerList",parser:RN})],DN);var ON=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.Organization,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,required:!0})],ON.prototype,"Organization",void 0),ne([he({localName:He.ElementNames.NoticeNumbers,parser:DN,required:!0})],ON.prototype,"NoticeNumbers",void 0),ON=ne([ce({localName:He.ElementNames.NoticeRef})],ON);var PN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.NoticeRef,parser:ON})],PN.prototype,"NoticeRef",void 0),ne([he({localName:He.ElementNames.ExplicitText,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],PN.prototype,"ExplicitText",void 0),PN=ne([ce({localName:He.ElementNames.SPUserNotice})],PN);var UN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([me()],UN.prototype,"Value",void 0),UN=ne([ce({localName:He.ElementNames.SPURI})],UN);var TN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);TN=ne([ce({localName:He.ElementNames.SigPolicyQualifiers,parser:VN})],TN);var LN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.SigPolicyId,parser:IN,required:!0})],LN.prototype,"SigPolicyId",void 0),ne([he({parser:eS})],LN.prototype,"Transforms",void 0),ne([he({localName:He.ElementNames.SigPolicyHash,parser:BN,required:!0})],LN.prototype,"SigPolicyHash",void 0),ne([he({localName:He.ElementNames.SigPolicyQualifiers,parser:TN})],LN.prototype,"SigPolicyQualifiers",void 0),LN=ne([ce({localName:He.ElementNames.SignaturePolicyId})],LN);var MN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.SignaturePolicyId,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,parser:LN})],MN.prototype,"SignaturePolicyId",void 0),ne([he({localName:He.ElementNames.SignaturePolicyImplied,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,converter:{set:function(e){return!0},get:function(e){return""}},defaultValue:!1})],MN.prototype,"SignaturePolicyImplied",void 0),MN=ne([ce({localName:He.ElementNames.SignaturePolicyIdentifier})],MN);var HN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.City,defaultValue:"",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],HN.prototype,"City",void 0),ne([he({localName:He.ElementNames.StateOrProvince,defaultValue:"",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],HN.prototype,"StateOrProvince",void 0),ne([he({localName:He.ElementNames.PostalCode,defaultValue:"",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],HN.prototype,"PostalCode",void 0),ne([he({localName:He.ElementNames.CountryName,defaultValue:"",namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix})],HN.prototype,"CountryName",void 0),HN=ne([ce({localName:He.ElementNames.SignatureProductionPlace})],HN);var _N=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);_N=ne([ce({localName:He.ElementNames.ClaimedRole})],_N);var KN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);KN=ne([ce({localName:He.ElementNames.ClaimedRoles,parser:_N})],KN);var jN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);jN=ne([ce({localName:He.ElementNames.CertifiedRole})],jN);var JN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);JN=ne([ce({localName:He.ElementNames.CertifiedRoles,parser:jN})],JN);var FN,GN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({parser:KN})],GN.prototype,"ClaimedRoles",void 0),ne([he({parser:JN})],GN.prototype,"CertifiedRoles",void 0),GN=ne([ce({localName:He.ElementNames.SignerRole})],GN);var qN=FN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([he({localName:He.ElementNames.CertDigest,parser:LS,required:!0})],qN.prototype,"CertDigest",void 0),ne([he({localName:He.ElementNames.IssuerSerialV2,namespaceURI:He.NamespaceURI,prefix:He.DefaultPrefix,converter:Pe,required:!1})],qN.prototype,"IssuerSerial",void 0),ne([fe({localName:He.AttributeNames.URI})],qN.prototype,"Uri",void 0),qN=FN=ne([ce({localName:He.ElementNames.Cert,parser:FN})],qN);var XN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke),WN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(XN=ne([ce({localName:"CertIDListV2",parser:qN})],XN));WN=ne([ce({localName:He.ElementNames.SigningCertificateV2})],WN);var zN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],zN.prototype,"Id",void 0),ne([he({localName:He.ElementNames.SigningTime,parser:ZS})],zN.prototype,"SigningTime",void 0),ne([he({parser:KS})],zN.prototype,"SigningCertificate",void 0),ne([he({parser:WN})],zN.prototype,"SigningCertificateV2",void 0),ne([he({parser:MN})],zN.prototype,"SignaturePolicyIdentifier",void 0),ne([he({parser:HN})],zN.prototype,"SignatureProductionPlace",void 0),ne([he({parser:GN})],zN.prototype,"SignerRole",void 0),zN=ne([ce({localName:He.ElementNames.SignedSignatureProperties})],zN);var QN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],QN.prototype,"Id",void 0),ne([he({parser:zN})],QN.prototype,"SignedSignatureProperties",void 0),ne([he({parser:EN})],QN.prototype,"SignedDataObjectProperties",void 0),QN=ne([ce({localName:He.ElementNames.SignedProperties})],QN);var YN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(je);YN=ne([ce({localName:He.ElementNames.UnsignedDataObjectProperty})],YN);var ZN=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],ZN.prototype,"Id",void 0),ZN=ne([ce({localName:He.ElementNames.UnsignedSignatureProperties,parser:YN})],ZN);var $N=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);$N=ne([ce({localName:He.ElementNames.OtherValue})],$N);var eA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);eA=ne([ce({localName:He.ElementNames.OCSPValues,parser:$N})],eA);var tA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);tA=ne([ce({localName:He.ElementNames.EncapsulatedOCSPValue})],tA);var rA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);rA=ne([ce({localName:He.ElementNames.OCSPValues,parser:tA})],rA);var aA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Fe);aA=ne([ce({localName:He.ElementNames.EncapsulatedCRLValue})],aA);var nA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Ke);nA=ne([ce({localName:He.ElementNames.CRLValues,parser:aA})],nA);var iA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],iA.prototype,"Id",void 0),ne([he({parser:nA})],iA.prototype,"CRLValues",void 0),ne([he({parser:rA})],iA.prototype,"OCSPValues",void 0),ne([he({parser:eA})],iA.prototype,"OtherValues",void 0),iA=ne([ce({localName:He.ElementNames.RevocationValues})],iA);var sA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN);sA=ne([ce({localName:He.ElementNames.SignatureTimeStamp})],sA);var uA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN);uA=ne([ce({localName:He.ElementNames.SigAndRefsTimeStamp})],uA);var oA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN);oA=ne([ce({localName:He.ElementNames.RefsOnlyTimeStamp})],oA);var lA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(wN);lA=ne([ce({localName:He.ElementNames.ArchiveTimeStamp})],lA);var cA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(jS);cA=ne([ce({localName:He.ElementNames.AttributeCertificateRefs})],cA);var hA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(oN);hA=ne([ce({localName:He.ElementNames.AttributeRevocationRefs})],hA);var fA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(ze);fA=ne([ce({localName:He.ElementNames.AttrAuthoritiesCertValues})],fA);var mA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(iA);mA=ne([ce({localName:He.ElementNames.AttributeRevocationValues})],mA);var vA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);vA=ne([ce({localName:"UnsignedSignatureProperty"})],vA);var dA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"OnLoadXml",value:function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes.item(t);if(r.nodeType===be.Element){var a=void 0;switch(r.localName){case He.ElementNames.CounterSignature:a=lN;break;case He.ElementNames.SignatureTimeStamp:a=sA;break;case He.ElementNames.CompleteCertificateRefs:a=jS;break;case He.ElementNames.CompleteRevocationRefs:a=oN;break;case He.ElementNames.AttributeCertificateRefs:a=cA;break;case He.ElementNames.AttributeRevocationRefs:a=hA;break;case He.ElementNames.SigAndRefsTimeStamp:a=uA;break;case He.ElementNames.RefsOnlyTimeStamp:a=oA;break;case He.ElementNames.CertificateValues:a=ze;break;case He.ElementNames.RevocationValues:a=iA;break;case He.ElementNames.AttrAuthoritiesCertValues:a=fA;break;case He.ElementNames.AttributeRevocationValues:a=mA;break;case He.ElementNames.ArchiveTimeStamp:a=lA}if(a){var n=a.LoadXml(r);this.Add(n)}}}}}]),r}(Ke);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],dA.prototype,"Id",void 0),dA=ne([ce({localName:He.ElementNames.UnsignedSignatureProperties,parser:vA})],dA);var gA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],gA.prototype,"Id",void 0),ne([he({parser:dA})],gA.prototype,"UnsignedSignatureProperties",void 0),ne([he({parser:ZN})],gA.prototype,"UnsignedDataObjectProperties",void 0),gA=ne([ce({localName:He.ElementNames.UnsignedProperties})],gA);var pA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.Target,required:!0})],pA.prototype,"Target",void 0),ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],pA.prototype,"Id",void 0),ne([he({parser:QN})],pA.prototype,"SignedProperties",void 0),ne([he({parser:gA})],pA.prototype,"UnsignedProperties",void 0),pA=ne([ce({localName:He.ElementNames.QualifyingProperties})],pA);var yA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(_e);ne([fe({localName:He.AttributeNames.URI,required:!0})],yA.prototype,"Uri",void 0),ne([fe({localName:He.AttributeNames.Id,defaultValue:""})],yA.prototype,"Id",void 0),yA=ne([ce({localName:He.ElementNames.QualifyingPropertiesReference})],yA);var kA=function(e){c(r,e);var t=y(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r)}(Kb);ne([he({parser:pA})],kA.prototype,"QualifyingProperties",void 0),kA=ne([ce({localName:Ob.Object})],kA);var wA=Object.freeze({__proto__:null,get Any(){return je},get AnyCollection(){return Je},get OtherCertificate(){return Ge},get OtherCertificateCollection(){return qe},get EncapsulatedX509Certificate(){return Xe},get EncapsulatedX509CertificateCollection(){return We},get CertificateValues(){return ze},get CommitmentTypeQualifier(){return et},get CommitmentTypeQualifiers(){return tt},get ObjectReference(){return rt},get ObjectReferenceCollection(){return at},get CommitmentTypeIndication(){return nt},get CompleteCertificateRefs(){return jS},get OtherRef(){return $S},get OtherRefs(){return eN},get ResponderID(){return tN},get OCSPIdentifier(){return rN},get OCSPRef(){return aN},get OCSPRefs(){return nN},get CRLIdentifier(){return iN},get CRLRef(){return sN},get CRLRefs(){return uN},get CompleteRevocationRefs(){return oN},get CounterSignature(){return lN},get DataObjectFormat(){return cN},get XadesDateTime(){return ZS},get EncapsulatedPKIData(){return Fe},get Include(){return hN},get ReferenceInfo(){return fN},get ReferenceInfos(){return mN},get EncapsulatedTimeStamp(){return vN},get EncapsulatedTimeStampCollection(){return dN},get XMLTimeStamp(){return gN},get XMLTimeStampCollection(){return pN},get GenericTimeStamp(){return yN},get Identifier(){return Qe},get DocumentationReference(){return Ye},get DocumentationReferences(){return Ze},get ObjectIdentifier(){return $e},get OtherTimeStamp(){return kN},get QualifyingProperties(){return pA},get QualifyingPropertiesReference(){return yA},get OtherValue(){return $N},get OtherValues(){return eA},get EncapsulatedOCSPValue(){return tA},get OCSPValues(){return rA},get EncapsulatedCRLValue(){return aA},get CRLValues(){return nA},get RevocationValues(){return iA},get SigPolicyId(){return IN},get SigPolicyHash(){return BN},get SigPolicyQualifier(){return VN},get Integer(){return RN},get IntegerList(){return DN},get NoticeReference(){return ON},get SPUserNotice(){return PN},get SPURI(){return UN},get SigPolicyQualifiers(){return TN},get SignaturePolicyId(){return LN},get SignaturePolicyIdentifier(){return MN},get SignatureProductionPlace(){return HN},get IndividualDataObjectsTimeStamp(){return bN},get IndividualDataObjectsTimeStampCollection(){return SN},get AllDataObjectsTimeStamp(){return NN},get DataObjectFormatCollection(){return AN},get CommitmentTypeIndicationCollection(){return CN},get AllDataObjectsTimeStampCollection(){return xN},get SignedDataObjectProperties(){return EN},get SignedProperties(){return QN},get SignedSignatureProperties(){return zN},get ClaimedRole(){return _N},get ClaimedRoles(){return KN},get CertifiedRole(){return jN},get CertifiedRoles(){return JN},get SignerRole(){return GN},get DigestAlgAndValueType(){return LS},get IssuerSerial(){return MS},get Cert(){return HS},get CertIDList(){return _S},get SigningCertificate(){return KS},get CertV2(){return qN},get CertIDListV2(){return XN},get SigningCertificateV2(){return WN},get UnsignedDataObjectProperty(){return YN},get UnsignedDataObjectProperties(){return ZN},get UnsignedProperties(){return gA},get SignatureTimeStamp(){return sA},get SigAndRefsTimeStamp(){return uA},get RefsOnlyTimeStamp(){return oA},get ArchiveTimeStamp(){return lA},get AttributeCertificateRefs(){return cA},get AttributeRevocationRefs(){return hA},get AttrAuthoritiesCertValues(){return fA},get AttributeRevocationValues(){return mA},get UnsignedSignatureProperty(){return vA},get UnsignedSignatureProperties(){return dA},get XAdESTimeStamp(){return wN},get DataObject(){return kA},XmlXades:He}),bA=function(e){c(d,e);var t,r,n,u,l,f,m,v=y(d);function d(e){var t;return s(this,d),(t=v.call(this,e)).properties=null,t.CreateQualifyingProperties(),t}return o(d,[{key:"Properties",get:function(){return this.properties}},{key:"SignedProperties",get:function(){if(!this.Properties)throw new ke(ye.XML_EXCEPTION,"Properties is empty");return this.Properties.SignedProperties}},{key:"UnsignedProperties",get:function(){if(!this.Properties)throw new ke(ye.XML_EXCEPTION,"Properties is empty");return this.Properties.UnsignedProperties}},{key:"LoadXml",value:function(e,t){w(h(d.prototype),"LoadXml",this).call(this,e);var r=null;this.XmlSignature.ObjectList.Some((function(e){if(e.Element)for(var t=0;t<e.Element.childNodes.length;t++){var a=e.Element.childNodes.item(t);if(a.nodeType===be.Element&&a.localName===He.ElementNames.QualifyingProperties)return r=pA.LoadXml(a),!0}return!1})),this.properties=r}},{key:"Sign",value:(m=i(regeneratorRuntime.mark((function e(t,r,a,n){var i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(h(d.prototype),"Sign",this).apply(this,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return m.apply(this,arguments)})},{key:"SignDetached",value:(f=i(regeneratorRuntime.mark((function e(t,r,a){var n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(h(d.prototype),"SignDetached",this).apply(this,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"CreateQualifyingProperties",value:function(){var e,t;if(this.Properties)throw new ke(ye.XML_EXCEPTION,"Cannot create QualifyingProperties cause current signature has got one. You must create CounterSignature");var r=Sw.crypto.getRandomValues(new Uint8Array(6)),a=Se.ToHex(r);(e=this.XmlSignature).Id||(e.Id="id-".concat(a));var n=new kA;n.QualifyingProperties.Target="#".concat(this.XmlSignature.Id),(t=n.QualifyingProperties.SignedProperties).Id||(t.Id="xades-".concat(this.XmlSignature.Id)),this.properties=n.QualifyingProperties,this.XmlSignature.ObjectList.Add(n)}},{key:"ApplySignOptions",value:(l=i(regeneratorRuntime.mark((function e(t,r,a,n){var i,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(h(d.prototype),"ApplySignOptions",this).call(this,t,r,a,n);case 2:if(!this.Properties){e.next=21;break}return(i=this.Properties.SignedProperties.SignedSignatureProperties).SigningTime.Value=new Date,n.signingTime&&(n.signingTime.value&&(i.SigningTime.Value=n.signingTime.value),n.signingTime.format&&(i.SigningTime.Format=n.signingTime.format)),s=Ve({},r,a.algorithm),u=s.hash,(o=new rS).Type="http://uri.etsi.org/01903#SignedProperties",o.Uri="#".concat(this.Properties.SignedProperties.Id),o.DigestMethod.Algorithm=DS.GetHashAlgorithm(u).namespaceURI,t.SignedInfo.References.Add(o),e.next=15,this.ApplySigningCertificate(n.signingCertificate);case 15:return e.next=17,this.ApplySigningCertificateV2(n.signingCertificateV2);case 17:return e.next=19,this.ApplySignaturePolicyIdentifier(n.policy);case 19:this.ApplySignatureProductionPlace(n.productionPlace),this.ApplySignerRoles(n.signerRole);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return l.apply(this,arguments)})},{key:"ApplySigningCertificate",value:(u=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties||!t){e.next=19;break}if((r="string"==typeof t?{certificate:t}:t).digestAlgorithm||(r.digestAlgorithm="SHA-256"),a=Se.FromBase64(r.certificate),n=new xS(a),!this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Count){e.next=8;break}throw new ke(ye.XML_EXCEPTION,"Signature can contain only one SigningCertificate");case 8:return(i=new HS).IssuerSerial.X509IssuerName=n.Issuer,i.IssuerSerial.X509SerialNumber=n.SerialNumber,s=DS.GetHashAlgorithm(r.digestAlgorithm),i.CertDigest.DigestMethod.Algorithm=s.namespaceURI,e.t0=Uint8Array,e.next=16,n.Thumbprint(s.algorithm.name);case 16:e.t1=e.sent,i.CertDigest.DigestValue=new e.t0(e.t1),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificate.Add(i);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"ApplySigningCertificateV2",value:(n=i(regeneratorRuntime.mark((function e(t){var r,a,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties||!t){e.next=17;break}if((r="string"==typeof t?{certificate:t}:t).digestAlgorithm||(r.digestAlgorithm="SHA-256"),a=Se.FromBase64(r.certificate),n=new xS(a),!this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificateV2.Count){e.next=8;break}throw new ke(ye.XML_EXCEPTION,"Signature can contain only one SigningCertificateV2");case 8:return i=new qN,s=DS.GetHashAlgorithm(r.digestAlgorithm),i.CertDigest.DigestMethod.Algorithm=s.namespaceURI,e.t0=Uint8Array,e.next=14,n.Thumbprint(s.algorithm.name);case 14:e.t1=e.sent,i.CertDigest.DigestValue=new e.t0(e.t1),this.Properties.SignedProperties.SignedSignatureProperties.SigningCertificateV2.Add(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"ApplySignaturePolicyIdentifier",value:(r=i(regeneratorRuntime.mark((function e(t){var r,n,i,s,u,o,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Properties){e.next=33;break}if(r=this.Properties.SignedProperties.SignedSignatureProperties,!t||"object"!==a(t)){e.next=32;break}if((n=new LN).SigPolicyId=new IN,n.SigPolicyId.Identifier=new Qe,t.identifier.qualifier&&(n.SigPolicyId.Identifier.Qualifier=t.identifier.qualifier),n.SigPolicyId.Identifier.Value=t.identifier.value,t.identifier.description&&(n.SigPolicyId.Description=t.identifier.description),t.identifier.references&&(n.SigPolicyId.DocumentationReferences=new Ze,t.identifier.references.forEach((function(e){var t=new Ye;t.Uri=e,n.SigPolicyId.DocumentationReferences.Add(t)}))),t.transforms&&t.transforms.length&&(n.Transforms=new eS,t.transforms.forEach((function(e){n.Transforms.Add(l.ResolveTransform(e))}))),n.SigPolicyHash=new BN,n.SigPolicyHash.DigestMethod=new Jb,i=DS.GetHashAlgorithm(t.hash),n.SigPolicyHash.DigestMethod.Algorithm=i.namespaceURI,!t.digestValue){e.next=19;break}n.SigPolicyHash.DigestValue=Se.FromBase64(t.digestValue),e.next=27;break;case 19:return s=n.SigPolicyId.Identifier.GetXml().cloneNode(!0),this.CopyNamespaces(s,s,!0),this.InjectNamespaces(this.GetSignatureNamespaces(),s,!0),u=null,n.Transforms&&n.Transforms.Count?u=this.ApplyTransforms(n.Transforms,s):((o=new Xb).LoadInnerXml(s),u=o.GetOutput()),e.next=26,i.Digest(u);case 26:n.SigPolicyHash.DigestValue=e.sent;case 27:t.qualifiers&&(n.SigPolicyQualifiers=new TN,t.qualifiers.forEach((function(e){var t=new VN;if("string"==typeof e){var r=new UN;r.Value=e,t.Add(r)}else{var a=new PN;e.explicitText&&(a.ExplicitText=e.explicitText),e.noticeRef&&(a.NoticeRef=new ON,a.NoticeRef.Organization=e.noticeRef.organization,a.NoticeRef.NoticeNumbers=new DN,e.noticeRef.noticeNumbers&&e.noticeRef.noticeNumbers.forEach((function(e){var t=new RN;t.Value=e,a.NoticeRef.NoticeNumbers.Add(t)}))),t.Add(a)}n.SigPolicyQualifiers.Add(t)}))),r.SignaturePolicyIdentifier.SignaturePolicyId=n,r.SignaturePolicyIdentifier.SignaturePolicyImplied=!1,e.next=33;break;case 32:t&&(r.SignaturePolicyIdentifier.SignaturePolicyImplied=!0);case 33:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"ApplySignatureProductionPlace",value:function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.city&&(t.SignatureProductionPlace.City=e.city),e.code&&(t.SignatureProductionPlace.PostalCode=e.code),e.country&&(t.SignatureProductionPlace.CountryName=e.country),e.state&&(t.SignatureProductionPlace.StateOrProvince=e.state)}}},{key:"ApplySignerRoles",value:function(e){if(this.Properties&&e){var t=this.Properties.SignedProperties.SignedSignatureProperties;e.claimed&&e.claimed.forEach((function(e){var r=new _N;r.Value=e,t.SignerRole.ClaimedRoles.Add(r)})),e.certified&&e.certified.forEach((function(e){var r=new jN;r.Encoding="der",r.Value=Se.FromBase64(e),t.SignerRole.CertifiedRoles.Add(r)}))}}},{key:"VerifySigningCertificate",value:(t=i(regeneratorRuntime.mark((function e(){var t,r,a,n,i,s,u,o,l,c,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.XmlSignature||!this.Properties){e.next=34;break}if(1===(r=this.Properties.SignedProperties.SignedSignatureProperties).SigningCertificate.Count){e.next=5;break}throw new ke(ye.XML_EXCEPTION,"Signature has got wrong amount of SigningCertificate, MUST be one");case 5:a=DS.GetHashAlgorithm("SHA-256"),n=r.SigningCertificate.Item(0),i=Se.ToBase64(n.CertDigest.DigestValue),s=this.XmlSignature.KeyInfo,u=0;case 10:if(s.Count,t){e.next=32;break}if(!((o=s.Item(u))instanceof IS)){e.next=29;break}l=o.Certificates,c=0;case 15:if(l.length,t){e.next=29;break}if(h=l[c]){e.next=19;break}return e.abrupt("continue",26);case 19:return e.t0=Uint8Array,e.next=22,h.Thumbprint(a.algorithm);case 22:e.t1=e.sent,f=new e.t0(e.t1),Se.ToBase64(f)===i&&(t=h);case 26:c++,e.next=15;break;case 29:u++,e.next=10;break;case 32:if(t&&t.Issuer===n.IssuerSerial.X509IssuerName&&t.SerialNumber===n.IssuerSerial.X509SerialNumber){e.next=34;break}throw new ke(ye.XML_EXCEPTION,"SigningCertificate not found");case 34:return e.abrupt("return",t);case 35:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),d}(OS);return e.Application=Sw,e.Convert=Se,e.Parse=Ie,e.Select=Ee,e.SignedXml=bA,e.xml=wA,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
